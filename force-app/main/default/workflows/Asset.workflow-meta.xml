<?xml version="1.0" encoding="UTF-8"?>
<Workflow xmlns="http://soap.sforce.com/2006/04/metadata">
    <fieldUpdates>
        <fullName>Build_DI_Name_Field</fullName>
        <field>Name</field>
        <formula>TEXT(Product2.Product_Line_Global__c) 
&amp; IF (TEXT(Product2.Edition__c) = &quot;&quot;, &quot;&quot;, &quot; &quot; &amp; TEXT(Product2.Edition__c) ) 
&amp; IF (TEXT(Product2.Interface_Classification__c) = &quot;&quot;, &quot;&quot;, &quot; &quot; &amp; TEXT(Product2.Interface_Classification__c) ) 
&amp; IF (TEXT(Product2.Line_Classification_Global__c) = &quot;&quot;, &quot;&quot;, &quot; &quot; &amp; TEXT(Product2.Line_Classification_Global__c) ) 
&amp; IF (TEXT(Product2.Line_Subclassification_Global__c) = &quot;&quot;, &quot;&quot;, &quot; (&quot; &amp; TEXT(Product2.Line_Subclassification_Global__c) &amp; &quot;)&quot; ) 
&amp; 
/* IF the Productâ€™s Classification is NOT NULL, THEN CONCATENATE &quot; - &lt;&lt;Classification&gt;&gt;&quot; */ 
IF (Product2.Classification__c &lt;&gt; &quot;&quot;, &quot; - &quot; &amp; Product2.Classification__c, &quot;&quot;) 
&amp; 
/* IF the Product Family = &quot;Support&quot; */ 
IF (TEXT(Product2.Family) = &quot;Support&quot;, 
/* IF Support Classification is NOT NULL, THEN CONCATENATE &quot;( &lt;&lt; SupportClassification&gt;&gt; Support)&quot;, ELSE CONCATENATE &quot; (Support)&quot; */ 
IF (TEXT(Product2.Support_Classification__c) &lt;&gt; &quot;&quot;, &quot; (&quot; &amp; TEXT(Product2.Support_Classification__c) &amp; &quot; Support)&quot;, &quot; (Support)&quot; ) 
/* ELSE No DI Support Classification) */ 
, &quot;&quot;)</formula>
        <name>Build DI Name Field</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>true</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Uncheck_Market_Vision</fullName>
        <field>Market_Vision__c</field>
        <literalValue>0</literalValue>
        <name>Uncheck Market Vision</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Literal</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Update_AccountId_DI_Index_Id</fullName>
        <description>NICC-013119</description>
        <field>AccountId_DIIndexID__c</field>
        <formula>CASESAFEID(AccountId) + CASESAFEID(Product2.DI_Index__r.Id)</formula>
        <name>Update AccountId &amp; DI Index Id</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Update_AccountId_ProductId</fullName>
        <description>Salesforce.com Change Request: NICC-009418

Update the AccountId &amp; ProductId field</description>
        <field>AccountId_ProductId__c</field>
        <formula>AccountId + Product2Id</formula>
        <name>Update AccountId &amp; ProductId</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Update_Asset_Write_History_Checkbox</fullName>
        <field>WriteHistory__c</field>
        <literalValue>1</literalValue>
        <name>Update Asset Write History Checkbox</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Literal</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Update_Purchase_Date</fullName>
        <field>Purchase_Date__c</field>
        <formula>InstallDate</formula>
        <name>Update Purchase Date</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Update_Quantity</fullName>
        <description>When the Quantity field does not equal Quantity Provisioned, update the Quantity to match.</description>
        <field>Quantity</field>
        <formula>Quantity_Provisioned__c</formula>
        <name>Update Quantity</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <rules>
        <fullName>Build DI Name</fullName>
        <actions>
            <name>Build_DI_Name_Field</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Conditionally constructs DI name based on related fields on Product2.</description>
        <formula>OR (
     ISNEW(),
     ISCHANGED(Name), 
     ISCHANGED(Product2Id)
)</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Quantity Provisioned Synchronization</fullName>
        <actions>
            <name>Update_Quantity</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Used to keep the standard &quot;Quantity&quot; field in sync with the &quot;Quantity Provisioned&quot; field (so that reports that reference the &quot;Quantity&quot; field will remain accurate.</description>
        <formula>Quantity &lt;&gt;  Quantity_Provisioned__c</formula>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Uncheck Market Vision</fullName>
        <actions>
            <name>Uncheck_Market_Vision</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Uncheck Market Vision checkbox when DI goes inactive.</description>
        <formula>AND (      ISPICKVAL(Status, &quot;Inactive&quot;),      Market_Vision__c = true  )</formula>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Update AccountId %26 DI Index Id</fullName>
        <actions>
            <name>Update_AccountId_DI_Index_Id</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>NICC-013119 - Populate the AccountId &amp; DI Index Id field.</description>
        <formula>AND (     ISNEW(),      NOT(ISBLANK(AccountId)),     NOT(ISBLANK(Product2.DI_Index__r.Id)) ) || AND (     ISCHANGED(Product2Id),      NOT(ISBLANK(AccountId)),      NOT(ISBLANK(Product2.DI_Index__r.Id)) ) || AND (     ISCHANGED(DI_Index_Name__c),      NOT(ISBLANK(AccountId)),     NOT(ISBLANK(Product2Id)) )</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Update AccountId %26 ProductId</fullName>
        <actions>
            <name>Update_AccountId_ProductId</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Salesforce.com Change Request: NICC-009418

Populate the AccountId &amp; ProductId field</description>
        <formula>AND (
    ISNEW(), 
    NOT(ISBLANK(AccountId)),
    NOT(ISBLANK(Product2Id))
)
||
AND (
    ISCHANGED(Product2Id), 
    NOT(ISBLANK(AccountId)), 
    NOT(ISBLANK(Product2Id))
)</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Update Asset Write History Checkbox</fullName>
        <actions>
            <name>Update_Asset_Write_History_Checkbox</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <formula>AND (
     NOT (
        ISNEW()
    ), 
    OR (
        ISCHANGED(Name),
        ISCHANGED(Annual_Subscription_Amount__c), 
        ISCHANGED(Cendyn_Location_ID__c), 
        ISCHANGED(InstallDate), 
        ISCHANGED(IsHostedDI__c), 
        ISCHANGED(MeetingMatrix_Product_Key__c), 
        ISCHANGED(Product2Id), 
        ISCHANGED(Purchase_Date__c), 
        ISCHANGED(Quantity_Billed__c), 
        ISCHANGED(Quantity_Ordered__c), 
        ISCHANGED(Quantity_Provisioned__c), 
        ISCHANGED(Ship_Date__c), 
        ISCHANGED(Status), 
        ISCHANGED(Usage_End_Date__c), 
        ISCHANGED(Product_Group__c), 
        ISCHANGED(Product_Line__c), 
        ISCHANGED(Version__c), 
        ISCHANGED(Market_Vision__c) 
    ) 
)</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Update Purchase Date</fullName>
        <actions>
            <name>Update_Purchase_Date</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Set Purchase Date = Install Date when Purchase Date &gt; Install Date.</description>
        <formula>Purchase_Date__c  &gt;  InstallDate</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
</Workflow>
