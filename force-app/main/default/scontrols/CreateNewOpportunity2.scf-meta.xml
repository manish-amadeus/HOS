<?xml version="1.0" encoding="UTF-8"?>
<Scontrol xmlns="http://soap.sforce.com/2006/04/metadata">
    <contentSource>HTML</contentSource>
    <encodingKey>UTF-8</encodingKey>
    <fileContent>Ly8gU0ZPUkNFQ0xJRU5ULkpTCi8qIDEvMjMvMjAwNiAKICogQ29weXJpZ2h0IChjKSAyMDA1LCBzYWxlc2ZvcmNlLmNvbSwgaW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiAKICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0IG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCAKICogdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKICogCiAqICAgIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSAKICogICAgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAqICAKICogICAgUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgCiAqICAgIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4gCiAqICAgIAogKiAgICBOZWl0aGVyIHRoZSBuYW1lIG9mIHNhbGVzZm9yY2UuY29tLCBpbmMuIG5vciB0aGUgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIAogKiAgICBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLgogKiAgCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCAKICogV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIAogKiBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgT1dORVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgCiAqIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgCiAqIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSAKICogSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcgCiAqIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSAKICogUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiAqLwovKiogCiAqIEBmaWxlb3ZlcnZpZXcgVGhlIHNmb3JjZWNsaWVudC5qcyBmaWxlIGlzIHRoZSBtYWluIGludGVyZmFjZSBmb3IgdXNpbmcKICogdGhlIHNmb3JjZSBBUEkgZnJvbSBqYXZhc2NyaXB0LiAgTW9zdCBvZiB0aGUgbWV0aG9kcyBleHBvc2VkIGluIHRoaXMgZmlsZQogKiB2ZXJ5IGNsb3NlbHkgbWF0Y2ggdGhlIGludGVyZmFjZXMgZGVzY3JpYmVkIGZvciBpbiB0aGUgc2ZvcmNlIEFQSSBkb2N1bWVudGF0aW9uCiAqIGZvciB0aGUgd2ViIHNlcnZpY2UuICBJdCB3aWxsIGJlIG5vdGVkIHdoZXJlIHRoZSB0d28gaW50ZXJmYWNlcyBkaXZlcmdlLgogKiB7QGxpbmsgaHR0cDovL3d3dy5zZm9yY2UuY29tL3Jlc291cmNlcy9hcGkuanNwIFNmb3JjZSBBUEkgRG9jdW1lbnRhdGlvbn0KICoKICovClNmb3JjZSA9IGZ1bmN0aW9uKCkgewoJdGhpcy5jbGFzc05hbWUgPSAiU2ZvcmNlIjsKfTsKU2ZvcmNlLnJlYWR5ID0gdHJ1ZTsKU2ZvcmNlLmhhdmVCcm93c2VyU3VwcG9ydCA9IGZhbHNlOwoKaWYgKHdpbmRvdyAmJiB3aW5kb3cuZG9jdW1lbnQpIHsKCS8vZ2V0IHRoZSByZXN0IG9mIGpzIGZpbGVzCglTZm9yY2UucmVhZHkgPSBmYWxzZTsKCXZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXTsKCXZhciBjTm9kZXMgPSBoZWFkLmNoaWxkTm9kZXM7Cgl2YXIgaW5jbHVkZUJyb3dzZXIgPSBmYWxzZTsKCWdldFRoaXNQYXRoID0gZnVuY3Rpb24oKSB7CgkJZm9yICh2YXIgaT0wO2k8Y05vZGVzLmxlbmd0aDtpKyspIHsKCQkJaWYgKGNOb2Rlc1tpXS5ub2RlVHlwZSAhPSAzICYmIGNOb2Rlc1tpXS5ub2RlVHlwZSAhPSA4KSB7CgkJCQlpZiAoY05vZGVzW2ldLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PSAic2NyaXB0IiApIHsKCQkJCQlpZiAoY05vZGVzW2ldLnNyYy5pbmRleE9mKCJzZm9yY2VjbGllbnQuanMiKSA+IC0xKSB7CgkJCQkJCWlmIChjTm9kZXNbaV0uc3JjLmluZGV4T2YoImJyb3dzZXI9dHJ1ZSIpID4gLTEpCgkJCQkJCQlpbmNsdWRlQnJvd3NlciA9IHRydWU7CgkJCQkJCXJldHVybiBjTm9kZXNbaV0uc3JjLnN1YnN0cmluZygwLCBjTm9kZXNbaV0uc3JjLmluZGV4T2YoInNmb3JjZWNsaWVudC5qcyIpKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIG51bGw7Cgl9CglnZXRUYWcgPSBmdW5jdGlvbiAodGFnTmFtZSwgZmlsZU5hbWUpIHsKCQlmb3IgKHZhciBpPTA7aTxjTm9kZXMubGVuZ3RoO2krKykgewoJCQlpZiAoY05vZGVzW2ldLm5vZGVUeXBlICE9IDMgJiYgY05vZGVzW2ldLm5vZGVUeXBlICE9IDgpIHsKCQkJCWlmIChjTm9kZXNbaV0udGFnTmFtZS50b0xvd2VyQ2FzZSgpID09IHRhZ05hbWUudG9Mb3dlckNhc2UoKSkgewoJCQkJCWlmIChjTm9kZXNbaV0uc3JjICE9IHVuZGVmaW5lZCkgewoJCQkJCQl2YXIgZmlsZVBhdGggPSBjTm9kZXNbaV0uc3JjOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXZhciBmaWxlUGF0aCA9IGNOb2Rlc1tpXS5ocmVmOwoJCQkJCX0KCQkJCQlpZiAoZmlsZVBhdGguaW5kZXhPZihmaWxlTmFtZSkgPiAtMSkgewoJCQkJCQlyZXR1cm4gY05vZGVzW2ldOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQlyZXR1cm4gbnVsbDsKCX0KCWFkZEhlYWRUYWcgPSBmdW5jdGlvbih0YWdOYW1lLCBmaWxlTmFtZSwgdXNlU291cmNlLCB0eXBlLCByZWwpIHsKCQl2YXIgcGF0aCA9IHNyYzsKCQl2YXIgaXNMaW5rID0gZmFsc2U7CgkJaWYgKHRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PSAibGluayIpIHsKCQkJcGF0aCArPSAiY3NzLyI7CgkJCWlzTGluayA9IHRydWU7CgkJfQoJCWlmICh1c2VTb3VyY2UgPT0gdHJ1ZSkgewoJCQlwYXRoID0gcGF0aCArIGZpbGVOYW1lOwoJCX0gZWxzZSB7CgkJCXBhdGggPSBmaWxlTmFtZTsKCQl9CgkJdmFyIHRhZyA9IGdldFRhZyh0YWdOYW1lLCBmaWxlTmFtZSk7CgkJaWYgKHRhZyA9PSBudWxsKSB7CgkJCXZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKTsKCQkJaWYgKGlzTGluayA9PSB0cnVlKSB7CgkJCQlzLmhyZWYgPSBwYXRoOwoJCQl9IGVsc2UgewoJCQkJcy5zcmMgPSBwYXRoOwoJCQl9CgkJCXMudHlwZSA9IHR5cGU7CgkJCWlmIChyZWwgIT0gdW5kZWZpbmVkKSB7CgkJCQlzLnJlbCA9IHJlbDsKCQkJfQoJCQloZWFkLmFwcGVuZENoaWxkKHMpCgkJfQoJfQoJCSAKCXZhciBzcmMgPSBnZXRUaGlzUGF0aCgpOwoJaWYgKGluY2x1ZGVCcm93c2VyID09IHRydWUpIHsKCQlhZGRIZWFkVGFnKCJzY3JpcHQiLCAiYnJvd3NlcnN1cHBvcnQuanMiLCB0cnVlLCAidGV4dC9qYXZhc2NyaXB0Iik7CgkJYWRkSGVhZFRhZygibGluayIsICJjYWxlbmRhci5jc3MiLCB0cnVlLCAidGV4dC9jc3MiLCAic3R5bGVzaGVldCIpOwoJCS8vYWRkSGVhZFRhZygibGluayIsICJodHRwczovL25hMS5zYWxlc2ZvcmNlLmNvbS9jc3MvaWVfZ2xvYmFsLmNzcyIgLCBmYWxzZSwgInRleHQvY3NzIiwgInN0eWxlc2hlZXQiKTsKCX0gZWxzZSB7CgkJU2ZvcmNlLnJlYWR5ID0gdHJ1ZTsKCX0KfQoKT2JqZWN0LmdldFR5cGUgPWZ1bmN0aW9uKGluc3RhbmNlKXtyZXR1cm4gaW5zdGFuY2UuY29uc3RydWN0b3I7fQpPYmplY3QuX3R5cGVOYW1lID0nT2JqZWN0JzsKT2JqZWN0LmNsYXNzTmFtZSA9ICdPYmplY3QnOwpBcnJheS5jbGFzc05hbWUgPSAnQXJyYXknOwpTZm9yY2UuVXRpbCA9IGZ1bmN0aW9uKCkgewoJdGhpcy5jbGFzc05hbWUgPSAiVXRpbCI7Cn07ClNmb3JjZS5VdGlsLnByb3RvdHlwZSA9IG5ldyBGdW5jdGlvbjsKICAgIFNmb3JjZS5VdGlsLkZyb21Jc29EYXRlVGltZSA9IGZ1bmN0aW9uKEN1ckRhdGUpIHsvKiBTZXQgdGhlIGZyYWdtZW50IGV4cHJlc3Npb25zKi92YXIgUyA9ICJbXFwtLzouXSI7dmFyIFlyID0gIigoPzoxWzYtOV18WzItOV1bMC05XSlbMC05XXsyfSkiO3ZhciBNbyA9IFMgKyAiKCg/OjFbMDEyXSl8KD86MFsxLTldKXxbMS05XSkiO3ZhciBEeSA9IFMgKyAiKCg/OjNbMDFdKXwoPzpbMTJdWzAtOV0pfCg/OjBbMS05XSl8WzEtOV0pIjt2YXIgSHIgPSAiKDJbMC00XXxbMDFdP1swLTldKSI7dmFyIE1uID0gUyArICIoWzAtNV0/WzAtOV0pIjt2YXIgU2QgPSAiKD86IiArIFMgKyAiKFswLTVdP1swLTldKSg/OlsuLF0oWzAtOV0rKSk/KT8iO3ZhciBUWiA9ICIoPzooWil8KD86KFtcK1wtXSkoMVswMTJdfFswXT9bMC05XSkoPzo6PyhbMC01XT9bMC05XSkpPykpPyI7LyogUmVnRXggdGhlIGlucHV0Ki8vKiBGaXJzdCBjaGVjazogSnVzdCBkYXRlIHBhcnRzIChtb250aCBhbmQgZGF5IGFyZSBvcHRpb25hbCkqLy8qIFNlY29uZCBjaGVjazogRnVsbCBkYXRlIHBsdXMgdGltZSAoc2Vjb25kcywgbWlsbGlzZWNvbmRzIGFuZCBUaW1lWm9uZSBpbmZvIGFyZSBvcHRpb25hbCkqL3ZhciBURjtpZiAoIFRGID0gbmV3IFJlZ0V4cCgiXiIgKyBZciArICIoPzoiICsgTW8gKyAiKD86IiArIER5ICsgIik/KT8iICsgIiQiKS5leGVjKEN1ckRhdGUpICkge30gZWxzZSBpZiAoIFRGID0gbmV3IFJlZ0V4cCgiXiIgKyBZciArIE1vICsgRHkgKyAiVCIgKyBIciArIE1uICsgU2QgKyBUWiArICIkIikuZXhlYyhDdXJEYXRlKSApIHt9Oy8qIElmIHRoZSBkYXRlIGNvdWxkbid0IGJlIHBhcnNlZCwgcmV0dXJuIG51bGwqL2lmICggIVRGICkge3JldHVybiBudWxsO307LyogRGVmYXVsdCB0aGUgVGltZSBGcmFnbWVudHMgaWYgdGhleSdyZSBub3QgcHJlc2VudCovaWYgKCAhVEZbMl0gKSB7IFRGWzJdID0gMTsgfSBlbHNlIHsgVEZbMl0gPSBURlsyXSAtIDEgfTtpZiAoICFURlszXSApIHsgVEZbM10gPSAxOyB9O2lmICggIVRGWzRdICkgeyBURls0XSA9IDA7IH07aWYgKCAhVEZbNV0gKSB7IFRGWzVdID0gMDsgfTtpZiAoICFURls2XSApIHsgVEZbNl0gPSAwOyB9O2lmICggIVRGWzddICkgeyBURls3XSA9IDA7IH07aWYgKCAhVEZbOF0gKSB7IFRGWzhdID0gbnVsbCB9O2lmICggVEZbOV0gIT0gIi0iICYmIFRGWzldICE9ICIrIiApIHsgVEZbOV0gPSBudWxsOyB9O2lmICggIVRGWzEwXSApIHsgVEZbMTBdID0gMDsgfSBlbHNlIHsgVEZbMTBdID0gVEZbOV0gKyBURlsxMF07IH07aWYgKCAhVEZbMTFdICkgeyBURlsxMV0gPSAwOyB9IGVsc2UgeyBURlsxMV0gPSBURls5XSArIFRGWzExXTsgfTsvKiBJZiB0aGVyZSdzIG5vIHRpbWV6b25lIGluZm8gdGhlIGRhdGEgaXMgbG9jYWwgdGltZSovaWYgKCAhVEZbOF0gJiYgIVRGWzldICkge3JldHVybiBuZXcgRGF0ZShURlsxXSwgVEZbMl0sIFRGWzNdLCBURls0XSwgVEZbNV0sIFRGWzZdLCBURls3XSk7fTsvKiBJZiB0aGUgVVRDIGluZGljYXRvciBpcyBzZXQgdGhlIGRhdGUgaXMgVVRDKi9pZiAoIFRGWzhdID09ICJaIiApIHtyZXR1cm4gbmV3IERhdGUoRGF0ZS5VVEMoVEZbMV0sIFRGWzJdLCBURlszXSwgVEZbNF0sIFRGWzVdLCBURls2XSwJVEZbN10pKTt9Oy8qIElmIHRoZSBkYXRlIGhhcyBhIHRpbWV6b25lIG9mZnNldCAqL2lmICggVEZbOV0gPT0gIi0iIHx8IFRGWzldID09ICIrIiApIHsvKiBHZXQgY3VycmVudCBUaW1lem9uZSBpbmZvcm1hdGlvbiovdmFyIEN1clRaID0gbmV3IERhdGUoKS5nZXRUaW1lem9uZU9mZnNldCgpO3ZhciBDdXJUWmggPSBURlsxMF0gLSAoKEN1clRaID49IDAgPyAiLSIgOiAiKyIpICsgTWF0aC5mbG9vcihNYXRoLmFicyhDdXJUWikgLyA2MCkpO3ZhciBDdXJUWm0gPSBURlsxMV0gLSAoKEN1clRaID49IDAgPyAiLSIgOiAiKyIpICsgKE1hdGguYWJzKEN1clRaKSAlIDYwKSk7LyogUmV0dXJuIHRoZSBkYXRlKi9yZXR1cm4gbmV3IERhdGUoVEZbMV0sIFRGWzJdLCBURlszXSwgVEZbNF0gLSBDdXJUWmgsIFRGWzVdIC0gQ3VyVFptLCBURls2XSwgVEZbN10pO307fTsgCiAgICBTZm9yY2UuVXRpbC5DYWxjT2Zmc2V0ID0gZnVuY3Rpb24odGhlRGF0ZSkge3ZhciB0b2RheSA9IHRoZURhdGU7dmFyIHllYXIgID0gdG9kYXkuZ2V0RnVsbFllYXIoKTt2YXIgaG91ciA9IHRvZGF5LmdldEhvdXJzKCk7dmFyIGhvdXJVVEMgPSB0b2RheS5nZXRVVENIb3VycygpO3ZhciBkaWZmID0gaG91ciAtIGhvdXJVVEM7dmFyIGhvdXJkaWZmZXJlbmNlID0gTWF0aC5hYnMoZGlmZik7dmFyIG1pbnV0ZSA9IHRvZGF5LmdldE1pbnV0ZXMoKTt2YXIgbWludXRlVVRDID0gdG9kYXkuZ2V0VVRDTWludXRlcygpO3ZhciBtaW51dGVkaWZmZXJlbmNlO2lmIChtaW51dGUgIT0gbWludXRlVVRDICYmIG1pbnV0ZVVUQyA8IDMwICYmIGRpZmYgPCAwKSB7IGhvdXJkaWZmZXJlbmNlLS07IH1pZiAobWludXRlICE9IG1pbnV0ZVVUQyAmJiBtaW51dGVVVEMgPiAzMCAmJiBkaWZmID4gMCkgeyBob3VyZGlmZmVyZW5jZS0tOyB9aWYgKG1pbnV0ZSAhPSBtaW51dGVVVEMpIHsJbWludXRlZGlmZmVyZW5jZSA9IDMwO30gZWxzZSB7bWludXRlZGlmZmVyZW5jZSA9IDA7fWlmIChkaWZmIDwgMCkge3JldHVybiAoKGhvdXJkaWZmZXJlbmNlICogNjApICsgbWludXRlZGlmZmVyZW5jZSkgKiAtMTt9IGVsc2Uge3JldHVybiAoaG91cmRpZmZlcmVuY2UgKiA2MCkgKyBtaW51dGVkaWZmZXJlbmNlfX07CiAgICBTZm9yY2UuVXRpbC5Ub0lzb0RhdGUgPSBmdW5jdGlvbih0aGVEYXRlKSB7CQogICAgICAgIHZhciByZXR1cm5TdHJpbmcgPSB0aGVEYXRlLmdldEZ1bGxZZWFyKCk7CQogICAgICAgIHJldHVyblN0cmluZyArPSAiLSIgKyAodGhlRGF0ZS5nZXRNb250aCgpICsgMSkudG9TdHJpbmcoKS5wYWRMZWZ0KCIwIiwgMik7CQogICAgICAgIHJldHVyblN0cmluZyArPSAiLSIgKyAodGhlRGF0ZS5nZXREYXRlKCkpLnRvU3RyaW5nKCkucGFkTGVmdCgiMCIsIDIpOwkKICAgICAgICByZXR1cm4gcmV0dXJuU3RyaW5nOwogICAgfTsKICAgIC8qKgogICAgICogMy8xLzIwMDYgREpDIC0gRml4ZWQgZGF0ZSBjYWxjdWxhdGlvbiB0byBwcm9wZWx5IGNhbGN1bGF0ZSBkYXRlIGFuZCB0aW1lIGZvciB6b25lcyBpbiBBdXN0cmFsaWEKICAgICAqIENvbnRyaWJ1dGlvbiBmcm9tIEFsdGl1bQogICAgKi8KICAgIFNmb3JjZS5VdGlsLlRvSXNvRGF0ZVRpbWUgPSBmdW5jdGlvbih0aGVEYXRlKSB7CgkgICAgdmFyIHRvZGF5ID0gdGhlRGF0ZTsKCSAgICB2YXIgeWVhciAgPSB0aGVEYXRlLmdldEZ1bGxZZWFyKCk7CgkgICAgdmFyIG1vbnRoID0gdGhlRGF0ZS5nZXRNb250aCgpICsgMTsKCSAgICB2YXIgZGF5ICA9IHRoZURhdGUuZ2V0RGF0ZSgpOwoJICAgIHZhciBob3VyID0gdGhlRGF0ZS5nZXRIb3VycygpOwoJICAgIHZhciBob3VyVVRDID0gdGhlRGF0ZS5nZXRVVENIb3VycygpOwoJICAgIHZhciBtaW51dGUgPSB0aGVEYXRlLmdldE1pbnV0ZXMoKTsKCSAgICB2YXIgbWludXRlVVRDID0gdGhlRGF0ZS5nZXRVVENNaW51dGVzKCk7CgkgICAgdmFyIHNlY29uZCA9IHRoZURhdGUuZ2V0U2Vjb25kcygpOwoKICAgICAgICAvKm5ldyBmdW5jdGlvbmFsaXR5IHRvIGVuc3VyZSBjb3JyZWN0IHRpbWV6b25lIDMvMS8yMDA2IC0gY291cnRlc3kgb2YgQWx0aXVtICovCiAgICAgICAgdmFyIHV0Y0RhdGVJbnQgPSAoMTAwMDAqdGhlRGF0ZS5nZXRVVENGdWxsWWVhcigpKSArICgxMDAqdGhlRGF0ZS5nZXRVVENNb250aCgpKSArICh0aGVEYXRlLmdldFVUQ0RhdGUoKSk7CiAgICAgICAgdmFyIHRoZURhdGVJbnQgPSAoMTAwMDAqdGhlRGF0ZS5nZXRGdWxsWWVhcigpKSArICgxMDAqdGhlRGF0ZS5nZXRNb250aCgpKSArICh0aGVEYXRlLmdldERhdGUoKSk7CiAgICAgICAgCiAgICAgICAgdmFyIGRheURpZmZlcmVuY2UgPSB0aGVEYXRlSW50IC0gdXRjRGF0ZUludAogICAgICAgIGlmIChkYXlEaWZmZXJlbmNlICE9IDApIHsgZGF5RGlmZmVyZW5jZSA9IGRheURpZmZlcmVuY2UgLyBNYXRoLmFicyhkYXlEaWZmZXJlbmNlKTsgfSAvL2Vuc3VyZSB3ZSBnZXQgZWl0aGVyIDAsMSBvciAtMQogICAgICAgIAogICAgICAgIHZhciBkaWZmID0gKGhvdXIgKyAoZGF5RGlmZmVyZW5jZSAqIDI0KSkgLSBob3VyVVRDOwoKCSAgICB2YXIgaG91cmRpZmZlcmVuY2UgPSBNYXRoLmFicyhkaWZmKTsKCSAgICB2YXIgbWludXRlZGlmZmVyZW5jZSA9IE1hdGguYWJzKG1pbnV0ZSAtIG1pbnV0ZVVUQyk7CiAgICAJCgkgICAgaWYgKGhvdXJkaWZmZXJlbmNlICsgbWludXRlZGlmZmVyZW5jZSA9PSAwKSB7CgkJICAgIHRpbWV6b25lID0gIloiOwoJICAgIH0gZWxzZSB7CgkJICAgIGlmIChkaWZmID4gMCkgewoJCQkgICAgdmFyIHBtID0gIisiOwoJCSAgICB9IGVsc2UgewoJCQkgICAgdmFyIHBtID0gIi0iOwoJCSAgICB9CgkJICAgIGlmIChtaW51dGVkaWZmZXJlbmNlIDwgMTApIHsKCQkJICAgIG1pbnV0ZWRpZmZlcmVuY2UgPSAiMCIgKyBtaW51dGVkaWZmZXJlbmNlOwoJCSAgICB9CgkJICAgIGlmIChob3VyZGlmZmVyZW5jZSA8IDEwKSB7IAoJCQkgICAgdGltZXpvbmUgPSBwbSArICIwIiArIGhvdXJkaWZmZXJlbmNlICsgIjoiICsgbWludXRlZGlmZmVyZW5jZTsKCQkgICAgfSBlbHNlIHsKCQkJICAgIHRpbWV6b25lID0gcG0gKyBob3VyZGlmZmVyZW5jZSArICI6IiArIG1pbnV0ZWRpZmZlcmVuY2U7CgkJICAgIH0KCSAgICB9CiAgICAJCgkgICAgaWYgKG1vbnRoIDw9IDkpIG1vbnRoID0gIjAiICsgbW9udGg7CgkgICAgaWYgKGRheSA8PSA5KSBkYXkgPSAiMCIgKyBkYXk7CgkgICAgaWYgKGhvdXIgPD0gOSkgaG91ciA9ICIwIiArIGhvdXI7CgkgICAgaWYgKG1pbnV0ZSA8PSA5KSBtaW51dGUgPSAiMCIgKyBtaW51dGU7CgkgICAgaWYgKHNlY29uZCA8PSA5KSBzZWNvbmQgPSAiMCIgKyBzZWNvbmQ7CiAgICAJCgkgICAgcmV0dXJuICB5ZWFyICsgIi0iICsgbW9udGggKyAiLSIgKyBkYXkgKyAiVCIgKyBob3VyICsgIjoiICsgbWludXRlICsgIjoiICsgc2Vjb25kICsgdGltZXpvbmU7CiAgICB9OwpTZm9yY2UuVXRpbC5Jc0RhdGUgPSBmdW5jdGlvbihwX0V4cHJlc3Npb24pewlyZXR1cm4gIWlzTmFOKG5ldyBEYXRlKHBfRXhwcmVzc2lvbikpO307ClNmb3JjZS5VdGlsLkRhdGVBZGQgPSBmdW5jdGlvbihwX0ludGVydmFsLCBwX051bWJlciwgcF9EYXRlKXtpZighU2ZvcmNlLlV0aWwuSXNEYXRlKHBfRGF0ZSkpe3JldHVybiAiaW52YWxpZCBkYXRlOiAnIiArIHBfRGF0ZSArICInIjt9aWYoaXNOYU4ocF9OdW1iZXIpKXtyZXR1cm4gImludmFsaWQgbnVtYmVyOiAnIiArIHBfTnVtYmVyICsgIiciO30JcF9OdW1iZXIgPSBuZXcgTnVtYmVyKHBfTnVtYmVyKTt2YXIgZHQgPSBuZXcgRGF0ZShwX0RhdGUpO3N3aXRjaChwX0ludGVydmFsLnRvTG93ZXJDYXNlKCkpe2Nhc2UgInl5eXkiOiB7ZHQuc2V0RnVsbFllYXIoZHQuZ2V0RnVsbFllYXIoKSArIHBfTnVtYmVyKTticmVhazt9Y2FzZSAicSI6IHtkdC5zZXRNb250aChkdC5nZXRNb250aCgpICsgKHBfTnVtYmVyKjMpKTticmVhazt9Y2FzZSAibSI6IHtkdC5zZXRNb250aChkdC5nZXRNb250aCgpICsgcF9OdW1iZXIpO2JyZWFrO31jYXNlICJ5IjpjYXNlICJkIjpjYXNlICJ3Ijoge2R0LnNldERhdGUoZHQuZ2V0RGF0ZSgpICsgcF9OdW1iZXIpO2JyZWFrO31jYXNlICJ3dyI6IHtkdC5zZXREYXRlKGR0LmdldERhdGUoKSArIChwX051bWJlcio3KSk7YnJlYWs7fWNhc2UgImgiOiB7ZHQuc2V0SG91cnMoZHQuZ2V0SG91cnMoKSArIHBfTnVtYmVyKTticmVhazt9Y2FzZSAibiI6IHtkdC5zZXRNaW51dGVzKGR0LmdldE1pbnV0ZXMoKSArIHBfTnVtYmVyKTticmVhazt9Y2FzZSAicyI6IHtkdC5zZXRTZWNvbmRzKGR0LmdldFNlY29uZHMoKSArIHBfTnVtYmVyKTticmVhazt9Y2FzZSAibXMiOiB7ZHQuc2V0TWlsbGlzZWNvbmRzKGR0LmdldE1pbGxpc2Vjb25kcygpICsgcF9OdW1iZXIpO2JyZWFrO31kZWZhdWx0OiB7cmV0dXJuICJpbnZhbGlkIGludGVydmFsOiAnIiArIHBfSW50ZXJ2YWwgKyAiJyI7fX1yZXR1cm4gZHQ7fTsKU2ZvcmNlLlV0aWwuR2V0RGF0ZUZyb21Gb3JtYXQgPSBmdW5jdGlvbih2YWwsZm9ybWF0KSB7dmFsPXZhbCsiIjtmb3JtYXQ9Zm9ybWF0KyIiO3ZhciBpX3ZhbD0wO3ZhciBpX2Zvcm1hdD0wO3ZhciBjPSIiO3ZhciB0b2tlbj0iIjt2YXIgdG9rZW4yPSIiO3ZhciB4LHk7dmFyIG5vdz1uZXcgRGF0ZSgpO3ZhciB5ZWFyPW5vdy5nZXRZZWFyKCk7dmFyIG1vbnRoPW5vdy5nZXRNb250aCgpKzE7dmFyIGRhdGU9MTt2YXIgaGg9bm93LmdldEhvdXJzKCk7dmFyIG1tPW5vdy5nZXRNaW51dGVzKCk7dmFyIHNzPW5vdy5nZXRTZWNvbmRzKCk7dmFyIGFtcG09IiI7d2hpbGUgKGlfZm9ybWF0IDwgZm9ybWF0Lmxlbmd0aCkge2M9Zm9ybWF0LmNoYXJBdChpX2Zvcm1hdCk7dG9rZW49IiI7d2hpbGUgKChmb3JtYXQuY2hhckF0KGlfZm9ybWF0KT09YykgJiYgKGlfZm9ybWF0IDwgZm9ybWF0Lmxlbmd0aCkpIHt0b2tlbiArPSBmb3JtYXQuY2hhckF0KGlfZm9ybWF0KyspO31pZiAodG9rZW49PSJ5eXl5IiB8fCB0b2tlbj09Inl5IiB8fCB0b2tlbj09InkiKSB7aWYgKHRva2VuPT0ieXl5eSIpIHsgeD00O3k9NDsgfWlmICh0b2tlbj09Inl5IikgICB7IHg9Mjt5PTI7IH1pZiAodG9rZW49PSJ5IikgICAgeyB4PTI7eT00OyB9eWVhcj1TZm9yY2UuVXRpbC5HZXRJbnQodmFsLGlfdmFsLHgseSk7aWYgKHllYXI9PW51bGwpIHsgcmV0dXJuIDA7IH1pX3ZhbCArPSB5ZWFyLmxlbmd0aDtpZiAoeWVhci5sZW5ndGg9PTIpIHtpZiAoeWVhciA+IDcwKSB7IHllYXI9MTkwMCsoeWVhci0wKTsgfWVsc2UgeyB5ZWFyPTIwMDArKHllYXItMCk7IH19fWVsc2UgaWYgKHRva2VuPT0iTU1NInx8dG9rZW49PSJOTk4iKXttb250aD0wO2ZvciAodmFyIGk9MDsgaTxTZm9yY2UuVXRpbC5NT05USF9OQU1FUy5sZW5ndGg7IGkrKykge3ZhciBtb250aF9uYW1lPVNmb3JjZS5VdGlsLk1PTlRIX05BTUVTW2ldO2lmICh2YWwuc3Vic3RyaW5nKGlfdmFsLGlfdmFsK21vbnRoX25hbWUubGVuZ3RoKS50b0xvd2VyQ2FzZSgpPT1tb250aF9uYW1lLnRvTG93ZXJDYXNlKCkpIHtpZiAodG9rZW49PSJNTU0ifHwodG9rZW49PSJOTk4iJiZpPjExKSkge21vbnRoPWkrMTtpZiAobW9udGg+MTIpIHsgbW9udGggLT0gMTI7IH1pX3ZhbCArPSBtb250aF9uYW1lLmxlbmd0aDticmVhazt9fX1pZiAoKG1vbnRoIDwgMSl8fChtb250aD4xMikpe3JldHVybiAwO319ZWxzZSBpZiAodG9rZW49PSJFRSJ8fHRva2VuPT0iRSIpe2ZvciAodmFyIGk9MDsgaTxTZm9yY2UuVXRpbC5EQVlfTkFNRVMubGVuZ3RoOyBpKyspIHt2YXIgZGF5X25hbWU9U2ZvcmNlLlV0aWwuREFZX05BTUVTW2ldO2lmICh2YWwuc3Vic3RyaW5nKGlfdmFsLGlfdmFsK2RheV9uYW1lLmxlbmd0aCkudG9Mb3dlckNhc2UoKT09ZGF5X25hbWUudG9Mb3dlckNhc2UoKSkge2lfdmFsICs9IGRheV9uYW1lLmxlbmd0aDticmVhazt9fX1lbHNlIGlmICh0b2tlbj09Ik1NInx8dG9rZW49PSJNIikge21vbnRoPVNmb3JjZS5VdGlsLkdldEludCh2YWwsaV92YWwsdG9rZW4ubGVuZ3RoLDIpO2lmKG1vbnRoPT1udWxsfHwobW9udGg8MSl8fChtb250aD4xMikpe3JldHVybiAwO31pX3ZhbCs9bW9udGgubGVuZ3RoO31lbHNlIGlmICh0b2tlbj09ImRkInx8dG9rZW49PSJkIikge2RhdGU9U2ZvcmNlLlV0aWwuR2V0SW50KHZhbCxpX3ZhbCx0b2tlbi5sZW5ndGgsMik7aWYoZGF0ZT09bnVsbHx8KGRhdGU8MSl8fChkYXRlPjMxKSl7cmV0dXJuIDA7fWlfdmFsKz1kYXRlLmxlbmd0aDt9ZWxzZSBpZiAodG9rZW49PSJoaCJ8fHRva2VuPT0iaCIpIHtoaD1TZm9yY2UuVXRpbC5HZXRJbnQodmFsLGlfdmFsLHRva2VuLmxlbmd0aCwyKTtpZihoaD09bnVsbHx8KGhoPDEpfHwoaGg+MTIpKXtyZXR1cm4gMDt9aV92YWwrPWhoLmxlbmd0aDt9ZWxzZSBpZiAodG9rZW49PSJISCJ8fHRva2VuPT0iSCIpIHtoaD1TZm9yY2UuVXRpbC5HZXRJbnQodmFsLGlfdmFsLHRva2VuLmxlbmd0aCwyKTtpZihoaD09bnVsbHx8KGhoPDApfHwoaGg+MjMpKXtyZXR1cm4gMDt9aV92YWwrPWhoLmxlbmd0aDt9ZWxzZSBpZiAodG9rZW49PSJLSyJ8fHRva2VuPT0iSyIpIHtoaD1TZm9yY2UuVXRpbC5HZXRJbnQodmFsLGlfdmFsLHRva2VuLmxlbmd0aCwyKTtpZihoaD09bnVsbHx8KGhoPDApfHwoaGg+MTEpKXtyZXR1cm4gMDt9aV92YWwrPWhoLmxlbmd0aDt9ZWxzZSBpZiAodG9rZW49PSJrayJ8fHRva2VuPT0iayIpIHtoaD1TZm9yY2UuVXRpbC5HZXRJbnQodmFsLGlfdmFsLHRva2VuLmxlbmd0aCwyKTtpZihoaD09bnVsbHx8KGhoPDEpfHwoaGg+MjQpKXtyZXR1cm4gMDt9aV92YWwrPWhoLmxlbmd0aDtoaC0tO31lbHNlIGlmICh0b2tlbj09Im1tInx8dG9rZW49PSJtIikge21tPVNmb3JjZS5VdGlsLkdldEludCh2YWwsaV92YWwsdG9rZW4ubGVuZ3RoLDIpO2lmKG1tPT1udWxsfHwobW08MCl8fChtbT41OSkpe3JldHVybiAwO31pX3ZhbCs9bW0ubGVuZ3RoO31lbHNlIGlmICh0b2tlbj09InNzInx8dG9rZW49PSJzIikge3NzPVNmb3JjZS5VdGlsLkdldEludCh2YWwsaV92YWwsdG9rZW4ubGVuZ3RoLDIpO2lmKHNzPT1udWxsfHwoc3M8MCl8fChzcz41OSkpe3JldHVybiAwO31pX3ZhbCs9c3MubGVuZ3RoO31lbHNlIGlmICh0b2tlbj09ImEiKSB7aWYgKHZhbC5zdWJzdHJpbmcoaV92YWwsaV92YWwrMikudG9Mb3dlckNhc2UoKT09ImFtIikge2FtcG09IkFNIjt9ZWxzZSBpZiAodmFsLnN1YnN0cmluZyhpX3ZhbCxpX3ZhbCsyKS50b0xvd2VyQ2FzZSgpPT0icG0iKSB7YW1wbT0iUE0iO31lbHNlIHtyZXR1cm4gMDt9aV92YWwrPTI7fWVsc2Uge2lmICh2YWwuc3Vic3RyaW5nKGlfdmFsLGlfdmFsK3Rva2VuLmxlbmd0aCkhPXRva2VuKSB7cmV0dXJuIDA7fWVsc2Uge2lfdmFsKz10b2tlbi5sZW5ndGg7fX19aWYgKGlfdmFsICE9IHZhbC5sZW5ndGgpIHsgcmV0dXJuIDA7IH1pZiAobW9udGg9PTIpIHtpZiAoICggKHllYXIlND09MCkmJih5ZWFyJTEwMCAhPSAwKSApIHx8ICh5ZWFyJTQwMD09MCkgKSB7IGlmIChkYXRlID4gMjkpeyByZXR1cm4gMDsgfX1lbHNlIHsgaWYgKGRhdGUgPiAyOCkgeyByZXR1cm4gMDsgfSB9fWlmICgobW9udGg9PTQpfHwobW9udGg9PTYpfHwobW9udGg9PTkpfHwobW9udGg9PTExKSkge2lmIChkYXRlID4gMzApIHsgcmV0dXJuIDA7IH19aWYgKGhoPDEyICYmIGFtcG09PSJQTSIpIHsgaGg9aGgtMCsxMjsgfWVsc2UgaWYgKGhoPjExICYmIGFtcG09PSJBTSIpIHsgaGgtPTEyOyB9dmFyIG5ld2RhdGU9bmV3IERhdGUoeWVhcixtb250aC0xLGRhdGUsaGgsbW0sc3MpO3JldHVybiBuZXdkYXRlLmdldFRpbWUoKTt9OwovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIEF1dGhvcjogTWF0dCBLcnVzZSA8bWF0dEBtYXR0a3J1c2UuY29tPgovLyBXV1c6IGh0dHA6Ly93d3cubWF0dGtydXNlLmNvbS8KLy8KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpTZm9yY2UuVXRpbC5NT05USF9OQU1FUz1uZXcgQXJyYXkoJ0phbnVhcnknLCdGZWJydWFyeScsJ01hcmNoJywnQXByaWwnLCdNYXknLCdKdW5lJywnSnVseScsJ0F1Z3VzdCcsJ1NlcHRlbWJlcicsJ09jdG9iZXInLCdOb3ZlbWJlcicsJ0RlY2VtYmVyJywnSmFuJywnRmViJywnTWFyJywnQXByJywnTWF5JywnSnVuJywnSnVsJywnQXVnJywnU2VwJywnT2N0JywnTm92JywnRGVjJyk7ClNmb3JjZS5VdGlsLkRBWV9OQU1FUz1uZXcgQXJyYXkoJ1N1bmRheScsJ01vbmRheScsJ1R1ZXNkYXknLCdXZWRuZXNkYXknLCdUaHVyc2RheScsJ0ZyaWRheScsJ1NhdHVyZGF5JywnU3VuJywnTW9uJywnVHVlJywnV2VkJywnVGh1JywnRnJpJywnU2F0Jyk7ClNmb3JjZS5VdGlsLkxaID0gZnVuY3Rpb24oeCkge3JldHVybih4PDB8fHg+OT8iIjoiMCIpK3h9ClNmb3JjZS5VdGlsLklzRGF0ZTIgPSBmdW5jdGlvbih2YWwsZm9ybWF0KSB7dmFyIGRhdGU9U2ZvcmNlLlV0aWwuR2V0RGF0ZUZyb21Gb3JtYXQodmFsLGZvcm1hdCk7aWYgKGRhdGU9PTApIHsgcmV0dXJuIGZhbHNlOyB9cmV0dXJuIHRydWU7fTsKU2ZvcmNlLlV0aWwuQ29tcGFyZURhdGVzID0gZnVuY3Rpb24oZGF0ZTEsZGF0ZWZvcm1hdDEsZGF0ZTIsZGF0ZWZvcm1hdDIpIHt2YXIgZDE9U2ZvcmNlLlV0aWwuR2V0RGF0ZUZyb21Gb3JtYXQoZGF0ZTEsZGF0ZWZvcm1hdDEpO3ZhciBkMj1TZm9yY2UuVXRpbC5HZXREYXRlRnJvbUZvcm1hdChkYXRlMixkYXRlZm9ybWF0Mik7aWYgKGQxPT0wIHx8IGQyPT0wKSB7cmV0dXJuIC0xO31lbHNlIGlmIChkMSA+IGQyKSB7cmV0dXJuIDE7fXJldHVybiAwO307ClNmb3JjZS5VdGlsLkZvcm1hdERhdGUgPSBmdW5jdGlvbihkYXRlLGZvcm1hdCkgewoJZm9ybWF0PWZvcm1hdCsiIjsKCXZhciByZXN1bHQ9IiI7Cgl2YXIgaV9mb3JtYXQ9MDsKCXZhciBjPSIiOwoJdmFyIHRva2VuPSIiOwoJdmFyIHk9ZGF0ZS5nZXRZZWFyKCkrIiI7Cgl2YXIgTT1kYXRlLmdldE1vbnRoKCkrMTsKCXZhciBkPWRhdGUuZ2V0RGF0ZSgpOwoJdmFyIEU9ZGF0ZS5nZXREYXkoKTsKCXZhciBIPWRhdGUuZ2V0SG91cnMoKTsKCXZhciBtPWRhdGUuZ2V0TWludXRlcygpOwoJdmFyIHM9ZGF0ZS5nZXRTZWNvbmRzKCk7Cgl2YXIgeXl5eSx5eSxNTU0sTU0sZGQsaGgsaCxtbSxzcyxhbXBtLEhILEgsS0ssSyxrayxrOwoJdmFyIHZhbHVlPW5ldyBPYmplY3QoKTsKCWlmICh5Lmxlbmd0aCA8IDQpIHsKCQl5ID0gIiIrKHktMCsxOTAwKTsKCX0gCgl2YWx1ZVsieSJdID0gIiIreTsKCXZhbHVlWyJ5eXl5Il0gPSB5OwoJdmFsdWVbInl5Il0gPSB5LnN1YnN0cmluZygyLDQpOwoJdmFsdWVbIk0iXSA9IE07Cgl2YWx1ZVsiTU0iXSA9IFNmb3JjZS5VdGlsLkxaKE0pOwoJdmFsdWVbIk1NTSJdID0gU2ZvcmNlLlV0aWwuTU9OVEhfTkFNRVNbTS0xXTsKCXZhbHVlWyJOTk4iXSA9IFNmb3JjZS5VdGlsLk1PTlRIX05BTUVTW00rMTFdOwoJdmFsdWVbImQiXSA9IGQ7Cgl2YWx1ZVsiZGQiXSA9IFNmb3JjZS5VdGlsLkxaKGQpOwoJdmFsdWVbIkUiXSA9IFNmb3JjZS5VdGlsLkRBWV9OQU1FU1tFKzddOwoJdmFsdWVbIkVFIl0gPSBTZm9yY2UuVXRpbC5EQVlfTkFNRVNbRV07Cgl2YWx1ZVsiSCJdID0gSDsKCXZhbHVlWyJISCJdID0gU2ZvcmNlLlV0aWwuTFooSCk7CglpZiAoSD09MCl7CgkJdmFsdWVbImgiXT0xMjsKCX0gZWxzZSBpZiAoSD4xMil7CgkJdmFsdWVbImgiXSA9IEgtMTI7Cgl9IGVsc2UgewoJCXZhbHVlWyJoIl0gPSBIOwoJfQoJdmFsdWVbImhoIl09U2ZvcmNlLlV0aWwuTFoodmFsdWVbImgiXSk7CglpZiAoSD4xMSl7CgkJdmFsdWVbIksiXT1ILTEyOwoJfSBlbHNlIHsKCQl2YWx1ZVsiSyJdPUg7Cgl9Cgl2YWx1ZVsiayJdPUgrMTsKCXZhbHVlWyJLSyJdPVNmb3JjZS5VdGlsLkxaKHZhbHVlWyJLIl0pOwoJdmFsdWVbImtrIl09U2ZvcmNlLlV0aWwuTFoodmFsdWVbImsiXSk7CglpZiAoSCA+IDExKSB7IAoJCXZhbHVlWyJhIl09IlBNIjsgCgl9IGVsc2UgeyAKCQl2YWx1ZVsiYSJdPSJBTSI7IAoJfQoJdmFsdWVbIm0iXSA9IG07Cgl2YWx1ZVsibW0iXSA9IFNmb3JjZS5VdGlsLkxaKG0pOwoJdmFsdWVbInMiXT1zOwoJdmFsdWVbInNzIl09U2ZvcmNlLlV0aWwuTFoocyk7Cgl3aGlsZSAoaV9mb3JtYXQgPCBmb3JtYXQubGVuZ3RoKSB7CgkJYz1mb3JtYXQuY2hhckF0KGlfZm9ybWF0KTsKCQl0b2tlbj0iIjsKCQl3aGlsZSAoKGZvcm1hdC5jaGFyQXQoaV9mb3JtYXQpPT1jKSAmJiAoaV9mb3JtYXQgPCBmb3JtYXQubGVuZ3RoKSkgewoJCQl0b2tlbiArPSBmb3JtYXQuY2hhckF0KGlfZm9ybWF0KyspOwoJCX0KCQlpZiAodmFsdWVbdG9rZW5dICE9IG51bGwpIHsgCgkJCXJlc3VsdD1yZXN1bHQgKyB2YWx1ZVt0b2tlbl07IAoJCX0gZWxzZSB7IAoJCQlyZXN1bHQ9cmVzdWx0ICsgdG9rZW47IAoJCX0KCX0KCXJldHVybiByZXN1bHQ7Cn07ClNmb3JjZS5VdGlsLklzSW50ZWdlciA9IGZ1bmN0aW9uKHZhbCkge3ZhciBkaWdpdHM9IjEyMzQ1Njc4OTAiO2ZvciAodmFyIGk9MDsgaSA8IHZhbC5sZW5ndGg7IGkrKykge2lmIChkaWdpdHMuaW5kZXhPZih2YWwuY2hhckF0KGkpKT09LTEpIHsgcmV0dXJuIGZhbHNlOyB9fXJldHVybiB0cnVlO307ClNmb3JjZS5VdGlsLkdldEludCA9IGZ1bmN0aW9uKHN0cixpLG1pbmxlbmd0aCxtYXhsZW5ndGgpIHtmb3IgKHZhciB4PW1heGxlbmd0aDsgeD49bWlubGVuZ3RoOyB4LS0pIHt2YXIgdG9rZW49c3RyLnN1YnN0cmluZyhpLGkreCk7aWYgKHRva2VuLmxlbmd0aCA8IG1pbmxlbmd0aCkgeyByZXR1cm4gbnVsbDsgfWlmIChTZm9yY2UuVXRpbC5Jc0ludGVnZXIodG9rZW4pKSB7IHJldHVybiB0b2tlbjsgfX1yZXR1cm4gbnVsbDt9OwpTZm9yY2UuVXRpbC5QYXJzZURhdGUgPSBmdW5jdGlvbih2YWwpIHsKCWlmIChTZm9yY2UuVXRpbC5kbHR5cGVvZih2YWwpID09ICJkYXRlIikgcmV0dXJuIHZhbDsKCXZhciBwcmVmZXJFdXJvPShhcmd1bWVudHMubGVuZ3RoPT0yKT9hcmd1bWVudHNbMV06ZmFsc2U7CglnZW5lcmFsRm9ybWF0cz1uZXcgQXJyYXkoJ3ktTS1kJywnTU1NIGQsIHknLCdNTU0gZCx5JywneS1NTU0tZCcsJ2QtTU1NLXknLCdNTU0gZCcpOwoJbW9udGhGaXJzdD1uZXcgQXJyYXkoJ00vZC95JywnTS1kLXknLCdNLmQueScsJ01NTS1kJywnTS9kJywnTS1kJyk7CglkYXRlRmlyc3QgPW5ldyBBcnJheSgnZC9NL3knLCdkLU0teScsJ2QuTS55JywnZC1NTU0nLCdkL00nLCdkLU0nKTsKCXZhciBjaGVja0xpc3Q9bmV3IEFycmF5KGdlbmVyYWxGb3JtYXRzLHByZWZlckV1cm8/ZGF0ZUZpcnN0Om1vbnRoRmlyc3QscHJlZmVyRXVybz9tb250aEZpcnN0OmRhdGVGaXJzdCk7dmFyIGQ9bnVsbDtmb3IgKHZhciBpPTA7IGk8Y2hlY2tMaXN0Lmxlbmd0aDsgaSsrKSB7dmFyIGw9Y2hlY2tMaXN0W2ldO2ZvciAodmFyIGo9MDsgajxsLmxlbmd0aDsgaisrKSB7ZD1TZm9yY2UuVXRpbC5HZXREYXRlRnJvbUZvcm1hdCh2YWwsbFtqXSk7aWYgKGQhPTApIHsgcmV0dXJuIG5ldyBEYXRlKGQpOyB9fX1yZXR1cm4gbnVsbDt9CgpCb29sZWFuLnBhcnNlID0gZnVuY3Rpb24odmFsdWUpe2lmICh0eXBlb2YodmFsdWUpPT0nc3RyaW5nJyl7cmV0dXJuICh2YWx1ZS50b0xvd2VyQ2FzZSgpPT0ndHJ1ZScpO31yZXR1cm4gdmFsdWUgP3RydWUgOmZhbHNlO30KTnVtYmVyLnBhcnNlID1mdW5jdGlvbih2YWx1ZSl7aWYgKCF2YWx1ZSB8fCh2YWx1ZS5sZW5ndGggPT0wKSl7cmV0dXJuIDA7fXJldHVybiBwYXJzZUZsb2F0KHZhbHVlKTt9Ck51bWJlci5fdHlwZU5hbWUgPSdOdW1iZXInO1N0cmluZy5wcm90b3R5cGUuZW5kc1dpdGggPWZ1bmN0aW9uKHN1ZmZpeCl7cmV0dXJuICh0aGlzLnN1YnN0cih0aGlzLmxlbmd0aCAtc3VmZml4Lmxlbmd0aCk9PXN1ZmZpeCk7fQoKU3RyaW5nLnByb3RvdHlwZS5zdGFydHNXaXRoID1mdW5jdGlvbihwcmVmaXgpe3JldHVybiAodGhpcy5zdWJzdHIoMCxwcmVmaXgubGVuZ3RoKT09cHJlZml4KTt9ClN0cmluZy5wcm90b3R5cGUudHJpbUxlZnQgPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucmVwbGFjZSgvXlxzKi8sIiIpO30KU3RyaW5nLnByb3RvdHlwZS50cmltUmlnaHQgPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucmVwbGFjZSgvXHMqJC8sIiIpO30KU3RyaW5nLnByb3RvdHlwZS50cmltID1mdW5jdGlvbigpe3JldHVybiB0aGlzLnRyaW1SaWdodCgpLnRyaW1MZWZ0KCk7fQpTdHJpbmcucHJvdG90eXBlLnBhZExlZnQgPSBmdW5jdGlvbihwYWRDaGFyLCB0b3RhbExlbmd0aCkge3ZhciB0aGlzTGVuID0gdGhpcy5sZW5ndGg7dmFyIG91dCA9IHRoaXM7aWYgKHRoaXNMZW4gPCB0b3RhbExlbmd0aCkge3ZhciBkaWZmID0gdG90YWxMZW5ndGggLSB0aGlzTGVuO2ZvciAodmFyIGk9MDtpPGRpZmY7aSsrKSB7b3V0ID0gcGFkQ2hhciArIG91dDt9fXJldHVybiBvdXQ7fTsKU3RyaW5nLnByb3RvdHlwZS5wYWRSaWdodCA9IGZ1bmN0aW9uKHBhZENoYXIsIHRvdGFsTGVuZ3RoKSB7dmFyIHRoaXNMZW4gPSB0aGlzLmxlbmd0aDt2YXIgb3V0ID0gdGhpcztpZiAodGhpc0xlbiA8IHRvdGFsTGVuZ3RoKSB7dmFyIGRpZmYgPSB0b3RhbExlbmd0aCAtIHRoaXNMZW47Zm9yICh2YXIgaT0wO2k8ZGlmZjtpKyspIHtvdXQgPSBvdXQgKyBwYWRDaGFyO319cmV0dXJuIG91dDt9OwpTdHJpbmcuZm9ybWF0ID1mdW5jdGlvbihmb3JtYXQpe2ZvciAodmFyIGkgPTE7aSA8YXJndW1lbnRzLmxlbmd0aDtpKyspe2Zvcm1hdCA9Zm9ybWF0LnJlcGxhY2UoInsiKyhpIC0xKSsifSIsYXJndW1lbnRzW2ldKTt9cmV0dXJuIGZvcm1hdDt9ClN0cmluZy5wcm90b3R5cGUubm9QWCA9IGZ1bmN0aW9uKCkge2lmICh0aGlzLmxlbmd0aCA9PSAwKSByZXR1cm4gMDsgZWxzZSByZXR1cm4gcGFyc2VJbnQodGhpcy5yZXBsYWNlKC9weC8sICIiKSk7fQpTdHJpbmcucHJvdG90eXBlLnB4QWRkID0gZnVuY3Rpb24odmFsKSB7cmV0dXJuICh0aGlzLm5vUFgoKSArIHZhbCkgKyAicHgiO30KU3RyaW5nLl90eXBlTmFtZSA9J1N0cmluZyc7CgovKiogcHJpdmF0ZSAqLwovL1Nmb3JjZS5tb3ZlID0gZnVuY3Rpb24oZWxlbWVudCwgeCwgeSkge2lmICh5ID09IHVuZGVmaW5lZCkgdmFyIHkgPSAwO2lmICh4ID09IHVuZGVmaW5lZCkgdmFyIHggPSAwO2VsZW1lbnQuc3R5bGUubGVmdCA9IGVsZW1lbnQuc3R5bGUubGVmdC5weEFkZCh5KTtlbGVtZW50LnN0eWxlLnRvcCA9IGVsZW1lbnQuc3R5bGUudG9wLnB4QWRkKHgpO30KLyoqIHByaXZhdGUgKi8KLy9TZm9yY2UubW92ZVRvID0gZnVuY3Rpb24oZWxlbWVudCwgeCwgeSkgewlpZiAoeSA9PSB1bmRlZmluZWQpIHZhciB5ID0gMDsJaWYgKHggPT0gdW5kZWZpbmVkKSB2YXIgeCA9IDA7ZWxlbWVudC5zdHlsZS5sZWZ0ID0geSArICJweCI7ZWxlbWVudC5zdHlsZS50b3AgPSB4ICsgInB4Ijt9CgoKU2ZvcmNlLkhhc2h0YWJsZSA9IGZ1bmN0aW9uKCkgewoJdGhpcy5nZXRLZXlzID0gZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMua2V5czsKCX0KCXRoaXMubWFwID0gbmV3IEFycmF5KCk7Cgl0aGlzLmNsYXNzTmFtZSA9ICJIYXNodGFibGUiOwoJdGhpcy5sZW5ndGggPSAwOwoJdGhpcy5rZXlzID0gbmV3IEFycmF5KCk7Cn07ClNmb3JjZS5IYXNodGFibGUucHJvdG90eXBlLmdldEl0ZW0gPSBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHRoaXMubWFwW2tleS50b0xvd2VyQ2FzZSgpXTsgfTsKU2ZvcmNlLkhhc2h0YWJsZS5wcm90b3R5cGUuYWRkSXRlbSA9ZnVuY3Rpb24oa2V5LCB2YWx1ZSl7CQoJdmFyIGsgPSBrZXkudG9Mb3dlckNhc2UoKTsKCXRoaXMua2V5c1trXSA9IGs7Cgl0aGlzLm1hcFtrXSA9IHZhbHVlOwoJdGhpcy5sZW5ndGgrKzsKfTsKU2ZvcmNlLkhhc2h0YWJsZS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbigpewoJaWYgKHRoaXMubGVuZ3RoID4wKXsKCQl0aGlzLm1hcC5zcGxpY2UoMCwgdGhpcy5sZW5ndGgpOwoJCXRoaXMua2V5cy5zcGxpY2UoMCwgdGhpcy5rZXlzLmxlbmd0aCk7CgkJdGhpcy5sZW5ndGggPSAwOwoJfQp9OwpTZm9yY2UuSGFzaHRhYmxlLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCl7Cgl2YXIgY2xvbmVkQXJyYXkgPSBuZXcgU2ZvcmNlLkhhc2h0YWJsZSgpOwkKCXZhciBsZW5ndGggPSB0aGlzLmxlbmd0aDsKCWZvciAoa2V5IGluIHRoaXMubWFwKSB7CgkJY2xvbmVkQXJyYXkuYWRkSXRlbShrZXksIHRoaXMubWFwW2tleV0pOwoJfQoJcmV0dXJuIGNsb25lZEFycmF5Owp9OwpTZm9yY2UuSGFzaHRhYmxlLnByb3RvdHlwZS5jb250YWluc0l0ZW0gPSBmdW5jdGlvbihrZXkpewoJdmFyIGluZGV4ID0gdGhpcy5pbmRleE9mKGtleSk7CQoJcmV0dXJuIChpbmRleCA+PTApOwp9OwpTZm9yY2UuSGFzaHRhYmxlLnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24oa2V5KXsKCXZhciB4ID0ga2V5LnRvTG93ZXJDYXNlKCk7Cgl2YXIgYyA9IDA7Cglmb3IgKGsgaW4gdGhpcy5tYXApIHsKCQlpZiAoayA9PSB4KXsKCQkJcmV0dXJuIGM7CgkJfQoJCWMrKzsKCX0KCXJldHVybiAtMTsKfTsKU2ZvcmNlLkhhc2h0YWJsZS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oa2V5KXsKCXZhciBrID0ga2V5LnRvTG93ZXJDYXNlKCk7Cgl2YXIgaW5kZXggPSB0aGlzLmluZGV4T2Yoayk7CglpZiAoaW5kZXggPj0wKXsKCQl0aGlzLm1hcC5zcGxpY2UoaW5kZXgsMSk7CgkJdGhpcy5rZXlzW2tdID09IG51bGw7CgkJdGhpcy5sZW5ndGgtLTsKCX0KfTsKU2ZvcmNlLkhhc2h0YWJsZS5fdHlwZU5hbWUgPSdIYXNodGFibGUnOwpTZm9yY2UuSGFzaHRhYmxlLnByb3RvdHlwZS5wYXJzZSA9ZnVuY3Rpb24odmFsdWUpe3JldHVybiBldmFsKCcoJyt2YWx1ZSArJyknKTt9CgkJCQpSZWdFeHAucGFyc2UgPWZ1bmN0aW9uKHZhbHVlKXtpZiAodmFsdWUuc3RhcnRzV2l0aCgnLycpKXt2YXIgZW5kU2xhc2hJbmRleCA9dmFsdWUubGFzdEluZGV4T2YoJy8nKTtpZiAoZW5kU2xhc2hJbmRleCA+MSl7dmFyIGV4cHJlc3Npb24gPXZhbHVlLnN1YnN0cmluZygxLGVuZFNsYXNoSW5kZXgpO3ZhciBmbGFncyA9dmFsdWUuc3Vic3RyKGVuZFNsYXNoSW5kZXggKzEpO3JldHVybiBuZXcgUmVnRXhwKGV4cHJlc3Npb24sZmxhZ3MpO319cmV0dXJuIG51bGw7fQpSZWdFeHAuX3R5cGVOYW1lID0nUmVnRXhwJzsKCkRhdGUuX3R5cGVOYW1lID0nRGF0ZSc7ClNmb3JjZS5Ccm93c2VyID0gZnVuY3Rpb24oKXsKICAgIHZhciB1YSwgcywgaTsKICAgIHRoaXMuaXNJRSA9IGZhbHNlOwogICAgdGhpcy5pc05TID0gZmFsc2U7CiAgICB0aGlzLnZlcnNpb24gPSBudWxsOwogICAgdWEgPSBuYXZpZ2F0b3IudXNlckFnZW50O3MgPSAiTVNJRSI7CiAgICBpZiAoKGkgPSB1YS5pbmRleE9mKHMpKSA+PSAwKSB7CiAgICAgICAgdGhpcy5pc0lFID0gdHJ1ZTsKICAgICAgICB0aGlzLnZlcnNpb24gPSBwYXJzZUZsb2F0KHVhLnN1YnN0cihpICsgcy5sZW5ndGgpKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBzID0gIk5ldHNjYXBlNi8iOwogICAgaWYgKChpID0gdWEuaW5kZXhPZihzKSkgPj0gMCkgewogICAgICAgIHRoaXMuaXNOUyA9IHRydWU7CiAgICAgICAgdGhpcy52ZXJzaW9uID0gcGFyc2VGbG9hdCh1YS5zdWJzdHIoaSArIHMubGVuZ3RoKSk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgcyA9ICJHZWNrbyI7CiAgICBpZiAoKGkgPSB1YS5pbmRleE9mKHMpKSA+PSAwKSB7CiAgICAgICAgdGhpcy5pc05TID0gdHJ1ZTsKICAgICAgICB0aGlzLnZlcnNpb24gPSA2LjE7cmV0dXJuOwogICAgfQp9OwpTZm9yY2UuQXBwbGljYXRpb24gPSBmdW5jdGlvbigpIHsKCXZhciBfdHlwZTsKCXZhciBiID0gbmV3IFNmb3JjZS5Ccm93c2VyKCk7Cgl0aGlzLmdldF90eXBlID0gZnVuY3Rpb24oKSB7CgkJaWYgKCFfdHlwZSl7CgkJCV90eXBlID0gU2ZvcmNlLkFwcGxpY2F0aW9uLlR5cGUuRmlyZUZveDsKCQkJaWYgKGIuaXNJRSl7CgkJCQlfdHlwZSA9IFNmb3JjZS5BcHBsaWNhdGlvbi5UeXBlLkludGVybmV0RXhwbG9yZXI7CgkJCX0gZWxzZSBpZiAoYi5pc05TKXsKCQkJCV90eXBlID0gU2ZvcmNlLkFwcGxpY2F0aW9uLlR5cGUuRmlyZUZveDsKCQkJfSBlbHNlIHsKCQkJICAgIHRyeSB7CgkJICAgICAgICAgICAgaWYgKFVSTCkgewoJCSAgICAgICAgICAgICAgICBfdHlwZSA9IFNmb3JjZS5BcHBsaWNhdGlvbi5UeXBlLktvbmZhYnVsYXRvcjsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9IGNhdGNoIChlKSB7fQoJCQl9CgkJfQoJCXJldHVybiBfdHlwZTsKCX07Cn07ClNmb3JjZS5BcHBsaWNhdGlvbi5UeXBlID0gbmV3IE9iamVjdCgpOwpTZm9yY2UuQXBwbGljYXRpb24uVHlwZS5PdGhlciA9ICJPdGhlciI7ClNmb3JjZS5BcHBsaWNhdGlvbi5UeXBlLkludGVybmV0RXhwbG9yZXIgPSAiSW50ZXJuZXRFeHBsb3JlciI7ClNmb3JjZS5BcHBsaWNhdGlvbi5UeXBlLkZpcmVGb3ggPSAiRmlyZUZveCI7ClNmb3JjZS5BcHBsaWNhdGlvbi5UeXBlLkZpcmVmb3ggPSBTZm9yY2UuQXBwbGljYXRpb24uVHlwZS5GaXJlRm94OwpTZm9yY2UuQXBwbGljYXRpb24uVHlwZS5Lb25mYWJ1bGF0b3IgPSAiS29uZmFidWxhdG9yIjsKClNmb3JjZS5YTUxET00gPSBmdW5jdGlvbigpewoJaWYgKFNmb3JjZS5BcHBsaWNhdGlvbi5nZXRfdHlwZSgpPT0gU2ZvcmNlLkFwcGxpY2F0aW9uLlR5cGUuSW50ZXJuZXRFeHBsb3Jlcil7CgkJdmFyIHByb2dJRHMgPVsnTXN4bWwyLkRPTWRvYy42LjAnLCdNc3htbDIuRE9NZG9jLjUuMCcsJ01zeG1sMi5ET01kb2MuNC4wJywnTXN4bWwyLkRPTWRvYy4zLjAnLCdNc3htbDIuRE9NRG9jdW1lbnQnXTsKCQlmb3IgKHZhciBpID0wO2kgPHByb2dJRHMubGVuZ3RoO2krKyl7CgkJCXRyeSB7CgkJCQl2YXIgeG1sRE9NID0gbmV3IEFjdGl2ZVhPYmplY3QocHJvZ0lEc1tpXSk7CgkJCQlyZXR1cm4geG1sRE9NOwoJCQl9IGNhdGNoIChleCl7fQoJCX0KCQlyZXR1cm4gbnVsbDsKCX0gZWxzZSB7CgkJcmV0dXJuIGRvbVBhcnNlciA9IG5ldyBET01QYXJzZXIoKTsKCX0KfTsKU2ZvcmNlLlhNTERPTVN0cmluZyA9IGZ1bmN0aW9uKG1hcmt1cCl7Cgl2YXIgeG1sRE9NID0gbmV3IFNmb3JjZS5YTUxET00oKTsKCWlmIChTZm9yY2UuQXBwbGljYXRpb24uZ2V0X3R5cGUoKT09IFNmb3JjZS5BcHBsaWNhdGlvbi5UeXBlLkludGVybmV0RXhwbG9yZXIpewoJCXhtbERPTS5hc3luYyA9IGZhbHNlOwoJCXhtbERPTS5sb2FkWE1MKG1hcmt1cCk7CgkJcmV0dXJuIHhtbERPTTsKCX0gZWxzZSB7CgkJcmV0dXJuIHhtbERPTS5wYXJzZUZyb21TdHJpbmcobWFya3VwLCd0ZXh0L3htbCcpOwoJfQp9OwpTZm9yY2UuWE1MRE9NRmlsZSA9IGZ1bmN0aW9uKHVybCwgY2FsbGJhY2spIHsKCV90aGlzID0gdGhpczsKCV9jYWxsYmFjayA9IGNhbGxiYWNrOwoJcnNjID0gZnVuY3Rpb24oZSkgewoJCWlmIChfeG1sLnJlcS5yZWFkeVN0YXRlID09IDQpIHsKCQkJLy8gb25seSBpZiAiT0siCgkJCWlmIChfeG1sLnJlcS5zdGF0dXMgPT0gMjAwKSB7CgkJCQlpZiAoX2NhbGxiYWNrICE9IHVuZGVmaW5lZCkgY2FsbGJhY2soX3htbC5yZXEpOwoJCQkJLy9yZXR1cm4gX3RoaXMucmVzcG9uc2VYTUw7CgkJCX0gZWxzZSB7CgkJCQlhbGVydCgiVGhlcmUgd2FzIGEgcHJvYmxlbSByZXRyaWV2aW5nIHRoZSBYTUwgZGF0YTpcbiIgKwoJCQkJCV94bWwucmVxLnN0YXR1c1RleHQpOwoJCQl9CgkJfQoJfTsKCQoJX3htbCA9IG5ldyBTZm9yY2UuWG1sSHR0cCgpOwoJaWYgKGNhbGxiYWNrKSB7CgkJX3htbC5yZXEub25yZWFkeXN0YXRlY2hhbmdlID0gcnNjOwoJfQoJX3htbC5yZXEub3BlbignR0VUJywgdXJsLCBmYWxzZSk7CglfeG1sLnJlcS5zZW5kKCBudWxsICk7CglyZXR1cm4gX3htbC5yZXE7Cn07Ci8qKgogKiBDb25zdHJ1Y3QgYSBuZXcgU2ZvcmNlQ2xpZW50IG9iamVjdCAtICBEdXJpbmcgdGhpcyBjb25zdHJ1Y3RvciwgZGVwZW5kZW50IGpzIGZpbGVzCiAqIGFyZSBvYnRhaW5lZCBmcm9tIGEgd2VsbCBrbm93biB1cmw6ICBBdCB0aGUgdGltZSBvZiBjb25zdHJ1Y3Rpb25zLCB3ZSBkbyBub3QgaGF2ZQogKiBhIHZhbGlkIGNvbm5lY3Rpb24gdG8gdGhlIHdlYnNlcnZpY2U6ICBUaGlzIG11c3QgYmUgb2J0YWluZWQgYnkgdXNpbmcgTG9naW4KICogb3IgaW5pdDogIHNmb3JjZUNsaWVudCBpbml0IGlzIGFwcHJvcHJpYXRlIHdoZW4gdXNlZCBpbiBhbiBTZm9yY2UgQ29udHJvbC4KICogQGNvbnN0cnVjdG9yCiAqLwpTZm9yY2UuQ2xpZW50ID0gZnVuY3Rpb24oKSB7Cgl2YXIgX3RoaXMgPSB0aGlzOwoJLyoqIEBpZ25vcmUgKi8KCXRoaXMuZGVzY3JpYmVDYWNoZSA9IG5ldyBTZm9yY2UuSGFzaHRhYmxlKCk7IAoJLyoqIEBpZ25vcmUgKi8KCXRoaXMuZGVzY3JpYmVMYXlvdXRDYWNoZSA9IG5ldyBTZm9yY2UuSGFzaHRhYmxlKCk7IAoJLyoqIEBpZ25vcmUgKi8KCXRoaXMuZGVzY3JpYmVUYWJzQ2FjaGUgPSBuZXcgU2ZvcmNlLkhhc2h0YWJsZSgpOwoJdGhpcy5zZXNzaW9uSWQgPSAiIjsKCXRoaXMudXNlcklkID0gIiI7Cgl0aGlzLnVybCA9ICIiOwoJdGhpcy5sb2dpblVybCA9ICJodHRwczovL3d3dy5zYWxlc2ZvcmNlLmNvbS9zZXJ2aWNlcy9Tb2FwL3UvNy4wIjsKCXRoaXMudXNlcm5hbWUgPSAiIjsKCXRoaXMucGFzc3dvcmQgPSAiIjsKCXRoaXMuYmF0Y2hTaXplID0gIjIwMCI7Cgl0aGlzLnVzZXJJbmZvID0gbnVsbDsKCXRoaXMubG9nU29hcE1lc3NhZ2VzID0gZmFsc2U7Cgl0aGlzLnNvYXBNZXNzYWdlcyA9IG5ldyBBcnJheSgpOwkKCXRoaXMudmVyc2lvbiA9ICIwLjAuMV9iMDAyIjsKCXRoaXMub25FcnJvciA9IHVuZGVmaW5lZDsKCXRoaXMuYXBwVHlwZSA9IG5ldyBTZm9yY2UuQXBwbGljYXRpb24oKS5nZXRfdHlwZSgpOwoJdGhpcy5jbGllbnRJZCA9IG51bGw7CgkKCS8qKiBAaWdub3JlICovCgl0aGlzLmdldFhNTEh0dHBSZXF1ZXN0ID0gZnVuY3Rpb24oKXtpZih0eXBlb2YgQWN0aXZlWE9iamVjdCE9InVuZGVmaW5lZCIpe3JldHVybiBuZXcgQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKX0gZWxzZSBpZih0eXBlb2YgWE1MSHR0cFJlcXVlc3QhPSJ1bmRlZmluZWQiKXtyZXR1cm4gbmV3IFhNTEh0dHBSZXF1ZXN0KCl9IGVsc2Uge3JldHVybiBudWxsfX07CgkvKiogQGlnbm9yZSAqLwoJLy90aGlzLnNjcmlwdCA9IGZ1bmN0aW9uKHNyYykgewkKCS8vCWRvYy53cml0ZSgnPHNjcmlwdCBzcmM9IicgKyBzcmMgKyAnIiB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPjwvc2NyaXB0PicpOwoJLy99CgkvKiogQGlnbm9yZSAqLwoJLy90aGlzLmxvYWRDbGllbnRTY3JpcHRzID0gZnVuY3Rpb24oKSB7CgkvLwlpZiAoZG9jdW1lbnQgIT0gdW5kZWZpbmVkKSB7CgkvLwkJdmFyIHByZWY7CgkvLwkJdmFyIHNjcmlwdHMgPSBTZm9yY2UuZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKTsKCS8vCQlmb3IgKHZhciBpPTA7aTxzY3JpcHRzLmxlbmd0aDtpKyspIHsKCS8vCQkJdmFyIHNjcmlwdFNvdXJjZSA9IHNjcmlwdHNbaV0uc3JjOwoJLy8JCQlpZiAoc2NyaXB0U291cmNlLmluZGV4T2YoInNmb3JjZWNsaWVudC5qcyIpID4gMCkgewoJLy8JCQkJcHJlZiA9IHNjcmlwdFNvdXJjZS5zdWJzdHJpbmcoMCwgc2NyaXB0U291cmNlLmluZGV4T2YoInNmb3JjZWNsaWVudC5qcyIpKTsKCS8vCQkJCXRoaXMuaW1hZ2VGb2xkZXIgPSBwcmVmICsgImltYWdlcy8iOwoJLy8JCQkJYnJlYWs7CgkvLwkJCX0KCS8vCQl9CgkvLwkJdGhpcy5zY3JpcHQocHJlZiArICJ1dGlsLmpzIik7CgkvLwkJdGhpcy5zY3JpcHQocHJlZiArICJkbHR5cGVvZi5qcyIpOwoJLy8JCXRoaXMuc2NyaXB0KHByZWYgKyAiZG9tZnVuYy5qcyIpOwoJLy8JCXRoaXMuc2NyaXB0KHByZWYgKyAiZHluYWxpYi5qcyIpOwoJLy8JCXRoaXMuc2NyaXB0KHByZWYgKyAiZHluYXByb3BlcnR5LmpzIik7CgkvLwkJdGhpcy5zY3JpcHQocHJlZiArICJzb2Fwb2JqZWN0cy5qcyIpOwoJLy8JCXRoaXMuc2NyaXB0KHByZWYgKyAiY2FsZW5kYXIuanMiKTsKCS8vCQl0aGlzLnNjcmlwdChwcmVmICsgImNvbWJvYm94LmpzIik7CgkvLwkJdGhpcy5zY3JpcHQocHJlZiArICJtdWx0aXNlbGVjdHBpY2tsaXN0LmpzIik7CgkvLwkJdGhpcy5zY3JpcHQocHJlZiArICJyZW5kZXJpbmcuanMiKTsKCS8vCQl0aGlzLnNjcmlwdChwcmVmICsgImxheW91dC5qcyIpOwoJLy8JCXRoaXMuc2NyaXB0KHByZWYgKyAiZGF0YWJpbmRpbmcuanMiKTsKCS8vCQl0aGlzLnNjcmlwdChwcmVmICsgInNmb3JjZWxvZ2dlci5qcyIpOwoJLy8JCXRoaXMuc2NyaXB0KHByZWYgKyAiZGlhbG9nLmpzIik7CgkvLwkJdGhpcy5zY3JpcHQocHJlZiArICJidXN5Ym94LmpzIik7CgkvLwl9CgkvL307CgkvL3RoaXMubG9hZENsaWVudFNjcmlwdHMoKTsKCgl0aGlzLm9uSW5pdENhbGxiYWNrID0gZnVuY3Rpb24oKSB7cmV0dXJuO307CgkKCS8qKgoJICogWW91IGNhbiB1c2UgdGhpcyB0byBwcmV2ZW50IHJlc2V0dGluZyB0aGUgdXJsIGFmdGVyIGEgbG9naW4gb3BlcmF0aW9uLgoJICogQHR5cGUge0Jvb2xlYW59CgkgKi8KCXRoaXMubWFpbnRhaW5Mb2dpblVybCA9IGZhbHNlOwp9Ci8qKiBAaWdub3JlICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLk9QRU5fSEVBREVSID0gIjxzb2FwZW52OkhlYWRlcj5cbiI7Ci8qKiBAaWdub3JlICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLkNMT1NFX0hFQURFUiA9ICI8L3NvYXBlbnY6SGVhZGVyPlxuIjsKLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuT1BFTl9CT0RZID0gIjxzb2FwZW52OkJvZHk+XG4iOwovKiogQGlnbm9yZSAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5DTE9TRV9CT0RZID0gIjwvc29hcGVudjpCb2R5PlxuIjsKLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuQ0xPU0VfRU5WID0gIjwvc29hcGVudjpFbnZlbG9wZT5cbiI7Ci8qKiBAaWdub3JlICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLk9QRU5fRU5WID0gIjw/eG1sIHZlcnNpb249JzEuMCcgZW5jb2Rpbmc9J1VURi04JyA/Pjxzb2FwZW52OkVudmVsb3BlIHhtbG5zOnNvYXBlbnY9J2h0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3NvYXAvZW52ZWxvcGUvJyB4bWxuczp4c2Q9J2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hJyB4bWxuczp4c2k9J2h0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlJz5cbiI7Ci8qKiBAaWdub3JlICovIApTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5nZXRDbGllbnRJZCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuY2xpZW50SWQ7Cn07Ci8qKiBAaWdub3JlICovIApTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5zZXRDbGllbnRJZCA9IGZ1bmN0aW9uKGlkKSB7CiAgICB0aGlzLmNsaWVudElkID0gaWQ7Cn07Ci8qKiBAaWdub3JlICovIApTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5vcGVuWE1MRmlsZSA9IGZ1bmN0aW9uKGZpbGVuYW1lKSB7fTsKLyoqCiAqIFJlZ2lzdGVycyBhIGxpc3RlbmVyIGZvciB0aGUgaW5pdCBjb21wbGV0ZSBldmVudC4gIFRoZSBpbml0IGNvbXBsZXRlIGV2ZW50IGlzIGNhbGxlZCBkaXJlY3RseSBhZnRlciB0aGUgaW5pdCBtZXRob2QgaGFzIGNvbXBsZXRlZC4KICogVGhlIGV2ZW50IG5vIHZhbHVlcy4KICogPEJSPjxCUj5FeGFtcGxlOiBUaGlzIGV4YW1wbGUgc2V0cyB0aGUgc2V0dXAgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGFmdGVyIGluaXRpYWxpemF0aW9uIGlzIGNvbXBsZXRlLjxCUj48QlI+CiAqIDxwcmU+PGNvZGU+ZnVuY3Rpb24gaW5pdFBhZ2UoKSB7CiAqICAgIHNmb3JjZUNsaWVudC51c2VDb29raWVzID0gdHJ1ZTsKICogICAgc2ZvcmNlQ2xpZW50LnJlZ2lzdGVySW5pdENhbGxiYWNrKHNldHVwKTsKICogICAgc2ZvcmNlQ2xpZW50LmluaXQoInshQVBJX1Nlc3Npb25fSUR9IiwgInshQVBJX1BhcnRuZXJfU2VydmVyX1VSTF82MH0iLCB0cnVlKTsKICogIH0KICogIGZ1bmN0aW9uIHNldHVwKCkgewogKiAgICB2YXIgZGcgPSBzZm9yY2VDbGllbnQuRGVzY3JpYmVHbG9iYWwoKTsKICogICAgdmFyIHNlbCA9IFNmb3JjZS5kb2MuZ2V0RWxlbWVudEJ5SWQoImNib1R5cGUiKTsKICogICAgc2VsLm9wdGlvbnMubGVuZ3RoID0gMDsKICogICAgZm9yICh2YXIgaT0wO2kmbHQ7ZGcudHlwZXMubGVuZ3RoO2krKykgewogKiAgICAgIHZhciBvcHQgPSBkb2MuY3JlYXRlRWxlbWVudCgiT1BUSU9OIik7CiAqICAgICAgb3B0LnZhbHVlID0gZGcudHlwZXNbaV07CiAqICAgICAgb3B0LmFwcGVuZENoaWxkKGRvYy5jcmVhdGVUZXh0Tm9kZShkZy50eXBlc1tpXSkpOwogKiAgICAgIHNlbC5hcHBlbmRDaGlsZChvcHQpOwogKiAgICB9CiAqICB9CiAqIDwvY29kZT48L3ByZT4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbEJhY2sgVGhlIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiBldmVudCBpcyByYWlzZWQuCiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5yZWdpc3RlckluaXRDYWxsYmFjayA9IGZ1bmN0aW9uKCBjYWxsQmFjayApIHsgdGhpcy5vbkluaXRDYWxsYmFjayA9IGNhbGxCYWNrOyB9OwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS52ZXJib3NlID0gZmFsc2U7CgovKioKICogUmV0dXJucyB0aGUgdmVyc2lvbiBvZiB0aGlzIHRvb2xraXQuCiAqIEByZXR1cm4gVGhlIHZlcnNpb24gb2YgdGhlIHRvb2xraXQuCiAqIEB0eXBlIDxTdHJpbmc+IHN0cmluZwogKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuZ2V0VmVyc2lvbiA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdmVyc2lvbjsgfTsKLyoqIEBpZ25vcmUgKi8gClNmb3JjZS5DbGllbnQucHJvdG90eXBlLmJ1aWxkUmVxdWVzdCA9IGZ1bmN0aW9uKG9wZXJhdGlvbikgewogICAgdmFyIG91dCA9IHRoaXMuT1BFTl9FTlY7CiAgICBvdXQgKz0gdGhpcy5PUEVOX0hFQURFUjsKICAgIG91dCArPSB0aGlzLmdldFNlc3Npb25IZWFkZXIoKTsKICAgIG91dCArPSB0aGlzLmdldEJhdGNoSGVhZGVyKCk7CiAgICBpZiAodGhpcy5nZXRDbGllbnRJZCgpICE9IG51bGwpIHsKICAgICAgICBvdXQgKz0gdGhpcy5nZXRDYWxsT3B0aW9uc0hlYWRlcigpOwogICAgICAgIGFsZXJ0KHRoaXMuZ2V0Q2FsbE9wdGlvbnNIZWFkZXIoKSk7CiAgICB9CiAgICBvdXQgKz0gdGhpcy5DTE9TRV9IRUFERVIgKyB0aGlzLk9QRU5fQk9EWSArIG9wZXJhdGlvbiArIHRoaXMuQ0xPU0VfQk9EWSArIHRoaXMuQ0xPU0VfRU5WOwogICAgcmV0dXJuIG91dDsKfTsKLyoqIEBpZ25vcmUgKi8gU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuZ2V0QmF0Y2hIZWFkZXIgPSBmdW5jdGlvbigpIHsJcmV0dXJuICI8UXVlcnlPcHRpb25zIHNvYXBlbnY6bXVzdFVuZGVyc3RhbmQ9JzAnPjxuczQ6YmF0Y2hTaXplIHhtbG5zOm5zND0ndXJuOnBhcnRuZXIuc29hcC5zZm9yY2UuY29tJz4iICsgdGhpcy5nZXRCYXRjaFNpemUoKSArICI8L25zNDpiYXRjaFNpemU+PC9RdWVyeU9wdGlvbnM+IjsJfTsKLyoqIEBpZ25vcmUgKi8gU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuZ2V0U2Vzc2lvbkhlYWRlciA9IGZ1bmN0aW9uKCkgewlyZXR1cm4gIjxuczE6U2Vzc2lvbkhlYWRlciBzb2FwZW52Om11c3RVbmRlcnN0YW5kPScwJyB4bWxuczpuczE9J1Nmb3JjZVNlcnZpY2UnPjxuczI6c2Vzc2lvbklkIHhtbG5zOm5zMj0ndXJuOnBhcnRuZXIuc29hcC5zZm9yY2UuY29tJz4iICsgCXRoaXMuZ2V0U2Vzc2lvbklkKCkgKyAgIjwvbnMyOnNlc3Npb25JZD48L25zMTpTZXNzaW9uSGVhZGVyPiI7CX07Ci8qKiBAaWdub3JlICovIFNmb3JjZS5DbGllbnQucHJvdG90eXBlLmdldENhbGxPcHRpb25zSGVhZGVyID0gZnVuY3Rpb24oKSB7CXJldHVybiAiPG5zMTpDYWxsT3B0aW9ucyBzb2FwZW52Om11c3RVbmRlcnN0YW5kPScwJyB4bWxuczpuczE9J1Nmb3JjZVNlcnZpY2UnPjxuczI6Y2xpZW50IHhtbG5zOm5zMj0ndXJuOnBhcnRuZXIuc29hcC5zZm9yY2UuY29tJz4iICsgdGhpcy5nZXRDbGllbnRJZCgpICsgICI8L25zMjpjbGllbnQ+PC9uczE6Q2FsbE9wdGlvbnM+IjsJfTsKLyoqIEBpZ25vcmUgKi8gU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuc2V0VXNlckluZm8gPSBmdW5jdGlvbih1aW5mbykgeyAKCV91c2VySW5mbyA9IHVpbmZvOyAKfTsKLyoqCiAqIEdldHMgdGhlIGN1cnJlbnQgc2Vzc2lvbiBpZC4KICogQHJldHVybiBBIHNlc3Npb24gaWQge0BsaW5rIFN0cmluZ30gCiAqIEB0eXBlIDxTdHJpbmc+IHN0cmluZwogKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuZ2V0U2Vzc2lvbklkID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnNlc3Npb25JZDsgfTsKLyoqCiAqIFNldHMgdGhlIHNlc3Npb24gaWQsIHR5cGljYWxseSBjYWxsZWQgYnkgdGhlIEluaXQgZnVuY3Rpb24uCiAqIEBwYXJhbSB7U3RyaW5nfSBzZXNzaW9uSWQgVGhlIHNlc3Npb24gaWQgdG8gdXNlLgogKiBAdHlwZSA8U3RyaW5nPiBzdHJpbmcKICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLnNldFNlc3Npb25JZCA9IGZ1bmN0aW9uKHNlc3Npb25JZCkgeyB0aGlzLnNlc3Npb25JZCA9IHNlc3Npb25JZDsgfTsKLyoqCiAqIEdldHMgdGhlIGN1cnJlbnQgdXNlcidzIGlkLgogKiBAcmV0dXJuIEEgdXNlciBpZCB7QGxpbmsgU3RyaW5nfSAKICogQHR5cGUgPFN0cmluZz4gc3RyaW5nCiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5nZXRVc2VySWQgPSBmdW5jdGlvbigpIHsgCglyZXR1cm4gdGhpcy51c2VySW5mby51c2VySWQ7IAp9OwovKiogQGlnbm9yZSAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5zZXRVc2VySWQgPSBmdW5jdGlvbih1c2VySUQpIHsgdGhpcy51c2VySWQgPSB1c2VySUQ7IH07Ci8qKgogKiBHZXRzIHRoZSBjdXJyZW50IGVuZHBvaW50IHVybC4KICogQHJldHVybiBlbmRwb2ludCB1cmwge0BsaW5rIFN0cmluZ30KICogQHR5cGUgPFN0cmluZz4gc3RyaW5nCiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5nZXRVcmwgPSBmdW5jdGlvbigpIHsgCiAgICB2YXIgdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgcmV0dXJuIHRoaXMudXJsICsgIj9ub2NhY2hlPSIgKyB0OyAKfTsKLyoqCiAqIFNldHMgdGhlIGVuZHBvaW50IHVybC4gIFlvdSBjYW4gdXNlIHRoaXMgdG8gb3ZlcnJpZGUgdGhlIHVybCByZXR1cm5lZCBmcm9tIGxvZ2luIG9yIHRvIHNldCBmcm9tIHRoZSBtZXJnZSBmaWVsZCB7IS4uLlNlcnZlclVSTH0KICogQHBhcmFtIHtTdHJpbmd9IGVuZHBvaW50VVJMIEEgdmFsaWQgdXJsIHRvIHRoZSBzYWxlc2ZvcmNlLm9jbSBlbmRwb2ludC4KICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLnNldFVybCA9IGZ1bmN0aW9uKGVuZHBvaW50VVJMKSB7IHRoaXMudXJsID0gZW5kcG9pbnRVUkw7IH07Ci8qKgogKiBHZXQgdGhlIHVybCB0aGF0IHdpbGwgYmUgdXNlZCBmb3IgbG9naW4KICogQHJldHVybiBUaGUgbG9naW4gdXJsIHtAbGluayBTdHJpbmd9CiAqIEB0eXBlIDxTdHJpbmc+IHN0cmluZwogKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuZ2V0TG9naW5VcmwgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMubG9naW5Vcmw7IH07Ci8qKgogKiBTZXRzIHRoZSB1cmwgdG8gdXNlIGZvciB0aGUgbG9naW4gY2FsbC4KICogQHBhcmFtIHtTdHJpbmd9IGxvZ2luVVJMIFRoZSB1cmwgdG8gdXNlIGZvciBsb2dpbi4KICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLnNldExvZ2luVXJsID0gZnVuY3Rpb24obG9naW5VUkwpIHsgdGhpcy5sb2dpblVybCA9IGxvZ2luVVJMOyB9OwovKioKICogR2V0cyB0aGUgdXNlcm5hbWUgZm9yIHRoaXMgaW5zdGFuY2Ugb2YgU2ZvcmNlQ2xpZW50IGZvciBhdXRoZW50aWNhdGlvbiB0byBzYWxlc2ZvcmNlLmNvbQogKiBAcmV0dXJuIFRoZSB1c2VybmFtZSBmb3IgdGhpcyBpbnN0YW5jZS4KICogQHR5cGUgPFN0cmluZz4gc3RyaW5nCiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5nZXRVc2VybmFtZSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy51c2VybmFtZTsgfTsKLyoqCiAqIFNldHMgdGhlIHVzZXJuYW1lIGZvciB0aGlzIGluc3RhbmNlIG9mIFNmb3JjZUNsaWVudCBmb3IgYXV0aGVudGljYXRpb24gdG8gc2FsZXNmb3JjZS5jb20KICogQHBhcmFtIHtTdHJpbmcpIHVzZXJOYW1lIFRoZSB1c2VybmFtZSBmb3IgdGhpcyBpbnN0YW5jZS4KICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLnNldFVzZXJuYW1lID0gZnVuY3Rpb24odXNlck5hbWUpIHsgdGhpcy51c2VybmFtZSA9IHVzZXJOYW1lOyB9OwovKioKICogR2V0cyB0aGUgcGFzc3dvcmQgZm9yIHRoaXMgaW5zdGFuY2Ugb2YgU2ZvcmNlQ2xpZW50IGZvciBhdXRoZW50aWNhdGlvbiB0byBzYWxlc2ZvcmNlLmNvbQogKiBAcmV0dXJuIFRoZSBwYXNzd29yZCBmb3IgdGhpcyBpbnN0YW5jZS4KICogQHR5cGUgPFN0cmluZz4gc3RyaW5nCiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5nZXRQYXNzd29yZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMucGFzc3dvcmQ7IH07Ci8qKgogKiBTZXRzIHRoZSBwYXNzd29yZCBmb3IgdGhpcyBpbnN0YW5jZSBvZiBTZm9yY2VDbGllbnQgZm9yIGF1dGhlbnRpY2F0aW9uIHRvIHNhbGVzZm9yY2UuY29tCiAqIEBwYXJhbSB7U3RyaW5nKSBwYXNzd29yZCBUaGUgcGFzc3dvcmQgZm9yIHRoaXMgaW5zdGFuY2UuCiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5zZXRMb2NhbFBhc3N3b3JkID0gZnVuY3Rpb24ocGFzc3dvcmQpIHsgdGhpcy5wYXNzd29yZCA9IHBhc3N3b3JkOyB9OwovKioKICogR2V0cyB0aGUgY3VycmVudCBxdWVyeSBiYXRjaCBzaXplIHNldHRpbmcuCiAqIEByZXR1cm4gVGhlIGN1cnJlbnQgYmF0Y2ggc2l6ZQogKiBAdHlwZSB7SW50ZWdlcn0KICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLmdldEJhdGNoU2l6ZSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5iYXRjaFNpemU7IH07Ci8qKgogKiBTZXQgdGhlIGJhdGNoIHNpemUgZm9yIHF1ZXJ5IG9wZXJhdGlvbnMuICBNYXggc2l6ZSBpcyAyMDAwLgogKiBAcGFyYW0ge0ludGVnZXJ9IHNpemUgVGhlIGJhdGNoIHNpemUuCiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5zZXRCYXRjaFNpemUgPSBmdW5jdGlvbihzaXplKSB7IHRoaXMuYmF0Y2hTaXplID0gc2l6ZTsgfTsKLyoqCiAqIFJlc2VydmVkIGZvciBmdXR1cmUgdXNlCiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5nZXRRU1Bhcm0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMucXNQYXJtOyB9OwovKioKICogUmVzZXJ2ZWQgZm9yIGZ1dHVyZSB1c2UKICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLnNldFFTUGFybSA9IGZ1bmN0aW9uKHZhbHVlKSB7IHRoaXMucXNQYXJtID0gdmFsdWU7IH07CgovL1B1YmxpYyBNZXRob2RzCi8qKgogKiBSZXR1cm5zIGEgY3Jvc3MgYnJvd3NlciBodHRwIHJlcXVlc3Qgb2JqZWN0IHN1aXRhYmxlIGZvciBwb3N0L2dldCBvcGVyYXRpb25zLgogKgogKi8KIC8vU2ZvcmNlLkNsaWVudC5nZXRYTUxIdHRwUmVxdWVzdCA9IGdldFhNTEh0dHBSZXF1ZXN0OwogCi8qKgogKiBJbml0aWFsaXplIGFuIHNmb3JjZUNsaWVudCB1c2luZyB0aGUgbWVyZ2UgZmllbGRzIGZvciBzZXNzaW9uIGlkIGFuZCBzZXJ2ZXIgdXJsCiAqIGZyb20gYW4gc2ZvcmNlIGNvbnRyb2wuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBzZXNzSWQgQSB2YWxpZCBzZXNzaW9uIGlkIGZyb20gYW4gc2ZvcmNlIGNvbnRyb2wgbWVyZ2UgZmllbGQuCiAqIEBwYXJhbSB7U3RyaW5nfSBzZXJ2ZXJVcmwgVGhlIGFwaSBzZXJ2ZXIgZW5kcG9pbnQgbWVyZ2UgZmllbGQgZnJvbSBhbiBzZm9yY2UgY29udHJvbC4KICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbihzZXNzSWQsIHNlcnZlclVybCwgdXNlQnVpbHRJbkxvZ2luU2NyZWVuKSB7IAoJaWYgKFNmb3JjZS5yZWFkeSA9PSBmYWxzZSkgewoJCS8vdGhpcyBhc3N1bWVzIFNmb3JjZS5yZWFkeSB3YXMgc2V0IHRvIGZhbHNlIHRvIGxvYWQgdGhlIGJyb3dzZXIgc3VwcG9ydC4gIAoJCS8vQnJvd3NlciBzdXBwb3J0IHdpbGwgc2V0IFNmb3JjZS5yZWFkIHRvIHRydWUgd2hlbiBpdCBoYXMgbG9hZGVkIGNvbXBsZXRlbHkuCgkJd2luZG93LnNldFRpbWVvdXQobmV3IEZ1bmN0aW9uKCJzZm9yY2VDbGllbnQuaW5pdCgnIiArIHNlc3NJZCArICInLCAnIiArIHNlcnZlclVybCArICInLCAiICsgdXNlQnVpbHRJbkxvZ2luU2NyZWVuICsgIik7IiksIDMwKTsKCX0gZWxzZSB7CgkJaWYgKHNlc3NJZCAhPSB1bmRlZmluZWQgJiYgc2Vzc0lkLmxlbmd0aCA9PSAwKSB7IAoJCQlzZXNzSWQgPSBudWxsOwoJCX0gZWxzZSBpZiAoc2Vzc0lkID09IHVuZGVmaW5lZCkgewkJCgkJCXNlc3NJZCA9IG51bGw7CQkKCQl9CgoJCWlmIChzZXJ2ZXJVcmwgIT0gdW5kZWZpbmVkICYmIHNlcnZlclVybC5sZW5ndGggPT0gMCkgeyAKCQkJc2VydmVyVXJsID0gbnVsbDsKCQl9IGVsc2UgaWYgKHNlcnZlclVybCA9PSB1bmRlZmluZWQpIHsJCQoJCQlzZXJ2ZXJVcmwgPSBudWxsOwkJCgkJfQoKCQlpZiAoU2ZvcmNlLmhhdmVCcm93c2VyU3VwcG9ydCA9PSB0cnVlKSB7CgkJCXRoaXMuaW5pdGIoc2Vzc0lkLCBzZXJ2ZXJVcmwsIHVzZUJ1aWx0SW5Mb2dpblNjcmVlbik7CgkJfSBlbHNlIHsKCQkJdGhpcy5zZXRTZXNzaW9uSWQoc2Vzc0lkKTsgICAKCQkJdGhpcy5zZXRVcmwoc2VydmVyVXJsKTsKCgkJCWlmIChzZXNzSWQgPT0gbnVsbCB8fCBzZXNzSWQgPT0gInshQVBJX1Nlc3Npb25fSUR9IikgewoJCQkJdGhpcy5vbkluaXRDYWxsYmFjaygpOwoJCQl9IGVsc2UgaWYgKHNlc3NJZCAhPSAieyFBUElfU2Vzc2lvbl9JRH0iKXsKCQkJCXRoaXMuc2V0VXNlckluZm8odGhpcy5nZXRVc2VySW5mbygpKTsKCQkJCXRoaXMub25Jbml0Q2FsbGJhY2soKTsKCQkJfQoJCX0KCX0JCn07Ci8qKiBAaWdub3JlICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLkluaXQgPSBTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5pbml0OwoJLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuWE1MSHR0cFJlcXVlc3RzID0gbmV3IEFycmF5KCk7ClNmb3JjZS5DbGllbnQucHJvdG90eXBlLm9uVGltaW5nQ2FsbGJhY2sgPSBmdW5jdGlvbihvcGVyYXRpb24sIGVsYXBzZWRUaW1lKSB7Cn07CQovKioKICogUmVnaXN0ZXJzIGEgbGlzdGVuZXIgZm9yIHRoZSB0aW1pbmcgZXZlbnQuICBUaGUgdGltaW5nIGV2ZW50IGlzIGNhbGxlZCB3aGVuIGEgdGltZWQgZXZlbnQgaGFzIGNvbXBsZXRlZC4gIFRpbWluZyBldmVudHMgYXJlIHNwZWNpZmljIHRvIEFQSSByZXF1ZXN0cyBhbmQgcmVzcG9uc2VzIGFuZCBhcmUgaW1wbGVtZW50ZWQgYXMgYSBkaWFnbm9zdGljIGZlYXR1cmUuCiAqIFRoZSBldmVudCByZXR1cm5zIHR3byB2YWx1ZXMsIHRoZSBuYW1lIG9mIHRoZSBBUEkgY2FsbCBhbmQgdGhlIGVsYXBzZWQgdGltZSBpbiBtcyBmb3IgdGhlIGNhbGwuCiAqIDxCUj48QlI+RXhhbXBsZTo8QlI+PEJSPgogKiA8Y29kZT4KICogc2ZvcmNlQ2xpZW50LnJlZ2lzdGVyVGltaW5nQ2FsbGJhY2soaGFuZGxlVGltaW5nRXZlbnQpOzxCUj48QlI+CiAqIGZ1bmN0aW9uIEhhbmRsZVRpbWluZ0V2ZW50KG9wLCBldCkgezxCUj4KICogJm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7YWxlcnQoIlRoZSAiICsgb3AgKyAiIGNhbGwgdG9vayArICIgKyBldCArICIgbXMuIik7PEJSPgogKiB9PEJSPgogKiA8L2NvZGU+CiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxCYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIHdoZW4gZXZlbnQgaXMgcmFpc2VkLgogKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUucmVnaXN0ZXJUaW1pbmdDYWxsYmFjayA9IGZ1bmN0aW9uKGNhbGxCYWNrKSB7IHRoaXMub25UaW1pbmdDYWxsYmFjayA9IGNhbGxCYWNrOyB9OwoKCi8qKiBAaWdub3JlICovClNmb3JjZS5YbWxIdHRwID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBzb2FwTWVzc2FnZSwgYXN5bmMsIGYpIHsKCXRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBudWxsOwoJdGhpcy5yZXEgPSBudWxsOwoJdGhpcy5zb2FwTWVzc2FnZSA9IHNvYXBNZXNzYWdlIHx8IG51bGw7CgkKCXZhciBhcHBUeXBlID0gbmV3IFNmb3JjZS5BcHBsaWNhdGlvbigpOwoJdmFyIHJldFZhbHVlID0gbnVsbDsKCQoJdmFyIGdldENvbnRyb2xQcmVmaXggPSBmdW5jdGlvbiAoKSB7CgkJaWYgKGdldENvbnRyb2xQcmVmaXgucHJlZml4KSB7CgkJCXJldHVybiBnZXRDb250cm9sUHJlZml4LnByZWZpeDsKCQl9CgkJCgkJdmFyIHByZWZpeGVzID0gWyJNU1hNTDIiLCAiTWljcm9zb2Z0IiwgIk1TWE1MIiwgIk1TWE1MMyJdOwoJCXZhciBvLCBvMjsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHByZWZpeGVzLmxlbmd0aDsgaSsrKSB7CgkJCXRyeSB7CgkJCQkvLyB0cnkgdG8gY3JlYXRlIHRoZSBvYmplY3RzCgkJCQlvID0gbmV3IEFjdGl2ZVhPYmplY3QocHJlZml4ZXNbaV0gKyAiLlhtbEh0dHAiKTsKCQkJCW8yID0gbmV3IEFjdGl2ZVhPYmplY3QocHJlZml4ZXNbaV0gKyAiLlhtbERvbSIpOwoJCQkJcmV0dXJuIGdldENvbnRyb2xQcmVmaXgucHJlZml4ID0gcHJlZml4ZXNbaV07CgkJCX0KCQkJY2F0Y2ggKGV4KSB7fTsKCQl9CiAgIAoJCXRocm93IG5ldyBFcnJvcigiQ291bGQgbm90IGZpbmQgYW4gaW5zdGFsbGVkIFhNTCBwYXJzZXIiKTsKCX07CgkKCXRyeSB7CgkJaWYgKHNmb3JjZUNsaWVudC5hcHBUeXBlICE9IFNmb3JjZS5BcHBsaWNhdGlvbi5UeXBlLkludGVybmV0RXhwbG9yZXIpIHsKCQkJdGhpcy5yZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgCgkJCS8vIHNvbWUgb2xkZXIgdmVyc2lvbnMgb2YgTW96IGRpZCBub3Qgc3VwcG9ydCB0aGUgcmVhZHlTdGF0ZSBwcm9wZXJ0eQoJCQkvLyBhbmQgdGhlIG9ucmVhZHlzdGF0ZSBldmVudCBzbyB3ZSBwYXRjaCBpdCEKCQkJaWYgKHRoaXMucmVxLnJlYWR5U3RhdGUgPT0gbnVsbCkgewoJCQkJdGhpcy5yZXEucmVhZHlTdGF0ZSA9IDE7CgkJCQl0aGlzLnJlcS5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgZnVuY3Rpb24gKCkgewoJCQkJCXRoaXMucmVxLnJlYWR5U3RhdGUgPSA0OwoJCQkJCWlmICh0eXBlb2YgdGhpcy5yZXEub25yZWFkeXN0YXRlY2hhbmdlID09ICJmdW5jdGlvbiIpCgkJCQkJCXRoaXMucmVxLm9ucmVhZHlzdGF0ZWNoYW5nZSgpOwoJCQkJCX0sIGZhbHNlKTsKCQkJfQoJCQkKCQkJdHJ5IHsKCQkJLyoqIEBpZ25vcmUgKi8KCQkJRG9jdW1lbnQucHJvdG90eXBlLmxvYWRYTUwgPSBmdW5jdGlvbiAocykgewoJCQkJdmFyIGRvYzIgPSAobmV3IERPTVBhcnNlcigpKS5wYXJzZUZyb21TdHJpbmcocywgInRleHQveG1sIik7CgkJCQl3aGlsZSAodGhpcy5oYXNDaGlsZE5vZGVzKCkpIHsKCQkJCQl0aGlzLnJlbW92ZUNoaWxkKHRoaXMubGFzdENoaWxkKTsKCQkJCX0KCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgZG9jMi5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7CgkJCQkJdGhpcy5hcHBlbmRDaGlsZCh0aGlzLmltcG9ydE5vZGUoZG9jMi5jaGlsZE5vZGVzW2ldLCB0cnVlKSk7CgkJCQl9CgkJCX07CgoJCQkvKiogQGlnbm9yZSAqLwoJCQlEb2N1bWVudC5wcm90b3R5cGUuX19kZWZpbmVHZXR0ZXJfXygieG1sIiwgZnVuY3Rpb24gKCkgewoJCQkJcmV0dXJuIChuZXcgWE1MU2VyaWFsaXplcigpKS5zZXJpYWxpemVUb1N0cmluZyh0aGlzKTsKCQkJfSk7CgkJCX0gY2F0Y2ggKGV4KSB7CgkJCX0KCQl9CgkJaWYgKHdpbmRvdy5BY3RpdmVYT2JqZWN0KSB7CgkJCXRoaXMucmVxID0gbmV3IEFjdGl2ZVhPYmplY3QoZ2V0Q29udHJvbFByZWZpeCgpICsgIi5YbWxIdHRwIik7CgkJfQoJCXRyeSB7CgkJCWlmIChVcmwpIHsKCQkJCXRoaXMucmVxID0gbmV3IFVybCgpOwoJCQl9CgkJfSBjYXRjaChlKSB7fQoJCWlmIChhc3luYyA9PSB0cnVlKSB7CgkJCXRoaXMucmVxLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGY7CgkJfQoJCXJldHVybiB0aGlzOwoJfQoJY2F0Y2ggKGV4KSB7YWxlcnQoZXgpfQoJLy8gZmVsbCB0aHJvdWdoCgl0aHJvdyBuZXcgRXJyb3IoIllvdXIgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IFhtbEh0dHAgb2JqZWN0cyIpOwp9OwovL1NlbmRlcgovKioKICogQGlnbm9yZQogKiBUaGlzIGlzIHRoZSBtZXRob2QgdGhhdCBzZW5kcyBhIHJlcXVlc3QgdG8gdGhlIHdlYiBzZXJ2aWNlLiAgVGhlIHVybCB0aGF0IGlzIHVzZWQKICogaXMgdGhlIHVybCB0aGF0IGlzIHJldHVybmVkIGZyb20gZ2V0U2VydmVyVXJsIGFuZCBzZXQgYnkgc2V0U2VydmVyVXJsLiAgVGhpcyBraW5kIG9mCiAqIGxpbWl0cyB0aGlzIGNhbGwgdG8gYmUgc3BlY2lmaWMgdG8gdGhlIHNmb3JjZUNsaWVudCBhbmQgc2hvdWxkIG5vdCBiZSByZXVzZWQgZm9yIG90aGVyCiAqIGFyYml0cmFyeSBodHRwIHJlcXVlc3RzLiAgCiAqIEBwYXJhbSB7U3RyaW5nfSByZXF1ZXN0IEEgZnVsbHkgZm9ybWVkIFNPQVAgbWVzc2FnZS4KICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlciBUaGUgaGFuZGxlciB0aGF0IHdpbGwgY29uc3VtZSB0aGUgcmVzcG9uc2UgU09BUCBtZXNzYWdlLiAgRWFjaAogKiBBUEkgY2FsbCBjb250YWlucyBhbiBpbnRlcm5hbCBoYW5kbGVyIHRoYXQgd2lsbCBkZXNlcmlhbGl6ZSB0aGUgcmVzcG9uc2UgaW50byB0aGUgYXBwcm9wcmlhdGUKICogb2JqZWN0IGZvciB0aGF0IHBhcnRpY3VsYXIgY2FsbC4gIFRoaXMgaXMgTk9UIHRoZSBhc3luY2hyb25vdXMgaGFuZGxlciBzcGVjaWZpZWQgZm9yIGFuIEFQSSBjYWxsLgogKiBAcGFyYW0ge1N0cmluZ30gb3BlcmF0aW9uIFRoaXMgaXMgYW4gaW5mb3JtYXRpb25hbCBmaWVsZCBpbmRpY2F0aW5nIHdoYXQga2luZCBvZiBzb2FwIHJlcXVlc3QgaXMKICogYmVpbmcgbWFkZS4KICogQHBhcmFtIHtCb29sZWFufSBhc3luYyBGbGFnIHRvIGNvbnRyb2wgd2hldGhlciBvciBub3QgdGhlIGNhbGwgaXMgdG8gbWFkZSBhc3luY2hyb25vdXNseSBvciBub3QuCiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5TZW5kUmVxdWVzdCA9IGZ1bmN0aW9uKHNvYXBNZXNzYWdlLCBoYW5kbGVyLCBvcGVyYXRpb24sIGFzeW5jLCB1cmwpIHsKCWlmIChzb2FwTWVzc2FnZSA9PSBudWxsIHx8IGhhbmRsZXIgPT0gbnVsbCB8fCBvcGVyYXRpb24gPT0gbnVsbCB8fCBhc3luYyA9PSBudWxsIHx8IHVybCA9PSBudWxsKSB7CgkJaWYgKHNvYXBNZXNzYWdlID09IG51bGwpIHRocm93ICJUaGUgc29hcE1lc3NhZ2UgcGFyYW1ldGVyIG11c3Qgbm90IGJlIG51bGwuIjsgZWxzZSBpZiAoaGFuZGxlciA9PSBudWxsKSB0aHJvdyAiVGhlIGhhbmRsZXIgcGFyYW1ldGVyIG11c3Qgbm90IGJlIG51bGwuIjsgZWxzZSBpZiAob3BlcmF0aW9uID09IG51bGwpIHRocm93ICJUaGUgb3BlcmF0aW9uIHBhcmFtZXRlciBtdXN0IG5vdCBiZSBudWxsLiI7IGVsc2UgaWYgKGFzeW5jID09IG51bGwpCXRocm93ICJUaGUgYXN5bmMgcGFyYW1ldGVyIG11c3Qgbm90IGJlIG51bGwuIjsgZWxzZQl0aHJvdyAiVGhlIHVybCBwYXJhbWV0ZXIgbXVzdCBub3QgYmUgbnVsbC4iOwoJCXJldHVybjsKCX0KCQoJdmFyIG1lID0gdGhpczsKCXZhciBfb3BlcmF0aW9uID0gb3BlcmF0aW9uOwoJdmFyIF9zb2FwTWVzc2FnZSA9IHNvYXBNZXNzYWdlOwoJdGhpcy5pbnRlcm5hbENhbGxCYWNrID0gZnVuY3Rpb24oaSkgewoJCXRyeSB7IGlmICh3aW5kb3cuWE1MSHR0cFJlcXVlc3QpIHsgbmV0c2NhcGUuc2VjdXJpdHkuUHJpdmlsZWdlTWFuYWdlci5lbmFibGVQcml2aWxlZ2UoIlVuaXZlcnNhbEJyb3dzZXJSZWFkIik7CX0JfSBjYXRjaChlKSB7fQoJCWlmIChtZS5YTUxIdHRwUmVxdWVzdHNbaV0ucmVxLnJlYWR5U3RhdGUgPT0gNCkgewoJCQl2YXIgZW5kVGltZSA9IFNmb3JjZS5VdGlsLnRpbWVfb2JqZWN0LkVuZFRpbWluZygpOwoJCQlpZiAodGhpcy5vblRpbWluZ0NhbGxiYWNrKSB0aGlzLm9uVGltaW5nQ2FsbGJhY2soX29wZXJhdGlvbiwgZW5kVGltZSk7CgkJCWlmICh0aGlzLnRpbWVybG9nKSB0aGlzLnRpbWVybG9nLndyaXRlbG4oX29wZXJhdGlvbiArICI6ICIgKyBlbmRUaW1lLnRvU3RyaW5nKCkpOwoJCQl2YXIgaCA9IG1lLlhNTEh0dHBSZXF1ZXN0c1tpXS5jYWxsYmFjazsKCQkJaWYgKG1lLmhpZGVXYWl0KSBtZS5oaWRlV2FpdCgpOwoJCQlpZiggaCApIHsKCQkJCWlmICh0aGlzLmxvZ1NvYXBNZXNzYWdlcyA9PSB0cnVlKSB7IAoJCQkJCXRoaXMuc29hcE1lc3NhZ2VzLnB1c2goeyJvcGVyYXRpb24iOiBfb3BlcmF0aW9uLCAicmVxdWVzdCI6IF9zb2FwTWVzc2FnZSwgInJlc3BvbnNlIjogbWUuWE1MSHR0cFJlcXVlc3RzW2ldLnJlcS5yZXNwb25zZVRleHR9KSAKCQkJCX07CgkJCQlpZiAodGhpcy5pbmJvdW5kRGF0YUV2ZW50SGFuZGxlciAhPSBudWxsKSB0aGlzLmluYm91bmREYXRhRXZlbnRIYW5kbGVyKF9vcGVyYXRpb24sIF9zb2FwTWVzc2FnZSwgbWUuWE1MSHR0cFJlcXVlc3RzW2ldLnJlcSk7CgkJCQloKG1lLlhNTEh0dHBSZXF1ZXN0c1tpXS5yZXEpOwoJCQkJbWUuWE1MSHR0cFJlcXVlc3RzW2ldID0gbnVsbDsKCQkJfSBlbHNlIHsKCQkJCWV2YWwoJ2YgPSBmdW5jdGlvbigpIHsgaW50ZXJuYWxDYWxsQmFjaygnICsgaSArICcpOyB9Jyk7CgkJCQlzZXRUaW1lb3V0KCBmLCAxMDAgKTsKCQkJfQoJCQltZS5YTUxIdHRwUmVxdWVzdF9jb3VudCAtPSAxOwoJCX0KCX0KCQoJdmFyIGkgPSB0aGlzLlhNTEh0dHBSZXF1ZXN0cy5sZW5ndGg7CglldmFsKCdmID0gZnVuY3Rpb24oKSB7IG1lLmludGVybmFsQ2FsbEJhY2soJyArIGkgKyAnKTsgfScpOwoJdGhpcy5YTUxIdHRwUmVxdWVzdHMucHVzaCggbmV3IFNmb3JjZS5YbWxIdHRwKGhhbmRsZXIsIHNvYXBNZXNzYWdlLCBhc3luYywgZikpOwoJX3RoaXMgPSB0aGlzOwoJCgl0cnkgeyBpZiAoc2ZvcmNlQ2xpZW50LmFwcFR5cGUgPT0gU2ZvcmNlLkFwcGxpY2F0aW9uLlR5cGUuRmlyZUZveCkgeyBuZXRzY2FwZS5zZWN1cml0eS5Qcml2aWxlZ2VNYW5hZ2VyLmVuYWJsZVByaXZpbGVnZSgiVW5pdmVyc2FsQnJvd3NlclJlYWQiKTsJfQl9IGNhdGNoKGUpIHt9CgoJaWYoIHNvYXBNZXNzYWdlID09IG51bGwgKSB7CgkJbWUuWE1MSHR0cFJlcXVlc3RzW2ldLnJlcS5vcGVuKCdHRVQnLCB1cmwsIGFzeW5jKTsKCQltZS5YTUxIdHRwUmVxdWVzdHNbaV0ucmVxLnNlbmQoIG51bGwgKTsKCX0gZWxzZSB7CgkJbWUuWE1MSHR0cFJlcXVlc3RzW2ldLnJlcS5vcGVuKCdQT1NUJywgdXJsLCBhc3luYyk7CgkJbWUuWE1MSHR0cFJlcXVlc3RzW2ldLnJlcS5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCAidGV4dC94bWw7IGNoYXJzZXQ9dXRmLTgiKTsKCQltZS5YTUxIdHRwUmVxdWVzdHNbaV0ucmVxLnNldFJlcXVlc3RIZWFkZXIoIlNPQVBBY3Rpb24iLCAibSIpOwoJCVNmb3JjZS5VdGlsLnRpbWVfb2JqZWN0LlN0YXJ0VGltaW5nKCk7CgkJaWYgKHRoaXMuc29hcGxvZykgdGhpcy5zb2FwbG9nLndyaXRlbG4oc29hcE1lc3NhZ2UpOwoJCWlmIChhc3luYyA9PSB0cnVlKSB7CgkJCWlmIChtZS5zaG93V2FpdCkgewoJCQkJbWUuc2hvd1dhaXQoKTsKCQkJfQoJCQl3aW5kb3cuc2V0VGltZW91dCgnU2ZvcmNlLlNlbmRJdCgnICsgIGkgKyAnLCAiJyArIGFzeW5jICsgJyIsICInICsgX29wZXJhdGlvbiArICciKScsIDUwKTsKCQl9IGVsc2UgewoJCQlTZm9yY2UuU2VuZEl0KGksICJmYWxzZSIsIF9vcGVyYXRpb24sIHRoaXMub25UaW1pbmdDYWxsYmFjayk7CgkJfQoJfQoJbWUuWE1MSHR0cFJlcXVlc3RfY291bnQgKz0gMTsKfQpTZm9yY2UuU2VuZEl0ID0gZnVuY3Rpb24ocmVxSW5kZXgsIGFzeW5jLCBvcGVyYXRpb24sIG90Y2IpIHsKCXNmb3JjZUNsaWVudC5YTUxIdHRwUmVxdWVzdHNbcmVxSW5kZXhdLnJlcS5zZW5kKCBzZm9yY2VDbGllbnQuWE1MSHR0cFJlcXVlc3RzW3JlcUluZGV4XS5zb2FwTWVzc2FnZSApOwoJaWYgKGFzeW5jLnRvTG93ZXJDYXNlKCkgPT0gImZhbHNlIikgewoJCXZhciBlbmRUaW1lID0gU2ZvcmNlLlV0aWwudGltZV9vYmplY3QuRW5kVGltaW5nKCk7CgkJaWYgKHNmb3JjZUNsaWVudC50aW1lcmxvZykgc2ZvcmNlQ2xpZW50LnRpbWVybG9nLndyaXRlbG4ob3BlcmF0aW9uICsgIjogIiArIGVuZFRpbWUudG9TdHJpbmcoKSk7CgkJaWYgKHNmb3JjZUNsaWVudC5sb2dTb2FwTWVzc2FnZXMgPT0gdHJ1ZSkgeyAKCQkJc2ZvcmNlQ2xpZW50LnNvYXBNZXNzYWdlcy5wdXNoKHsib3BlcmF0aW9uIjogb3BlcmF0aW9uLCAicmVxdWVzdCI6IHNmb3JjZUNsaWVudC5YTUxIdHRwUmVxdWVzdHNbcmVxSW5kZXhdLnNvYXBNZXNzYWdlLCAicmVzcG9uc2UiOiBzZm9yY2VDbGllbnQuWE1MSHR0cFJlcXVlc3RzW3JlcUluZGV4XS5yZXEucmVzcG9uc2VUZXh0fSkgCgkJfTsKCQlpZiAob3RjYikgb3RjYihvcGVyYXRpb24sIFNmb3JjZS5VdGlsLnRpbWVfb2JqZWN0LkVuZFRpbWluZygpLnRvU3RyaW5nKCkpOwoJCXNmb3JjZUNsaWVudC5YTUxIdHRwUmVxdWVzdHNbcmVxSW5kZXhdLmNhbGxiYWNrKHNmb3JjZUNsaWVudC5YTUxIdHRwUmVxdWVzdHNbcmVxSW5kZXhdLnJlcSk7CgkJc2ZvcmNlQ2xpZW50LlhNTEh0dHBSZXF1ZXN0c1tyZXFJbmRleF0gPSBudWxsOwoJfQkJCn0KLyoqCiAqIFBlcmZvcm1zIGEgbG9naW4gdG8gdGhlIHNhbGVzZm9yY2UuY29tIHdlYiBzZXJ2aWNlLiAgQWx0aG91Z2ggdGhpcyBtZXRob2Qgc3VwcG9ydHMKICogYW4gYXN5bmNocm9ub3VzIGNhbGxiYWNrLCBpdCBpcyB3aXNlIHRvIGFsd2F5cyB1c2UgdGhpcyBjYWxsIHN5bmNocm9ub3VzbHkuICBBcyB3aXRoCiAqIGFsbCBBUEkgY2FsbHMsIHRoZSByZXR1cm4gdmFsdWUgY2FuIGJlIGEgU29hcEZhdWx0IG9iamVjdCBpbiB0aGUgY2FzZSBvZiBhIHNlcnZlciBzaWRlCiAqIGV4Y2VwdGlvbiAodGhpcyBpbmNsdWRlcyBhIGZhaWxlZCBsb2dpbiBkdWUgdG8gYmFkIHVzZXJuYW1lIG9yIHBhc3N3b3JkKS4KICogQHBhcmFtIHtTdHJpbmd9IHVzZXJOYW1lIEEgc2FsZXNmb3JjZS5jb20gdXNlcm5hbWUgaW4gdGhlIGZvcm0gb2YgYW4gZW1haWwgYWRkcmVzcy4KICogQHBhcmFtIHtTdHJpbmd9IHBhc3N3b3JkIEEgc2FsZXNmb3JjZS5jb20gcGFzc3dvcmQuCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIEEgcG9pbnRlciB0byBhIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbmNlIHRoZSBodHRwIHJlcXVlc3QgaGFzIHJldHVybmVkLgogKiBAcGFyYW0ge0Jvb2xlYW59IGFzeW5jIEEgZmxhZyB0byBpbmRpY2F0ZSB0aGF0IHRoZSBjYWxsIHNob3VsZCBiZSBtYWRlIGFzeW5jaHJvbm91c2x5IG9yIG5vdC4gIEEKICogdmFsdWUgb2YgdHJ1ZSB3aWxsIGNhdXNlIHRoZSBtZXRob2QgdG8gcmV0dXJuIGltbWVkaWF0ZWx5IGFuZCBvbmNlIGEgcmVzcG9uc2UgaXMgcmVjaWV2ZWQsIHRoZSBjYWxsYmFjawogKiBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQgYW5kIHBhc3NlZCB0aGUgcmVzdWx0cyBvZiB0aGUgY2FsbC4KICogQHR5cGUgTG9naW5SZXN1bHQvU29hcEZhdWx0CiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJOYW1lLCBwYXNzd29yZCwgY2FsbGJhY2spIHsgCgl0aGlzLnNldFVybCh0aGlzLmdldExvZ2luVXJsKCkpOyAKCXZhciBzZkNsaWVudCA9IHRoaXM7Cgl2YXIgcmV0dXJuVmFsdWU7CglpbnRlcm5hbENhbGxiYWNrID0gZnVuY3Rpb24gKHJlcSkgewoJCWlmIChyZXEucmVhZHlTdGF0ZSA9PSA0KSB7CgkJCXJldHVyblZhbHVlID0gU2ZvcmNlLmNyZWF0ZVNmb3JjZU9iamVjdChyZXEpOwoJCQlpZiAoU2ZvcmNlLlV0aWwuZGx0eXBlb2YocmV0dXJuVmFsdWUpID09ICJMb2dpblJlc3VsdCIpIHsKCQkJCWlmIChzZkNsaWVudC5tYWludGFpbkxvZ2luVXJsID09IGZhbHNlKSB7CgkJCQkJc2ZDbGllbnQuc2V0VXJsKHJldHVyblZhbHVlLnNlcnZlclVybCk7CgkJCQl9CgkJCQlzZkNsaWVudC5zZXRTZXNzaW9uSWQocmV0dXJuVmFsdWUuc2Vzc2lvbklkKTsKCQkJCXNmQ2xpZW50LnNldFVzZXJJbmZvKHJldHVyblZhbHVlLnVzZXJJbmZvKTsKCgkJCX0KCQkJaWYgKGNhbGxiYWNrKSB7IAoJCQkJY2FsbGJhY2socmV0dXJuVmFsdWUpOwoJCQl9CgkJfQoJfTsKCW1ha2VMb2dpblJlcXVlc3QgPSBmdW5jdGlvbih1biwgcHdkKSB7IGlmIChzZkNsaWVudC5nZXRVc2VybmFtZSgpID09IG51bGwgfHwgdW4gIT0gc2ZDbGllbnQuZ2V0VXNlcm5hbWUoKSkgeyBzZkNsaWVudC5zZXRVc2VybmFtZSh1bik7IH1pZiAoc2ZDbGllbnQuZ2V0UGFzc3dvcmQoKSA9PSBudWxsIHx8IHB3ZCAhPSBzZkNsaWVudC5nZXRQYXNzd29yZCgpKSB7IHNmQ2xpZW50LnNldExvY2FsUGFzc3dvcmQocHdkKTsgfSByZXR1cm4gc2ZDbGllbnQuT1BFTl9FTlYgKyBzZkNsaWVudC5PUEVOX0JPRFkgKyAiPGxvZ2luIHhtbG5zPVwidXJuOnBhcnRuZXIuc29hcC5zZm9yY2UuY29tXCI+PHVzZXJuYW1lPiIgKyBzZkNsaWVudC5nZXRVc2VybmFtZSgpICsgIjwvdXNlcm5hbWU+PHBhc3N3b3JkPiIgKyBzZkNsaWVudC5nZXRQYXNzd29yZCgpICsgIjwvcGFzc3dvcmQ+IiArICI8L2xvZ2luPiIgKyBzZkNsaWVudC5DTE9TRV9CT0RZICsgc2ZDbGllbnQuQ0xPU0VfRU5WOyB9OwoJdmFyIGFzeW5jID0gKGNhbGxiYWNrICE9IHVuZGVmaW5lZCk7Cgl0aGlzLlNlbmRSZXF1ZXN0KG1ha2VMb2dpblJlcXVlc3QodXNlck5hbWUsIHBhc3N3b3JkKSwgaW50ZXJuYWxDYWxsYmFjaywgImxvZ2luIiwgYXN5bmMsIHRoaXMuZ2V0VXJsKCkpOwoJcmV0dXJuIHJldHVyblZhbHVlOwp9OwovKiogQGlnbm9yZSAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5Mb2dpbiA9IFNmb3JjZS5DbGllbnQucHJvdG90eXBlLmxvZ2luOwovKioKICogUGVyZm9ybXMgYSBsZWFkIGNvbnZlcnQgb3BlcmF0aW9uCiAqIEBwYXJhbSB7TGVhZENvbnZlcnRzfSBsZWFkQ29udmVydHMgQSBMZWFkQ29udmVydHMgc3RydWN0dXJlLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBBIHBvaW50ZXIgdG8gYSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSB0aGUgaHR0cCByZXF1ZXN0IGhhcyByZXR1cm5lZC4KICogQHBhcmFtIHtCb29sZWFufSBhc3luYyBBIGZsYWcgdG8gaW5kaWNhdGUgdGhhdCB0aGUgY2FsbCBzaG91bGQgYmUgbWFkZSBhc3luY2hyb25vdXNseSBvciBub3QuICBBCiAqIHZhbHVlIG9mIHRydWUgd2lsbCBjYXVzZSB0aGUgbWV0aG9kIHRvIHJldHVybiBpbW1lZGlhdGVseSBhbmQgb25jZSBhIHJlc3BvbnNlIGlzIHJlY2lldmVkLCB0aGUgY2FsbGJhY2sKICogZnVuY3Rpb24gd2lsbCBiZSBpbnZva2VkIGFuZCBwYXNzZWQgdGhlIHJlc3VsdHMgb2YgdGhlIGNhbGwuCiAqIEB0eXBlIENvbnZlcnRMZWFkUmVzdWx0W10vU29hcEZhdWx0CiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5jb252ZXJ0TGVhZCA9IGZ1bmN0aW9uKGxlYWRDb252ZXJ0cywgY2FsbGJhY2spIHsKCXZhciBzZkNsaWVudCA9IHRoaXM7Cgl2YXIgcmV0dXJuVmFsdWU7CglpbnRlcm5hbENhbGxiYWNrID0gZnVuY3Rpb24ocmVxKSB7cmV0dXJuVmFsdWUgPSBTZm9yY2UuY3JlYXRlU2ZvcmNlT2JqZWN0KHJlcSk7aWYgKGNhbGxiYWNrKSB7Y2FsbGJhY2socmV0dXJuVmFsdWUpO319OwoJbWFrZUNvbnZlcnRMZWFkUmVxdWVzdCA9IGZ1bmN0aW9uKCkgeyB2YXIgc29hcCA9ICI8Y29udmVydExlYWQgeG1sbnM9XCJ1cm46cGFydG5lci5zb2FwLnNmb3JjZS5jb21cIj4iO2lmIChTZm9yY2UuVXRpbC5kbHR5cGVvZihsZWFkQ29udmVydHMpID09ICJhcnJheSIpIHtmb3IgKHZhciBpPTA7aTxsZWFkQ29udmVydHMubGVuZ3RoO2krKykge3NvYXAgKz0gbGVhZENvbnZlcnRzW2ldLnRvU29hcCgpO319IGVsc2Uge3NvYXAgKz0gbGVhZENvbnZlcnRzLnRvU29hcCgpO31zb2FwICs9ICI8L2NvbnZlcnRMZWFkPiI7cmV0dXJuIHNmQ2xpZW50LmJ1aWxkUmVxdWVzdChzb2FwKTt9Cgl2YXIgYXN5bmMgPSAoY2FsbGJhY2sgIT0gdW5kZWZpbmVkKTsKCXRoaXMuU2VuZFJlcXVlc3QobWFrZUNvbnZlcnRMZWFkUmVxdWVzdCgpLCBpbnRlcm5hbENhbGxiYWNrLCAibGVhZENvbnZlcnQiLCBhc3luYywgdGhpcy5nZXRVcmwoKSk7CglyZXR1cm4gcmV0dXJuVmFsdWU7Cn07Ci8qKiBAaWdub3JlICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLkNvbnZlcnRMZWFkCT0gU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuY29udmVydExlYWQ7CgovKioKICogUGVyZm9ybXMgYSBkZXNjcmliZSBzb2JqZWN0IG9wZXJhdGlvbi4gIFRoZSByZXN1bHRzIGFyZSBjYWNoZWQgaW4gYSBoYXNobWFwIGltcGxlbWVudGF0aW9uIGZvciAKICogdGhlIGxpZmV0aW1lIG9mIHRoZSBqYXZhc2NyaXB0IHNlc3Npb24uCiAqIEBwYXJhbSB7U3RyaW5nfSBvYmplY3RUeXBlIFRoZSB0eXBlIG9mIG9iamVjdCB0byBkZXNjcmliZS4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQSBwb2ludGVyIHRvIGEgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgdGhlIGh0dHAgcmVxdWVzdCBoYXMgcmV0dXJuZWQuCiAqIEBwYXJhbSB7Qm9vbGVhbn0gYXN5bmMgQSBmbGFnIHRvIGluZGljYXRlIHRoYXQgdGhlIGNhbGwgc2hvdWxkIGJlIG1hZGUgYXN5bmNocm9ub3VzbHkgb3Igbm90LiAgQQogKiB2YWx1ZSBvZiB0cnVlIHdpbGwgY2F1c2UgdGhlIG1ldGhvZCB0byByZXR1cm4gaW1tZWRpYXRlbHkgYW5kIG9uY2UgYSByZXNwb25zZSBpcyByZWNpZXZlZCwgdGhlIGNhbGxiYWNrCiAqIGZ1bmN0aW9uIHdpbGwgYmUgaW52b2tlZCBhbmQgcGFzc2VkIHRoZSByZXN1bHRzIG9mIHRoZSBjYWxsLgogKiBAdHlwZSBEZXNjcmliZVNPYmplY3RSZXN1bHQvU29hcEZhdWx0CiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5kZXNjcmliZVNPYmplY3QgPSBmdW5jdGlvbihvYmplY3RUeXBlLCBjYWxsYmFjaykgewoJdmFyIHNmQ2xpZW50ID0gdGhpczsKCXZhciByZXR1cm5WYWx1ZTsKCWludGVybmFsQ2FsbGJhY2sgPSBmdW5jdGlvbihyZXEpIHsKCSAgICByZXR1cm5WYWx1ZSA9IFNmb3JjZS5jcmVhdGVTZm9yY2VPYmplY3QocmVxKTsKCSAgICBpZiAoU2ZvcmNlLlV0aWwuZGx0eXBlb2YocmV0dXJuVmFsdWUpICE9ICJGYXVsdCIpIHsKCSAgICAgICAgc2ZDbGllbnQuZGVzY3JpYmVDYWNoZS5hZGRJdGVtKG9iamVjdFR5cGUudG9Mb3dlckNhc2UoKSwgcmV0dXJuVmFsdWUpOwoJICAgIH0KCSAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHJldHVyblZhbHVlKTsKCX07CglpZiAodGhpcy5kZXNjcmliZUNhY2hlLmNvbnRhaW5zSXRlbShvYmplY3RUeXBlLnRvTG93ZXJDYXNlKCkpID09IGZhbHNlKSB7CgkJbWFrZURlc2NyaWJlU09iamVjdFJlcXVlc3QgPSBmdW5jdGlvbihvYmplY3RUeXBlKSB7IAoJCQlyZXR1cm4gc2ZDbGllbnQuYnVpbGRSZXF1ZXN0KCI8ZGVzY3JpYmVTT2JqZWN0IHhtbG5zPVwidXJuOnBhcnRuZXIuc29hcC5zZm9yY2UuY29tXCI+PHNPYmplY3RUeXBlPiIgKyBvYmplY3RUeXBlICsgIjwvc09iamVjdFR5cGU+PC9kZXNjcmliZVNPYmplY3Q+Iik7CQoJCX07CgkJdmFyIGFzeW5jID0gKGNhbGxiYWNrICE9IHVuZGVmaW5lZCk7CgkJc2ZDbGllbnQuU2VuZFJlcXVlc3QobWFrZURlc2NyaWJlU09iamVjdFJlcXVlc3Qob2JqZWN0VHlwZSksIGludGVybmFsQ2FsbGJhY2ssICJkZXNjcmliZSIsIGFzeW5jLCBzZkNsaWVudC5nZXRVcmwoKSk7Cgl9IGVsc2UgewoJCXJldHVyblZhbHVlID0gdGhpcy5kZXNjcmliZUNhY2hlLmdldEl0ZW0ob2JqZWN0VHlwZS50b0xvd2VyQ2FzZSgpKTsKCQlpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHJldHVyblZhbHVlKTsKCX0KCXJldHVybiByZXR1cm5WYWx1ZTsKfTsKLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuRGVzY3JpYmVTT2JqZWN0ID0gU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuZGVzY3JpYmVTT2JqZWN0OwoKLyoqCiAqIFNpbWlsaWFyIHRvIGRlc2NyaWJTT2JqZWN0IGJ1dCB5b3UgY2FuIGRlc2NyaWJlIG11bHRpcGxlIG9iamVjdHMgd2l0aCBvbmUgY2FsbC4KICogQHNlZSBAZGVzY3JpYmVTT2JqZWN0CiAqIEBwYXJhbSB7U3RyaW5nfSBvYmplY3RUeXBlIFRoZSB0eXBlIG9mIG9iamVjdCB0byBkZXNjcmliZS4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQSBwb2ludGVyIHRvIGEgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgdGhlIGh0dHAgcmVxdWVzdCBoYXMgcmV0dXJuZWQuCiAqIEBwYXJhbSB7Qm9vbGVhbn0gYXN5bmMgQSBmbGFnIHRvIGluZGljYXRlIHRoYXQgdGhlIGNhbGwgc2hvdWxkIGJlIG1hZGUgYXN5bmNocm9ub3VzbHkgb3Igbm90LiAgQQogKiB2YWx1ZSBvZiB0cnVlIHdpbGwgY2F1c2UgdGhlIG1ldGhvZCB0byByZXR1cm4gaW1tZWRpYXRlbHkgYW5kIG9uY2UgYSByZXNwb25zZSBpcyByZWNpZXZlZCwgdGhlIGNhbGxiYWNrCiAqIGZ1bmN0aW9uIHdpbGwgYmUgaW52b2tlZCBhbmQgcGFzc2VkIHRoZSByZXN1bHRzIG9mIHRoZSBjYWxsLgogKiBAdHlwZSBEZXNjcmliZVNPYmplY3RSZXN1bHQvU29hcEZhdWx0CiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5kZXNjcmliZVNPYmplY3RzID0gZnVuY3Rpb24ob2JqZWN0VHlwZXMsIGNhbGxiYWNrKSB7Cgl2YXIgc2ZDbGllbnQgPSB0aGlzOwoJdmFyIHJldHVyblZhbHVlID0gbnVsbDsKCWludGVybmFsQ2FsbGJhY2sgPSBmdW5jdGlvbihyZXEpIHsKCSAgICBkZWJ1Z2dlcjsKCSAgICB2YXIgciA9IG5ldyBBcnJheSgpOwoJICAgIHJldHVyblZhbHVlID0gU2ZvcmNlLmNyZWF0ZVNmb3JjZU9iamVjdChyZXEpOwoJICAgIGlmIChyZXR1cm5WYWx1ZS5jbGFzc05hbWUgIT0gIkZhdWx0IikgewoJICAgICAgICBmb3IgKHZhciBpaT0wO2lpPG9iamVjdFR5cGVzLmxlbmd0aDtpaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgbiA9IG9iamVjdFR5cGVzW2lpXS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgaWYgKHNmQ2xpZW50LmRlc2NyaWJlQ2FjaGUuY29udGFpbnNJdGVtKG4udG9Mb3dlckNhc2UoKSkgPT0gZmFsc2UpIHsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBqaj0wO2pqPHJldHVyblZhbHVlLmxlbmd0aDtqaisrKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciBuMiA9IHJldHVyblZhbHVlW2pqXS5uYW1lLnRvTG93ZXJDYXNlKCk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChuMiA9PSBuKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzZkNsaWVudC5kZXNjcmliZUNhY2hlLmFkZEl0ZW0obi50b0xvd2VyQ2FzZSgpLCByZXR1cm5WYWx1ZVtqal0pOwoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByLnB1c2goc2ZDbGllbnQuZGVzY3JpYmVDYWNoZS5nZXRJdGVtKG4udG9Mb3dlckNhc2UoKSkpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVyblZhbHVlID0gcjsKCSAgICB9CgkgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhyZXR1cm5WYWx1ZSk7Cgl9OwoJdmFyIG5vbkNhY2hlZE9iamVjdFR5cGVzID0gbmV3IEFycmF5KCk7Cglmb3IgKHZhciBpPTA7aTxvYmplY3RUeXBlcy5sZW5ndGg7aSsrKSB7CgkgICAgaWYgKHRoaXMuZGVzY3JpYmVDYWNoZS5jb250YWluc0l0ZW0ob2JqZWN0VHlwZXNbaV0udG9Mb3dlckNhc2UoKSkgPT0gZmFsc2UpIHsKCSAgICAgICAgbm9uQ2FjaGVkT2JqZWN0VHlwZXMucHVzaChvYmplY3RUeXBlc1tpXSk7CgkgICAgfQoJfQoJaWYgKG5vbkNhY2hlZE9iamVjdFR5cGVzLmxlbmd0aCA9PSAwKSB7CgkgICAgdmFyIHJldEFycmF5ID0gbmV3IEFycmF5KCk7CgkgICAgZm9yICh2YXIgaT0wO2k8b2JqZWN0VHlwZXMubGVuZ3RoO2krKykgewoJICAgICAgICByZXRBcnJheS5wdXNoKHRoaXMuZGVzY3JpYmVDYWNoZS5nZXRJdGVtKG9iamVjdFR5cGVzW2ldLnRvTG93ZXJDYXNlKCkpKTsKCSAgICB9CgkgICAgcmV0dXJuVmFsdWUgPSByZXRBcnJheTsKCSAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHJldHVyblZhbHVlKTsKCX0gZWxzZSB7CgkgICAgbWFrZURlc2NyaWJlU09iamVjdHNSZXF1ZXN0ID0gZnVuY3Rpb24obm9uQ2FjaGVkT2JqZWN0VHlwZXMpIHsgCgkgICAgICAgIHZhciBzb2FwTXNnID0gIjxkZXNjcmliZVNPYmplY3RzIHhtbG5zPVwidXJuOnBhcnRuZXIuc29hcC5zZm9yY2UuY29tXCI+IjsKCSAgICAgICAgZm9yICh2YXIgaT0wO2k8bm9uQ2FjaGVkT2JqZWN0VHlwZXMubGVuZ3RoO2krKykgewoJICAgICAgICAgICAgc29hcE1zZyArPSAiPHNPYmplY3RUeXBlPiIgKyBub25DYWNoZWRPYmplY3RUeXBlc1tpXSArICI8L3NPYmplY3RUeXBlPiI7CgkgICAgICAgIH0KCSAgICAgICAgc29hcE1zZyArPSAiPC9kZXNjcmliZVNPYmplY3RzPiI7CgkgICAgICAgIHJldHVybiBzZkNsaWVudC5idWlsZFJlcXVlc3Qoc29hcE1zZyk7CiAgICAgICAgfTsKCSAgICB2YXIgYXN5bmMgPSAoY2FsbGJhY2sgIT0gdW5kZWZpbmVkKTsKCSAgICB0aGlzLlNlbmRSZXF1ZXN0KG1ha2VEZXNjcmliZVNPYmplY3RzUmVxdWVzdChub25DYWNoZWRPYmplY3RUeXBlcyksIGludGVybmFsQ2FsbGJhY2ssICJkZXNjcmliZSIsIGFzeW5jLCB0aGlzLmdldFVybCgpKTsKCX0KCXJldHVybiByZXR1cm5WYWx1ZTsKfTsKLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuRGVzY3JpYmVTT2JqZWN0cyA9IFNmb3JjZS5DbGllbnQucHJvdG90eXBlLmRlc2NyaWJlU09iamVjdHM7Ci8qKgogKiBQZXJmb3JtcyBhIGRlc2NyaWJlIGdsb2JhbCBvcGVyYXRpb24gdG8gcmV0cmlldmUgYWxsIHRoZSBhdmFpbGFibGUgc2ZvcmNlIG9iamVjdHMuCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIEEgcG9pbnRlciB0byBhIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbmNlIHRoZSBodHRwIHJlcXVlc3QgaGFzIHJldHVybmVkLgogKiBAcGFyYW0ge0Jvb2xlYW59IGFzeW5jIEEgZmxhZyB0byBpbmRpY2F0ZSB0aGF0IHRoZSBjYWxsIHNob3VsZCBiZSBtYWRlIGFzeW5jaHJvbm91c2x5IG9yIG5vdC4gIEEKICogdmFsdWUgb2YgdHJ1ZSB3aWxsIGNhdXNlIHRoZSBtZXRob2QgdG8gcmV0dXJuIGltbWVkaWF0ZWx5IGFuZCBvbmNlIGEgcmVzcG9uc2UgaXMgcmVjaWV2ZWQsIHRoZSBjYWxsYmFjawogKiBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQgYW5kIHBhc3NlZCB0aGUgcmVzdWx0cyBvZiB0aGUgY2FsbC4KICogQHR5cGUgRGVzY3JpYmVHbG9iYWxSZXN1bHQvU29hcEZhdWx0CiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5kZXNjcmliZUdsb2JhbCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7Cgl2YXIgc2ZDbGllbnQgPSB0aGlzOwoJdmFyIHJldHVyblZhbHVlOwoJaW50ZXJuYWxDYWxsYmFjayA9IGZ1bmN0aW9uKHJlcSkgewoJCXJldHVyblZhbHVlID0gU2ZvcmNlLmNyZWF0ZVNmb3JjZU9iamVjdChyZXEpOwoJCWlmIChjYWxsYmFjaykgeyAKCQkJY2FsbGJhY2socmV0dXJuVmFsdWUpOyAKCQl9Cgl9OwoJbWFrZURlc2NyaWJlR2xvYmFsUmVxdWVzdCA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gc2ZDbGllbnQuYnVpbGRSZXF1ZXN0KCI8ZGVzY3JpYmVHbG9iYWwgeG1sbnM9J3VybjpwYXJ0bmVyLnNvYXAuc2ZvcmNlLmNvbSc+PC9kZXNjcmliZUdsb2JhbD4iKTsgfTsKCWFzeW5jID0gKGNhbGxiYWNrICE9IHVuZGVmaW5lZCk7Cgl0aGlzLlNlbmRSZXF1ZXN0KG1ha2VEZXNjcmliZUdsb2JhbFJlcXVlc3QoKSwgaW50ZXJuYWxDYWxsYmFjaywgImRlc2NyaWJlR2xvYmFsIiwgYXN5bmMsIHRoaXMuZ2V0VXJsKCkpOwoJcmV0dXJuIHJldHVyblZhbHVlOwp9OwovKiogQGlnbm9yZSAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5EZXNjcmliZUdsb2JhbCA9IFNmb3JjZS5DbGllbnQucHJvdG90eXBlLmRlc2NyaWJlR2xvYmFsOwovKioKICogUGVyZm9ybXMgYSBkZXNjcmliZSBsYXlvdXQgb3BlcmF0aW9uCiAqIEBwYXJhbSB7U3RyaW5nfSBvYmplY3RUeXBlIFRoZSB0eXBlIG9mIG9iamVjdCB0byBkZXNjcmliZSB0aGUgbGF5b3V0IGZvci4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQSBwb2ludGVyIHRvIGEgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgdGhlIGh0dHAgcmVxdWVzdCBoYXMgcmV0dXJuZWQuCiAqIEBwYXJhbSB7Qm9vbGVhbn0gYXN5bmMgQSBmbGFnIHRvIGluZGljYXRlIHRoYXQgdGhlIGNhbGwgc2hvdWxkIGJlIG1hZGUgYXN5bmNocm9ub3VzbHkgb3Igbm90LiAgQQogKiB2YWx1ZSBvZiB0cnVlIHdpbGwgY2F1c2UgdGhlIG1ldGhvZCB0byByZXR1cm4gaW1tZWRpYXRlbHkgYW5kIG9uY2UgYSByZXNwb25zZSBpcyByZWNpZXZlZCwgdGhlIGNhbGxiYWNrCiAqIGZ1bmN0aW9uIHdpbGwgYmUgaW52b2tlZCBhbmQgcGFzc2VkIHRoZSByZXN1bHRzIG9mIHRoZSBjYWxsLgogKiBAdHlwZSBEZXNjcmliZUxheW91dFJlc3VsdC9Tb2FwRmF1bHQKICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLmRlc2NyaWJlTGF5b3V0ID0gZnVuY3Rpb24ob2JqZWN0VHlwZSwgY2FsbGJhY2spIHsKCXZhciBzZkNsaWVudCA9IHRoaXM7Cgl2YXIgcmV0dXJuVmFsdWU7CglpbnRlcm5hbENhbGxiYWNrID0gZnVuY3Rpb24ocmVxKSB7cmV0dXJuVmFsdWUgPSBTZm9yY2UuY3JlYXRlU2ZvcmNlT2JqZWN0KHJlcSk7IGlmIChTZm9yY2UuVXRpbC5kbHR5cGVvZihyZXR1cm5WYWx1ZSkgIT0gIlNvYXBGYXVsdCIpIHtzZkNsaWVudC5kZXNjcmliZUxheW91dENhY2hlLmFkZEl0ZW0ob2JqZWN0VHlwZS50b0xvd2VyQ2FzZSgpLCByZXR1cm5WYWx1ZSk7fWlmIChjYWxsYmFjaykgY2FsbGJhY2socmV0dXJuVmFsdWUpO307CglpZiAodGhpcy5kZXNjcmliZUxheW91dENhY2hlLmNvbnRhaW5zSXRlbShvYmplY3RUeXBlLnRvTG93ZXJDYXNlKCkpID09IGZhbHNlKSB7bWFrZURlc2NyaWJlTGF5b3V0UmVxdWVzdCA9IGZ1bmN0aW9uKG9iamVjdFR5cGUpIHsgcmV0dXJuIHNmQ2xpZW50LmJ1aWxkUmVxdWVzdCgiPGRlc2NyaWJlTGF5b3V0IHhtbG5zPVwidXJuOnBhcnRuZXIuc29hcC5zZm9yY2UuY29tXCI+PHNPYmplY3RUeXBlPiIgKyBvYmplY3RUeXBlICsgIjwvc09iamVjdFR5cGU+PC9kZXNjcmliZUxheW91dD4iKTt9O2FzeW5jID0gKGNhbGxiYWNrICE9IHVuZGVmaW5lZCk7dGhpcy5TZW5kUmVxdWVzdChtYWtlRGVzY3JpYmVMYXlvdXRSZXF1ZXN0KG9iamVjdFR5cGUpLCBpbnRlcm5hbENhbGxiYWNrLCAiZGVzY3JpYmVMYXlvdXQiLCBhc3luYywgdGhpcy5nZXRVcmwoKSk7fSBlbHNlIHtyZXR1cm5WYWx1ZSA9IHRoaXMuZGVzY3JpYmVMYXlvdXRDYWNoZS5nZXRJdGVtKG9iamVjdFR5cGUudG9Mb3dlckNhc2UoKSk7aWYgKGNhbGxiYWNrKSBjYWxsYmFjayhyZXR1cm5WYWx1ZSk7fQoJcmV0dXJuIHJldHVyblZhbHVlOwp9OwovKiogQGlnbm9yZSAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5EZXNjcmliZUxheW91dCA9IFNmb3JjZS5DbGllbnQucHJvdG90eXBlLmRlc2NyaWJlTGF5b3V0OwovKioKICogUGVyZm9ybXMgYSBkZXNjcmliZSB0YWJzIG9wZXJhdGlvbgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBBIHBvaW50ZXIgdG8gYSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSB0aGUgaHR0cCByZXF1ZXN0IGhhcyByZXR1cm5lZC4KICogQHBhcmFtIHtCb29sZWFufSBhc3luYyBBIGZsYWcgdG8gaW5kaWNhdGUgdGhhdCB0aGUgY2FsbCBzaG91bGQgYmUgbWFkZSBhc3luY2hyb25vdXNseSBvciBub3QuICBBCiAqIHZhbHVlIG9mIHRydWUgd2lsbCBjYXVzZSB0aGUgbWV0aG9kIHRvIHJldHVybiBpbW1lZGlhdGVseSBhbmQgb25jZSBhIHJlc3BvbnNlIGlzIHJlY2lldmVkLCB0aGUgY2FsbGJhY2sKICogZnVuY3Rpb24gd2lsbCBiZSBpbnZva2VkIGFuZCBwYXNzZWQgdGhlIHJlc3VsdHMgb2YgdGhlIGNhbGwuCiAqIEB0eXBlIERlc2NyaWJlVGFiU2V0UmVzdWx0W10vU29hcEZhdWx0CiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5kZXNjcmliZVRhYnMgPSBmdW5jdGlvbihjYWxsYmFjaykgewoJdmFyIHNmQ2xpZW50ID0gdGhpczsKCXZhciByZXR1cm5WYWx1ZTsKCWludGVybmFsQ2FsbGJhY2sgPSBmdW5jdGlvbihyZXEpIHsKCQlyZXR1cm5WYWx1ZSA9IFNmb3JjZS5jcmVhdGVTZm9yY2VPYmplY3QocmVxKTsgCgkJaWYgKFNmb3JjZS5VdGlsLmRsdHlwZW9mKHJldHVyblZhbHVlKSAhPSAiU29hcEZhdWx0IikgewoJCQlzZkNsaWVudC5kZXNjcmliZVRhYnNDYWNoZS5hZGRJdGVtKCJ0YWJzIiwgcmV0dXJuVmFsdWUpOwoJCX0KCQlpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHJldHVyblZhbHVlKTsKCX0KCWlmICh0aGlzLmRlc2NyaWJlVGFic0NhY2hlLmNvbnRhaW5zSXRlbSgidGFicyIpID09IGZhbHNlKSB7CgkJbWFrZURlc2NyaWJlVGFic1JlcXVlc3QgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHNmQ2xpZW50LmJ1aWxkUmVxdWVzdCgiPGRlc2NyaWJlVGFicyB4bWxucz1cInVybjpwYXJ0bmVyLnNvYXAuc2ZvcmNlLmNvbVwiPjwvZGVzY3JpYmVUYWJzPiIpO307CgkJYXN5bmMgPSAoY2FsbGJhY2sgIT0gdW5kZWZpbmVkKTsKCQl0aGlzLlNlbmRSZXF1ZXN0KG1ha2VEZXNjcmliZVRhYnNSZXF1ZXN0KCksIGludGVybmFsQ2FsbGJhY2ssICJkZXNjcmliZVRhYnMiLCBhc3luYywgdGhpcy5nZXRVcmwoKSk7Cgl9IGVsc2UgewoJCXJldHVyblZhbHVlID0gdGhpcy5kZXNjcmliZVRhYnNDYWNoZS5nZXRJdGVtKCJ0YWJzIik7CgkJaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhyZXR1cm5WYWx1ZSk7Cgl9CglyZXR1cm4gcmV0dXJuVmFsdWU7Cn07Ci8qKiBAaWdub3JlICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLkRlc2NyaWJlVGFicyA9IFNmb3JjZS5DbGllbnQucHJvdG90eXBlLmRlc2NyaWJlVGFiczsKLyoqCiAqIFBlcmZvcm1zIGEgZ2V0IHNlcnZlciB0aW1lc3RhbXAgb3BlcmF0aW9uCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIEEgcG9pbnRlciB0byBhIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbmNlIHRoZSBodHRwIHJlcXVlc3QgaGFzIHJldHVybmVkLgogKiBAcGFyYW0ge0Jvb2xlYW59IGFzeW5jIEEgZmxhZyB0byBpbmRpY2F0ZSB0aGF0IHRoZSBjYWxsIHNob3VsZCBiZSBtYWRlIGFzeW5jaHJvbm91c2x5IG9yIG5vdC4gIEEKICogdmFsdWUgb2YgdHJ1ZSB3aWxsIGNhdXNlIHRoZSBtZXRob2QgdG8gcmV0dXJuIGltbWVkaWF0ZWx5IGFuZCBvbmNlIGEgcmVzcG9uc2UgaXMgcmVjaWV2ZWQsIHRoZSBjYWxsYmFjawogKiBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQgYW5kIHBhc3NlZCB0aGUgcmVzdWx0cyBvZiB0aGUgY2FsbC4KICogQHR5cGUgR2V0U2VydmVyVGltZXN0YW1wUmVzdWx0L1NvYXBGYXVsdAogKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuZ2V0U2VydmVyVGltZXN0YW1wID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKCXZhciBzZkNsaWVudCA9IHRoaXM7Cgl2YXIgcmV0dXJuVmFsdWUgPSBudWxsOwoJaW50ZXJuYWxDYWxsYmFjayA9IGZ1bmN0aW9uKHJlcSkgewoJCXJldHVyblZhbHVlID0gU2ZvcmNlLmNyZWF0ZVNmb3JjZU9iamVjdChyZXEpOyAKCQlpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHJldHVyblZhbHVlKTsKCX0KCW1ha2VHZXRTZXJ2ZXJUaW1lc3RhbXBSZXF1ZXN0ID0gZnVuY3Rpb24oKSB7CXJldHVybiBzZkNsaWVudC5idWlsZFJlcXVlc3QoIjxnZXRTZXJ2ZXJUaW1lc3RhbXAgeG1sbnM9J3VybjpwYXJ0bmVyLnNvYXAuc2ZvcmNlLmNvbScgLz4iKTsgfTsKCWFzeW5jID0gKGNhbGxiYWNrICE9IHVuZGVmaW5lZCk7Cgl0aGlzLlNlbmRSZXF1ZXN0KG1ha2VHZXRTZXJ2ZXJUaW1lc3RhbXBSZXF1ZXN0KCksIGludGVybmFsQ2FsbGJhY2ssICJnZXRTZXJ2ZXJUaW1lU3RhbXAiLCBhc3luYywgdGhpcy5nZXRVcmwoKSk7CglpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHJldHVyblZhbHVlKTsKCXJldHVybiByZXR1cm5WYWx1ZTsKfTsKLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuR2V0U2VydmVyVGltZXN0YW1wID1TZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5nZXRTZXJ2ZXJUaW1lc3RhbXA7Ci8qKgogKiBQZXJmb3JtcyBhIGdldCB1c2VyIGluZm8gb3BlcmF0aW9uCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIEEgcG9pbnRlciB0byBhIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbmNlIHRoZSBodHRwIHJlcXVlc3QgaGFzIHJldHVybmVkLgogKiBAcGFyYW0ge0Jvb2xlYW59IGFzeW5jIEEgZmxhZyB0byBpbmRpY2F0ZSB0aGF0IHRoZSBjYWxsIHNob3VsZCBiZSBtYWRlIGFzeW5jaHJvbm91c2x5IG9yIG5vdC4gIEEKICogdmFsdWUgb2YgdHJ1ZSB3aWxsIGNhdXNlIHRoZSBtZXRob2QgdG8gcmV0dXJuIGltbWVkaWF0ZWx5IGFuZCBvbmNlIGEgcmVzcG9uc2UgaXMgcmVjaWV2ZWQsIHRoZSBjYWxsYmFjawogKiBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQgYW5kIHBhc3NlZCB0aGUgcmVzdWx0cyBvZiB0aGUgY2FsbC4KICogQHR5cGUgR2V0VXNlckluZm9SZXN1bHQvU29hcEZhdWx0CiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5nZXRVc2VySW5mbyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7Cgl2YXIgc2ZDbGllbnQgPSB0aGlzOwoJdmFyIHJldHVyblZhbHVlOwoJaW50ZXJuYWxDYWxsYmFjayA9IGZ1bmN0aW9uKHJlcSkgewoJCXJldHVyblZhbHVlID0gU2ZvcmNlLmNyZWF0ZVNmb3JjZU9iamVjdChyZXEpOwoJCWlmIChyZXR1cm5WYWx1ZS5jbGFzc05hbWUgPSAiVXNlckluZm9SZXN1bHQiKSB7CgkJCXNmQ2xpZW50LnNldFVzZXJJbmZvKHJldHVyblZhbHVlKTsKCQl9CgkJaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhyZXR1cm5WYWx1ZSk7Cgl9CgltYWtlR2V0VXNlckluZm9SZXF1ZXN0ID0gZnVuY3Rpb24oKSB7CXJldHVybiBzZkNsaWVudC5idWlsZFJlcXVlc3QoIjxnZXRVc2VySW5mbyB4bWxucz0ndXJuOnBhcnRuZXIuc29hcC5zZm9yY2UuY29tJyAvPiIpOyB9OwoJYXN5bmMgPSAoY2FsbGJhY2sgIT0gdW5kZWZpbmVkKTsKCXRoaXMuU2VuZFJlcXVlc3QobWFrZUdldFVzZXJJbmZvUmVxdWVzdCgpLCBpbnRlcm5hbENhbGxiYWNrLCAiZ2V0VXNlckluZm8iLCBhc3luYywgdGhpcy5nZXRVcmwoKSk7CglpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHJldHVyblZhbHVlKTsKCXJldHVybiByZXR1cm5WYWx1ZTsKfTsKLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuR2V0VXNlckluZm8gPSBTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5nZXRVc2VySW5mbzsKLyoqCiAqIFBlcmZvcm1zIGEgZ2V0IHVwZGF0ZWQgb3BlcmF0aW9uCiAqIEBwYXJhbSB7U3RyaW5nfSBvYmplY3RUeXBlIFRoZSB0eXBlIG9mIG9iamVjdCB0byBwb2xsLgogKiBAcGFyYW0ge0RhdGV9IHN0YXJ0RGF0ZSBUaGUgbG93ZXIgYm91bmRhcnkgb2YgdGhlIHBvbGxpbmcgd2luZG93LgogKiBAcGFyYW0ge0RhdGV9IGVuZERhdGUgVGhlIHVwcGVyIGJvdW5kYXJ5IG9mIHRoZSBwb2xsaW5nIHdpbmRvdy4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQSBwb2ludGVyIHRvIGEgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgdGhlIGh0dHAgcmVxdWVzdCBoYXMgcmV0dXJuZWQuCiAqIEBwYXJhbSB7Qm9vbGVhbn0gYXN5bmMgQSBmbGFnIHRvIGluZGljYXRlIHRoYXQgdGhlIGNhbGwgc2hvdWxkIGJlIG1hZGUgYXN5bmNocm9ub3VzbHkgb3Igbm90LiAgQQogKiB2YWx1ZSBvZiB0cnVlIHdpbGwgY2F1c2UgdGhlIG1ldGhvZCB0byByZXR1cm4gaW1tZWRpYXRlbHkgYW5kIG9uY2UgYSByZXNwb25zZSBpcyByZWNpZXZlZCwgdGhlIGNhbGxiYWNrCiAqIGZ1bmN0aW9uIHdpbGwgYmUgaW52b2tlZCBhbmQgcGFzc2VkIHRoZSByZXN1bHRzIG9mIHRoZSBjYWxsLgogKiBAdHlwZSBHZXRVcGRhdGVkUmVzdWx0L1NvYXBGYXVsdAogKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuZ2V0VXBkYXRlZCA9IGZ1bmN0aW9uKG9iamVjdFR5cGUsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSwgY2FsbGJhY2spIHsKCXZhciBzZkNsaWVudCA9IHRoaXM7Cgl2YXIgcmV0dXJuVmFsdWU7CglpbnRlcm5hbENhbGxiYWNrID0gZnVuY3Rpb24ocmVxKSB7CgkJcmV0dXJuVmFsdWUgPSBTZm9yY2UuY3JlYXRlU2ZvcmNlT2JqZWN0KHJlcSk7IAoJCWlmIChjYWxsYmFjaykgY2FsbGJhY2socmV0dXJuVmFsdWUpOwoJfQoJbWFrZUdldFVwZGF0ZWRSZXF1ZXN0ID0gZnVuY3Rpb24oKSB7cmV0dXJuIHNmQ2xpZW50LmJ1aWxkUmVxdWVzdCgiPGdldFVwZGF0ZWQgeG1sbnM9J3VybjpwYXJ0bmVyLnNvYXAuc2ZvcmNlLmNvbSc+PHNPYmplY3RUeXBlPiIgKyBvYmplY3RUeXBlICsgIjwvc09iamVjdFR5cGU+PHN0YXJ0RGF0ZT4iICsgU2ZvcmNlLlV0aWwuVG9Jc29EYXRlVGltZShzdGFydERhdGUpICsgIjwvc3RhcnREYXRlPjxlbmREYXRlPiIgKyBTZm9yY2UuVXRpbC5Ub0lzb0RhdGVUaW1lKGVuZERhdGUpICsgIjwvZW5kRGF0ZT48L2dldFVwZGF0ZWQ+Iik7IH07Cglhc3luYyA9IChjYWxsYmFjayAhPSB1bmRlZmluZWQpOwoJdGhpcy5TZW5kUmVxdWVzdChtYWtlR2V0VXBkYXRlZFJlcXVlc3QoKSwgaW50ZXJuYWxDYWxsYmFjaywgImdldFVwZGF0ZWQiLCBhc3luYywgdGhpcy5nZXRVcmwoKSk7CglpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHJldHVyblZhbHVlKTsKCXJldHVybiByZXR1cm5WYWx1ZTsKfTsKLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuR2V0VXBkYXRlZCA9IFNmb3JjZS5DbGllbnQucHJvdG90eXBlLmdldFVwZGF0ZWQ7Ci8qKgogKiBQZXJmb3JtcyBhIGdldCBkZWxldGVkIG9wZXJhdGlvbgogKiBAcGFyYW0ge1N0cmluZ30gb2JqZWN0VHlwZSBUaGUgdHlwZSBvZiBvYmplY3QgdG8gcG9sbC4KICogQHBhcmFtIHtEYXRlfSBzdGFydERhdGUgVGhlIGxvd2VyIGJvdW5kYXJ5IG9mIHRoZSBwb2xsaW5nIHdpbmRvdy4KICogQHBhcmFtIHtEYXRlfSBlbmREYXRlIFRoZSB1cHBlciBib3VuZGFyeSBvZiB0aGUgcG9sbGluZyB3aW5kb3cuCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIEEgcG9pbnRlciB0byBhIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbmNlIHRoZSBodHRwIHJlcXVlc3QgaGFzIHJldHVybmVkLgogKiBAcGFyYW0ge0Jvb2xlYW59IGFzeW5jIEEgZmxhZyB0byBpbmRpY2F0ZSB0aGF0IHRoZSBjYWxsIHNob3VsZCBiZSBtYWRlIGFzeW5jaHJvbm91c2x5IG9yIG5vdC4gIEEKICogdmFsdWUgb2YgdHJ1ZSB3aWxsIGNhdXNlIHRoZSBtZXRob2QgdG8gcmV0dXJuIGltbWVkaWF0ZWx5IGFuZCBvbmNlIGEgcmVzcG9uc2UgaXMgcmVjaWV2ZWQsIHRoZSBjYWxsYmFjawogKiBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQgYW5kIHBhc3NlZCB0aGUgcmVzdWx0cyBvZiB0aGUgY2FsbC4KICogQHR5cGUgR2V0RGVsZXRlZFJlc3VsdC9Tb2FwRmF1bHQKICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLmdldERlbGV0ZWQgPSBmdW5jdGlvbihvYmplY3RUeXBlLCBzdGFydERhdGUsIGVuZERhdGUsIGNhbGxiYWNrKSB7Cgl2YXIgc2ZDbGllbnQgPSB0aGlzOwoJdmFyIHJldHVyblZhbHVlOwoJaW50ZXJuYWxDYWxsYmFjayA9IGZ1bmN0aW9uKHJlcSkgewoJCXJldHVyblZhbHVlID0gU2ZvcmNlLmNyZWF0ZVNmb3JjZU9iamVjdChyZXEpOyAKCQlpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHJldHVyblZhbHVlKTsKCX0KCW1ha2VHZXREZWxldGVkUmVxdWVzdCA9IGZ1bmN0aW9uKCkgewlyZXR1cm4gc2ZDbGllbnQuYnVpbGRSZXF1ZXN0KCI8Z2V0RGVsZXRlZCB4bWxucz0ndXJuOnBhcnRuZXIuc29hcC5zZm9yY2UuY29tJz48c09iamVjdFR5cGU+IiArIG9iamVjdFR5cGUgKyAiPC9zT2JqZWN0VHlwZT48c3RhcnREYXRlPiIgKyBTZm9yY2UuVXRpbC5Ub0lzb0RhdGVUaW1lKHN0YXJ0RGF0ZSkgKyAiPC9zdGFydERhdGU+PGVuZERhdGU+IiArIFNmb3JjZS5VdGlsLlRvSXNvRGF0ZVRpbWUoZW5kRGF0ZSkgKyAiPC9lbmREYXRlPjwvZ2V0RGVsZXRlZD4iKTsgfTsKCWFzeW5jID0gKGNhbGxiYWNrICE9IHVuZGVmaW5lZCk7Cgl0aGlzLlNlbmRSZXF1ZXN0KG1ha2VHZXREZWxldGVkUmVxdWVzdCgpLCBpbnRlcm5hbENhbGxiYWNrLCAiZ2V0RGVsZXRlZCIsIGFzeW5jLCB0aGlzLmdldFVybCgpKTsKCWlmIChjYWxsYmFjaykgY2FsbGJhY2socmV0dXJuVmFsdWUpOwoJcmV0dXJuIHJldHVyblZhbHVlOwp9OwovKiogQGlnbm9yZSAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5HZXREZWxldGVkID0gU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuZ2V0RGVsZXRlZDsKLyoqCiAqIFBlcmZvcm1zIGEgcXVlcnkgb3BlcmF0aW9uCiAqIEBwYXJhbSB7U3RyaW5nfSBzb3FsIFRoZSBzZm9yY2Ugb2JqZWN0IHF1ZXJ5IGxhbmd1YWdlIHRoYXQgY29uc3RpdHV0ZXMgYSBzZWxlY3Rpb24uCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIEEgcG9pbnRlciB0byBhIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbmNlIHRoZSBodHRwIHJlcXVlc3QgaGFzIHJldHVybmVkLgogKiBAcGFyYW0ge0Jvb2xlYW59IGFzeW5jIEEgZmxhZyB0byBpbmRpY2F0ZSB0aGF0IHRoZSBjYWxsIHNob3VsZCBiZSBtYWRlIGFzeW5jaHJvbm91c2x5IG9yIG5vdC4gIEEKICogdmFsdWUgb2YgdHJ1ZSB3aWxsIGNhdXNlIHRoZSBtZXRob2QgdG8gcmV0dXJuIGltbWVkaWF0ZWx5IGFuZCBvbmNlIGEgcmVzcG9uc2UgaXMgcmVjaWV2ZWQsIHRoZSBjYWxsYmFjawogKiBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQgYW5kIHBhc3NlZCB0aGUgcmVzdWx0cyBvZiB0aGUgY2FsbC4KICogQHR5cGUgUXVlcnlSZXN1bHQvU29hcEZhdWx0CiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5zZWxlY3RBbGxRdWVyeSA9IGZ1bmN0aW9uKG9iamVjdCwgd2hlcmVDbGF1c2UsIGNhbGxiYWNrKSB7Cgl2YXIgc2ZDbGllbnQgPSB0aGlzOwoJdmFyIHJldHVyblZhbHVlOwoJdmFyIHNvcWwgPSAiU2VsZWN0ICIgKyBzZm9yY2VDbGllbnQuRGVzY3JpYmVTT2JqZWN0KG9iamVjdCkuZmllbGRMaXN0ICsgIiBGcm9tICIgKyBvYmplY3Q7CglpZiAoU2ZvcmNlLlV0aWwuZGx0eXBlb2Yod2hlcmVDbGF1c2UpLnRvTG93ZXJDYXNlKCkgPT0gInN0cmluZyIpIHsKCQlzb3FsICs9ICIgIiArIHdoZXJlQ2xhdXNlOwoJfQoJaW50ZXJuYWxDYWxsYmFjayA9IGZ1bmN0aW9uKHJlcSkgewoJCXJldHVyblZhbHVlID0gU2ZvcmNlLmNyZWF0ZVNmb3JjZU9iamVjdChyZXEpOwoJCXJldHVyblZhbHVlWyJTT1FMIl0gPSBzb3FsOwoJCWlmIChjYWxsYmFjaykgewoJCQljYWxsYmFjayhyZXR1cm5WYWx1ZSk7CgkJfQoJfQoJbWFrZVF1ZXJ5UmVxdWVzdCA9IGZ1bmN0aW9uKFNPUUwpIHsJcmV0dXJuIHNmQ2xpZW50LmJ1aWxkUmVxdWVzdCgiPHF1ZXJ5IHhtbG5zPSd1cm46cGFydG5lci5zb2FwLnNmb3JjZS5jb20nPjxxdWVyeVN0cmluZz48IVtDREFUQVsiICsgU09RTCArICJdXT48L3F1ZXJ5U3RyaW5nPjwvcXVlcnk+Iik7IH07Cglhc3luYyA9IChjYWxsYmFjayAhPSB1bmRlZmluZWQpOwoJdGhpcy5TZW5kUmVxdWVzdChtYWtlUXVlcnlSZXF1ZXN0KHNvcWwpLCBpbnRlcm5hbENhbGxiYWNrLCAicXVlcnkiLCBhc3luYywgdGhpcy5nZXRVcmwoKSk7CglyZXR1cm4gcmV0dXJuVmFsdWU7Cn07Ci8qKiBAaWdub3JlICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLlNlbGVjdEFsbFF1ZXJ5ID0gU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuc2VsZWN0QWxsUXVlcnk7Ci8qKgogKiBQZXJmb3JtcyBhIHF1ZXJ5IG9wZXJhdGlvbgogKiBAcGFyYW0ge1N0cmluZ30gc29xbCBUaGUgc2ZvcmNlIG9iamVjdCBxdWVyeSBsYW5ndWFnZSB0aGF0IGNvbnN0aXR1dGVzIGEgc2VsZWN0aW9uLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBBIHBvaW50ZXIgdG8gYSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSB0aGUgaHR0cCByZXF1ZXN0IGhhcyByZXR1cm5lZC4KICogQHBhcmFtIHtCb29sZWFufSBhc3luYyBBIGZsYWcgdG8gaW5kaWNhdGUgdGhhdCB0aGUgY2FsbCBzaG91bGQgYmUgbWFkZSBhc3luY2hyb25vdXNseSBvciBub3QuICBBCiAqIHZhbHVlIG9mIHRydWUgd2lsbCBjYXVzZSB0aGUgbWV0aG9kIHRvIHJldHVybiBpbW1lZGlhdGVseSBhbmQgb25jZSBhIHJlc3BvbnNlIGlzIHJlY2lldmVkLCB0aGUgY2FsbGJhY2sKICogZnVuY3Rpb24gd2lsbCBiZSBpbnZva2VkIGFuZCBwYXNzZWQgdGhlIHJlc3VsdHMgb2YgdGhlIGNhbGwuCiAqIEB0eXBlIFF1ZXJ5UmVzdWx0L1NvYXBGYXVsdAogKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUucXVlcnkgPSBmdW5jdGlvbihzb3FsLCBjYWxsYmFjaykgewoJdmFyIHNmQ2xpZW50ID0gdGhpczsKCXZhciByZXR1cm5WYWx1ZTsKCWludGVybmFsQ2FsbGJhY2sgPSBmdW5jdGlvbihyZXEpIHsKCQl2YXIgdCA9IG5ldyBTZm9yY2UuVXRpbC5UaW1lc3RhbXBfY2xhc3MoKTsKCQl0LlN0YXJ0VGltaW5nKCk7CgkJcmV0dXJuVmFsdWUgPSBTZm9yY2UuY3JlYXRlU2ZvcmNlT2JqZWN0KHJlcSk7CgkJaWYgKHNmb3JjZUNsaWVudC50aW1lcmxvZykgc2ZvcmNlQ2xpZW50LnRpbWVybG9nLndyaXRlbG4oIlF1ZXJ5IERlc2VyaWFsaXplOiAiICsgdC5FbmRUaW1pbmcoKSk7CgkJcmV0dXJuVmFsdWVbIlNPUUwiXSA9IHNvcWw7CgkJcmV0dXJuVmFsdWVbIlJlcXVlc3RlZENvbHVtbnMiXSA9IFNmb3JjZS5VdGlsLlBhcnNlU2VsZWN0TGlzdEZyb21TT1FMKHNvcWwpOwoJCWlmIChjYWxsYmFjaykgewoJCQljYWxsYmFjayhyZXR1cm5WYWx1ZSk7CgkJfQoJfQoJCgltYWtlUXVlcnlSZXF1ZXN0ID0gZnVuY3Rpb24oU09RTCkgewkKCQlyZXR1cm4gc2ZDbGllbnQuYnVpbGRSZXF1ZXN0KCI8cXVlcnkgeG1sbnM9J3VybjpwYXJ0bmVyLnNvYXAuc2ZvcmNlLmNvbSc+PHF1ZXJ5U3RyaW5nPjwhW0NEQVRBWyIgKyBTT1FMICsgIl1dPjwvcXVlcnlTdHJpbmc+PC9xdWVyeT4iKTsgCgl9OwoJYXN5bmMgPSAoY2FsbGJhY2sgIT0gdW5kZWZpbmVkKTsKCXNmQ2xpZW50LlNlbmRSZXF1ZXN0KG1ha2VRdWVyeVJlcXVlc3Qoc29xbCksIGludGVybmFsQ2FsbGJhY2ssICJxdWVyeSIsIGFzeW5jLCBzZkNsaWVudC5nZXRVcmwoKSk7CglyZXR1cm4gcmV0dXJuVmFsdWU7Cn07Ci8qKiBAaWdub3JlICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLlF1ZXJ5ID0gU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUucXVlcnk7Ci8qKgogKiBQZXJmb3JtcyBhIHF1ZXJ5IG1vcmUgb3BlcmF0aW9uCiAqIEBwYXJhbSB7U3RyaW5nfSBxdWVyeUxvY2F0aW9uIFRoZSBxdWVyeSAiY3Vyc29yIiB0byBmZXRjaC4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQSBwb2ludGVyIHRvIGEgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgdGhlIGh0dHAgcmVxdWVzdCBoYXMgcmV0dXJuZWQuCiAqIEBwYXJhbSB7Qm9vbGVhbn0gYXN5bmMgQSBmbGFnIHRvIGluZGljYXRlIHRoYXQgdGhlIGNhbGwgc2hvdWxkIGJlIG1hZGUgYXN5bmNocm9ub3VzbHkgb3Igbm90LiAgQQogKiB2YWx1ZSBvZiB0cnVlIHdpbGwgY2F1c2UgdGhlIG1ldGhvZCB0byByZXR1cm4gaW1tZWRpYXRlbHkgYW5kIG9uY2UgYSByZXNwb25zZSBpcyByZWNpZXZlZCwgdGhlIGNhbGxiYWNrCiAqIGZ1bmN0aW9uIHdpbGwgYmUgaW52b2tlZCBhbmQgcGFzc2VkIHRoZSByZXN1bHRzIG9mIHRoZSBjYWxsLgogKiBAdHlwZSBRdWVyeVJlc3VsdC9Tb2FwRmF1bHQKICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLnF1ZXJ5TW9yZSA9IGZ1bmN0aW9uKHF1ZXJ5TG9jYXRvciwgY2FsbGJhY2spIHsKCXZhciBzZkNsaWVudCA9IHRoaXM7Cgl2YXIgcmV0dXJuVmFsdWU7CglpbnRlcm5hbENhbGxiYWNrID0gZnVuY3Rpb24ocmVxKSB7CgkJcmV0dXJuVmFsdWUgPSBTZm9yY2UuY3JlYXRlU2ZvcmNlT2JqZWN0KHJlcSk7IC8vc2ZDbGllbnQuX3F1ZXJ5SGFuZGxlcihyZXEpOwoJCWlmIChjYWxsYmFjaykgewoJCQljYWxsYmFjayhyZXR1cm5WYWx1ZSk7CgkJfQoJfTsKCW1ha2VRdWVyeU1vcmVSZXF1ZXN0ID0gZnVuY3Rpb24ocXVlcnlMb2NhdG9yKSB7CXJldHVybiBzZkNsaWVudC5idWlsZFJlcXVlc3QoIjxxdWVyeU1vcmUgeG1sbnM9XCJ1cm46cGFydG5lci5zb2FwLnNmb3JjZS5jb21cIj48cXVlcnlMb2NhdG9yPiIgKyBxdWVyeUxvY2F0b3IgKyAiPC9xdWVyeUxvY2F0b3I+PC9xdWVyeU1vcmU+Iik7IH07Cglhc3luYyA9IChjYWxsYmFjayAhPSB1bmRlZmluZWQpOwoJc2ZDbGllbnQuU2VuZFJlcXVlc3QobWFrZVF1ZXJ5TW9yZVJlcXVlc3QocXVlcnlMb2NhdG9yKSwgaW50ZXJuYWxDYWxsYmFjaywgInF1ZXJ5bW9yZSIsIGFzeW5jLCBzZkNsaWVudC5nZXRVcmwoKSk7CglyZXR1cm4gcmV0dXJuVmFsdWU7Cn07Ci8qKiBAaWdub3JlICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLlF1ZXJ5TW9yZSA9IFNmb3JjZS5DbGllbnQucHJvdG90eXBlLnF1ZXJ5TW9yZTsKLyoqCiAqIFBlcmZvcm1zIGEgcmV0cmlldmUgb3BlcmF0aW9uCiAqIEBwYXJhbSB7U3RyaW5nfSBmaWVsZExpc3QgQSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBmaWVsZHMgdG8gcmV0cmlldmUuCiAqIEBwYXJhbSB7U3RyaW5nfSBvYmplY3RUeXBlIFRoZSB0eXBlIG9mIG9iamVjdCB0aGF0IHRoZSBpZCBhcnJheSByZXByZXNlbnRzLgogKiBAcGFyYW0ge0FycmF5fSBpZEFycmF5IEFuIGFycmF5IG9mIGlkIHN0cmluZ3MgdG8gcmV0cmlldmUgZGF0YSBmb3IuICBUaGlzIGlzIGRpZmZlcmVudCB0aGFuIHRoZQogKiBzdGFuZGFyZCBBUEkgKGF0IGxlYXN0IGZvciBKQVZBKSBpbiB0aGF0IGl0IHRha2VzIGlkIHN0cmluZ3MgcmF0aGVyIHRoYW4gaWQgb2JqZWN0cy4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQSBwb2ludGVyIHRvIGEgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgdGhlIGh0dHAgcmVxdWVzdCBoYXMgcmV0dXJuZWQuCiAqIEBwYXJhbSB7Qm9vbGVhbn0gYXN5bmMgQSBmbGFnIHRvIGluZGljYXRlIHRoYXQgdGhlIGNhbGwgc2hvdWxkIGJlIG1hZGUgYXN5bmNocm9ub3VzbHkgb3Igbm90LiAgQQogKiB2YWx1ZSBvZiB0cnVlIHdpbGwgY2F1c2UgdGhlIG1ldGhvZCB0byByZXR1cm4gaW1tZWRpYXRlbHkgYW5kIG9uY2UgYSByZXNwb25zZSBpcyByZWNpZXZlZCwgdGhlIGNhbGxiYWNrCiAqIGZ1bmN0aW9uIHdpbGwgYmUgaW52b2tlZCBhbmQgcGFzc2VkIHRoZSByZXN1bHRzIG9mIHRoZSBjYWxsLgogKiBAdHlwZSBTT2JqZWN0W10vU29hcEZhdWx0CiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5yZXRyaWV2ZSA9IGZ1bmN0aW9uKGZpZWxkTGlzdCwgb2JqZWN0VHlwZSwgaWRBcnJheSwgY2FsbGJhY2spIHsKCXZhciBzZkNsaWVudCA9IHRoaXM7Cgl2YXIgcmV0dXJuVmFsdWU7CglpbnRlcm5hbENhbGxiYWNrID0gZnVuY3Rpb24ocmVxKSB7CgkJcmV0dXJuVmFsdWUgPSBTZm9yY2UuY3JlYXRlU2ZvcmNlT2JqZWN0KHJlcSk7CgkJaWYgKGNhbGxiYWNrKSB7CgkJCWNhbGxiYWNrKHJldHVyblZhbHVlKTsKCQl9Cgl9OwoJbWFrZVJldHJpZXZlUmVxdWVzdCA9IGZ1bmN0aW9uKCkgewoJCXZhciBfaWRzID0gIiI7IAoJCWlmIChTZm9yY2UuVXRpbC5kbHR5cGVvZihpZEFycmF5KSA9PSAiYXJyYXkiKSB7IAoJCQlmb3IgKCB2YXIgaT0wO2k8aWRBcnJheS5sZW5ndGg7aSsrKSB7CgkJCQlfaWRzICs9ICI8aWRzPiIgKyBpZEFycmF5W2ldICsgIjwvaWRzPiI7IAoJCQl9CQoJCX0gZWxzZSB7IAoJCQlfaWRzID0gIjxpZHM+IiArIGlkQXJyYXkgKyAiPC9pZHM+IjsgCgkJfQoJCXJldHVybiBzZkNsaWVudC5idWlsZFJlcXVlc3QoIjxyZXRyaWV2ZSB4bWxucz1cInVybjpwYXJ0bmVyLnNvYXAuc2ZvcmNlLmNvbVwiPjxmaWVsZExpc3Q+IiArIGZpZWxkTGlzdCArICI8L2ZpZWxkTGlzdD48c09iamVjdFR5cGU+IiArIG9iamVjdFR5cGUgKyAiPC9zT2JqZWN0VHlwZT4iICsgX2lkcyArICI8L3JldHJpZXZlPiIpOyAKCX07Cglhc3luYyA9IChjYWxsYmFjayAhPSB1bmRlZmluZWQpOwoJdGhpcy5TZW5kUmVxdWVzdChtYWtlUmV0cmlldmVSZXF1ZXN0KCksIGludGVybmFsQ2FsbGJhY2ssICJyZXRyaWV2ZSIsIGFzeW5jLCB0aGlzLmdldFVybCgpKTsKCXJldHVybiByZXR1cm5WYWx1ZTsKfTsKLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuUmV0cmlldmUgPSBTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5yZXRyaWV2ZTsKLyoqCiAqIFBlcmZvcm1zIGEgc2VhcmNoIG9wZXJhdGlvbgogKiBAcGFyYW0ge1N0cmluZ30gc2VhcmNoU3RyaW5nIFRoaXMgcGFyYW1ldGVyIG11c3QgYmUgYSB3ZWxsIGZvcm1lZCBTT1NMIHN0cmluZy4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQSBwb2ludGVyIHRvIGEgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uY2UgdGhlIGh0dHAgcmVxdWVzdCBoYXMgcmV0dXJuZWQuCiAqIEBwYXJhbSB7Qm9vbGVhbn0gYXN5bmMgQSBmbGFnIHRvIGluZGljYXRlIHRoYXQgdGhlIGNhbGwgc2hvdWxkIGJlIG1hZGUgYXN5bmNocm9ub3VzbHkgb3Igbm90LiAgQQogKiB2YWx1ZSBvZiB0cnVlIHdpbGwgY2F1c2UgdGhlIG1ldGhvZCB0byByZXR1cm4gaW1tZWRpYXRlbHkgYW5kIG9uY2UgYSByZXNwb25zZSBpcyByZWNpZXZlZCwgdGhlIGNhbGxiYWNrCiAqIGZ1bmN0aW9uIHdpbGwgYmUgaW52b2tlZCBhbmQgcGFzc2VkIHRoZSByZXN1bHRzIG9mIHRoZSBjYWxsLgogKiBAdHlwZSBTZWFyY2hSZXN1bHQvU29hcEZhdWx0CiAqLwpTZm9yY2UuQ2xpZW50LnByb3RvdHlwZS5zZWFyY2ggPSBmdW5jdGlvbihzZWFyY2hTdHJpbmcsIGNhbGxiYWNrKSB7Cgl2YXIgc2ZDbGllbnQgPSB0aGlzOwoJdmFyIHJldHVyblZhbHVlOwoJaW50ZXJuYWxDYWxsYmFjayA9IGZ1bmN0aW9uKHJlcSkgewoJCXJldHVyblZhbHVlID0gU2ZvcmNlLmNyZWF0ZVNmb3JjZU9iamVjdChyZXEpOwoJCWlmIChjYWxsYmFjaykgewoJCQljYWxsYmFjayhyZXR1cm5WYWx1ZSk7CgkJfQoJfTsKCW1ha2VTZWFyY2hSZXF1ZXN0ID0gZnVuY3Rpb24oKSB7IHJldHVybiBzZkNsaWVudC5idWlsZFJlcXVlc3QoIjxzZWFyY2ggeG1sbnM9XCJ1cm46cGFydG5lci5zb2FwLnNmb3JjZS5jb21cIj48c2VhcmNoU3RyaW5nPjwhW0NEQVRBWyIgKyBzZWFyY2hTdHJpbmcgKyAiXV0+PC9zZWFyY2hTdHJpbmc+PC9zZWFyY2g+Iik7fTsKCWFzeW5jID0gKGNhbGxiYWNrICE9IHVuZGVmaW5lZCk7Cgl0aGlzLlNlbmRSZXF1ZXN0KG1ha2VTZWFyY2hSZXF1ZXN0KCksIGludGVybmFsQ2FsbGJhY2ssICJzZWFyY2giLCBhc3luYywgdGhpcy5nZXRVcmwoKSk7CglyZXR1cm4gcmV0dXJuVmFsdWU7Cn07Ci8qKiBAaWdub3JlICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLlNlYXJjaCA9IFNmb3JjZS5DbGllbnQucHJvdG90eXBlLnNlYXJjaDsKLyoqCiAqIFBlcmZvcm1zIGEgc2V0IHBhc3N3b3JkIG9wZXJhdGlvbgogKiBAcGFyYW0ge1N0cmluZ30gdXNlcklkIFRoZSBpZCBvZiB0aGUgdXNlciB3aG9zZSBwYXNzd29yZCB3aWxsIGJlIGNoYW5nZWQuCiAqIEBwYXJhbSB7U3RyaW5nfSBwYXNzd29yZCBUaGUgbmV3IHBhc3N3b3JkIHRvIHNldCBmb3IgdGhlIGluZGljYXRlZCB1c2VyLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBBIHBvaW50ZXIgdG8gYSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSB0aGUgaHR0cCByZXF1ZXN0IGhhcyByZXR1cm5lZC4KICogQHBhcmFtIHtCb29sZWFufSBhc3luYyBBIGZsYWcgdG8gaW5kaWNhdGUgdGhhdCB0aGUgY2FsbCBzaG91bGQgYmUgbWFkZSBhc3luY2hyb25vdXNseSBvciBub3QuICBBCiAqIHZhbHVlIG9mIHRydWUgd2lsbCBjYXVzZSB0aGUgbWV0aG9kIHRvIHJldHVybiBpbW1lZGlhdGVseSBhbmQgb25jZSBhIHJlc3BvbnNlIGlzIHJlY2lldmVkLCB0aGUgY2FsbGJhY2sKICogZnVuY3Rpb24gd2lsbCBiZSBpbnZva2VkIGFuZCBwYXNzZWQgdGhlIHJlc3VsdHMgb2YgdGhlIGNhbGwuCiAqIEB0eXBlIFNldFBhc3N3b3JkUmVzdWx0L1NvYXBGYXVsdAogKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuc2V0UGFzc3dvcmQgPSBmdW5jdGlvbih1c2VySWQsIHBhc3N3b3JkLCBjYWxsYmFjaykgewoJdmFyIHNmQ2xpZW50ID0gdGhpczsKCXZhciByZXR1cm5WYWx1ZTsKCWludGVybmFsQ2FsbGJhY2sgPSBmdW5jdGlvbihyZXEpIHsKCQlyZXR1cm5WYWx1ZSA9IFNmb3JjZS5jcmVhdGVTZm9yY2VPYmplY3QocmVxKTsKCQlpZiAoY2FsbGJhY2spIHsKCQkJY2FsbGJhY2socmV0dXJuVmFsdWUpOwoJCX0KCX07CgltYWtlU2V0UGFzc3dvcmRSZXF1ZXN0ID0gZnVuY3Rpb24oKSB7IHJldHVybiBzZkNsaWVudC5idWlsZFJlcXVlc3QoIjxzZXRQYXNzd29yZCB4bWxucz1cInVybjpwYXJ0bmVyLnNvYXAuc2ZvcmNlLmNvbVwiPjx1c2VySWQ+PCFbQ0RBVEFbIiArIHVzZXJJZCArICJdXT48L3VzZXJJZD48cGFzc3dvcmQ+IiArIHBhc3N3b3JkICsgIjwvcGFzc3dvcmQ+PC9zZXRQYXNzd29yZD4iKTt9OwoJYXN5bmMgPSAoY2FsbGJhY2sgIT0gdW5kZWZpbmVkKTsKCXRoaXMuU2VuZFJlcXVlc3QobWFrZVNldFBhc3N3b3JkUmVxdWVzdCgpLCBpbnRlcm5hbENhbGxiYWNrLCAic2V0UGFzc3dvcmQiLCBhc3luYywgdGhpcy5nZXRVcmwoKSk7CglyZXR1cm4gcmV0dXJuVmFsdWU7Cn07Ci8qKiBAaWdub3JlICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLlNldFBhc3N3b3JkID0gU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuc2V0UGFzc3dvcmQ7Ci8qKgogKiBQZXJmb3JtcyBhIHJlc2V0IHBhc3N3b3JkIG9wZXJhdGlvbiAoY2F1c2VzIGEgc3lzdGVtIGdlbmVyYXRlZCBwYXNzd29yZCB0byBiZSBhc3NpZ25lZCB0byB0aGUgdXNlcikuCiAqIEBwYXJhbSB7U3RyaW5nfSB1c2VySWQgVGhlIGlkIG9mIHRoZSB1c2VyIHdob3NlIHBhc3N3b3JkIHdpbGwgYmUgcmVzZXQuCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIEEgcG9pbnRlciB0byBhIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbmNlIHRoZSBodHRwIHJlcXVlc3QgaGFzIHJldHVybmVkLgogKiBAcGFyYW0ge0Jvb2xlYW59IGFzeW5jIEEgZmxhZyB0byBpbmRpY2F0ZSB0aGF0IHRoZSBjYWxsIHNob3VsZCBiZSBtYWRlIGFzeW5jaHJvbm91c2x5IG9yIG5vdC4gIEEKICogdmFsdWUgb2YgdHJ1ZSB3aWxsIGNhdXNlIHRoZSBtZXRob2QgdG8gcmV0dXJuIGltbWVkaWF0ZWx5IGFuZCBvbmNlIGEgcmVzcG9uc2UgaXMgcmVjaWV2ZWQsIHRoZSBjYWxsYmFjawogKiBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQgYW5kIHBhc3NlZCB0aGUgcmVzdWx0cyBvZiB0aGUgY2FsbC4KICogQHR5cGUgUmVzZXRQYXNzd29yZFJlc3VsdC9Tb2FwRmF1bHQKICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLnJlc2V0UGFzc3dvcmQgPSBmdW5jdGlvbih1c2VySWQsIGNhbGxiYWNrKSB7Cgl2YXIgc2ZDbGllbnQgPSB0aGlzOwoJdmFyIHJldHVyblZhbHVlOwoJaW50ZXJuYWxDYWxsYmFjayA9IGZ1bmN0aW9uKHJlcSkgewoJCXJldHVyblZhbHVlID0gU2ZvcmNlLmNyZWF0ZVNmb3JjZU9iamVjdChyZXEpOwoJCWlmIChjYWxsYmFjaykgewoJCQljYWxsYmFjayhyZXR1cm5WYWx1ZSk7CgkJfQoJfTsKCW1ha2VSZXNldFBhc3N3b3JkUmVxdWVzdCA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gc2ZDbGllbnQuYnVpbGRSZXF1ZXN0KCI8cmVzZXRQYXNzd29yZCB4bWxucz1cInVybjpwYXJ0bmVyLnNvYXAuc2ZvcmNlLmNvbVwiPjx1c2VySWQ+IiArIHVzZXJJZCArICI8L3VzZXJJZD48L3Jlc2V0UGFzc3dvcmQ+Iik7fTsKCWFzeW5jID0gKGNhbGxiYWNrICE9IHVuZGVmaW5lZCk7Cgl0aGlzLlNlbmRSZXF1ZXN0KG1ha2VSZXNldFBhc3N3b3JkUmVxdWVzdCgpLCBpbnRlcm5hbENhbGxiYWNrLCAicmVzZXRQYXNzd29yZCIsIGFzeW5jLCB0aGlzLmdldFVybCgpKTsKCXJldHVybiByZXR1cm5WYWx1ZTsKfTsKLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuUmVzZXRQYXNzd29yZCA9IFNmb3JjZS5DbGllbnQucHJvdG90eXBlLnJlc2V0UGFzc3dvcmQ7Ci8qKgogKiBQZXJmb3JtcyBhIGRlbGV0ZSBvcGVyYXRpb24KICogQHBhcmFtIHtBcnJheX0gaWRzIEFuIGFycmF5IG9mIGlkcyB0byBkZWxldGUgKGluIHByYWN0aWNlIHRoaXMgZnVuY3Rpb24gY2FuIHRha2UgYSBzaW5nbGUgaWQgc3RyaW5nIGFzIHdlbGwpLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBBIHBvaW50ZXIgdG8gYSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSB0aGUgaHR0cCByZXF1ZXN0IGhhcyByZXR1cm5lZC4KICogQHBhcmFtIHtCb29sZWFufSBhc3luYyBBIGZsYWcgdG8gaW5kaWNhdGUgdGhhdCB0aGUgY2FsbCBzaG91bGQgYmUgbWFkZSBhc3luY2hyb25vdXNseSBvciBub3QuICBBCiAqIHZhbHVlIG9mIHRydWUgd2lsbCBjYXVzZSB0aGUgbWV0aG9kIHRvIHJldHVybiBpbW1lZGlhdGVseSBhbmQgb25jZSBhIHJlc3BvbnNlIGlzIHJlY2lldmVkLCB0aGUgY2FsbGJhY2sKICogZnVuY3Rpb24gd2lsbCBiZSBpbnZva2VkIGFuZCBwYXNzZWQgdGhlIHJlc3VsdHMgb2YgdGhlIGNhbGwuCiAqIEB0eXBlIFNhdmVSZXN1bHRbXS9Tb2FwRmF1bHQKICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLl9kZWxldGUgPSBmdW5jdGlvbihpZHMsIGNhbGxiYWNrKSB7Cgl2YXIgc2ZDbGllbnQgPSB0aGlzOwoJdmFyIHJldHVyblZhbHVlOwoJaW50ZXJuYWxDYWxsYmFjayA9IGZ1bmN0aW9uKHJlcSkgewoJCXJldHVyblZhbHVlID0gU2ZvcmNlLmNyZWF0ZVNmb3JjZU9iamVjdChyZXEpOyAvL3NmQ2xpZW50Ll9kZWxldGVIYW5kbGVyKHJlcSk7CgkJaWYgKGNhbGxiYWNrKSB7CgkJCWNhbGxiYWNrKHJldHVyblZhbHVlKTsKCQl9Cgl9OwoJbWFrZURlbGV0ZVJlcXVlc3QgPSBmdW5jdGlvbigpIHsJdmFyIF9pZHMgPSAiIjsgaWYgKFNmb3JjZS5VdGlsLmRsdHlwZW9mKGlkcykgPT0gImFycmF5IikgeyBmb3IgKHZhciBpPTA7aTxpZHMubGVuZ3RoO2krKykgewlfaWRzICs9ICI8aWRzPiIgKyBpZHNbaV0gKyAiPC9pZHM+IjsgfQl9IGVsc2UgeyBfaWRzID0gIjxpZHM+IiArIGlkcyArICI8L2lkcz4iOyB9CXJldHVybiBzZkNsaWVudC5idWlsZFJlcXVlc3QoIjxkZWxldGUgeG1sbnM9XCJ1cm46cGFydG5lci5zb2FwLnNmb3JjZS5jb21cIj4iICsgX2lkcyArICI8L2RlbGV0ZT4iKTsgfTsKCWFzeW5jID0gKGNhbGxiYWNrICE9IHVuZGVmaW5lZCk7Cgl0aGlzLlNlbmRSZXF1ZXN0KG1ha2VEZWxldGVSZXF1ZXN0KCksIGludGVybmFsQ2FsbGJhY2ssICJkZWxldGUiLCBhc3luYywgdGhpcy5nZXRVcmwoKSk7CglyZXR1cm4gcmV0dXJuVmFsdWU7Cn07Ci8qKiBAaWdub3JlICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLkRlbGV0ZSA9IFNmb3JjZS5DbGllbnQucHJvdG90eXBlLl9kZWxldGU7Ci8qKgogKiBQZXJmb3JtcyBhIGNyZWF0ZSBvcGVyYXRpb24gb3BlcmF0aW9uCiAqIEBwYXJhbSB7QXJyYXl9IG9iamVjdHMgQW4gYXJyYXkgb2Ygc29iamVjdHMgdG8gY3JlYXRlLCBtdXN0IGJlIG9mIHRoZSBzYW1lIG9iamVjdCB0eXBlLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBBIHBvaW50ZXIgdG8gYSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSB0aGUgaHR0cCByZXF1ZXN0IGhhcyByZXR1cm5lZC4KICogQHBhcmFtIHtCb29sZWFufSBhc3luYyBBIGZsYWcgdG8gaW5kaWNhdGUgdGhhdCB0aGUgY2FsbCBzaG91bGQgYmUgbWFkZSBhc3luY2hyb25vdXNseSBvciBub3QuICBBCiAqIHZhbHVlIG9mIHRydWUgd2lsbCBjYXVzZSB0aGUgbWV0aG9kIHRvIHJldHVybiBpbW1lZGlhdGVseSBhbmQgb25jZSBhIHJlc3BvbnNlIGlzIHJlY2lldmVkLCB0aGUgY2FsbGJhY2sKICogZnVuY3Rpb24gd2lsbCBiZSBpbnZva2VkIGFuZCBwYXNzZWQgdGhlIHJlc3VsdHMgb2YgdGhlIGNhbGwuCiAqIEB0eXBlIFNhdmVSZXN1bHRbXS9Tb2FwRmF1bHQKICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKG9iamVjdHMsIGNhbGxiYWNrKSB7Cgl2YXIgc2ZDbGllbnQgPSB0aGlzOwoJdmFyIHJldHVyblZhbHVlOwoJaW50ZXJuYWxDYWxsYmFjayA9IGZ1bmN0aW9uKHJlcSkgewoJCXJldHVyblZhbHVlID0gU2ZvcmNlLmNyZWF0ZVNmb3JjZU9iamVjdChyZXEpOyAvL3NmQ2xpZW50Ll9jcmVhdGVIYW5kbGVyKHJlcSk7CgkJaWYgKGNhbGxiYWNrKSB7CgkJCWNhbGxiYWNrKHJldHVyblZhbHVlKTsKCQl9Cgl9OwoJbWFrZUNyZWF0ZVJlcXVlc3QgPSBmdW5jdGlvbihzb2JqZWN0cykgeyAKCQlyZXR1cm4gc2ZDbGllbnQuYnVpbGRSZXF1ZXN0KCI8Y3JlYXRlIHhtbG5zPVwidXJuOnBhcnRuZXIuc29hcC5zZm9yY2UuY29tXCI+IiArIHNvYmplY3RzICsgIjwvY3JlYXRlPiIpOyAKCX07Cglhc3luYyA9IChjYWxsYmFjayAhPSB1bmRlZmluZWQpOwoJdGhpcy5TZW5kUmVxdWVzdChtYWtlQ3JlYXRlUmVxdWVzdChTZm9yY2UuU2VyaWFsaXphdGlvbi5TZXJpYWxpemVCZWFuKG9iamVjdHMsICJmb3JjcmVhdGUiKSksIGludGVybmFsQ2FsbGJhY2ssICJjcmVhdGUiLCBhc3luYywgdGhpcy5nZXRVcmwoKSk7CglyZXR1cm4gcmV0dXJuVmFsdWU7Cn0KLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuQ3JlYXRlID0gU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuY3JlYXRlOwovKioKICogUGVyZm9ybXMgYW4gdXBkYXRlIG9wZXJhdGlvbiBvcGVyYXRpb24KICogQHBhcmFtIHtBcnJheX0gb2JqZWN0cyBBbiBhcnJheSBvZiBzb2JqZWN0cyB0byB1cGRhdGUsIG11c3QgYmUgb2YgdGhlIHNhbWUgb2JqZWN0IHR5cGUuCiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIEEgcG9pbnRlciB0byBhIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbmNlIHRoZSBodHRwIHJlcXVlc3QgaGFzIHJldHVybmVkLgogKiBAcGFyYW0ge0Jvb2xlYW59IGFzeW5jIEEgZmxhZyB0byBpbmRpY2F0ZSB0aGF0IHRoZSBjYWxsIHNob3VsZCBiZSBtYWRlIGFzeW5jaHJvbm91c2x5IG9yIG5vdC4gIEEKICogdmFsdWUgb2YgdHJ1ZSB3aWxsIGNhdXNlIHRoZSBtZXRob2QgdG8gcmV0dXJuIGltbWVkaWF0ZWx5IGFuZCBvbmNlIGEgcmVzcG9uc2UgaXMgcmVjaWV2ZWQsIHRoZSBjYWxsYmFjawogKiBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQgYW5kIHBhc3NlZCB0aGUgcmVzdWx0cyBvZiB0aGUgY2FsbC4KICogQHR5cGUgU2F2ZVJlc3VsdFtdL1NvYXBGYXVsdAogKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24ob2JqZWN0cywgY2FsbGJhY2spIHsKCXZhciBzZkNsaWVudCA9IHRoaXM7Cgl2YXIgcmV0dXJuVmFsdWU7CglpbnRlcm5hbENhbGxiYWNrID0gZnVuY3Rpb24ocmVxKSB7CgkJcmV0dXJuVmFsdWUgPSBTZm9yY2UuY3JlYXRlU2ZvcmNlT2JqZWN0KHJlcSk7IAoJCWlmIChyZXR1cm5WYWx1ZS5jbGFzc05hbWUgPSAiYXJyYXkiKSB7CgkJCWlmIChvYmplY3RzLmNsZWFyRGlydHlGbGFnKSB7CgkJCQlvYmplY3RzLmNsZWFyRGlydHlGbGFnKCk7CgkJCX0KCQl9IGVsc2UgewoJCQlmb3IgKHZhciBpPTA7aTxvYmplY3RzLmxlbmd0aDtpKyspIHsKCQkJCW9iamVjdHNbaV0uY2xlYXJEaXJ0eUZsYWcoKTsKCQkJfQoJCX0KCQlpZiAoY2FsbGJhY2spIHsKCQkJY2FsbGJhY2socmV0dXJuVmFsdWUpOwoJCX0KCX07CgltYWtlVXBkYXRlUmVxdWVzdCA9IGZ1bmN0aW9uKHNvYmplY3RzKSB7IAoJCXJldHVybiBzZkNsaWVudC5idWlsZFJlcXVlc3QoIjx1cGRhdGUgeG1sbnM9XCJ1cm46cGFydG5lci5zb2FwLnNmb3JjZS5jb21cIj4iICsgc29iamVjdHMgKyAiPC91cGRhdGU+Iik7IH07Cglhc3luYyA9IChjYWxsYmFjayAhPSB1bmRlZmluZWQpOwoJdGhpcy5TZW5kUmVxdWVzdChtYWtlVXBkYXRlUmVxdWVzdChTZm9yY2UuU2VyaWFsaXphdGlvbi5TZXJpYWxpemVCZWFuKG9iamVjdHMsICJmb3J1cGRhdGUiKSksIGludGVybmFsQ2FsbGJhY2ssICJ1cGRhdGUiLCBhc3luYywgdGhpcy5nZXRVcmwoKSk7CglyZXR1cm4gcmV0dXJuVmFsdWU7Cn07Ci8qKiBAaWdub3JlICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLlVwZGF0ZSA9IFNmb3JjZS5DbGllbnQucHJvdG90eXBlLnVwZGF0ZTsKLyoqCiAqIFBlcmZvcm1zIGFuIHVwZGF0ZSBvcGVyYXRpb24gb3BlcmF0aW9uCiAqIEBwYXJhbSB7QXJyYXl9IG9iamVjdHMgQW4gYXJyYXkgb2Ygc29iamVjdHMgdG8gdXBkYXRlLCBtdXN0IGJlIG9mIHRoZSBzYW1lIG9iamVjdCB0eXBlLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBBIHBvaW50ZXIgdG8gYSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgb25jZSB0aGUgaHR0cCByZXF1ZXN0IGhhcyByZXR1cm5lZC4KICogQHBhcmFtIHtCb29sZWFufSBhc3luYyBBIGZsYWcgdG8gaW5kaWNhdGUgdGhhdCB0aGUgY2FsbCBzaG91bGQgYmUgbWFkZSBhc3luY2hyb25vdXNseSBvciBub3QuICBBCiAqIHZhbHVlIG9mIHRydWUgd2lsbCBjYXVzZSB0aGUgbWV0aG9kIHRvIHJldHVybiBpbW1lZGlhdGVseSBhbmQgb25jZSBhIHJlc3BvbnNlIGlzIHJlY2lldmVkLCB0aGUgY2FsbGJhY2sKICogZnVuY3Rpb24gd2lsbCBiZSBpbnZva2VkIGFuZCBwYXNzZWQgdGhlIHJlc3VsdHMgb2YgdGhlIGNhbGwuCiAqIEB0eXBlIFNhdmVSZXN1bHRbXS9Tb2FwRmF1bHQKICovClNmb3JjZS5DbGllbnQucHJvdG90eXBlLnVwc2VydD0gZnVuY3Rpb24oZXh0ZXJuYWxJZEZpZWxkTmFtZSwgb2JqZWN0cywgY2FsbGJhY2spIHsKCXZhciBzZkNsaWVudCA9IHRoaXM7Cgl2YXIgcmV0dXJuVmFsdWU7CglpbnRlcm5hbENhbGxiYWNrID0gZnVuY3Rpb24ocmVxKSB7CgkJcmV0dXJuVmFsdWUgPSBTZm9yY2UuY3JlYXRlU2ZvcmNlT2JqZWN0KHJlcSk7IAoJCWlmIChyZXR1cm5WYWx1ZS5jbGFzc05hbWUgPSAiYXJyYXkiKSB7CgkJCWlmIChvYmplY3RzLmNsZWFyRGlydHlGbGFnKSB7CgkJCQlvYmplY3RzLmNsZWFyRGlydHlGbGFnKCk7CgkJCX0gZWxzZSB7CgkJCQlmb3IgKHZhciBpPTA7aTxvYmplY3RzLmxlbmd0aDtpKyspIHsKCQkJCQlvYmplY3RzW2ldLmNsZWFyRGlydHlGbGFnKCk7CgkJCQl9CgkJCX0KCQl9CgkJaWYgKGNhbGxiYWNrKSB7CgkJCWNhbGxiYWNrKHJldHVyblZhbHVlKTsKCQl9Cgl9OwoJbWFrZVVwZGF0ZVJlcXVlc3QgPSBmdW5jdGlvbihzb2JqZWN0cykgeyAKCQlyZXR1cm4gc2ZDbGllbnQuYnVpbGRSZXF1ZXN0KCI8dXBzZXJ0IHhtbG5zPVwidXJuOnBhcnRuZXIuc29hcC5zZm9yY2UuY29tXCI+PGV4dGVybmFsSURGaWVsZE5hbWU+IiArIGV4dGVybmFsSWRGaWVsZE5hbWUgKyAiPC9leHRlcm5hbElERmllbGROYW1lPiIgKyBzb2JqZWN0cyArICI8L3Vwc2VydD4iKTsgfTsKCWFzeW5jID0gKGNhbGxiYWNrICE9IHVuZGVmaW5lZCk7Cgl0aGlzLlNlbmRSZXF1ZXN0KG1ha2VVcGRhdGVSZXF1ZXN0KFNmb3JjZS5TZXJpYWxpemF0aW9uLlNlcmlhbGl6ZUJlYW4ob2JqZWN0cywgImZvcnVwc2VydCIpKSwgaW50ZXJuYWxDYWxsYmFjaywgInVwc2VydCIsIGFzeW5jLCB0aGlzLmdldFVybCgpKTsKCXJldHVybiByZXR1cm5WYWx1ZTsKfTsKLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUuVXBzZXJ0ID0gU2ZvcmNlLkNsaWVudC5wcm90b3R5cGUudXBzZXJ0OwogCnZhciBzZm9yY2VDbGllbnQgPSBuZXcgU2ZvcmNlLkNsaWVudCgpOwoKLy8gU29hcE9iamVjdC5qcwovLyBKU2NyaXB0IHNvdXJjZSBjb2RlCi8qCiAqIENvcHlyaWdodCAoYykgMjAwNSwgc2FsZXNmb3JjZS5jb20sIGluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogCiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgCiAqIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAqIAogKiAgICBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgCiAqICAgIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogKiAgCiAqICAgIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIAogKiAgICB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uIAogKiAgICAKICogICAgTmVpdGhlciB0aGUgbmFtZSBvZiBzYWxlc2ZvcmNlLmNvbSwgaW5jLiBub3IgdGhlIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciAKICogICAgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KICogIAogKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgCiAqIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSAKICogUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIE9XTkVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIAogKiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIAogKiBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgCiAqIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVCAoSU5DTFVESU5HIAogKiBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgCiAqIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgogKi8KClNmb3JjZS5Tb2FwT2JqZWN0ID0gZnVuY3Rpb24oKSB7fQovKiogQHJldHVybiBTdHJpbmcgCiAqIEB0eXBlIFN0cmluZwogKi8KU2ZvcmNlLlNvYXBPYmplY3QucHJvdG90eXBlLnRvSHRtbFN0cmluZyA9IGZ1bmN0aW9uKHRhYikgeyByZXR1cm4gU2ZvcmNlLm9iamVjdFRvSHRtbFN0cmluZyh0aGlzLCB0YWIpOyB9OwovKiogQHJldHVybiBTdHJpbmcgCiAqIEB0eXBlIFN0cmluZwogKi8KU2ZvcmNlLlNvYXBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7IHJldHVybiBTZm9yY2Uub2JqZWN0VG9TdHJpbmcodGhpcyk7IH07CgpTZm9yY2UuU29hcE9iamVjdC5GaWVsZFR5cGUgPSBuZXcgT2JqZWN0KCk7ClNmb3JjZS5Tb2FwT2JqZWN0LkZpZWxkVHlwZS5TVFJJTkcgPSAic3RyaW5nIjsKU2ZvcmNlLlNvYXBPYmplY3QuRmllbGRUeXBlLlBJQ0tMSVNUID0gInBpY2tsaXN0IjsKU2ZvcmNlLlNvYXBPYmplY3QuRmllbGRUeXBlLk1VTFRJUElDS0xJU1QgPSAibXVsdGlwaWNrbGlzdCI7ClNmb3JjZS5Tb2FwT2JqZWN0LkZpZWxkVHlwZS5DT01CT0JPWCA9ICJjb21ib2JveCI7ClNmb3JjZS5Tb2FwT2JqZWN0LkZpZWxkVHlwZS5SRUZFUkVOQ0UgPSAicmVmZXJlbmNlIjsKU2ZvcmNlLlNvYXBPYmplY3QuRmllbGRUeXBlLkJBU0U2NCA9ICJiYXNlNjQiOwpTZm9yY2UuU29hcE9iamVjdC5GaWVsZFR5cGUuQk9PTEVBTiA9ICJib29sZWFuIjsKU2ZvcmNlLlNvYXBPYmplY3QuRmllbGRUeXBlLkNVUlJFTkNZID0gImN1cnJlbmN5IjsKU2ZvcmNlLlNvYXBPYmplY3QuRmllbGRUeXBlLlRFWFRBUkVBID0gInRleHRhcmVhIjsKU2ZvcmNlLlNvYXBPYmplY3QuRmllbGRUeXBlLklOVCA9ICJpbnQiOwpTZm9yY2UuU29hcE9iamVjdC5GaWVsZFR5cGUuRE9VQkxFID0gImRvdWJsZSI7ClNmb3JjZS5Tb2FwT2JqZWN0LkZpZWxkVHlwZS5QRVJDRU5UID0gInBlcmNlbnQiOwpTZm9yY2UuU29hcE9iamVjdC5GaWVsZFR5cGUuUEhPTkUgPSAicGhvbmUiOwpTZm9yY2UuU29hcE9iamVjdC5GaWVsZFR5cGUuSUQgPSAiaWQiOwpTZm9yY2UuU29hcE9iamVjdC5GaWVsZFR5cGUuREFURSA9ICJkYXRlIjsKU2ZvcmNlLlNvYXBPYmplY3QuRmllbGRUeXBlLkRBVEVUSU1FID0gImRhdGV0aW1lIjsKU2ZvcmNlLlNvYXBPYmplY3QuRmllbGRUeXBlLlVSTCA9ICJ1cmwiOwpTZm9yY2UuU29hcE9iamVjdC5GaWVsZFR5cGUuRU1BSUwgPSAiZW1haWwiOwoKU2ZvcmNlLlNvYXBPYmplY3QuU29hcFR5cGUgPSBuZXcgT2JqZWN0KCk7ClNmb3JjZS5Tb2FwT2JqZWN0LlNvYXBUeXBlLklEID0gInRuczpJRCI7ClNmb3JjZS5Tb2FwT2JqZWN0LlNvYXBUeXBlLkJBU0U2NEJJTkFSWSA9ICJ4c2Q6YmFzZTY0QmluYXJ5IjsKU2ZvcmNlLlNvYXBPYmplY3QuU29hcFR5cGUuQk9PTEVBTiA9ICJ4c2Q6Ym9vbGVhbiI7ClNmb3JjZS5Tb2FwT2JqZWN0LlNvYXBUeXBlLkRPVUJMRSA9ICJ4c2Q6ZG91YmxlIjsKU2ZvcmNlLlNvYXBPYmplY3QuU29hcFR5cGUuSU5UID0gInhzZDppbnQiOwpTZm9yY2UuU29hcE9iamVjdC5Tb2FwVHlwZS5TVFJJTkcgPSAieHNkOnN0cmluZyI7ClNmb3JjZS5Tb2FwT2JqZWN0LlNvYXBUeXBlLkRBVEUgPSAieHNkOmRhdGUiOwpTZm9yY2UuU29hcE9iamVjdC5Tb2FwVHlwZS5EQVRFVElNRSA9ICJ4c2Q6ZGF0ZVRpbWUiOwoKU2ZvcmNlLmZhdWx0ID0gZnVuY3Rpb24oX2RldGFpbCkgewoJCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiZmF1bHQiOwoJaWYgKF9kZXRhaWwpIHsKCQlTZm9yY2UubG9hZE9iamVjdCh0aGlzLCBfZGV0YWlsKTsKCQkvL3RoaXMuZXhjZXB0aW9uQ29kZSA9IFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChfZGV0YWlsLCAiZXhjZXB0aW9uQ29kZSIpOwoJCS8vdGhpcy5leGNlcHRpb25NZXNzYWdlID0gU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKF9kZXRhaWwsICJleGNlcHRpb25NZXNzYWdlIik7CgkJLy90aGlzLnR5cGUgPSBTZm9yY2UuRE9NLkdldEF0dHJpYnV0ZVZhbHVlKF9kZXRhaWwsICJ4c2k6dHlwZSIpOwoJfQp9ClNmb3JjZS5mYXVsdC5wcm90b3R5cGUgPSBuZXcgU2ZvcmNlLlNvYXBPYmplY3Q7Ci8qKiBAdHlwZSBTdHJpbmcgKi8KU2ZvcmNlLmZhdWx0LnByb3RvdHlwZS5leGNlcHRpb25Db2RlID0gbmV3IFN0cmluZygpOwovKiogQHR5cGUgU3RyaW5nICovClNmb3JjZS5mYXVsdC5wcm90b3R5cGUuZXhjZXB0aW9uTWVzc2FnZSA9IG5ldyBTdHJpbmcoKTsKClNmb3JjZS5kZXRhaWwgPSBmdW5jdGlvbihzb2FwKSB7Cgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiZGV0YWlsIjsKCWlmIChzb2FwKSB7CgkJU2ZvcmNlLmxvYWRPYmplY3QodGhpcywgc29hcCk7Cgl9Cn0KU2ZvcmNlLmRldGFpbC5wcm90b3R5cGUgPSBuZXcgU2ZvcmNlLlNvYXBPYmplY3Q7ClNmb3JjZS5kZXRhaWwucHJvdG90eXBlLmZhdWx0ID0gbmV3IFNmb3JjZS5mYXVsdCgpOwpTZm9yY2UuZGV0YWlsLnByb3RvdHlwZS50eXBlID0gbmV3IFN0cmluZygpOwoKU2ZvcmNlLkZhdWx0ID0gZnVuY3Rpb24oc29hcCkgewoKCXRoaXMuYmFzZSA9IFNmb3JjZS5Tb2FwT2JqZWN0OwoJdGhpcy5iYXNlKCk7Cgl0aGlzLmNsYXNzTmFtZSA9ICJGYXVsdCI7CglpZiAoc29hcCkgewoJCVNmb3JjZS5sb2FkT2JqZWN0KHRoaXMsIHNvYXApOwoJfQp9ClNmb3JjZS5GYXVsdC5wcm90b3R5cGUgPSBuZXcgU2ZvcmNlLlNvYXBPYmplY3Q7Ci8qKiBAdHlwZSBTdHJpbmcgKi8KU2ZvcmNlLkZhdWx0LnByb3RvdHlwZS5mYXVsdGNvZGUgPSBuZXcgU3RyaW5nKCk7Ci8qKiBAdHlwZSBTdHJpbmcgKi8KU2ZvcmNlLkZhdWx0LnByb3RvdHlwZS5mYXVsdHN0cmluZyA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkZhdWx0LnByb3RvdHlwZS5kZXRhaWwgPSBuZXcgU2ZvcmNlLmRldGFpbCgpOwoKU2ZvcmNlLkdldFVzZXJJbmZvUmVzdWx0ID0gZnVuY3Rpb24oc29hcCkgewoKCXRoaXMuYmFzZSA9IFNmb3JjZS5Tb2FwT2JqZWN0OwoJdGhpcy5iYXNlKCk7Cgl0aGlzLmNsYXNzTmFtZSA9ICJHZXRVc2VySW5mb1Jlc3VsdCI7CgkKCWlmIChzb2FwKSB7CgkJU2ZvcmNlLmxvYWRPYmplY3QodGhpcywgc29hcCk7Cgl9Cn0KU2ZvcmNlLkdldFVzZXJJbmZvUmVzdWx0LnByb3RvdHlwZSA9IG5ldyBTZm9yY2UuU29hcE9iamVjdDsKU2ZvcmNlLkdldFVzZXJJbmZvUmVzdWx0LnByb3RvdHlwZS5hY2Nlc3NpYmlsaXR5TW9kZSA9IG5ldyBCb29sZWFuKCk7ClNmb3JjZS5HZXRVc2VySW5mb1Jlc3VsdC5wcm90b3R5cGUuY3VycmVuY3lTeW1ib2wgPSBuZXcgU3RyaW5nKCk7ClNmb3JjZS5HZXRVc2VySW5mb1Jlc3VsdC5wcm90b3R5cGUub3JnYW5pemF0aW9uSWQgPSBuZXcgU3RyaW5nKCk7ClNmb3JjZS5HZXRVc2VySW5mb1Jlc3VsdC5wcm90b3R5cGUub3JnYW5pemF0aW9uTXVsdGlDdXJyZW5jeSA9IG5ldyBCb29sZWFuKCk7ClNmb3JjZS5HZXRVc2VySW5mb1Jlc3VsdC5wcm90b3R5cGUub3JnYW5pemF0aW9uTmFtZSA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkdldFVzZXJJbmZvUmVzdWx0LnByb3RvdHlwZS51c2VyRGVmYXVsdEN1cnJlbmN5SXNvQ29kZSA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkdldFVzZXJJbmZvUmVzdWx0LnByb3RvdHlwZS51c2VyRW1haWwgPSBuZXcgU3RyaW5nKCk7ClNmb3JjZS5HZXRVc2VySW5mb1Jlc3VsdC5wcm90b3R5cGUudXNlckZ1bGxOYW1lID0gbmV3IFN0cmluZygpOwpTZm9yY2UuR2V0VXNlckluZm9SZXN1bHQucHJvdG90eXBlLnVzZXJJZCA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkdldFVzZXJJbmZvUmVzdWx0LnByb3RvdHlwZS51c2VyTGFuZ3VhZ2UgPSBuZXcgU3RyaW5nKCk7ClNmb3JjZS5HZXRVc2VySW5mb1Jlc3VsdC5wcm90b3R5cGUudXNlckxvY2FsZSA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkdldFVzZXJJbmZvUmVzdWx0LnByb3RvdHlwZS51c2VyVGltZVpvbmUgPSBuZXcgU3RyaW5nKCk7ClNmb3JjZS5HZXRVc2VySW5mb1Jlc3VsdC5wcm90b3R5cGUudXNlclVpU2tpbiA9IG5ldyBTdHJpbmcoKTsKClNmb3JjZS5Mb2dpblJlc3VsdCA9IGZ1bmN0aW9uKHNvYXApIHsKCXRoaXMuYmFzZSA9IFNmb3JjZS5Tb2FwT2JqZWN0OwoJdGhpcy5jbGFzc05hbWUgPSAiTG9naW5SZXN1bHQiOwoJaWYgKHNvYXApIHsKCQlTZm9yY2UubG9hZE9iamVjdCh0aGlzLCBzb2FwKTsJCQoJfQoJLypmdW5jdGlvbiBsb2FkTWUob2JqLCBub2RlKSB7CgkJaWYgKG5ldyBTZm9yY2UuQXBwbGljYXRpb24oKS5nZXRfdHlwZSgpID09IFNmb3JjZS5BcHBsaWNhdGlvbi5UeXBlLkludGVybmV0RXhwbG9yZXIpIHsKCQkJdmFyIG5vZGVOYW1lID0gImJhc2VOYW1lIjsKCQl9IGVsc2UgewoJCQl2YXIgbm9kZU5hbWUgPSAibG9jYWxOYW1lIjsKCQl9CgkJZm9yICh2YXIgaT0wO2k8bm9kZS5jaGlsZE5vZGVzLmxlbmd0aDtpKyspIHsKCQkJdmFyIG5hbWUgID0gbm9kZS5jaGlsZE5vZGVzW2ldW25vZGVOYW1lXTsKCQkJaWYgKChub2RlLmNoaWxkTm9kZXNbaV0uY2hpbGROb2Rlcy5sZW5ndGggPiAwICYmIG5vZGUuY2hpbGROb2Rlc1tpXS5jaGlsZE5vZGVzWzBdLm5vZGVUeXBlICE9IDMpID09IHRydWUpIHsKCQkJCXZhciBuZXdvYmogPSBuZXcgU2ZvcmNlW29ialtuYW1lXS5jbGFzc05hbWVdOwoJCQkJbG9hZE1lKG5ld29iaiwgbm9kZS5jaGlsZE5vZGVzW2ldKTsKCQkJCW9ialtuYW1lXSA9IG5ld29iajsKCQkJfSBlbHNlIHsKCQkJCW9ialtuYW1lXSA9IFNmb3JjZS5nZXRUeXBlZFZhbHVlKG5vZGUuY2hpbGROb2Rlc1tpXSwgb2JqLCBuYW1lKTsKCQkJfQoJCX0KCX07Ki8KfQpTZm9yY2UuTG9naW5SZXN1bHQucHJvdG90eXBlID0gbmV3IFNmb3JjZS5Tb2FwT2JqZWN0OwovKiogQHR5cGUgQm9vbGVhbiAqLwpTZm9yY2UuTG9naW5SZXN1bHQucHJvdG90eXBlLnBhc3N3b3JkRXhwaXJlZCA9IG5ldyBCb29sZWFuKCk7Ci8qKiBAdHlwZSBTdHJpbmcgKi8KU2ZvcmNlLkxvZ2luUmVzdWx0LnByb3RvdHlwZS5zZXJ2ZXJVcmwgPSBuZXcgU3RyaW5nKCk7Ci8qKiBAdHlwZSBTdHJpbmcgKi8KU2ZvcmNlLkxvZ2luUmVzdWx0LnByb3RvdHlwZS5zZXNzaW9uSWQgPSBuZXcgU3RyaW5nKCk7Ci8qKiBAdHlwZSBTdHJpbmcgKi8KU2ZvcmNlLkxvZ2luUmVzdWx0LnByb3RvdHlwZS51c2VySWQgPSBuZXcgU3RyaW5nKCk7Ci8qKiBAdHlwZSBHZXRVc2VySW5mb1Jlc3VsdCAqLwpTZm9yY2UuTG9naW5SZXN1bHQucHJvdG90eXBlLnVzZXJJbmZvID0gbmV3IFNmb3JjZS5HZXRVc2VySW5mb1Jlc3VsdCgpOwoKU2ZvcmNlLlF1ZXJ5UmVzdWx0ID0gZnVuY3Rpb24oc29hcCkgewoKCXRoaXMuYmFzZSA9IFNmb3JjZS5Tb2FwT2JqZWN0OwoJdGhpcy5iYXNlKCk7Cgl0aGlzLmNsYXNzTmFtZSA9ICJRdWVyeVJlc3VsdCI7CglpZiAoc29hcCkgewoJCXRoaXMucmVjb3JkcyA9IG5ldyBBcnJheSgpOwoJCVNmb3JjZS5sb2FkT2JqZWN0KHRoaXMsIHNvYXApOwoJCWlmICh0aGlzLnNpemUgPiAwKSB7CgkJCXZhciByZWNzID0gU2ZvcmNlLkRPTS5HZXRJbW1lZGlhdGVDaGlsZEVsZW1lbnRzQnlOYW1lKHNvYXAsICJyZWNvcmRzIik7CgkJCS8vdmFyIHJlY3MgPSBzb2FwLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJyZWNvcmRzIik7CgkJCXRoaXMucmVjb3JkcyA9IFNmb3JjZS5TZXJpYWxpemF0aW9uLkRlc2VyaWFsaXplQmVhbnMocmVjcyk7CgkJfQoJfQp9OwpTZm9yY2UuUXVlcnlSZXN1bHQucHJvdG90eXBlID0gbmV3IFNmb3JjZS5Tb2FwT2JqZWN0OwovKiogQHR5cGUgSW50ZWdlciAqLwpTZm9yY2UuUXVlcnlSZXN1bHQucHJvdG90eXBlLnNpemUgPSAwOwovKiogQHR5cGUgU3RyaW5nICovClNmb3JjZS5RdWVyeVJlc3VsdC5wcm90b3R5cGUucXVlcnlMb2NhdG9yID0gbmV3IFN0cmluZygpOwovKiogQHR5cGUgQm9vbGVhbiAqLwpTZm9yY2UuUXVlcnlSZXN1bHQucHJvdG90eXBlLmRvbmUgPSBuZXcgQm9vbGVhbigpOwovKiogQHR5cGUgRHluYUJlYW5bXSAqLwpTZm9yY2UuUXVlcnlSZXN1bHQucHJvdG90eXBlLnJlY29yZHMgPSBuZXcgQXJyYXkoKTsKU2ZvcmNlLlF1ZXJ5UmVzdWx0LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKHRhYikgewoJaWYgKHRhYiA9PSB1bmRlZmluZWQpIHsKCQl0YWIgPSAiIjsKCX0KCWluZCsrOwoJdmFyIG91dHB1dCA9ICJcbiIgKyB0YWIgKyAiUXVlcnkgUmVzdWx0IFsiICsgaW5kICsiXTpcbiI7CglvdXRwdXQgKz0gdGFiICsgInNpemU6ICIgKyB0aGlzLnNpemUgKyAiXG4iOwoJb3V0cHV0ICs9IHRhYiArICJxdWVyeUxvY2F0b3I6ICIgKyB0aGlzLnF1ZXJ5TG9jYXRvciArICJcbiI7CglvdXRwdXQgKz0gdGFiICsgImRvbmU6ICIgKyB0aGlzLmRvbmUgKyAiXG4iOwoJdmFyIG5ld1RhYiA9IHRhYiArICIgICAgIjsKCWZvciAodmFyIGk9MDtpPHRoaXMucmVjb3Jkcy5sZW5ndGg7aSsrKSB7CgkJdmFyIGRiID0gdGhpcy5yZWNvcmRzW2ldOwoJCW91dHB1dCArPSB0YWIgKyAicmVjb3JkICIgKyAoaSArIDEpICsgIiBbIiArIGluZCArICJdOlxuIjsKCQlmb3IgKGtleSBpbiBkYi5rZXlzKSB7CgkJCXZhciB2ID0gZGIuZ2V0SXRlbShrZXkpLnZhbHVlOwoJCQlpZiAodiA9PSBudWxsKSB7CgkJCQlvdXRwdXQgKz0gbmV3VGFiICsga2V5ICsgIjogKG51bGwpXG4iOwoJCQl9IGVsc2UgewoJCQkJdHJ5IHsKCQkJCQlpZiAoZGIuZ2V0SXRlbShrZXkpLnZhbHVlLmNsYXNzTmFtZSA9PSAiRHluYWJlYW4iKSB7CgkJCQkJCW91dHB1dCArPSBuZXdUYWIgKyBrZXkgKyAiOiAiICsgZGIuZ2V0SXRlbShrZXkpLnZhbHVlLnRvU3RyaW5nKG5ld1RhYiArICIgICAgIikgKyAiXG4iOwoJCQkJCX0gZWxzZSBpZiAoZGIuZ2V0SXRlbShrZXkpLnZhbHVlLmNsYXNzTmFtZSA9PSAiUXVlcnlSZXN1bHQiKSB7CgkJCQkJCW91dHB1dCArPSBuZXdUYWIgKyBrZXkgKyAiOiAiICsgZGIuZ2V0SXRlbShrZXkpLnZhbHVlLnRvU3RyaW5nKG5ld1RhYiArICIgICAgIikgKyAiXG4iOwoJCQkJCX0gZWxzZSB7CgkJCQkJCW91dHB1dCArPSBuZXdUYWIgKyBrZXkgKyAiOiAiICsgZGIuZ2V0SXRlbShrZXkpLnZhbHVlLnRvU3RyaW5nKG5ld1RhYikgKyAiXG4iOwoJCQkJCX0KCQkJCX0gY2F0Y2goZSkgewoJCQkJCW91dHB1dCArPSBuZXdUYWIgKyBrZXkgKyAiOiAiICsgZGIuZ2V0SXRlbShrZXkpLnZhbHVlICsgIlxuIjsKCQkJCX0KCQkJfQoJCX0KCX0KCW91dHB1dCArPSB0YWIgKyAiUXVlcnlSZXN1bHQgWyIgKyBpbmQgKyAiXSAgKioqKioqKioqKioqKioqKioqKioqKiogXG4iOwoJaW5kLS07CglyZXR1cm4gb3V0cHV0Owp9OwoKU2ZvcmNlLkxlYWRDb252ZXJ0ID0gZnVuY3Rpb24oKSB7CgoJdGhpcy5iYXNlID0gU2ZvcmNlLlNvYXBPYmplY3Q7Cgl0aGlzLmJhc2UoKTsKCXRoaXMuY2xhc3NOYW1lID0gIkxlYWRDb252ZXJ0cyI7Cn0KU2ZvcmNlLkxlYWRDb252ZXJ0LnByb3RvdHlwZSA9IG5ldyBTZm9yY2UuU29hcE9iamVjdDsKLyoqIElkIG9mIHRoZSBhY2NvdW50IHRvIGFkZCB0aGUgY29udmVydGVkIGxlYWQgdG8uCiAqIEB0eXBlIFN0cmluZyAqLwpTZm9yY2UuTGVhZENvbnZlcnQucHJvdG90eXBlLmFjY291bnRJZCA9IG5ldyBTdHJpbmcoKTsKLyoqIElkIG9mIHRoZSBjb250YWN0IHRvIG1lcmdlIHRoZSBsZWFkIGluZm8gd2l0aC4KICogQHR5cGUgU3RyaW5nICovClNmb3JjZS5MZWFkQ29udmVydC5wcm90b3R5cGUuY29udGFjdElkID0gbmV3IFN0cmluZygpOwovKiogVGhlIHN0YXR1cyB0byBhc3NpZ24gdG8gdGhlIGNvbnZlcnRlZCBsZWFkIHJlY29yZCAobXVzdCBiZSBhbiBleGlzdGluZyBzdGF0dXMpLgogKiBAdHlwZSBTdHJpbmcgKi8KU2ZvcmNlLkxlYWRDb252ZXJ0LnByb3RvdHlwZS5jb252ZXJ0ZWRTdGF0dXMgPSBuZXcgU3RyaW5nKCk7Ci8qKiBJbmRpY2F0aW9uIHdoZXRoZXIgYSBuZXcgb3Bwb3J0dW5pdHkgc2hvdWxkIGJlIGNyZWF0ZWQgZHVyaW5nIGNvbnZlcnNpb24uCiAqIEB0eXBlIEJvb2xlYW4gKi8KU2ZvcmNlLkxlYWRDb252ZXJ0LnByb3RvdHlwZS5kb05vdENyZWF0ZU9wcG9ydHVuaXR5ID0gbmV3IEJvb2xlYW4oKTsKLyoqIFRoZSBpZCBvZiB0aGUgbGVhZCB0byBjb252ZXJ0LgogKiBAdHlwZSBTdHJpbmcgKi8KU2ZvcmNlLkxlYWRDb252ZXJ0LnByb3RvdHlwZS5sZWFkSWQgPSBuZXcgU3RyaW5nKCk7Ci8qKiBJZiBjcmVhdGluZyBhIG5ldyBvcHBvcnR1bml0eSwgdGhpcyBpcyB0aGUgbmFtZSB0aGF0IHdpbGwgYmUgYXNzaWduZWQgdG8gaXQuCiAqIEB0eXBlIFN0cmluZyAqLwpTZm9yY2UuTGVhZENvbnZlcnQucHJvdG90eXBlLm9wcG9ydHVuaXR5TmFtZSA9IG5ldyBTdHJpbmcoKTsKLyoqIEB0eXBlIEJvb2xlYW4gKi8KU2ZvcmNlLkxlYWRDb252ZXJ0LnByb3RvdHlwZS5vdmVyd3JpdGVMZWFkU291cmNlID0gbmV3IEJvb2xlYW4oKTsKLyoqIEB0eXBlIFN0cmluZyAqLwpTZm9yY2UuTGVhZENvbnZlcnQucHJvdG90eXBlLm93bmVySWQgPSBuZXcgU3RyaW5nKCk7Ci8qKiBJbmRpY2F0aW9uIHdoZXRoZXIgb3Igbm90IHRvIHNlbmQgYSBub3RpZmljYXRpb24gZW1haWwgdG8gdGhlIGNvbnZlcnRlZCBsZWFkJ3MgZW1haWwgYWRkcmVzcy4KICogQHR5cGUgQm9vbGVhbiAqLwpTZm9yY2UuTGVhZENvbnZlcnQucHJvdG90eXBlLnNlbmROb3RpZmljYXRpb25FbWFpbCA9IG5ldyBCb29sZWFuKCk7Ci8qKiBAcmV0dXJuIFN0cmluZyAKICogQHR5cGUgU3RyaW5nCiAqLwpTZm9yY2UuTGVhZENvbnZlcnQucHJvdG90eXBlLnRvU29hcCA9IGZ1bmN0aW9uKCkgewoJdmFyIG91dHB1dCA9ICI8bGVhZENvbnZlcnRzPiI7Cglmb3IgKGtleSBpbiB0aGlzKSB7CgkJaWYgKGtleSAhPSAiY2xhc3NOYW1lIikgewoJCQlpZiAoU2ZvcmNlLlV0aWwuZGx0eXBlb2YodGhpc1trZXldKSA9PSAic3RyaW5nIiB8fCBTZm9yY2UuVXRpbC5kbHR5cGVvZih0aGlzW2tleV0pID09ICJib29sZWFuIikgewoJCQkJaWYgKFNmb3JjZS5VdGlsLmRsdHlwZW9mKHRoaXNba2V5XSkgPT0gInN0cmluZyIpIHsKCQkJCQlpZiAodGhpc1trZXldLmxlbmd0aCA9PSAwKSB7CgkJCQkJCW91dHB1dCArPSAiPCIgKyBrZXkgKyAiIHhzaTpuaWw9XCJ0cnVlXCIvPiI7CgkJCQkJfSBlbHNlIHsKCQkJCQkJb3V0cHV0ICs9ICI8IiArIGtleSArICI+IiArIHRoaXNba2V5XSArICI8LyIgKyBrZXkgKyAiPiI7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQlvdXRwdXQgKz0gIjwiICsga2V5ICsgIj4iICsgdGhpc1trZXldLnRvU3RyaW5nKCkgKyAiPC8iICsga2V5ICsgIj4iOwoJCQkJfQoJCQl9CgkJfQoJfQoJcmV0dXJuIG91dHB1dCArICI8L2xlYWRDb252ZXJ0cz4iOwp9OwoKClNmb3JjZS5MZWFkQ29udmVydFJlc3VsdCA9IGZ1bmN0aW9uKHNvYXApIHsKCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiTGVhZENvbnZlcnRSZXN1bHQiOwoKCWlmIChzb2FwKSB7CgkJdGhpcy5lcnJvcnMgPSBuZXcgQXJyYXkoKTsKCQlTZm9yY2UubG9hZE9iamVjdCh0aGlzLCBzb2FwKTsKCX0KfQpTZm9yY2UuTGVhZENvbnZlcnRSZXN1bHQucHJvdG90eXBlID0gbmV3IFNmb3JjZS5Tb2FwT2JqZWN0OwpTZm9yY2UuTGVhZENvbnZlcnRSZXN1bHQucHJvdG90eXBlLmFjY291bnRJZCA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkxlYWRDb252ZXJ0UmVzdWx0LnByb3RvdHlwZS5jb250YWN0SWQgPSBuZXcgU3RyaW5nKCk7ClNmb3JjZS5MZWFkQ29udmVydFJlc3VsdC5wcm90b3R5cGUuZXJyb3JzID0gbmV3IEFycmF5KCk7ClNmb3JjZS5MZWFkQ29udmVydFJlc3VsdC5wcm90b3R5cGUubGVhZGlkID0gbmV3IFN0cmluZygpClNmb3JjZS5MZWFkQ29udmVydFJlc3VsdC5wcm90b3R5cGUub3Bwb3J0dW5pdHlJZCA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkxlYWRDb252ZXJ0UmVzdWx0LnByb3RvdHlwZS5zdWNjZXNzID0gbmV3IEJvb2xlYW4oKTsKClNmb3JjZS5EZXNjcmliZUdsb2JhbFJlc3VsdCA9IGZ1bmN0aW9uKHNvYXApIHsKCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiRGVzY3JpYmVHbG9iYWxSZXN1bHQiOwoKCWlmIChzb2FwKSB7CgkJdGhpcy50eXBlcyA9IG5ldyBBcnJheSgpOwoJCVNmb3JjZS5sb2FkT2JqZWN0KHRoaXMsIHNvYXApOwoJCS8vdmFyIHQgPSBzb2FwLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0eXBlcyIpOwoJCS8vZm9yICh2YXIgeD0wO3g8dC5sZW5ndGg7eCsrKSB7CgkJLy8JdGhpcy50eXBlc1t4XSA9IFNmb3JjZS5ET00uR2V0Tm9kZVZhbHVlKHRbeF0pOwoJCS8vfQoJfQp9ClNmb3JjZS5EZXNjcmliZUdsb2JhbFJlc3VsdC5wcm90b3R5cGUgPSBuZXcgU2ZvcmNlLlNvYXBPYmplY3Q7ClNmb3JjZS5EZXNjcmliZUdsb2JhbFJlc3VsdC5wcm90b3R5cGUuZW5jb2RpbmcgPSBuZXcgU3RyaW5nKCk7ClNmb3JjZS5EZXNjcmliZUdsb2JhbFJlc3VsdC5wcm90b3R5cGUubWF4QmF0Y2hTaXplID0gMDsKU2ZvcmNlLkRlc2NyaWJlR2xvYmFsUmVzdWx0LnByb3RvdHlwZS50eXBlcyA9IG5ldyBBcnJheSgpOwoKU2ZvcmNlLkRlc2NyaWJlR2xvYmFsUmVzdWx0LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewoJdmFyIG91dCA9ICJtYXhCYXRjaHNpemU6ICIgKyB0aGlzLm1heEJhdGNoU2l6ZSArICJcbiI7CglvdXQgKz0gImVuY29kaW5nOiAiICsgdGhpcy5lbmNvZGluZyArICJcbiI7CglvdXQgKz0gInR5cGVzOiBcbiI7Cglmb3IgKHZhciBpPTA7aTx0aGlzLnR5cGVzLmxlbmd0aDtpKyspIHsKCQlvdXQgKz0gIiAgICAiICsgdGhpcy50eXBlc1tpXSArICJcbiI7Cgl9CglyZXR1cm4gb3V0Owp9OwoKU2ZvcmNlLkRlc2NyaWJlTGF5b3V0UmVzdWx0ID0gZnVuY3Rpb24oc29hcCkgewoKCXRoaXMuYmFzZSA9IFNmb3JjZS5Tb2FwT2JqZWN0OwoJdGhpcy5iYXNlKCk7Cgl0aGlzLmNsYXNzTmFtZSA9ICJEZXNjcmliZUxheW91dFJlc3VsdCI7CgoJaWYgKHNvYXApIHsKCQl0aGlzLmxheW91dHMgPSBuZXcgQXJyYXkoKTsKCQl0aGlzLnJlY29yZFR5cGVNYXBwaW5ncyA9IG5ldyBBcnJheSgpOwoJCVNmb3JjZS5sb2FkT2JqZWN0KHRoaXMsIHNvYXApOwoJfQp9ClNmb3JjZS5EZXNjcmliZUxheW91dFJlc3VsdC5wcm90b3R5cGUgPSBuZXcgU2ZvcmNlLlNvYXBPYmplY3Q7ClNmb3JjZS5EZXNjcmliZUxheW91dFJlc3VsdC5wcm90b3R5cGUubGF5b3V0cyA9IG5ldyBBcnJheSgpOwpTZm9yY2UuRGVzY3JpYmVMYXlvdXRSZXN1bHQucHJvdG90eXBlLnJlY29yZFR5cGVNYXBwaW5ncyA9IG5ldyBBcnJheSgpOwoKU2ZvcmNlLkRlc2NyaWJlTGF5b3V0ID0gZnVuY3Rpb24oc29hcCkgewoKCXRoaXMuYmFzZSA9IFNmb3JjZS5Tb2FwT2JqZWN0OwoJdGhpcy5iYXNlKCk7Cgl0aGlzLmNsYXNzTmFtZSA9ICJEZXNjcmliZUxheW91dCI7CgoJaWYgKHNvYXApIHsKCQl0aGlzLmRldGFpbExheW91dFNlY3Rpb25zID0gbmV3IEFycmF5KCk7CgkJdGhpcy5lZGl0TGF5b3V0U2VjdGlvbnMgPSBuZXcgQXJyYXkoKTsKCQlTZm9yY2UubG9hZE9iamVjdCh0aGlzLCBzb2FwKTsKCX0KfQpTZm9yY2UuRGVzY3JpYmVMYXlvdXQucHJvdG90eXBlID0gbmV3IFNmb3JjZS5Tb2FwT2JqZWN0OwpTZm9yY2UuRGVzY3JpYmVMYXlvdXQucHJvdG90eXBlLmRldGFpbExheW91dFNlY3Rpb25zID0gbmV3IEFycmF5KCk7ClNmb3JjZS5EZXNjcmliZUxheW91dC5wcm90b3R5cGUuZWRpdExheW91dFNlY3Rpb25zID0gbmV3IEFycmF5KCk7ClNmb3JjZS5EZXNjcmliZUxheW91dC5wcm90b3R5cGUuaWQgPSBuZXcgU3RyaW5nKCk7CgpTZm9yY2UuUmVjb3JkVHlwZU1hcHBpbmcgPSBmdW5jdGlvbihzb2FwKSB7CgoJdGhpcy5iYXNlID0gU2ZvcmNlLlNvYXBPYmplY3Q7Cgl0aGlzLmJhc2UoKTsKCXRoaXMuY2xhc3NOYW1lID0gIlJlY29yZFR5cGVNYXBwaW5nIjsKCglpZiAoc29hcCkgewoJCXRoaXMucGlja2xpc3RzRm9yUmVjb3JkVHlwZSA9IG5ldyBBcnJheSgpOwoJCVNmb3JjZS5sb2FkT2JqZWN0KHRoaXMsIHNvYXApOwoJfQp9ClNmb3JjZS5SZWNvcmRUeXBlTWFwcGluZy5wcm90b3R5cGUgPSBuZXcgU2ZvcmNlLlNvYXBPYmplY3Q7ClNmb3JjZS5SZWNvcmRUeXBlTWFwcGluZy5wcm90b3R5cGUuYXZhaWxhYmxlID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLlJlY29yZFR5cGVNYXBwaW5nLnByb3RvdHlwZS5kZWZhdWx0UmVjb3JkVHlwZU1hcHBpbmcgPSBuZXcgQm9vbGVhbigpOwpTZm9yY2UuUmVjb3JkVHlwZU1hcHBpbmcucHJvdG90eXBlLmxheW91dElkID0gbmV3IFN0cmluZygpOwpTZm9yY2UuUmVjb3JkVHlwZU1hcHBpbmcucHJvdG90eXBlLm5hbWUgPSBuZXcgU3RyaW5nKCk7ClNmb3JjZS5SZWNvcmRUeXBlTWFwcGluZy5wcm90b3R5cGUucGlja2xpc3RzRm9yUmVjb3JkVHlwZSA9IG5ldyBBcnJheSgpOwpTZm9yY2UuUmVjb3JkVHlwZU1hcHBpbmcucHJvdG90eXBlLnJlY29yZFR5cGVJZCA9IG5ldyBTdHJpbmcoKTsKClNmb3JjZS5QaWNrbGlzdEZvclJlY29yZFR5cGUgPSBmdW5jdGlvbihzb2FwKSB7CgoJdGhpcy5iYXNlID0gU2ZvcmNlLlNvYXBPYmplY3Q7Cgl0aGlzLmJhc2UoKTsKCXRoaXMuY2xhc3NOYW1lID0gIlBpY2tsaXN0Rm9yUmVjb3JkVHlwZSI7CgoJaWYgKHNvYXApIHsKCQl0aGlzLnBpY2tsaXN0VmFsdWVzID0gbmV3IEFycmF5KCk7CgkJU2ZvcmNlLmxvYWRPYmplY3QodGhpcywgc29hcCk7Cgl9Cn0KU2ZvcmNlLlBpY2tsaXN0Rm9yUmVjb3JkVHlwZS5wcm90b3R5cGUgPSBuZXcgU2ZvcmNlLlNvYXBPYmplY3Q7ClNmb3JjZS5QaWNrbGlzdEZvclJlY29yZFR5cGUucHJvdG90eXBlLnBpY2tsaXN0TmFtZSA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLlBpY2tsaXN0Rm9yUmVjb3JkVHlwZS5wcm90b3R5cGUucGlja2xpc3RWYWx1ZXMgPSBuZXcgQXJyYXkoKTsKClNmb3JjZS5MYXlvdXRDb21wb25lbnRUeXBlID0gbmV3IE9iamVjdCgpOwpTZm9yY2UuTGF5b3V0Q29tcG9uZW50VHlwZS5GaWVsZCA9ICJGaWVsZCI7ClNmb3JjZS5MYXlvdXRDb21wb25lbnRUeXBlLlNlcGFyYXRvciA9ICJTZXBhcmF0b3IiOwoKU2ZvcmNlLkRlc2NyaWJlTGF5b3V0U2VjdGlvbiA9IGZ1bmN0aW9uKHNvYXApIHsKCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiRGVzY3JpYmVMYXlvdXRTZWN0aW9uIjsKCglpZiAoc29hcCkgewoJCXRoaXMubGF5b3V0Um93cyA9IG5ldyBBcnJheSgpOwoJCVNmb3JjZS5sb2FkT2JqZWN0KHRoaXMsIHNvYXApOwoJfQp9ClNmb3JjZS5EZXNjcmliZUxheW91dFNlY3Rpb24ucHJvdG90eXBlID0gbmV3IFNmb3JjZS5Tb2FwT2JqZWN0OwpTZm9yY2UuRGVzY3JpYmVMYXlvdXRTZWN0aW9uLnByb3RvdHlwZS5jb2x1bW5zID0gMDsKU2ZvcmNlLkRlc2NyaWJlTGF5b3V0U2VjdGlvbi5wcm90b3R5cGUuaGVhZGluZyA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkRlc2NyaWJlTGF5b3V0U2VjdGlvbi5wcm90b3R5cGUubGF5b3V0Um93cyA9IG5ldyBBcnJheSgpOwpTZm9yY2UuRGVzY3JpYmVMYXlvdXRTZWN0aW9uLnByb3RvdHlwZS5yb3dzID0gMDsKU2ZvcmNlLkRlc2NyaWJlTGF5b3V0U2VjdGlvbi5wcm90b3R5cGUudXNlQ29sbGFwc2libGVTZWN0aW9uID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLkRlc2NyaWJlTGF5b3V0U2VjdGlvbi5wcm90b3R5cGUudXNlSGVhZGluZyA9IG5ldyBCb29sZWFuKCk7CgpTZm9yY2UuRGVzY3JpYmVMYXlvdXRSb3cgPSBmdW5jdGlvbihzb2FwKSB7CgoJdGhpcy5iYXNlID0gU2ZvcmNlLlNvYXBPYmplY3Q7Cgl0aGlzLmJhc2UoKTsKCXRoaXMuY2xhc3NOYW1lID0gIkRlc2NyaWJlTGF5b3V0Um93IjsKCglpZiAoc29hcCkgewoJCXRoaXMubGF5b3V0SXRlbXMgPSBuZXcgQXJyYXkoKTsKCQlTZm9yY2UubG9hZE9iamVjdCh0aGlzLCBzb2FwKTsKCX0KfQpTZm9yY2UuRGVzY3JpYmVMYXlvdXRSb3cucHJvdG90eXBlID0gbmV3IFNmb3JjZS5Tb2FwT2JqZWN0OwpTZm9yY2UuRGVzY3JpYmVMYXlvdXRSb3cucHJvdG90eXBlLmxheW91dEl0ZW1zID0gbmV3IEFycmF5KCk7ClNmb3JjZS5EZXNjcmliZUxheW91dFJvdy5wcm90b3R5cGUubnVtSXRlbXMgPSAwOwoKU2ZvcmNlLkRlc2NyaWJlTGF5b3V0SXRlbSA9IGZ1bmN0aW9uKHNvYXApIHsKCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiRGVzY3JpYmVMYXlvdXRJdGVtIjsKCglpZiAoc29hcCkgewoJCXRoaXMubGF5b3V0Q29tcG9uZW50cyA9IG5ldyBBcnJheSgpOwoJCVNmb3JjZS5sb2FkT2JqZWN0KHRoaXMsIHNvYXApOwoJfQp9ClNmb3JjZS5EZXNjcmliZUxheW91dEl0ZW0ucHJvdG90eXBlID0gbmV3IFNmb3JjZS5Tb2FwT2JqZWN0OwpTZm9yY2UuRGVzY3JpYmVMYXlvdXRJdGVtLnByb3RvdHlwZS5lZGl0YWJsZSA9IG5ldyBCb29sZWFuKCk7ClNmb3JjZS5EZXNjcmliZUxheW91dEl0ZW0ucHJvdG90eXBlLmxhYmVsID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRGVzY3JpYmVMYXlvdXRJdGVtLnByb3RvdHlwZS5sYXlvdXRDb21wb25lbnRzID0gbmV3IEFycmF5KCk7ClNmb3JjZS5EZXNjcmliZUxheW91dEl0ZW0ucHJvdG90eXBlLnBsYWNlaG9sZGVyID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLkRlc2NyaWJlTGF5b3V0SXRlbS5wcm90b3R5cGUucmVxdWlyZWQgPSBuZXcgQm9vbGVhbigpOwoKU2ZvcmNlLkRlc2NyaWJlTGF5b3V0Q29tcG9uZW50ID0gZnVuY3Rpb24oc29hcCkgewoKCXRoaXMuYmFzZSA9IFNmb3JjZS5Tb2FwT2JqZWN0OwoJdGhpcy5iYXNlKCk7Cgl0aGlzLmNsYXNzTmFtZSA9ICJEZXNjcmliZUxheW91dENvbXBvbmVudCI7CgoJaWYgKHNvYXApIHsKCQlTZm9yY2UubG9hZE9iamVjdCh0aGlzLCBzb2FwKTsKCX0KfQpTZm9yY2UuRGVzY3JpYmVMYXlvdXRDb21wb25lbnQucHJvdG90eXBlID0gbmV3IFNmb3JjZS5Tb2FwT2JqZWN0OwpTZm9yY2UuRGVzY3JpYmVMYXlvdXRDb21wb25lbnQucHJvdG90eXBlLnRhYk9yZGVyID0gMDsKU2ZvcmNlLkRlc2NyaWJlTGF5b3V0Q29tcG9uZW50LnByb3RvdHlwZS50eXBlID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRGVzY3JpYmVMYXlvdXRDb21wb25lbnQucHJvdG90eXBlLnZhbHVlID0gbmV3IFN0cmluZygpOwoKLyoKICogMi8yNy8yMDA2IERKQyAtIEZpeGVkIGxhYmVsIGFuZCBzb2JqZWN0TmFtZSBmaWVsZHMgdG8gYmUgc3RyaW5ncyBpbnN0ZWFkIG9mIGJvb2xlYW4uCiovClNmb3JjZS5EZXNjcmliZVRhYiA9IGZ1bmN0aW9uKHNvYXApIHsKCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiRGVzY3JpYmVUYWIiOwoKCWlmIChzb2FwKSB7CgkJU2ZvcmNlLmxvYWRPYmplY3QodGhpcywgc29hcCk7Cgl9Cn0KU2ZvcmNlLkRlc2NyaWJlVGFiLnByb3RvdHlwZSA9IG5ldyBTZm9yY2UuU29hcE9iamVjdDsKU2ZvcmNlLkRlc2NyaWJlVGFiLnByb3RvdHlwZS5jdXN0b20gPSBuZXcgQm9vbGVhbigpOwpTZm9yY2UuRGVzY3JpYmVUYWIucHJvdG90eXBlLmxhYmVsID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRGVzY3JpYmVUYWIucHJvdG90eXBlLnNvYmplY3ROYW1lID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRGVzY3JpYmVUYWIucHJvdG90eXBlLnVybCA9IG5ldyBTdHJpbmcoKTsKClNmb3JjZS5EZXNjcmliZVRhYlNldFJlc3VsdCA9IGZ1bmN0aW9uKHNvYXApIHsKCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiRGVzY3JpYmVUYWJTZXRSZXN1bHQiOwoKCWlmIChzb2FwKSB7CgkJdGhpcy50YWJzID0gbmV3IEFycmF5KCk7CgkJU2ZvcmNlLmxvYWRPYmplY3QodGhpcywgc29hcCk7Cgl9Cn0KU2ZvcmNlLkRlc2NyaWJlVGFiU2V0UmVzdWx0LnByb3RvdHlwZSA9IG5ldyBTZm9yY2UuU29hcE9iamVjdDsKU2ZvcmNlLkRlc2NyaWJlVGFiU2V0UmVzdWx0LnByb3RvdHlwZS5sYWJlbCA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkRlc2NyaWJlVGFiU2V0UmVzdWx0LnByb3RvdHlwZS5sb2dvVXJsID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRGVzY3JpYmVUYWJTZXRSZXN1bHQucHJvdG90eXBlLnNlbGVjdGVkID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLkRlc2NyaWJlVGFiU2V0UmVzdWx0LnByb3RvdHlwZS50YWJzID0gbmV3IEFycmF5KCk7CgpTZm9yY2UuR2V0RGVsZXRlZFJlc3VsdCA9IGZ1bmN0aW9uKHNvYXApIHsKCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiR2V0RGVsZXRlZFJlc3VsdHMiOwoJCglpZiAoc29hcCkgewoJCXRoaXMuZGVsZXRlZFJlY29yZHMgPSBuZXcgQXJyYXkoKTsKCQlTZm9yY2UubG9hZE9iamVjdCh0aGlzLCBzb2FwKTsKCX0KfQpTZm9yY2UuR2V0RGVsZXRlZFJlc3VsdC5wcm90b3R5cGUgPSBuZXcgU2ZvcmNlLlNvYXBPYmplY3Q7ClNmb3JjZS5HZXREZWxldGVkUmVzdWx0LnByb3RvdHlwZS5kZWxldGVkUmVjb3JkcyA9IG5ldyBBcnJheSgpOwpTZm9yY2UuR2V0RGVsZXRlZFJlc3VsdC5wcm90b3R5cGUuc2ZvcmNlUmVzZXJ2ZWQgPSBuZXcgU3RyaW5nKCk7CgpTZm9yY2UuRGVsZXRlZFJlY29yZCA9IGZ1bmN0aW9uKHNvYXApIHsKCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiR2V0RGVsZXRlZFJlc3VsdCI7CgoJaWYgKHNvYXApIHsKCQlTZm9yY2UubG9hZE9iamVjdCh0aGlzLCBzb2FwKTsKCX0KfQpTZm9yY2UuRGVsZXRlZFJlY29yZC5wcm90b3R5cGUgPSBuZXcgU2ZvcmNlLlNvYXBPYmplY3Q7ClNmb3JjZS5EZWxldGVkUmVjb3JkLnByb3RvdHlwZS5pZCA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkRlbGV0ZWRSZWNvcmQucHJvdG90eXBlLmRlbGV0ZWREYXRlID0gbmV3IERhdGUoKTsKClNmb3JjZS5HZXRVcGRhdGVkUmVzdWx0ID0gZnVuY3Rpb24oc29hcCkgewoKCXRoaXMuYmFzZSA9IFNmb3JjZS5Tb2FwT2JqZWN0OwoJdGhpcy5iYXNlKCk7Cgl0aGlzLmNsYXNzTmFtZSA9ICJHZXRVcGRhdGVkUmVzdWx0IjsKCglpZiAoc29hcCkgewoJCXRoaXMuaWRzID0gbmV3IEFycmF5KCk7CgkJU2ZvcmNlLmxvYWRPYmplY3QodGhpcywgc29hcCk7Cgl9Cn0KU2ZvcmNlLkdldFVwZGF0ZWRSZXN1bHQucHJvdG90eXBlID0gbmV3IFNmb3JjZS5Tb2FwT2JqZWN0OwpTZm9yY2UuR2V0VXBkYXRlZFJlc3VsdC5wcm90b3R5cGUuaWRzID0gbmV3IEFycmF5KCk7ClNmb3JjZS5HZXRVcGRhdGVkUmVzdWx0LnByb3RvdHlwZS5zZm9yY2VSZXNlcnZlZCA9IG5ldyBTdHJpbmcoKTsKClNmb3JjZS5HZXRVcGRhdGVkUmVzdWx0LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewoJdmFyIG91dCA9ICIiOwoJaWYgKHRoaXMuaWRzLmxlbmd0aCA+IDApIHsKCQlmb3IgKHZhciBpPTA7aTx0aGlzLmlkcy5sZW5ndGg7aSsrKSB7CgkJCW91dCArPSAoaSArIDEpICsgdGhpcy5pZHNbaV0gKyAiXG4iOwoJCX0KCX0gZWxzZSB7CgkJb3V0ICs9ICJObyB1cGRhdGVkIHJlY29yZHMgZm91bmQuIjsKCX0KCXJldHVybiBvdXQ7Cn07ClNmb3JjZS5HZXRTZXJ2ZXJUaW1lc3RhbXBSZXN1bHQgPSBmdW5jdGlvbihzb2FwKSB7CgoJdGhpcy5iYXNlID0gU2ZvcmNlLlNvYXBPYmplY3Q7Cgl0aGlzLmJhc2UoKTsKCXRoaXMuY2xhc3NOYW1lID0gIkdldFNlcnZlclRpbWVzdGFtcFJlc3VsdCI7CgoJaWYgKHNvYXApIHsKCQlTZm9yY2UubG9hZE9iamVjdCh0aGlzLCBzb2FwKTsKCX0KCXRoaXMudGltZVN0YW1wID0gdGhpcy50aW1lc3RhbXA7Cn0KU2ZvcmNlLkdldFNlcnZlclRpbWVzdGFtcFJlc3VsdC5wcm90b3R5cGUgPSBuZXcgU2ZvcmNlLlNvYXBPYmplY3Q7ClNmb3JjZS5HZXRTZXJ2ZXJUaW1lc3RhbXBSZXN1bHQucHJvdG90eXBlLnRpbWVzdGFtcCA9IG5ldyBEYXRlKCk7CgpTZm9yY2UuUmVzZXRQYXNzd29yZFJlc3VsdCA9IGZ1bmN0aW9uKHNvYXApIHsKCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiUmVzZXRQYXNzd29yZFJlc3VsdCI7CgoJaWYgKHNvYXApIHsKCQlTZm9yY2UubG9hZE9iamVjdCh0aGlzLCBzb2FwKTsKCX0KfQpTZm9yY2UuUmVzZXRQYXNzd29yZFJlc3VsdC5wcm90b3R5cGUgPSBuZXcgU2ZvcmNlLlNvYXBPYmplY3Q7ClNmb3JjZS5SZXNldFBhc3N3b3JkUmVzdWx0LnByb3RvdHlwZS5wYXNzd29yZCA9IG5ldyBTdHJpbmcoKTsKClNmb3JjZS5TZXRQYXNzd29yZFJlc3VsdCA9IGZ1bmN0aW9uKHNvYXApIHsKCXRoaXMuYmFzZSA9IFNmb3JjZS5Tb2FwT2JqZWN0OwoJdGhpcy5iYXNlKCk7Cgl0aGlzLmNsYXNzTmFtZSA9ICJTZXRQYXNzd29yZFJlc3VsdCI7Cn0KU2ZvcmNlLlNldFBhc3N3b3JkUmVzdWx0LnByb3RvdHlwZSA9IG5ldyBTZm9yY2UuU29hcE9iamVjdDsKU2ZvcmNlLlNldFBhc3N3b3JkUmVzdWx0LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewoJcmV0dXJuICJzZXRQYXNzd29yZFJlc3VsdCBoYXMgbm8gcHJvcGVydGllcy4iOwp9OwoKU2ZvcmNlLlNlYXJjaFJlc3VsdCA9IGZ1bmN0aW9uKHNvYXApIHsKCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiU2VhcmNoUmVzdWx0IjsKCglpZiAoc29hcCkgewoJCXRoaXMuc2VhcmNoUmVjb3JkcyA9IG5ldyBBcnJheSgpOwoJCVNmb3JjZS5sb2FkT2JqZWN0KHRoaXMsIHNvYXApOwoJfQp9ClNmb3JjZS5TZWFyY2hSZXN1bHQucHJvdG90eXBlID0gbmV3IFNmb3JjZS5Tb2FwT2JqZWN0OwpTZm9yY2UuU2VhcmNoUmVzdWx0LnByb3RvdHlwZS5zZWFyY2hSZWNvcmRzID0gbmV3IEFycmF5KCk7ClNmb3JjZS5TZWFyY2hSZXN1bHQucHJvdG90eXBlLnNmb3JjZVJlc2VydmVkID0gbmV3IFN0cmluZygpOwoKLyoqIEBjb25zdHJ1Y3RvciAqLwpTZm9yY2UuU2F2ZVJlc3VsdHMgPSBmdW5jdGlvbigpIHsgdmFyIGEgPSBuZXcgQXJyYXkoKTsgYS5jbGFzc05hbWUgPSAiU2F2ZVJlc3VsdHMiOyByZXR1cm4gYTt9OwovKiogQGlnbm9yZSAqLwpTZm9yY2UuU2F2ZVJlc3VsdHMucHJvdG90eXBlLm5vb3AgPSBmdW5jdGlvbigpIHt9OwoKU2ZvcmNlLlNhdmVSZXN1bHQgPSBmdW5jdGlvbihzb2FwKSB7Cgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiU2F2ZVJlc3VsdCI7CgoJaWYgKHNvYXApIHsKCQl0aGlzLmVycm9ycyA9IG5ldyBBcnJheSgpOwoJCVNmb3JjZS5sb2FkT2JqZWN0KHRoaXMsIHNvYXApOwoJfQp9ClNmb3JjZS5TYXZlUmVzdWx0LnByb3RvdHlwZSA9IG5ldyBTZm9yY2UuU29hcE9iamVjdDsKU2ZvcmNlLlNhdmVSZXN1bHQucHJvdG90eXBlLmlkID0gbmV3IFN0cmluZygpOwpTZm9yY2UuU2F2ZVJlc3VsdC5wcm90b3R5cGUuc3VjY2VzcyA9IG5ldyBCb29sZWFuKCk7ClNmb3JjZS5TYXZlUmVzdWx0LnByb3RvdHlwZS5lcnJvcnMgPSBuZXcgQXJyYXkoKTsKCi8qKiBAY29uc3RydWN0b3IgKi8KU2ZvcmNlLkRlbGV0ZVJlc3VsdHMgPSBmdW5jdGlvbigpIHsgdmFyIGEgPSBuZXcgQXJyYXkoKTsgYS5jbGFzc05hbWUgPSAiRGVsZXRlUmVzdWx0cyI7IHJldHVybiBhO307Ci8qKiBAaWdub3JlICovClNmb3JjZS5EZWxldGVSZXN1bHRzLnByb3RvdHlwZS5ub29wID0gZnVuY3Rpb24oKSB7fTsKClNmb3JjZS5EZWxldGVSZXN1bHQgPSBmdW5jdGlvbihzb2FwKSB7Cgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiRGVsZXRlUmVzdWx0IjsKCglpZiAoc29hcCkgewoJCXRoaXMuZXJyb3JzID0gbmV3IEFycmF5KCk7CgkJU2ZvcmNlLmxvYWRPYmplY3QodGhpcywgc29hcCk7Cgl9Cn0KU2ZvcmNlLkRlbGV0ZVJlc3VsdC5wcm90b3R5cGUgPSBuZXcgU2ZvcmNlLlNvYXBPYmplY3Q7ClNmb3JjZS5EZWxldGVSZXN1bHQucHJvdG90eXBlLmlkID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRGVsZXRlUmVzdWx0LnByb3RvdHlwZS5zdWNjZXNzID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLkRlbGV0ZVJlc3VsdC5wcm90b3R5cGUuZXJyb3JzID0gbmV3IEFycmF5KCk7CgovKiogQGNvbnN0cnVjdG9yICovClNmb3JjZS5VcHNlcnRSZXN1bHRzID0gZnVuY3Rpb24oKSB7IHZhciBhID0gbmV3IEFycmF5KCk7IGEuY2xhc3NOYW1lID0gIlVwc2VydFJlc3VsdHMiOyByZXR1cm4gYTt9OwovKiogQGlnbm9yZSAqLwpTZm9yY2UuVXBzZXJ0UmVzdWx0cy5wcm90b3R5cGUubm9vcCA9IGZ1bmN0aW9uKCkge307CgpTZm9yY2UuVXBzZXJ0UmVzdWx0ID0gZnVuY3Rpb24oc29hcCkgewoJdGhpcy5iYXNlID0gU2ZvcmNlLlNvYXBPYmplY3Q7Cgl0aGlzLmJhc2UoKTsKCXRoaXMuY2xhc3NOYW1lID0gIlVwc2VydFJlc3VsdCI7CgkKCWlmIChzb2FwKSB7CgkJdGhpcy5lcnJvcnMgPSBuZXcgQXJyYXkoKTsKCQlTZm9yY2UubG9hZE9iamVjdCh0aGlzLCBzb2FwKTsKCX0KfQpTZm9yY2UuVXBzZXJ0UmVzdWx0LnByb3RvdHlwZSA9IG5ldyBTZm9yY2UuU29hcE9iamVjdDsKU2ZvcmNlLlVwc2VydFJlc3VsdC5wcm90b3R5cGUuY3JlYXRlZCA9IG5ldyBCb29sZWFuKCk7ClNmb3JjZS5VcHNlcnRSZXN1bHQucHJvdG90eXBlLmlkID0gbmV3IFN0cmluZygpOwpTZm9yY2UuVXBzZXJ0UmVzdWx0LnByb3RvdHlwZS5zdWNjZXNzID0gbmV3IEJvb2xlYW4oKTsKClNmb3JjZS5FcnJvciA9IGZ1bmN0aW9uKHNvYXApIHsKCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiRXJyb3JzIjsKCglpZiAoc29hcCkgewoJCXRoaXMuZmllbGRzID0gbmV3IEFycmF5KCk7CgkJU2ZvcmNlLmxvYWRPYmplY3QodGhpcywgc29hcCk7Cgl9Cn0KU2ZvcmNlLkVycm9yLnByb3RvdHlwZSA9IG5ldyBTZm9yY2UuU29hcE9iamVjdDsKU2ZvcmNlLkVycm9yLnByb3RvdHlwZS5maWVsZHMgPSBuZXcgQXJyYXkoKTsKU2ZvcmNlLkVycm9yLnByb3RvdHlwZS5tZXNzYWdlID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRXJyb3IucHJvdG90eXBlLnN0YXR1c0NvZGUgPSBuZXcgU3RyaW5nKCk7CgpTZm9yY2UuRGVzY3JpYmVTT2JqZWN0UmVzdWx0ID0gZnVuY3Rpb24oc29hcCkgewoJdGhpcy5iYXNlID0gU2ZvcmNlLlNvYXBPYmplY3Q7Cgl0aGlzLmJhc2UoKTsKCXRoaXMuY2xhc3NOYW1lID0gIkRlc2NyaWJlU09iamVjdFJlc3VsdCI7CgkKCWNyZWF0ZUNoaWxkUmVsYXRpb25zaGlwcyA9IGZ1bmN0aW9uKG5vZGUpIHsKCQlpZiAobm9kZS5sZW5ndGggPT0gMCkgewoJCQlyZXR1cm4gbmV3IFNmb3JjZS5IYXNodGFibGUoKTsKCQl9IGVsc2UgewoJCQl2YXIgcmV0ID0gbmV3IFNmb3JjZS5IYXNodGFibGUoKTsKCQkJZm9yICh2YXIgaT0wO2k8bm9kZS5sZW5ndGg7aSsrKSB7CgkJCQl2YXIgY3IgPSBuZXcgU2ZvcmNlLkNoaWxkUmVsYXRpb25zaGlwKCk7CgkJCQljci5jYXNjYWRlRGVsZXRlID0gU2ZvcmNlLkRPTS5HZXRCb29sKFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChub2RlW2ldLCAiY2FzY2FkZURlbGV0ZSIpKTsKCQkJCWNyLmNoaWxkU09iamVjdCA9IFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChub2RlW2ldLCAiY2hpbGRTT2JqZWN0Iik7CgkJCQljci5maWVsZCA9IFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChub2RlW2ldLCAiZmllbGQiKTsKCQkJCWNyLnJlbGF0aW9uc2hpcE5hbWUgPSBTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZSAobm9kZVtpXSwgInJlbGF0aW9uc2hpcE5hbWUiKTsKCQkJCWlmIChjci5yZWxhdGlvbnNoaXBOYW1lID09IG51bGwpIHsKCQkJCQlyZXQuYWRkSXRlbShjci5jaGlsZFNPYmplY3QsIGNyKTsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0LmFkZEl0ZW0oY3IucmVsYXRpb25zaGlwTmFtZSwgY3IpOwoJCQkJfQoJCQl9CgkJCXJldHVybiByZXQ7CgkJfQoJfTsKCWNyZWF0ZVBpY2tsaXN0VmFsdWVzID0gZnVuY3Rpb24obm9kZSkge2lmIChub2RlLmxlbmd0aCA9PSAwKSB7cmV0dXJuIG5ldyBBcnJheSgpO30gZWxzZSB7dmFyIHJldCA9IG5ldyBBcnJheSgpO2ZvciAodmFyIGk9MDtpPG5vZGUubGVuZ3RoO2krKykge3ZhciBwaWNrbGlzdEVudHJ5ID0gbmV3IFNmb3JjZS5QaWNrbGlzdEVudHJ5KCk7cGlja2xpc3RFbnRyeS5hY3RpdmUgPSBTZm9yY2UuRE9NLkdldEJvb2woU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKG5vZGVbaV0sICJhY3RpdmUiKSk7cGlja2xpc3RFbnRyeS5kZWZhdWx0VmFsdWUgPSBTZm9yY2UuRE9NLkdldEJvb2woU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKG5vZGVbaV0sICJkZWZhdWx0VmFsdWUiKSk7cGlja2xpc3RFbnRyeS5sYWJlbCA9IFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChub2RlW2ldLCAibGFiZWwiKTtwaWNrbGlzdEVudHJ5LnZhbHVlID0gU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKG5vZGVbaV0sICJ2YWx1ZSIpO3JldFtpXSA9IHBpY2tsaXN0RW50cnk7fXJldHVybiByZXQ7fX07CgljcmVhdGVGaWVsZHMgPSBmdW5jdGlvbihub2RlLCBfdGhpcykgewoJCWlmIChub2RlWzBdLmdldEF0dHJpYnV0ZSgieHNpOm5pbCIpID09ICJ0cnVlIikgewoJCQlyZXR1cm4gbmV3IEFycmF5KCk7CgkJfSBlbHNlIHsKCQkJdmFyIHJldCA9IG5ldyBBcnJheSgpOwoJCQlmb3IgKHZhciBpPTA7aTxub2RlLmxlbmd0aDtpKyspIHsKCQkJCXZhciBmaWVsZCA9IG5ldyBTZm9yY2UuRmllbGQoKTsKCQkJCWZpZWxkLnR5cGUgPSBTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZSAobm9kZVtpXSwgInR5cGUiKTsKCQkJCWZpZWxkLmF1dG9OdW1iZXIgPSBTZm9yY2UuRE9NLkdldEJvb2woU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKG5vZGVbaV0sICJhdXRvTnVtYmVyIikpOwoJCQkJZmllbGQuYnl0ZUxlbmd0aCA9IHBhcnNlSW50KFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChub2RlW2ldLCAiYnl0ZUxlbmd0aCIpKTsKCQkJCWZpZWxkLmNhbGN1bGF0ZWQgPSBTZm9yY2UuRE9NLkdldEJvb2woU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKG5vZGVbaV0sICJjYWxjdWxhdGVkIikpOwoJCQkJZmllbGQuY29udHJvbGxlck5hbWUgPSBTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZShub2RlW2ldLCAiY29udHJvbGxlck5hbWUiKTsKCQkJCWZpZWxkLmNyZWF0ZWFibGUgPSBTZm9yY2UuRE9NLkdldEJvb2woU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKG5vZGVbaV0sICJjcmVhdGVhYmxlIikpOwoJCQkJZmllbGQuY3VzdG9tID0gU2ZvcmNlLkRPTS5HZXRCb29sKFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChub2RlW2ldLCAiY3VzdG9tIikpOwoJCQkJZmllbGQuZGVmYXVsdGVkT25DcmVhdGUgPSBTZm9yY2UuRE9NLkdldEJvb2woU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKG5vZGVbaV0sICJkZWZhdWx0ZWRPbkNyZWF0ZSIpKTsKCQkJCWZpZWxkLmRlcGVuZGVudFBpY2tsaXN0ID0gU2ZvcmNlLkRPTS5HZXRCb29sKFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlKG5vZGVbaV0sICJkZXBlbmRlbnRQaWNrbGlzdCIpKTsKCQkJCWZpZWxkLmRpZ2l0cyA9IHBhcnNlSW50KFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChub2RlW2ldLCAiZGlnaXRzIikpOwoJCQkJZmllbGQuZXh0ZXJuYWxJZCA9IFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlKG5vZGVbaV0sICJleHRlcm5hbElkIik7CgkJCQlmaWVsZC5maWx0ZXJhYmxlID0gU2ZvcmNlLkRPTS5HZXRCb29sKFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChub2RlW2ldLCAiZmlsdGVyYWJsZSIpKTsKCQkJCWZpZWxkLmh0bWxGb3JtYXR0ZWQgPSBTZm9yY2UuRE9NLkdldEJvb2woU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUobm9kZVtpXSwgImh0bWxGb3JtYXR0ZWQiKSk7CgkJCQlmaWVsZC5sYWJlbCA9IFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChub2RlW2ldLCAibGFiZWwiKTsKCQkJCWZpZWxkLmxlbmd0aCA9IHBhcnNlSW50KFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChub2RlW2ldLCAibGVuZ3RoIikpOwoJCQkJZmllbGQubmFtZSA9IFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChub2RlW2ldLCAibmFtZSIpOwoJCQkJZmllbGQubmFtZUZpZWxkID0gU2ZvcmNlLkRPTS5HZXRCb29sKFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChub2RlW2ldLCAibmFtZUZpZWxkIikpOwoJCQkJZmllbGQubmlsbGFibGUgPSBTZm9yY2UuRE9NLkdldEJvb2woU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKG5vZGVbaV0sICJuaWxsYWJsZSIpKTsKCQkJCWlmIChmaWVsZC50eXBlID09ICJwaWNrbGlzdCIgfHwgZmllbGQudHlwZSA9PSAibXVsdGlwaWNrbGlzdCIgfHwgZmllbGQudHlwZSA9PSAiY29tYm9ib3giICkgewoJCQkJCWZpZWxkLnBpY2tsaXN0VmFsdWVzID0gY3JlYXRlUGlja2xpc3RWYWx1ZXMobm9kZVtpXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgicGlja2xpc3RWYWx1ZXMiKSk7CgkJCQl9CgkJCQlmaWVsZC5wcmVjaXNpb24gPSBwYXJzZUludChTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZSAobm9kZVtpXSwgInByZWNpc2lvbiIpKTsKCQkJCWlmIChmaWVsZC50eXBlID09ICJyZWZlcmVuY2UiKSB7CgkJCQkJdmFyIHJlbGF0aW9uc2hpcE5hbWUgPSBTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZSAobm9kZVtpXSwgInJlbGF0aW9uc2hpcE5hbWUiKTsKCQkJCQlpZiAocmVsYXRpb25zaGlwTmFtZSAhPSBudWxsKSB7CgkJCQkJCWZpZWxkLnJlbGF0aW9uc2hpcE5hbWUgPSByZWxhdGlvbnNoaXBOYW1lOwoJCQkJCQlfdGhpcy5wYXJlbnRSZWxhdGlvbnNoaXBzLmFkZEl0ZW0oZmllbGQucmVsYXRpb25zaGlwTmFtZSwgZmllbGQpOwoJCQkJCX0KCQkJCQl2YXIgcmVmcyA9IG5vZGVbaV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoInJlZmVyZW5jZVRvIik7CgkJCQkJaWYgKHJlZnMubGVuZ3RoID09IDApIHsKCQkJCQkJZmllbGQucmVmZXJlbmNlVG8gPSBuZXcgQXJyYXkoKTsKCQkJCQl9IGVsc2UgaWYgKHJlZnNbMF0uZ2V0QXR0cmlidXRlKCJ4c2k6bmlsIikgPT0gInRydWUiKSB7CgkJCQkJCWZpZWxkLnJlZmVyZW5jZVRvID0gbmV3IEFycmF5KCk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJdmFyIHJlZnNfZiA9IG5ldyBBcnJheSgpOwoJCQkJCQlmb3IgKHZhciBqPTA7ajxyZWZzLmxlbmd0aDtqKyspIHsKCQkJCQkJCXJlZnNfZltqXSA9IFNmb3JjZS5ET00uR2V0Tm9kZVZhbHVlKHJlZnNbal0pOwoJCQkJCQl9CgkJCQkJCWZpZWxkLnJlZmVyZW5jZVRvID0gcmVmc19mOwoJCQkJCX0KCQkJCX0KCQkJCWZpZWxkLnJlc3RyaWN0ZWRQaWNrbGlzdCA9IFNmb3JjZS5ET00uR2V0Qm9vbChTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZSAobm9kZVtpXSwgInJlc3RyaWN0ZWRQaWNrbGlzdCIpKTsKCQkJCWZpZWxkLnNjYWxlID0gcGFyc2VJbnQoU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKG5vZGVbaV0sICJzY2FsZSIpKTsKCQkJCWZpZWxkLnNvYXBUeXBlID0gU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKG5vZGVbaV0sICJzb2FwVHlwZSIpOwoJCQkJZmllbGQudXBkYXRlYWJsZSA9IFNmb3JjZS5ET00uR2V0Qm9vbChTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZSAobm9kZVtpXSwgInVwZGF0ZWFibGUiKSk7CgkJCQlyZXRbaV0gPSBmaWVsZDsKCQkJCV90aGlzLmZpZWxkTWFwLmFkZEl0ZW0oZmllbGQubmFtZS50b0xvd2VyQ2FzZSgpLCBmaWVsZCk7CgkJCQlpZiAoX3RoaXMuZmllbGRMaXN0Lmxlbmd0aCA+IDApIHsKCQkJCQlfdGhpcy5maWVsZExpc3QgKz0gIiwgIjsKCQkJCX0KCQkJCV90aGlzLmZpZWxkTGlzdCArPSBmaWVsZC5uYW1lOwoJCQl9CgkJCXJldHVybiByZXQ7CgkJfQoJfTsKCWNvdW50ZXIgPSAxOwoKCglpZiAoc29hcCl7CgkJdGhpcy5hY3RpdmF0ZWFibGUgPSBTZm9yY2UuRE9NLkdldEJvb2woU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKHNvYXAsICJhY3RpdmF0ZWFibGUiKSk7CgkJdGhpcy5jaGlsZFJlbGF0aW9uc2hpcHMgPSBjcmVhdGVDaGlsZFJlbGF0aW9uc2hpcHMoc29hcC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiY2hpbGRSZWxhdGlvbnNoaXBzIikpOwoJCXRoaXMuY3JlYXRlYWJsZSA9IFNmb3JjZS5ET00uR2V0Qm9vbChTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZSAoc29hcCwgImNyZWF0YWJsZSIpKTsKCQl0aGlzLmN1c3RvbSA9IFNmb3JjZS5ET00uR2V0Qm9vbChTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZSAoc29hcCwgImN1c3RvbSIpKTsKCQl0aGlzLmRlbGV0YWJsZSA9IFNmb3JjZS5ET00uR2V0Qm9vbChTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZSAoc29hcCwgImRlbGV0ZWFibGUiKSk7CgkJdGhpcy5maWVsZE1hcCA9IG5ldyBTZm9yY2UuSGFzaHRhYmxlKCk7CgkJdGhpcy5wYXJlbnRSZWxhdGlvbnNoaXBzID0gbmV3IFNmb3JjZS5IYXNodGFibGUoKTsKCQl0aGlzLmZpZWxkTGlzdCA9ICIiOwoJCXRoaXMuZmllbGRzID0gY3JlYXRlRmllbGRzKHNvYXAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImZpZWxkcyIpLCB0aGlzKTsKCQl0aGlzLmtleVByZWZpeCA9IFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChzb2FwLCAia2V5UHJlZml4Iik7CgkJdGhpcy5sYWJlbCA9IFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChzb2FwLCAibGFiZWwiKTsKCQl0aGlzLmxhYmVsUGx1cmFsID0gU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKHNvYXAsICJsYWJlbFBsdXJhbCIpOwoJCXRoaXMubGF5b3V0YWJsZSA9IFNmb3JjZS5ET00uR2V0Qm9vbChTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZSAoc29hcCwgImxheW91dGFibGUiKSk7CgkJdGhpcy5uYW1lID0gU2ZvcmNlLkRPTS5HZXROb2RlVmFsdWUoU2ZvcmNlLkRPTS5HZXRJbW1lZGlhdGVDaGlsZEVsZW1lbnRCeU5hbWUoc29hcCwgIm5hbWUiKSk7CgkJdGhpcy5xdWVyeWFibGUgPSBTZm9yY2UuRE9NLkdldEJvb2woU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKHNvYXAsICJxdWVyeWFibGUiKSk7CgkJdGhpcy5yZXBsaWNhdGVhYmxlID0gU2ZvcmNlLkRPTS5HZXRCb29sKFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChzb2FwLCAicmVwbGljYXRlYWJsZSIpKTsKCQl0aGlzLnJldHJpZXZlYWJsZSA9IFNmb3JjZS5ET00uR2V0Qm9vbChTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZSAoc29hcCwgInJldHJpZXZlYWJsZSIpKTsKCQl0aGlzLnNlYXJjaGFibGUgPSBTZm9yY2UuRE9NLkdldEJvb2woU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKHNvYXAsICJzZWFyY2hhYmxlIikpOwoJCXRoaXMudW5kZWxldGFibGUgPSBTZm9yY2UuRE9NLkdldEJvb2woU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKHNvYXAsICJ1bmRlbGV0ZWFibGUiKSk7CgkJdGhpcy51cGRhdGVhYmxlID0gU2ZvcmNlLkRPTS5HZXRCb29sKFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChzb2FwLCAidXBkYXRlYWJsZSIpKTsKCQl0aGlzLnVybERldGFpbCA9IFNmb3JjZS5ET00uR2V0RWxlbWVudFZhbHVlIChzb2FwLCAidXJsRGV0YWlsIik7CgkJdGhpcy51cmxFZGl0ID0gU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKHNvYXAsICJ1cmxFZGl0Iik7CgkJdGhpcy51cmxOZXcgPSBTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZSAoc29hcCwgInVybE5ldyIpOwoJfQp9ClNmb3JjZS5EZXNjcmliZVNPYmplY3RSZXN1bHQucHJvdG90eXBlID0gbmV3IFNmb3JjZS5Tb2FwT2JqZWN0OwpTZm9yY2UuRGVzY3JpYmVTT2JqZWN0UmVzdWx0LnByb3RvdHlwZS5hY3RpdmF0ZWFibGUgPSBuZXcgQm9vbGVhbigpOwpTZm9yY2UuRGVzY3JpYmVTT2JqZWN0UmVzdWx0LnByb3RvdHlwZS5jaGlsZFJlbGF0aW9uc2hpcHMgPSBuZXcgU2ZvcmNlLkhhc2h0YWJsZSgpOwpTZm9yY2UuRGVzY3JpYmVTT2JqZWN0UmVzdWx0LnByb3RvdHlwZS5jcmVhdGVhYmxlID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLkRlc2NyaWJlU09iamVjdFJlc3VsdC5wcm90b3R5cGUuY3VzdG9tID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLkRlc2NyaWJlU09iamVjdFJlc3VsdC5wcm90b3R5cGUuZGVsZXRhYmxlID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLkRlc2NyaWJlU09iamVjdFJlc3VsdC5wcm90b3R5cGUuZmllbGRNYXAgPSBuZXcgU2ZvcmNlLkhhc2h0YWJsZSgpOwpTZm9yY2UuRGVzY3JpYmVTT2JqZWN0UmVzdWx0LnByb3RvdHlwZS5wYXJlbnRSZWxhdGlvbnNoaXBzID0gbmV3IFNmb3JjZS5IYXNodGFibGUoKTsKU2ZvcmNlLkRlc2NyaWJlU09iamVjdFJlc3VsdC5wcm90b3R5cGUuZmllbGRMaXN0ID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRGVzY3JpYmVTT2JqZWN0UmVzdWx0LnByb3RvdHlwZS5maWVsZHMgPSBuZXcgQXJyYXkoKTsKU2ZvcmNlLkRlc2NyaWJlU09iamVjdFJlc3VsdC5wcm90b3R5cGUua2V5UHJlZml4ID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRGVzY3JpYmVTT2JqZWN0UmVzdWx0LnByb3RvdHlwZS5sYWJlbCA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkRlc2NyaWJlU09iamVjdFJlc3VsdC5wcm90b3R5cGUubGFiZWxQbHVyYWwgPSBuZXcgU3RyaW5nKCk7ClNmb3JjZS5EZXNjcmliZVNPYmplY3RSZXN1bHQucHJvdG90eXBlLmxheW91dGFibGUgPSBuZXcgQm9vbGVhbigpOwpTZm9yY2UuRGVzY3JpYmVTT2JqZWN0UmVzdWx0LnByb3RvdHlwZS5uYW1lID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRGVzY3JpYmVTT2JqZWN0UmVzdWx0LnByb3RvdHlwZS5xdWVyeWFibGUgPSBuZXcgQm9vbGVhbigpOwpTZm9yY2UuRGVzY3JpYmVTT2JqZWN0UmVzdWx0LnByb3RvdHlwZS5yZXBsaWNhdGVhYmxlID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLkRlc2NyaWJlU09iamVjdFJlc3VsdC5wcm90b3R5cGUucmV0cmlldmVhYmxlID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLkRlc2NyaWJlU09iamVjdFJlc3VsdC5wcm90b3R5cGUuc2VhcmNoYWJsZSA9IG5ldyBCb29sZWFuKCk7ClNmb3JjZS5EZXNjcmliZVNPYmplY3RSZXN1bHQucHJvdG90eXBlLnVuZGVsZXRhYmxlID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLkRlc2NyaWJlU09iamVjdFJlc3VsdC5wcm90b3R5cGUudXBkYXRlYWJsZSA9IG5ldyBCb29sZWFuKCk7ClNmb3JjZS5EZXNjcmliZVNPYmplY3RSZXN1bHQucHJvdG90eXBlLnVybERldGFpbCA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkRlc2NyaWJlU09iamVjdFJlc3VsdC5wcm90b3R5cGUudXJsRWRpdCA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkRlc2NyaWJlU09iamVjdFJlc3VsdC5wcm90b3R5cGUudXJsTmV3ID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRGVzY3JpYmVTT2JqZWN0UmVzdWx0LnByb3RvdHlwZS5jb250YWlucyA9IGZ1bmN0aW9uKGZpZWxkTmFtZSkgeyByZXR1cm4gdGhpcy5maWVsZE1hcC5jb250YWluc0l0ZW0oZmllbGROYW1lKTsgfTsKU2ZvcmNlLkRlc2NyaWJlU09iamVjdFJlc3VsdC5wcm90b3R5cGUuZ2V0TmFtZUZpZWxkID0gZnVuY3Rpb24oKSB7Cgl2YXIgb3V0ID0gIklkIjsKCWZvciAoa2V5IGluIHRoaXMuZmllbGRNYXAuZ2V0S2V5cygpKSB7CgkJaWYgKHRoaXMuZmllbGRNYXAuZ2V0SXRlbShrZXkpLm5hbWVGaWVsZCA9PSB0cnVlKSB7CgkJCWlmIChvdXQgPT0gIklkIikgewoJCQkJb3V0ID0gdGhpcy5maWVsZE1hcC5nZXRJdGVtKGtleSkubmFtZTsKCQkJfSBlbHNlIHsKCQkJCW91dCArPSAiLCIgKyB0aGlzLmZpZWxkTWFwLmdldEl0ZW0oa2V5KS5uYW1lOwoJCQl9CgkJfQoJfQoJCglyZXR1cm4gb3V0Owp9OwpTZm9yY2UuRGVzY3JpYmVTT2JqZWN0UmVzdWx0LnByb3RvdHlwZS5nZXRGaWVsZHNBc1NlbGVjdExpc3QgPSBmdW5jdGlvbigpIHsKCXZhciBvdXRwdXQgPSAiIjsKCWZvciAoa2V5IGluIHRoaXMuZmllbGRNYXAuZ2V0S2V5cygpKSB7CgkJb3V0cHV0ICs9IGtleSArICIsIjsKCX0KCXJldHVybiBvdXRwdXQuc3Vic3RyaW5nKG91dHB1dC5sZW5ndGggLSAxKTsKfQp2YXIgaW5kID0gMDsKClNmb3JjZS5DaGlsZFJlbGF0aW9uc2hpcCA9IGZ1bmN0aW9uKHNvYXApIHsKCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiQ2hpbGRSZWxhdGlvbnNoaXAiOwoKCWlmIChzb2FwKSB7CgkJU2ZvcmNlLmxvYWRPYmplY3QodGhpcywgc29hcCk7Cgl9Cn0KU2ZvcmNlLkNoaWxkUmVsYXRpb25zaGlwLnByb3RvdHlwZSA9IG5ldyBTZm9yY2UuU29hcE9iamVjdDsKU2ZvcmNlLkNoaWxkUmVsYXRpb25zaGlwLnByb3RvdHlwZS5jYXNjYWRlRGVsZXRlID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLkNoaWxkUmVsYXRpb25zaGlwLnByb3RvdHlwZS5jaGlsZFNPYmplY3QgPSBuZXcgU3RyaW5nKCk7ClNmb3JjZS5DaGlsZFJlbGF0aW9uc2hpcC5wcm90b3R5cGUuZmllbGQgPSBuZXcgU3RyaW5nKCk7ClNmb3JjZS5DaGlsZFJlbGF0aW9uc2hpcC5wcm90b3R5cGUucmVsYXRpb25zaGlwTmFtZSA9IG5ldyBTdHJpbmcoKTsKClNmb3JjZS5GaWVsZCA9IGZ1bmN0aW9uKHNvYXApIHsKCgl0aGlzLmJhc2UgPSBTZm9yY2UuU29hcE9iamVjdDsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiRmllbGQiOwoKCWlmIChzb2FwKSB7CQoJCXRoaXMucGlja2xpc3RWYWx1ZXMgPSBuZXcgQXJyYXkoKTsKCQl0aGlzLnJlZmVyZW5jZVRvID0gbmV3IEFycmF5KCk7ICAvL3N0cmluZ3MKCQlTZm9yY2UubG9hZE9iamVjdCh0aGlzLCBzb2FwKTsKCX0KCWNvdW50ZXIgPSAxOwoKfQpTZm9yY2UuRmllbGQucHJvdG90eXBlID0gbmV3IFNmb3JjZS5Tb2FwT2JqZWN0OwpTZm9yY2UuRmllbGQucHJvdG90eXBlLmF1dG9OdW1iZXIgPSBuZXcgQm9vbGVhbigpOwpTZm9yY2UuRmllbGQucHJvdG90eXBlLmJ5dGVMZW5ndGggPSAwOwpTZm9yY2UuRmllbGQucHJvdG90eXBlLmNhbGN1bGF0ZWQgPSBuZXcgQm9vbGVhbigpOwpTZm9yY2UuRmllbGQucHJvdG90eXBlLmNvbnRyb2xsZXJOYW1lID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRmllbGQucHJvdG90eXBlLmNyZWF0ZWFibGUgPSBuZXcgQm9vbGVhbigpOwpTZm9yY2UuRmllbGQucHJvdG90eXBlLmN1c3RvbSA9IG5ldyBCb29sZWFuKCk7ClNmb3JjZS5GaWVsZC5wcm90b3R5cGUuZGVmYXVsdGVkT25DcmVhdGUgPSBuZXcgQm9vbGVhbigpOwpTZm9yY2UuRmllbGQucHJvdG90eXBlLmRlcGVuZGVudFBpY2tsaXN0ID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLkZpZWxkLnByb3RvdHlwZS5kaWdpdHMgPSAwOwpTZm9yY2UuRmllbGQucHJvdG90eXBlLmV4dGVybmFsSWQgPSBuZXcgU3RyaW5nKCk7ClNmb3JjZS5GaWVsZC5wcm90b3R5cGUuZmlsdGVyYWJsZSA9IG5ldyBCb29sZWFuKCk7ClNmb3JjZS5GaWVsZC5wcm90b3R5cGUuaHRtbEZvcm1hdHRlZCA9IG5ldyBCb29sZWFuKCk7ClNmb3JjZS5GaWVsZC5wcm90b3R5cGUubGFiZWwgPSBuZXcgU3RyaW5nKCk7ClNmb3JjZS5GaWVsZC5wcm90b3R5cGUubGVuZ3RoID0gMDsKU2ZvcmNlLkZpZWxkLnByb3RvdHlwZS5uYW1lID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRmllbGQucHJvdG90eXBlLm5hbWVGaWVsZCA9IG5ldyBCb29sZWFuKCk7ClNmb3JjZS5GaWVsZC5wcm90b3R5cGUubmlsbGFibGUgPSBuZXcgQm9vbGVhbigpOwpTZm9yY2UuRmllbGQucHJvdG90eXBlLnBpY2tsaXN0VmFsdWVzID0gbmV3IEFycmF5KCk7ClNmb3JjZS5GaWVsZC5wcm90b3R5cGUucHJlY2lzaW9uID0gMDsKU2ZvcmNlLkZpZWxkLnByb3RvdHlwZS5yZWZlcmVuY2VUbyA9IG5ldyBBcnJheSgpOyAgLy9zdHJpbmdzClNmb3JjZS5GaWVsZC5wcm90b3R5cGUucmVsYXRpb25zaGlwTmFtZSA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkZpZWxkLnByb3RvdHlwZS5yZXN0cmljdGVkUGlja2xpc3QgPSBuZXcgQm9vbGVhbigpOwpTZm9yY2UuRmllbGQucHJvdG90eXBlLnNjYWxlID0gMDsKU2ZvcmNlLkZpZWxkLnByb3RvdHlwZS5zb2FwVHlwZSA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLkZpZWxkLnByb3RvdHlwZS50eXBlID0gbmV3IFN0cmluZygpOwpTZm9yY2UuRmllbGQucHJvdG90eXBlLnVwZGF0ZWFibGUgPSBuZXcgQm9vbGVhbigpOwoKU2ZvcmNlLlBpY2tsaXN0RW50cnkgPSBmdW5jdGlvbihzb2FwKSB7CgoJdGhpcy5iYXNlID0gU2ZvcmNlLlNvYXBPYmplY3Q7Cgl0aGlzLmJhc2UoKTsKCXRoaXMuY2xhc3NOYW1lID0gIlBpY2tsaXN0RW50cnkiOwoKCWlmIChzb2FwKSB7CgkJU2ZvcmNlLmxvYWRPYmplY3QodGhpcywgc29hcCk7Cgl9Cn0KU2ZvcmNlLlBpY2tsaXN0RW50cnkucHJvdG90eXBlID0gbmV3IFNmb3JjZS5Tb2FwT2JqZWN0OwpTZm9yY2UuUGlja2xpc3RFbnRyeS5wcm90b3R5cGUuYWN0aXZlID0gbmV3IEJvb2xlYW4oKTsKU2ZvcmNlLlBpY2tsaXN0RW50cnkucHJvdG90eXBlLmRlZmF1bHRWYWx1ZSA9IG5ldyBCb29sZWFuKCk7ClNmb3JjZS5QaWNrbGlzdEVudHJ5LnByb3RvdHlwZS5sYWJlbCA9IG5ldyBTdHJpbmcoKTsKU2ZvcmNlLlBpY2tsaXN0RW50cnkucHJvdG90eXBlLnZhbGlkRm9yID0gbmV3IEFycmF5KCk7ClNmb3JjZS5QaWNrbGlzdEVudHJ5LnByb3RvdHlwZS52YWx1ZSA9IG5ldyBTdHJpbmcoKTsKCi8qKiBAaWdub3JlICovClNmb3JjZS5nZXRSZXNwb25zZU5vZGUgPSBmdW5jdGlvbihyZXNwb25zZSkgewoJaWYgKHNmb3JjZUNsaWVudC5hcHBUeXBlICE9IFNmb3JjZS5BcHBsaWNhdGlvbi5UeXBlLkludGVybmV0RXhwbG9yZXIpIHsKCQl2YXIgYk5vZGUgPSByZXNwb25zZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiQm9keSIpWzBdOwoJCWZvciAoaT0wO2k8Yk5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7aSsrKSB7CgkJCWlmIChiTm9kZS5jaGlsZE5vZGVzW2ldLm5vZGVUeXBlID09IDEpIHsKCQkJCXJldHVybiBiTm9kZS5jaGlsZE5vZGVzW2ldOwoJCQl9CgkJfQoJfSBlbHNlIHsKCQlyZXR1cm4gcmVzcG9uc2UuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNvYXBlbnY6Qm9keSIpWzBdLmNoaWxkTm9kZXNbMF07Cgl9Cn0KCi8qKiBAaWdub3JlICovClNmb3JjZS5nZXRSZXNwb25zZU5hbWUgPSBmdW5jdGlvbihyZXNwb25zZU5vZGUpIHsKCWlmIChzZm9yY2VDbGllbnQuYXBwVHlwZSAhPSBTZm9yY2UuQXBwbGljYXRpb24uVHlwZS5JbnRlcm5ldEV4cGxvcmVyKSB7CgkJcmV0dXJuIHJlc3BvbnNlTm9kZS5sb2NhbE5hbWU7Cgl9IGVsc2UgewoJCXJldHVybiByZXNwb25zZU5vZGUuYmFzZU5hbWU7Cgl9Cn0KCi8qKiBAaWdub3JlICovClNmb3JjZS5jcmVhdGVTZm9yY2VPYmplY3QgPSBmdW5jdGlvbihyZXNwb25zZSkgewoKCVNmb3JjZS5VdGlsLnRpbWVfb2JqZWN0LlN0YXJ0VGltaW5nKCk7CgoJdmFyIHJlc3BvbnNlRE9NID0gcmVzcG9uc2UucmVzcG9uc2VYTUw7Cgl2YXIgcmV0dXJudlZhbHVlID0gbnVsbDsKCWlmICgocmVzcG9uc2VET00uZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNvYXBlbnY6RmF1bHQiKS5sZW5ndGggPiAwKSB8fCAocmVzcG9uc2VET00uZ2V0RWxlbWVudHNCeVRhZ05hbWUoIkZhdWx0IikubGVuZ3RoID4gMCkpIHsKCS8qPD94bWwgdmVyc2lvbj1cIjEuMFwiPz4KPHNvYXBlbnY6RW52ZWxvcGUgeG1sbnM6c29hcGVudj1cImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3NvYXAvZW52ZWxvcGUvXCIgeG1sbnM6eHNkPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWFcIiB4bWxuczp4c2k9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAxL1hNTFNjaGVtYS1pbnN0YW5jZVwiPgoJPHNvYXBlbnY6Qm9keT4KCQk8c29hcGVudjpGYXVsdD4KCQkJPGZhdWx0Y29kZSB4bWxuczpuczE9XCJ1cm46ZmF1bHQucGFydG5lci5zb2FwLnNmb3JjZS5jb21cIj5uczE6SU5WQUxJRF9MT0dJTjwvZmF1bHRjb2RlPgoJCQk8ZmF1bHRzdHJpbmc+SU5WQUxJRF9MT0dJTjogSW52YWxpZCB1c2VybmFtZSBvciBwYXNzd29yZCBvciBsb2NrZWQgb3V0LjwvZmF1bHRzdHJpbmc+CgkJCTxkZXRhaWw+CgkJCQk8c2Y6ZmF1bHQgeHNpOnR5cGU9XCJzZjpMb2dpbkZhdWx0XCIgeG1sbnM6c2Y9XCJ1cm46ZmF1bHQucGFydG5lci5zb2FwLnNmb3JjZS5jb21cIj4KCQkJCQk8c2Y6ZXhjZXB0aW9uQ29kZT5JTlZBTElEX0xPR0lOPC9zZjpleGNlcHRpb25Db2RlPgoJCQkJCTxzZjpleGNlcHRpb25NZXNzYWdlPkludmFsaWQgdXNlcm5hbWUgb3IgcGFzc3dvcmQgb3IgbG9ja2VkIG91dC48L3NmOmV4Y2VwdGlvbk1lc3NhZ2U+CgkJCQk8L3NmOmZhdWx0PgoJCQk8L2RldGFpbD4KCQk8L3NvYXBlbnY6RmF1bHQ+Cgk8L3NvYXBlbnY6Qm9keT4KPC9zb2FwZW52OkVudmVsb3BlPiovCgkJdmFyIHJlc3BvbnNlTm9kZSA9IFNmb3JjZS5nZXRSZXNwb25zZU5vZGUocmVzcG9uc2VET00pOwoJCQoJCXJldHVyblZhbHVlID0gbmV3IFNmb3JjZS5GYXVsdChyZXNwb25zZU5vZGUpOwoJfSBlbHNlIHsKCQl2YXIgcmVzcG9uc2VOb2RlID0gU2ZvcmNlLmdldFJlc3BvbnNlTm9kZShyZXNwb25zZURPTSk7CgoJCXZhciByZXN1bHRzID0gcmVzcG9uc2VOb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJyZXN1bHQiKTsKCQl2YXIgbmFtZSA9IFNmb3JjZS5nZXRSZXNwb25zZU5hbWUocmVzcG9uc2VOb2RlKTsKCQkKCQlzd2l0Y2ggKG5hbWUpIHsKCQkJY2FzZSAibG9naW5SZXNwb25zZSI6CgkJCQlyZXR1cm5WYWx1ZSA9IG5ldyBTZm9yY2UuTG9naW5SZXN1bHQocmVzdWx0c1swXSk7CgkJCQlicmVhazsKCQkJY2FzZSAicXVlcnlSZXNwb25zZSI6CgkJCWNhc2UgInF1ZXJ5TW9yZVJlc3BvbnNlIjoKCQkJCXJldHVyblZhbHVlID0gbmV3IFNmb3JjZS5RdWVyeVJlc3VsdChyZXN1bHRzWzBdKTsKCQkJCWJyZWFrOwoJCQljYXNlICJjcmVhdGVSZXNwb25zZSI6CgkJCWNhc2UgInVwZGF0ZVJlc3BvbnNlIjoKCQkJCXZhciByZXQgPSBuZXcgU2ZvcmNlLlNhdmVSZXN1bHRzKCk7IC8vQXJyYXkoKTsKCQkJCWZvciAodmFyIGk9MDtpPHJlc3VsdHMubGVuZ3RoO2krKykgewoJCQkJCXJldFtpXSA9IG5ldyBTZm9yY2UuU2F2ZVJlc3VsdChyZXN1bHRzW2ldKTsgCgkJCQl9CgkJCQlyZXR1cm5WYWx1ZSA9IHJldDsKCQkJCWJyZWFrOwoJCQljYXNlICJkZWxldGVSZXNwb25zZSI6CgkJCQl2YXIgcmV0ID0gbmV3IFNmb3JjZS5EZWxldGVSZXN1bHRzKCk7IC8vQXJyYXkoKTsKCQkJCWZvciAodmFyIGk9MDtpPHJlc3VsdHMubGVuZ3RoO2krKykgewoJCQkJCXJldFtpXSA9IG5ldyBTZm9yY2UuRGVsZXRlUmVzdWx0KHJlc3VsdHNbaV0pOyAKCQkJCX0KCQkJCXJldHVyblZhbHVlID0gcmV0OwoJCQkJYnJlYWs7CgkJCWNhc2UgInVwc2VydFJlc3BvbnNlIjoKCQkJCXZhciByZXQgPSBuZXcgU2ZvcmNlLlVwc2VydFJlc3VsdHMoKTsKCQkJCWZvciAodmFyIGk9MDtpPHJlc3VsdHMubGVuZ3RoO2krKykgewoJCQkJCXJldFtpXSA9IG5ldyBTZm9yY2UuVXBzZXJ0UmVzdWx0KHJlc3VsdHNbaV0pOwoJCQkJfQoJCQkJcmV0dXJuVmFsdWUgPSByZXQ7CgkJCQlicmVhazsKCQkJY2FzZSAiZGVzY3JpYmVTT2JqZWN0UmVzcG9uc2UiOgoJCQkJcmV0dXJuVmFsdWUgPSBuZXcgU2ZvcmNlLkRlc2NyaWJlU09iamVjdFJlc3VsdChyZXN1bHRzWzBdKTsgCgkJCQlicmVhazsKCQkJY2FzZSAiZGVzY3JpYmVTT2JqZWN0c1Jlc3BvbnNlIjoKCQkJICAgIHZhciBkZXNPUmV0ID0gbmV3IEFycmF5KCk7CgkJCSAgICBmb3IgKHZhciBpPTA7aTxyZXN1bHRzLmxlbmd0aDtpKyspIHsKCQkJICAgICAgICBkZXNPUmV0LnB1c2gobmV3IFNmb3JjZS5EZXNjcmliZVNPYmplY3RSZXN1bHQocmVzdWx0c1tpXSkpOyAKCQkJICAgIH0KCQkJCXJldHVyblZhbHVlID0gZGVzT1JldDsgCgkJCQlicmVhazsKCQkJY2FzZSAiZGVzY3JpYmVHbG9iYWxSZXNwb25zZSI6CgkJCQlyZXR1cm5WYWx1ZSA9IG5ldyBTZm9yY2UuRGVzY3JpYmVHbG9iYWxSZXN1bHQocmVzdWx0c1swXSk7CgkJCQlicmVhazsKCQkJY2FzZSAiZGVzY3JpYmVMYXlvdXRSZXNwb25zZSI6CgkJCQlyZXR1cm5WYWx1ZSA9IG5ldyBTZm9yY2UuRGVzY3JpYmVMYXlvdXRSZXN1bHQocmVzdWx0c1swXSk7CgkJCQlicmVhazsKCQkJY2FzZSAiZGVzY3JpYmVUYWJzUmVzcG9uc2UiOgoJCQkJdmFyIHRhYnJldCA9IG5ldyBBcnJheSgpOwoJCQkJZm9yICh2YXIgaT0wO2k8cmVzdWx0cy5sZW5ndGg7aSsrKSB7CgkJCQkJdGFicmV0LnB1c2gobmV3IFNmb3JjZS5EZXNjcmliZVRhYlNldFJlc3VsdChyZXN1bHRzW2ldKSk7CgkJCQl9CgkJCQlyZXR1cm5WYWx1ZSA9IHRhYnJldDsKCQkJCWJyZWFrOwoJCQljYXNlICJnZXRTZXJ2ZXJUaW1lc3RhbXBSZXNwb25zZSI6CgkJCQlyZXR1cm5WYWx1ZSA9IG5ldyBTZm9yY2UuR2V0U2VydmVyVGltZXN0YW1wUmVzdWx0KHJlc3VsdHNbMF0pOwoJCQkJYnJlYWs7CgkJCWNhc2UgInJldHJpZXZlUmVzcG9uc2UiOgoJCQkJcmV0dXJuVmFsdWUgPSBTZm9yY2UuU2VyaWFsaXphdGlvbi5EZXNlcmlhbGl6ZUJlYW5zKHJlc3VsdHMpOwoJCQkJYnJlYWs7CgkJCWNhc2UgInNlYXJjaFJlc3BvbnNlIjoKCQkJCXJldHVyblZhbHVlID0gbmV3IFNmb3JjZS5TZWFyY2hSZXN1bHQocmVzdWx0c1swXSk7CgkJCQlicmVhazsKCQkJY2FzZSAic2V0UGFzc3dvcmRSZXNwb25zZSI6CgkJCQlyZXR1cm5WYWx1ZSA9IG5ldyBTZm9yY2UuU2V0UGFzc3dvcmRSZXN1bHQocmVzdWx0c1swXSk7CgkJCQlicmVhazsKCQkJY2FzZSAicmVzZXRQYXNzd29yZFJlc3BvbnNlIjoKCQkJCXJldHVyblZhbHVlID0gbmV3IFNmb3JjZS5SZXNldFBhc3N3b3JkUmVzdWx0KHJlc3VsdHNbMF0pOwoJCQkJYnJlYWs7CgkJCWNhc2UgImdldFVzZXJJbmZvUmVzcG9uc2UiOgoJCQkJcmV0dXJuVmFsdWUgPSBuZXcgU2ZvcmNlLkdldFVzZXJJbmZvUmVzdWx0KHJlc3VsdHNbMF0pOwoJCQkJYnJlYWs7CgkJCWNhc2UgImdldFVwZGF0ZWRSZXNwb25zZSI6CgkJCQlyZXR1cm5WYWx1ZSA9IG5ldyBTZm9yY2UuR2V0VXBkYXRlZFJlc3VsdChyZXN1bHRzWzBdKTsKCQkJCWJyZWFrOwoJCQljYXNlICJnZXREZWxldGVkUmVzcG9uc2UiOgoJCQkJcmV0dXJuVmFsdWUgPSBuZXcgU2ZvcmNlLkdldERlbGV0ZWRSZXN1bHQocmVzdWx0c1swXSk7CgkJCQlicmVhazsKCQkJY2FzZSAiY29udmVydExlYWRSZXNwb25zZSI6CgkJCQl2YXIgbGVhZHJldCA9IG5ldyBBcnJheSgpOwoJCQkJZm9yICh2YXIgaT0wO2k8cmVzdWx0cy5sZW5ndGg7aSsrKSB7CgkJCQkJbGVhZHJldC5wdXNoKG5ldyBTZm9yY2UuTGVhZENvbnZlcnRSZXN1bHQocmVzdWx0c1tpXSkpOwoJCQkJfQoJCQkJcmV0dXJuVmFsdWUgPSBsZWFkcmV0OwoJCQkJYnJlYWs7CgkJfQkJCQkJCQkJCQkJCQkJCQoJfQoJaWYgKHNmb3JjZUNsaWVudC52ZXJib3NlID09IHRydWUpIHJldHVyblZhbHVlLl9fc29hcF9fID0gcmVzcG9uc2UucmVzcG9uc2VUZXh0OwoJcmV0dXJuIHJldHVyblZhbHVlOwp9OwoJCi8qKiBAaWdub3JlICovClNmb3JjZS5nZXRUeXBlZFZhbHVlID0gZnVuY3Rpb24obm9kZSwgdGhpc09iamVjdCwga2V5KSB7Cgl2YXIgdGFyZ2V0ID0ga2V5OwoJdmFyIHZhbHVlID0gU2ZvcmNlLkRPTS5HZXROb2RlVmFsdWUobm9kZSk7CgkKCXdpbmRvdy5zZXRUaW1lb3V0KCIiLCA1MCk7Cglzd2l0Y2ggKFNmb3JjZS5VdGlsLmRsdHlwZW9mKHRoaXNPYmplY3Rba2V5XSkudG9Mb3dlckNhc2UoKSkgewoJCWNhc2UgImJvb2xlYW4iOiAKCQkJcmV0dXJuIFNmb3JjZS5ET00uR2V0Qm9vbCh2YWx1ZSk7CgkJY2FzZSAiZnVuY3Rpb24iOgoJCQlyZXR1cm4gdmFsdWU7CgkJY2FzZSAibnVtYmVyIjoKCQkJcmV0dXJuIHBhcnNlSW50KHZhbHVlKTsKCQljYXNlICJzdHJpbmciOgoJCQlyZXR1cm4gdmFsdWU7CgkJY2FzZSAidW5kZWZpbmVkIjoKCQkJcmV0dXJuIHZhbHVlOwoJCWNhc2UgImFyZ3VtZW50cyI6CgkJCXJldHVybiB2YWx1ZTsKCQljYXNlICJoYXNodGFibGUiOgoJCQlzd2l0Y2ggKGtleSkgewoJCQkJY2FzZSAiY2hpbGRSZWxhdGlvbnNoaXBzIjoKCQkJCQlyZXR1cm4gbmV3IFNmb3JjZS5DaGlsZFJlbGF0aW9uc2hpcChub2RlKQoJCQkJCWJyZWFrOwoJCQl9CgkJCXJldHVybiByZXR2YWw7CgkJY2FzZSAiYXJyYXkiOgoJCQkvKkZvciB0aGUgYXJyYXksIHdlIHdpbGwgaGF2ZSB0byBzZWUgd2hhdCBraW5kIG9mIG9iamVjdCB3ZSovCgkJCS8qYXJlIGNyZWF0aW5nIGFuIGFycmF5IGZyb20gYmFzZWQgb24gdGhlIHhzaSB0eXBlIGluIHRoZSB4bWwqLwoJCQl2YXIgYXJyYXlOb2RlID0gbm9kZS5wYXJlbnROb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKGtleSk7CgkJCXZhciByZXR2YWwgPSBuZXcgQXJyYXkoKTsKCQkJZm9yICh2YXIgaT0wO2k8YXJyYXlOb2RlLmxlbmd0aDtpKyspIHsKCQkJCXN3aXRjaCAoa2V5KSB7CgkJCQkJY2FzZSAibGF5b3V0cyI6CgkJCQkJCXJldHZhbC5wdXNoKG5ldyBTZm9yY2UuRGVzY3JpYmVMYXlvdXQoYXJyYXlOb2RlW2ldKSk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImRldGFpbExheW91dFNlY3Rpb25zIjoKCQkJCQkJcmV0dmFsLnB1c2gobmV3IFNmb3JjZS5EZXNjcmliZUxheW91dFNlY3Rpb24oYXJyYXlOb2RlW2ldKSk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImVkaXRMYXlvdXRTZWN0aW9ucyI6CgkJCQkJCXJldHZhbC5wdXNoKG5ldyBTZm9yY2UuRGVzY3JpYmVMYXlvdXRTZWN0aW9uKGFycmF5Tm9kZVtpXSkpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJyZWNvcmRUeXBlTWFwcGluZ3MiOgoJCQkJCQlyZXR2YWwucHVzaChuZXcgU2ZvcmNlLlJlY29yZFR5cGVNYXBwaW5nKGFycmF5Tm9kZVtpXSkpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJsYXlvdXRSb3dzIjoKCQkJCQkJcmV0dmFsLnB1c2gobmV3IFNmb3JjZS5EZXNjcmliZUxheW91dFJvdyhhcnJheU5vZGVbaV0pKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAibGF5b3V0SXRlbXMiOgoJCQkJCQlyZXR2YWwucHVzaChuZXcgU2ZvcmNlLkRlc2NyaWJlTGF5b3V0SXRlbShhcnJheU5vZGVbaV0pKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAibGF5b3V0Q29tcG9uZW50cyI6CgkJCQkJCXJldHZhbC5wdXNoKG5ldyBTZm9yY2UuRGVzY3JpYmVMYXlvdXRDb21wb25lbnQoYXJyYXlOb2RlW2ldKSk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInBpY2tsaXN0c0ZvclJlY29yZFR5cGUiOgoJCQkJCQlyZXR2YWwucHVzaChuZXcgU2ZvcmNlLlBpY2tsaXN0Rm9yUmVjb3JkVHlwZShhcnJheU5vZGVbaV0pKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAidGFicyI6CgkJCQkJCXJldHZhbC5wdXNoKG5ldyBTZm9yY2UuRGVzY3JpYmVUYWIoYXJyYXlOb2RlW2ldKSk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInNlYXJjaFJlY29yZHMiOgoJCQkJCQlyZXR2YWxbaV0gPSBTZm9yY2UuU2VyaWFsaXphdGlvbi5EZXNlcmlhbGl6ZUJlYW4oYXJyYXlOb2RlW2ldLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJyZWNvcmQiKVswXSk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInR5cGVzIjoKCQkJCQkJcmV0dmFsLnB1c2goU2ZvcmNlLkRPTS5HZXROb2RlVmFsdWUoYXJyYXlOb2RlW2ldKSk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImlkcyI6CgkJCQkJCXJldHZhbC5wdXNoKFNmb3JjZS5ET00uR2V0Tm9kZVZhbHVlKGFycmF5Tm9kZVtpXSkpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJkZWxldGVkUmVjb3JkcyI6CgkJCQkJCXJldHZhbC5wdXNoKG5ldyBTZm9yY2UuRGVsZXRlZFJlY29yZChhcnJheU5vZGVbaV0pKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZXJyb3JzIjoKCQkJCQkJcmV0dmFsLnB1c2gobmV3IFNmb3JjZS5FcnJvcihhcnJheU5vZGVbaV0pKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiY2hpbGRSZWxhdGlvbnNoaXBzIjoKCQkJCQkJcmV0dmFsLnB1c2gobmV3IFNmb3JjZS5DaGlsZFJlbGF0aW9uc2hpcChhcnJheU5vZGVbaV0pKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiZmllbGRzIjoKCQkJCQkJdmFyIGZsZCA9IG5ldyBTZm9yY2UuRmllbGQoYXJyYXlOb2RlW2ldKTsKCQkJCQkJaWYgKGZsZC50eXBlICE9ICJwaWNrbGlzdCIpIHsKCQkJCQkJCWZsZC5waWNrbGlzdFZhbHVlcyA9IG51bGw7CgkJCQkJCX0KCQkJCQkJaWYgKGZsZC50eXBlICE9ICJyZWZlcmVuY2UiKSB7CgkJCQkJCQlmbGQucmVmZXJlbmNlVG8gPSBudWxsOwoJCQkJCQl9CgkJCQkJCXJldHZhbC5wdXNoKGZsZCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgInBpY2tsaXN0VmFsdWVzIjoKCQkJCQkJcmV0dmFsLnB1c2gobmV3IFNmb3JjZS5QaWNrbGlzdEVudHJ5KGFycmF5Tm9kZVtpXSkpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJyZWZlcmVuY2VUbyI6CgkJCQkJCXJldHZhbC5wdXNoKFNmb3JjZS5ET00uR2V0Tm9kZVZhbHVlKGFycmF5Tm9kZVtpXSkpOwoJCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gcmV0dmFsOwoJCWNhc2UgImRhdGUiOgoJCQlyZXR1cm4gU2ZvcmNlLlV0aWwuRnJvbUlzb0RhdGVUaW1lKHZhbHVlKTsKCQljYXNlICJlcnJvciI6CgkJCXJldHVybiB2YWx1ZTsKCQljYXNlICJtYXRoIjoKCQkJcmV0dXJuIHZhbHVlOwoJCWNhc2UgIm51bGwiOgoJCQlyZXR1cm4gdmFsdWU7CgkJY2FzZSAianNvYmplY3QiOgoJCQlyZXR1cm4gdmFsdWU7CgkJY2FzZSAicmVnZXhwIjoKCQkJcmV0dXJuIHZhbHVlOwoJCWNhc2UgImdldHVzZXJpbmZvcmVzdWx0IjoKCQkJcmV0dXJuIG5ldyBTZm9yY2UuR2V0VXNlckluZm9SZXN1bHQobm9kZSk7Cgl9Cn0KCi8qKiBAaWdub3JlICovClNmb3JjZS5zZXRUeXBlZFZhbHVlID0gZnVuY3Rpb24odGhpc09iamVjdCwga2V5KSB7Cgl2YXIgdGFyZ2V0ID0ga2V5OwoJdmFyIHZhbHVlID0gdGhpc09iamVjdFtrZXldOyAKCXN3aXRjaCAoU2ZvcmNlLlV0aWwuZGx0eXBlb2YodGhpc09iamVjdFtrZXldKS50b0xvd2VyQ2FzZSgpKSB7CgkJY2FzZSAiYm9vbGVhbiI6IAoJCQlyZXR1cm4gdmFsdWUudG9TdHJpbmcoKTsKCQljYXNlICJmdW5jdGlvbiI6CgkJCXJldHVybiB2YWx1ZS50b1N0cmluZygpOwoJCWNhc2UgIm51bWJlciI6CgkJCXJldHVybiB2YWx1ZS50b1N0cmluZygpOwoJCWNhc2UgInN0cmluZyI6CgkJCXJldHVybiB2YWx1ZS50b1N0cmluZygpOwoJCWNhc2UgInVuZGVmaW5lZCI6CgkJCXJldHVybiB2YWx1ZS50b1N0cmluZygpOwoJCWNhc2UgImFyZ3VtZW50cyI6CgkJCXJldHVybiB2YWx1ZS50b1N0cmluZygpOwoJCWNhc2UgImRhdGUiOgoJCQlyZXR1cm4gU2ZvcmNlLlV0aWwuVG9Jc29EYXRlVGltZSh2YWx1ZSk7CgkJY2FzZSAiZXJyb3IiOgoJCQlyZXR1cm4gdmFsdWUudG9TdHJpbmcoKTsKCQljYXNlICJtYXRoIjoKCQkJcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7CgkJY2FzZSAibnVsbCI6CgkJCXJldHVybiB2YWx1ZS50b1N0cmluZygpOwoJCWNhc2UgImpzb2JqZWN0IjoKCQkJcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7CgkJY2FzZSAicmVnZXhwIjoKCQkJcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7Cgl9Cn0KCi8qKiBAaWdub3JlICovClNmb3JjZS5oYXNHZW9jb2RlU2NoZW1hID0gZnVuY3Rpb24odGFibGVOYW1lKSB7Cgl2YXIgZGVzYyA9IHNmb3JjZUNsaWVudC5EZXNjcmliZVNPYmplY3QodGFibGVOYW1lKTsKCXZhciBmbGRNYXAgPSBkZXNjLmZpZWxkTWFwOwoJcmV0dXJuIChmbGRNYXBbImxhdF9fYyJdICE9IG51bGwgJiYgZmxkTWFwWyJsb25fX2MiXSAhPSBudWxsKTsKfQoKU2ZvcmNlLnhsb2FkT2JqZWN0ID0gZnVuY3Rpb24ob2JqLCBub2RlKSB7CglpZiAobmV3IFNmb3JjZS5BcHBsaWNhdGlvbigpLmdldF90eXBlKCkgPT0gU2ZvcmNlLkFwcGxpY2F0aW9uLlR5cGUuSW50ZXJuZXRFeHBsb3JlcikgewoJCXZhciBub2RlTmFtZSA9ICJiYXNlTmFtZSI7Cgl9IGVsc2UgewoJCXZhciBub2RlTmFtZSA9ICJsb2NhbE5hbWUiOwoJfQoJZm9yICh2YXIgaT0wO2k8bm9kZS5jaGlsZE5vZGVzLmxlbmd0aDtpKyspIHsKCQl2YXIgbmFtZSAgPSBub2RlLmNoaWxkTm9kZXNbaV1bbm9kZU5hbWVdOwoJCXZhciB0aGlzTm9kZSA9IG5vZGUuY2hpbGROb2Rlc1tpXTsKCQlpZiAodGhpc05vZGUuZ2V0QXR0cmlidXRlKSB7CgkJCXZhciB0ID0gdGhpc05vZGUuZ2V0QXR0cmlidXRlKCJ4c2k6dHlwZSIpOwoJCX0gZWxzZSB7CgkJCXZhciBhdHRzID0gdGhpc05vZGUuYXR0cmlidXRlczsKCQkJaWYgKGF0dHMgIT0gdW5kZWZpbmVkKSB7CgkJCQl2YXIgdCA9IGF0dHMuZ2V0TmFtZWRJdGVtKCJ0eXBlIik7CgkJCX0gZWxzZSB7CgkJCQl2YXIgdCA9IG51bGw7CgkJCX0KCQl9CgkJaWYgKHQgIT0gbnVsbCAmJiB0LmluZGV4T2YoIjoiKSA+IC0xKSB0ID0gdC5zdWJzdHJpbmcodC5pbmRleE9mKCI6IikgKyAxKTsKCQlpZiAodCAhPSBudWxsKSB7CgkJLy9pZiAoKHRoaXNOb2RlLmNoaWxkTm9kZXMubGVuZ3RoID4gMCAmJiB0aGlzTm9kZS5jaGlsZE5vZGVzWzBdLm5vZGVUeXBlICE9IDMpID09IHRydWUpIHsKCQkJLy9UaGlzIGNvdWxkIGJlIGFuIGFycmF5LCBpbiB3aGljaCBjYXNlIHdlIG5lZWQgdG8gbG9vayBhdCB0aGUgYXR0cmlidXRlcyB0byBkZXRlcm1pbmUKCQkJLy93aGF0IGtpbmQgb2Ygb2JqZWN0IHRvIGNyZWF0ZS4KCQkJaWYgKFNmb3JjZS5VdGlsLmRsdHlwZW9mKG9ialtuYW1lXSkgPT0gImFycmF5IikgewoJCQkJc3dpdGNoICh0LnRvTG93ZXJDYXNlKCkpIHsKCQkJCQljYXNlICJzb2JqZWN0IjoKCQkJCQkJb2JqW25hbWVdLnB1c2gobmV3IFNmb3JjZS5EeW5hYmVhbigiIiwgdHJ1ZSwgdGhpc05vZGUpKTsKCQkJCQkJLy9vYmpbbmFtZV0ucHVzaChTZm9yY2UuU2VyaWFsaXphdGlvbi5EZXNlcmlhbGl6ZUJlYW4odGhpc05vZGUpKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAic2F2ZXJlc3VsdCI6CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgImRlbGV0ZXJlc3VsdCI6CgkJCQkJCWJyZWFrOwoJCQkJfQoJCQl9IGVsc2UgaWYgKG9iai5jbGFzc05hbWUgJiYgb2JqLmNsYXNzTmFtZSA9PSAiRHluYWJlYW4iKSB7CgkJCQlpZiAob2JqW25hbWVdICE9IHVuZGVmaW5lZCkgewoJCQkJCW9ialtuYW1lXSA9IFNmb3JjZS5nZXRUeXBlZFZhbHVlKHRoaXNOb2RlLCBvYmosIG5hbWUpOwoJCQkJCWlmIChuYW1lLnRvTG93ZXJDYXNlKCkgPT0gInR5cGUiKSBvYmouc2V0VHlwZShvYmpbbmFtZV0pOwoJCQkJfSBlbHNlIHsKCQkJCQlpZiAodCAhPSB1bmRlZmluZWQpIHsKCQkJCQkJdmFyIHYgPSBuZXcgU2ZvcmNlW3RdKHRoaXNOb2RlKQoJCQkJCQlvYmouc2V0KG5hbWUsIHYpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCW9iai5zZXQobmFtZSwgU2ZvcmNlLmdldFR5cGVkVmFsdWUodGhpc05vZGUsIG9iaiwgbmFtZSkpOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIGlmIChvYmpbbmFtZV0uY2xhc3NOYW1lID09ICJIYXNodGFibGUiKSB7CgkJCQkvL2FkZCBhIG5ldyBoYXNoIGVudHJ5CgkJCX0gZWxzZSB7CgkJCQlvYmpbbmFtZV0gPSBuZXcgU2ZvcmNlW29ialtuYW1lXS5jbGFzc05hbWVdKHRoaXNOb2RlKTsKCQkJfQoJCQkvL2xvYWRNZShuZXdvYmosIG5vZGUuY2hpbGROb2Rlc1tpXSk7CgkJCS8vb2JqW25hbWVdID0gbmV3b2JqOwoJCX0gZWxzZSB7CgkJCWlmIChvYmouY2xhc3NOYW1lICYmIG9iai5jbGFzc05hbWUgPT0gIkR5bmFiZWFuIikgewoJCQkJaWYgKG9ialtuYW1lXSAhPSB1bmRlZmluZWQpIHsKCQkJCQlvYmpbbmFtZV0gPSBTZm9yY2UuZ2V0VHlwZWRWYWx1ZSh0aGlzTm9kZSwgb2JqLCBuYW1lKTsKCQkJCQlpZiAobmFtZS50b0xvd2VyQ2FzZSgpID09ICJ0eXBlIikgb2JqLnNldFR5cGUob2JqW25hbWVdKTsKCQkJCX0gZWxzZSB7CgkJCQkJaWYgKHRoaXNOb2RlLmdldEF0dHJpYnV0ZSgieHNpOm5pbCIpICE9ICJ0cnVlIikgewoJCQkJCQlvYmouc2V0KG5hbWUsIFNmb3JjZS5nZXRUeXBlZFZhbHVlKHRoaXNOb2RlLCBvYmosIG5hbWUpKTsKCQkJCQl9IGVsc2UgeyAKCQkJCQkJb2JqLnNldChuYW1lLCBudWxsKTsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSBpZiAob2JqW25hbWVdICYmIG9ialtuYW1lXS5jbGFzc05hbWUpIHsKCQkJCWlmIChvYmpbbmFtZV0uY2xhc3NOYW1lID09ICJIYXNodGFibGUiKSB7CgkJCQkJaWYgKG5hbWUgPT0gImNoaWxkUmVsYXRpb25zaGlwcyIpIHsKCQkJCQkJdmFyIGh0ID0gbmV3IFNmb3JjZS5DaGlsZFJlbGF0aW9uc2hpcCh0aGlzTm9kZSk7CgkJCQkJfSBlbHNlIGlmIChuYW1lID09ICJmaWVsZHMiKSB7CgkJCQkJCXZhciBodCA9IG5ldyBTZm9yY2UuRmllbGQodGhpc05vZGUpOwoJCQkJCX0gZWxzZSBpZiAobmFtZSA9PSAicGFyZW50UmVsYXRpb25zaGlwcyIpIHsKCQkJCQkJLy92YXIgaHQgPSBuZXcgU2ZvcmNlLgoJCQkJCX0KCQkJCQlvYmpbbmFtZV0uYWRkSXRlbShodC5jaGlsZFNPYmplY3QsIGh0KTsKCQkJCX0gZWxzZSB7CgkJCQkJb2JqW25hbWVdID0gbmV3IFNmb3JjZVtvYmpbbmFtZV0uY2xhc3NOYW1lXSh0aGlzTm9kZSk7CgkJCQl9CQkJCgkJCX0gZWxzZSB7CgkJCQlvYmpbbmFtZV0gPSBTZm9yY2UuZ2V0VHlwZWRWYWx1ZSh0aGlzTm9kZSwgb2JqLCBuYW1lKTsKCQkJfQoJCX0KCQkvL2lmICh0aGlzTm9kZS5oYXNBdHRyaWJ1dGVzKCkgPT0gdHJ1ZSkgewoJCQlpZiAodGhpc05vZGUuYXR0cmlidXRlcykgewoJCQkJZm9yICh2YXIgaj0wO2o8dGhpc05vZGUuYXR0cmlidXRlcy5sZW5ndGg7aisrKSB7CgkJCQkJdmFyIGF0dCA9IHRoaXNOb2RlLmF0dHJpYnV0ZXNbal07CgkJCQkJdmFyIGF0dE5hbWUgPSBhdHRbbm9kZU5hbWVdOwoJCQkJCWlmIChhdHQubmFtZS5pbmRleE9mKCJ4bWxucyIpID09IC0xKSB7CgkJCQkJCWlmIChvYmpbYXR0TmFtZV0gIT0gdW5kZWZpbmVkICYmIG9ialthdHROYW1lXS5sZW5ndGggPT0gMCkgewoJCQkJCQkJb2JqW2F0dE5hbWVdID09IFNmb3JjZS5nZXRUeXBlZFZhbHVlKGF0dCwgb2JqLCBhdHROYW1lKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCS8vfQoJfQp9OwoKLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLmxvYWRPYmplY3QgPSBmdW5jdGlvbih0aGlzT2JqZWN0LCBzb2FwKSB7CglTZm9yY2UuVXRpbC50aW1lX29iamVjdC5TdGFydFRpbWluZygpOwoJZm9yIChrZXkgaW4gdGhpc09iamVjdCkgewoJCXZhciBvYmpUeXBlID0gU2ZvcmNlLlV0aWwuZGx0eXBlb2YodGhpc09iamVjdFtrZXldKS50b0xvd2VyQ2FzZSgpOwoJCWlmIChvYmpUeXBlICE9ICJmdW5jdGlvbiIpIHsgCgkJCXZhciB4eXogPSBTZm9yY2UuRE9NLkdldEltbWVkaWF0ZUNoaWxkRWxlbWVudEJ5TmFtZShzb2FwLCBrZXkpOwoJCQlpZih4eXogIT0gbnVsbCkgewoJCQkJaWYgKHNvYXAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoa2V5KS5sZW5ndGggPiAwKSB7CgkJCQkJdGhpc09iamVjdFtrZXldID0gU2ZvcmNlLmdldFR5cGVkVmFsdWUoeHl6LCB0aGlzT2JqZWN0LCBrZXkpOwoJCQkJfQoJCQl9IAoJCX0KCX0KfQoKLyoqIEBpZ25vcmUgKi8KU2ZvcmNlLm9iamVjdFRvSHRtbFN0cmluZyA9IGZ1bmN0aW9uKG9iaiwgdGFiKSB7Cgl2YXIgb3V0cHV0ID0gIiI7CglpZiAodGFiID09IG51bGwpIHRhYiA9ICIiOwoJZm9yIChrZXkgaW4gb2JqKSB7CgkJdmFyIGtleXZhbCA9IGtleS50b1N0cmluZygpOwoJCWlmIChTZm9yY2UuVXRpbC5kbHR5cGVvZihvYmpba2V5dmFsXSkgIT0gImZ1bmN0aW9uIiAmJiBTZm9yY2UuVXRpbC5kbHR5cGVvZihvYmpba2V5dmFsXSkgIT0gIkZpZWxkIikgewoJCQlpZiAoU2ZvcmNlLlV0aWwuZGx0eXBlb2Yob2JqW2tleXZhbF0pID09ICJhcnJheSIpIHsKCQkJCWlmIChvYmpba2V5dmFsXS5sZW5ndGggPiAwKSB7CgkJCQkJb3V0cHV0ICs9IHRhYiArICI8Qj4iICsga2V5dmFsICsgIjwvQj4iOwoJCQkJCWZvciAodmFyIGk9MDtpPG9ialtrZXl2YWxdLmxlbmd0aDtpKyspIHsKCQkJCQkJb3V0cHV0ICs9IFNmb3JjZS5vYmplY3RUb0h0bWxTdHJpbmcob2JqW2tleXZhbF1baV0sIHRhYiArICImbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDsiKTsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlvdXRwdXQgKz0gdGFiICsgIjxCPiIgKyBrZXl2YWwgKyAiPC9CPjogIjsKCQkJCWlmIChvYmpba2V5dmFsXSAhPSB1bmRlZmluZWQpIHsKCQkJCQlpZiAob2JqW2tleXZhbF0udG9IdG1sU3RyaW5nKSB7CgkJCQkJCW91dHB1dCArPSBvYmpba2V5dmFsXS50b0h0bWxTdHJpbmcodGFiICsgIiZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyIpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCW91dHB1dCArPSBvYmpba2V5dmFsXS50b1N0cmluZygpICsgIjxicj4iOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJb3V0cHV0ICs9ICI8YnI+IjsKCQkJCX0KCQkJfQoJCX0KCX0KCXJldHVybiBvdXRwdXQgKyAiPEJSPiI7Cn0KCi8qKiBAaWdub3JlICovClNmb3JjZS5vYmplY3RUb1N0cmluZyA9IGZ1bmN0aW9uKG9iaiwgeCkgewoJdmFyIG91dHB1dCA9ICJcbiI7CglpZiAoeCkgb3V0cHV0ICs9IHggKyAiOiAiOwoJZm9yIChrZXkgaW4gb2JqKSB7CgkJdmFyIGtleXZhbCA9IGtleS50b1N0cmluZygpOwoJCWlmIChTZm9yY2UuVXRpbC5kbHR5cGVvZihvYmpba2V5dmFsXSkgIT0gImZ1bmN0aW9uIiAmJiBTZm9yY2UuVXRpbC5kbHR5cGVvZihvYmpba2V5dmFsXSkgIT0gIkZpZWxkIikgewoJCQlpZiAoU2ZvcmNlLlV0aWwuZGx0eXBlb2Yob2JqW2tleXZhbF0pLnRvTG93ZXJDYXNlKCkgPT0gImFycmF5IikgewoJCQkJLy9pZiAob2JqW2tleXZhbF0ubGVuZ3RoID4gMCkgewoJCQkJCW91dHB1dCArPSBrZXl2YWwgKyAiXG4iOwoJCQkJCWZvciAodmFyIGk9MDtpPG9ialtrZXl2YWxdLmxlbmd0aDtpKyspIHsKCQkJCQkJb3V0cHV0ICs9IG9ialtrZXl2YWxdW2ldLnRvU3RyaW5nKCk7Ly9TZm9yY2Uub2JqZWN0VG9TdHJpbmcob2JqW2tleXZhbF1baV0sIGkpOwoJCQkJCX0KCQkJCS8vfQoJCQl9IGVsc2UgewoJCQkJaWYgKGtleXZhbCAhPSAiZGVmaW5pdGlvbiIpIHsKCQkJCQlvdXRwdXQgKz0ga2V5dmFsICsgIjogIjsKCQkJCQlpZiAob2JqW2tleXZhbF0gIT0gdW5kZWZpbmVkKSB7CgkJCQkJCQlvdXRwdXQgKz0gb2JqW2tleXZhbF0udG9TdHJpbmcoKSArICJcbiI7CgkJCQkJfSBlbHNlIHsKCQkJCQkJb3V0cHV0ICs9ICJcbiI7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfQoJcmV0dXJuIG91dHB1dDsKfQovLyBET01GVU5DLkpTCi8qCiAqIENvcHlyaWdodCAoYykgMjAwNSwgc2FsZXNmb3JjZS5jb20sIGluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogCiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgCiAqIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAqIAogKiAgICBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgCiAqICAgIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogKiAgCiAqICAgIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIAogKiAgICB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uIAogKiAgICAKICogICAgTmVpdGhlciB0aGUgbmFtZSBvZiBzYWxlc2ZvcmNlLmNvbSwgaW5jLiBub3IgdGhlIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciAKICogICAgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KICogIAogKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIgCXNmb3JjZUNsaWVudC5yZWdpc3RlckluaXRDYWxsYmFjayggZnVuY3Rpb24oKSB7CgkJc2hvd0Rpdihzb3FsX3Rlc3Rlcik7CgkJZG9EZXNjcmliZUdsb2JhbCgpOwoJfSk7CkFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIAogKiBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgCiAqIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBPV05FUiBPUiBDT05UUklCVVRPUlMgQkUgTElBQkxFIEZPUiAKICogQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCAKICogVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIAogKiBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyAKICogTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIAogKiBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KICovCiAvKiogCiAqIEBmaWxlb3ZlcnZpZXcgVGhlIHNmb3JjZWNsaWVudC5qcyBmaWxlIGlzIHRoZSBtYWluIGludGVyZmFjZSBmb3IgdXNpbmcKICogdGhlIHNmb3JjZSBBUEkgZnJvbSBqYXZhc2NyaXB0LiAgTW9zdCBvZiB0aGUgbWV0aG9kcyBleHBvc2VkIGluIHRoaXMgZmlsZQogKiB2ZXJ5IGNsb3NlbHkgbWF0Y2ggdGhlIGludGVyZmFjZXMgZGVzY3JpYmVkIGZvciBpbiB0aGUgc2ZvcmNlIEFQSSBkb2N1bWVudGF0aW9uCiAqIGZvciB0aGUgd2ViIHNlcnZpY2UuICBJdCB3aWxsIGJlIG5vdGVkIHdoZXJlIHRoZSB0d28gaW50ZXJmYWNlcyBkaXZlcmdlLgogKiB7QGxpbmsgaHR0cDovL3d3dy5zZm9yY2UuY29tL3Jlc291cmNlcy9hcGkuanNwIFNmb3JjZSBBUEkgRG9jdW1lbnRhdGlvbn0KICoKICovCgovL0RPTSBGdW5jdGlvbnMKU2ZvcmNlLkRPTSA9IGZ1bmN0aW9uKCkge307ClNmb3JjZS5ET00ucHJvdG90eXBlID0gbmV3IEZ1bmN0aW9uOwpTZm9yY2UuRE9NLkdldEVsZW1lbnRWYWx1ZUJ5SW5kZXggPSBmdW5jdGlvbihub2RlLCBuYW1lLCBpbmRleCkgeyAKCWlmIChzZm9yY2VDbGllbnQuYXBwVHlwZSAhPSBTZm9yY2UuQXBwbGljYXRpb24uVHlwZS5JbnRlcm5ldEV4cGxvcmVyKSB7CiAgICAgICAgaWYgKG5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUobmFtZSlbMF0uZmlyc3RDaGlsZCA9PSBudWxsKSB7cmV0dXJuIG51bGw7fSBlbHNlIHtyZXR1cm4gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZShuYW1lKVswXS5maXJzdENoaWxkLmRhdGE7IH19IGVsc2UgeyB0cnkge3JldHVybiBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKG5hbWUpLml0ZW0oaW5kZXgpLnRleHQ7IH0gY2F0Y2ggKGUpIHtyZXR1cm4gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2Y6IiArIG5hbWUpLml0ZW0oaW5kZXgpLnRleHQ7IH19IH07ClNmb3JjZS5ET00uR2V0Tm9kZUJ5SW5kZXggPSBmdW5jdGlvbihub2RlLCBuYW1lLCBpbmRleCkgeyAKCWlmIChzZm9yY2VDbGllbnQuYXBwVHlwZSAhPSBTZm9yY2UuQXBwbGljYXRpb24uVHlwZS5JbnRlcm5ldEV4cGxvcmVyKSB7CiAgICAgICAgaWYgKG5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUobmFtZSlbMF0uZmlyc3RDaGlsZCA9PSBudWxsKSB7cmV0dXJuIG51bGw7fSBlbHNlIHt2YXIgbU5vZGUgPSBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKG5hbWUpWzBdO2ZvciAodmFyIGk9MDtpPG1Ob2RlLmNoaWxkTm9kZXMubGVuZ3RoO2krKykge2lmIChtTm9kZS5jaGlsZE5vZGVzW2ldLm5vZGVUeXBlID09IDEpIHtyZXR1cm4gbU5vZGUuY2hpbGROb2Rlc1tpXTt9fXJldHVybiBudWxsOyB9fSBlbHNlIHsgdHJ5IHtyZXR1cm4gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZShuYW1lKS5pdGVtKGluZGV4KTsgfSBjYXRjaCAoZSkge3JldHVybiBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzZjoiICsgbmFtZSkuaXRlbShpbmRleCk7IH19IH07ClNmb3JjZS5ET00uR2V0SW1tZWRpYXRlQ2hpbGRFbGVtZW50QnlOYW1lID0gZnVuY3Rpb24obm9kZSwgbmFtZSkgewoJdmFyIHJldCA9IFNmb3JjZS5ET00uR2V0SW1tZWRpYXRlQ2hpbGRFbGVtZW50c0J5TmFtZShub2RlLCBuYW1lKTsKCWlmIChyZXQgPT0gbnVsbCkgewoJCXJldHVybiBudWxsOwoJfSBlbHNlIHsKCQlyZXR1cm4gcmV0WzBdOwoJfQp9OwpTZm9yY2UuRE9NLkdldEltbWVkaWF0ZUNoaWxkRWxlbWVudHNCeU5hbWUgPSBmdW5jdGlvbihub2RlLCBuYW1lKSB7CglpZiAoc2ZvcmNlQ2xpZW50LmFwcFR5cGUgIT0gU2ZvcmNlLkFwcGxpY2F0aW9uLlR5cGUuSW50ZXJuZXRFeHBsb3JlcikgewoJCWlmIChub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKG5hbWUpID09IG51bGwpIHsKCQkJcmV0dXJuIG51bGw7CgkJfSBlbHNlIHsKCQkJdmFyIHhub2RlID0gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZShuYW1lKTsgCgkJCWlmICh4bm9kZS5sZW5ndGggPiAwKSB7CgkJCQlpZiAoeG5vZGUubGVuZ3RoID09IDEpIHsKCQkJCQlyZXR1cm4gW3hub2RlWzBdXTsKCQkJCX0gZWxzZSB7CgkJCQkJdmFyIG5vZGVzID0gbmV3IEFycmF5KCk7CgkJCQkJZm9yICh2YXIgaT0wO2k8eG5vZGUubGVuZ3RoO2krKykgewoJCQkJCQlpZiAoeG5vZGVbaV0ucGFyZW50Tm9kZSA9PSBub2RlICkgewoJCQkJCQkJbm9kZXMucHVzaCh4bm9kZVtpXSk7CgkJCQkJCQkvL3JldHVybiB4bm9kZVtpXTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlyZXR1cm4gbm9kZXM7CgkJCQl9CgkJCQkvL3JldHVybiBudWxsOwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIG51bGw7CgkJCX0gCgkJfQoJfSBlbHNlIHsgCgkJdmFyIHJldCA9IG5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUobmFtZSk7CgkJaWYgKHJldC5sZW5ndGggPT0gMCkgewoJCQlyZXQgPSBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzZjoiICsgbmFtZSk7CgkJfQoJCWlmIChyZXQubGVuZ3RoID4gMCkgewoJCQl2YXIgbm9kZXMgPSBuZXcgQXJyYXkoKTsKCQkJZm9yICh2YXIgaT0wO2k8cmV0Lmxlbmd0aDtpKyspIHsKCQkJCWlmIChub2RlLmJhc2VOYW1lICE9ICIiKSB7CgkJCQkJaWYgKHJldFtpXS5wYXJlbnROb2RlID09IG5vZGUpIHsKCQkJCQkJLy9yZXR1cm4gcmV0W2ldOwoJCQkJCQlub2Rlcy5wdXNoKHJldFtpXSk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQkvL3JldHVybiByZXRbaV07CgkJCQkJbm9kZXMucHVzaChyZXRbaV0pOwoJCQkJfSAKCQkJfQoJCQlyZXR1cm4gbm9kZXM7CgkJCS8vcmV0dXJuIG51bGw7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoJfSAKfTsKU2ZvcmNlLkRPTS5HZXRFbGVtZW50c0J5TmFtZU5TID0gZnVuY3Rpb24obm9kZSwgbmFtZSwgbnMpIHsKCWlmIChzZm9yY2VDbGllbnQuYXBwVHlwZSAhPSBTZm9yY2UuQXBwbGljYXRpb24uVHlwZS5JbnRlcm5ldEV4cGxvcmVyKSB7CiAgICAgICAgaWYgKG5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUobmFtZSkgPT0gbnVsbCkge3JldHVybiBudWxsO30gZWxzZSB7cmV0dXJuIG5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUobmFtZSk7IH19IGVsc2UgeyB0cnkge3ZhciByZXQgPSBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKG5hbWUpO2lmIChyZXQubGVuZ3RoID09IDApIHtyZXQgPSBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKG5zICsgIjoiICsgbmFtZSk7fXJldHVybiByZXQ7IH0gY2F0Y2ggKGUpIHtyZXR1cm4gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZShucyArICI6IiArIG5hbWUpOyB9fSB9OwpTZm9yY2UuRE9NLkdldEVsZW1lbnRzQnlOYW1lID0gZnVuY3Rpb24obm9kZSwgbmFtZSkgewoJaWYgKHNmb3JjZUNsaWVudC5hcHBUeXBlICE9IFNmb3JjZS5BcHBsaWNhdGlvbi5UeXBlLkludGVybmV0RXhwbG9yZXIpIHsKCQlpZiAobm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZShuYW1lKSA9PSBudWxsKSB7CgkJCXJldHVybiBudWxsOwoJCX0gZWxzZSB7CgkJCXJldHVybiBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKG5hbWUpOyAKCQl9Cgl9IGVsc2UgeyAKCQl0cnkgewoJCQl2YXIgcmV0ID0gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZShuYW1lKTsKCQkJaWYgKHJldC5sZW5ndGggPT0gMCkgewoJCQkJcmV0ID0gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2Y6IiArIG5hbWUpOwoJCQl9CgkJCXJldHVybiByZXQ7IAoJCX0gY2F0Y2ggKGUpIHsKCQkJcmV0dXJuIG5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNmOiIgKyBuYW1lKTsgCgkJfQoJfQp9OwoKU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgPSBmdW5jdGlvbihub2RlLCBuYW1lKSB7IAoJaWYgKHNmb3JjZUNsaWVudC5hcHBUeXBlICE9IFNmb3JjZS5BcHBsaWNhdGlvbi5UeXBlLkludGVybmV0RXhwbG9yZXIpIHsKCQl2YXIgbiA9IG5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUobmFtZSk7CgkJaWYgKG4gPT0gbnVsbCkgewoJCQlyZXR1cm4gbnVsbDsKCQl9IGVsc2UgaWYgKG5bMF0gPT0gbnVsbCkgewoJCQlyZXR1cm4gbnVsbDsKCQl9IGVsc2UgaWYgKG5bMF0uY2hpbGROb2Rlcy5sZW5ndGggPiAxKSB7CgkJCXJldHVybiBuWzBdOwoJCX0gZWxzZSBpZiAoblswXS5maXJzdENoaWxkID09IG51bGwpIHsKCQkJcmV0dXJuIG51bGw7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIG5bMF0uZmlyc3RDaGlsZC5ub2RlVmFsdWU7IAoJCX0KCX0gZWxzZSB7IAoJCXRyeSB7CgkJCXZhciBuID0gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZShuYW1lKVswXTsKCQkJaWYgKG4gPT0gbnVsbCkgCgkJCQluID0gbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2Y6IiArIG5hbWUpWzBdOwoJCQlpZiAobiA9PSBudWxsKSAKCQkJCXJldHVybiBudWxsOwoJCQlpZiAobi5jaGlsZE5vZGVzLmxlbmd0aCA+IDEpIHsgCgkJCQlyZXR1cm4gbjsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiBuLnRleHQ7CgkJCX0gCgkJfSBjYXRjaCAoZSkgewoJCQl2YXIgZW4gPSBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKG5hbWUpWzBdOwoJCQlpZiAobi5jaGlsZE5vZGVzLmxlbmd0aCA+IDEpIHsKCQkJCXJldHVybiBlbjsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzZjoiICsgbmFtZSlbMF0udGV4dDsgCgkJCX0KCQl9Cgl9Cn07ClNmb3JjZS5ET00uR2V0QXR0cmlidXRlVmFsdWUgPSBmdW5jdGlvbihub2RlLCBuYW1lKSB7Cgl2YXIgdmFsID0gbm9kZS5hdHRyaWJ1dGVzLmdldE5hbWVkSXRlbShuYW1lKTsgCglpZiAodmFsLm5vZGVWYWx1ZS5pbmRleE9mKCI6IikgIT0gLTEpIHsgCgkJcmV0dXJuIHZhbC5ub2RlVmFsdWUuc3Vic3RyaW5nKDMpOyB9IGVsc2UgeyByZXR1cm4gdmFsLm5vZGVWYWx1ZTsgfSB9OwpTZm9yY2UuRE9NLkdldE5vZGVWYWx1ZSA9IGZ1bmN0aW9uKG5vZGUpIHsKCWlmIChzZm9yY2VDbGllbnQuYXBwVHlwZSAhPSBTZm9yY2UuQXBwbGljYXRpb24uVHlwZS5JbnRlcm5ldEV4cGxvcmVyKSB7CiAgICAgICAgaWYgKG5vZGUubm9kZVZhbHVlID09IG51bGwgJiYgbm9kZS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxKSB7cmV0dXJuIG5vZGUuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWU7fSBlbHNlIHtyZXR1cm4gbm9kZS5ub2RlVmFsdWU7fX0gZWxzZSB7cmV0dXJuIG5vZGUudGV4dDt9fTsKU2ZvcmNlLkRPTS5HZXROb2RlTmFtZSA9IGZ1bmN0aW9uKG5vZGUpIHsKCWlmIChzZm9yY2VDbGllbnQuYXBwVHlwZSAhPSBTZm9yY2UuQXBwbGljYXRpb24uVHlwZS5JbnRlcm5ldEV4cGxvcmVyKSB7CiAgICAgICAgcmV0dXJuIG5vZGUubG9jYWxOYW1lO30gZWxzZSB7cmV0dXJuIG5vZGUuYmFzZU5hbWU7fX07ClNmb3JjZS5ET00uR2V0Qm9vbCA9IGZ1bmN0aW9uKHZhbCkge2lmICh2YWwgPT0gbnVsbCkgcmV0dXJuIG5ldyBCb29sZWFuKGZhbHNlKTtpZiAodmFsLnRvTG93ZXJDYXNlKCkgPT0gInRydWUiKSB7cmV0dXJuIG5ldyBCb29sZWFuKHRydWUpO30gZWxzZSB7cmV0dXJuIG5ldyBCb29sZWFuKGZhbHNlKTt9fTsKU2ZvcmNlLkRPTS5QYXJzZVZhbCA9IGZ1bmN0aW9uKHZhbHVlLCBuYW1lICxkZXNjKSB7Cgl2YXIgZmxkRGVmID0gZGVzYy5maWVsZE1hcC5nZXRJdGVtKG5hbWUudG9Mb3dlckNhc2UoKSk7CglpZiAoZmxkRGVmID09IG51bGwpIHsKCQl2YXIgY3IgPSBkZXNjLmNoaWxkUmVsYXRpb25zaGlwcy5nZXRJdGVtKG5hbWUudG9Mb3dlckNhc2UoKSk7CgkJaWYgKGNyICE9IG51bGwpIHsKCQkJLy9UaGlzIGlzIGFuIG9iamVjdCBkZWZpbml0aW9uIGZvciBhIGNoaWxkIHJlbGF0aW9uc2hpcAoJCQkvL1RoaXMgc2hvdWxkIGJlIGEgcXVlcnlSZXN1bHQgd2l0aCBhbGwgdGhlIHJlY29yZHMgb2YgdGhlIGNoaWxkIG9iamVjdAoJCQlyZXR1cm4gbmV3IFNmb3JjZS5RdWVyeVJlc3VsdCh2YWx1ZSk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIFNmb3JjZS5TZXJpYWxpemF0aW9uLkRlc2VyaWFsaXplQmVhbih2YWx1ZSk7CgkJfQoKCX0gZWxzZSB7CgkJaWYgKHZhbHVlID09IG51bGwgfHwgdmFsdWUubGVuZ3RoID09IDApIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoJCXZhciBmbGRUeXBlID0gZmxkRGVmLnR5cGU7CgkJaWYgKGZsZFR5cGUgPT0gInN0cmluZyIgfHwgZmxkVHlwZSA9PSAicGlja2xpc3QiIHx8IGZsZFR5cGUgPT0gIm11bHRpcGlja2xpc3QiIHx8IGZsZFR5cGUgPT0gImNvbWJvYm94IiB8fCBmbGRUeXBlID09ICJyZWZlcmVuY2UiIHx8IGZsZFR5cGUgPT0gInRleHRhcmVhIiB8fCBmbGRUeXBlID09ICJwaG9uZSIgfHwgZmxkVHlwZSA9PSAiaWQiIHx8IGZsZFR5cGUgPT0gInVybCIgfHwgZmxkVHlwZSA9PSAiZW1haWwiKSB7CgkJCXJldHVybiB2YWx1ZTsKCQl9IGVsc2UgaWYgKGZsZFR5cGUgPT0gImJvb2xlYW4iKSB7CgkJCWlmICh2YWx1ZS50b0xvd2VyQ2FzZSgpID09ICJmYWxzZSIpIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgkJfSBlbHNlIGlmIChmbGRUeXBlID09ICJjdXJyZW5jeSIgfHwgZmxkVHlwZSA9PSAiZG91YmxlIiB8fCBmbGRUeXBlID09ICJwZXJjZW50IikgewoJCQlyZXR1cm4gcGFyc2VGbG9hdCh2YWx1ZSk7CgkJfSBlbHNlIGlmIChmbGRUeXBlID09ICJkYXRlIiB8fCBmbGRUeXBlID09ICJkYXRldGltZSIpIHsKCQkJcmV0dXJuIFNmb3JjZS5VdGlsLkZyb21Jc29EYXRlVGltZSh2YWx1ZSk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHZhbHVlOwoJCX0KCX0KfTsKU2ZvcmNlLkRPTS5Mb2FkWG1sRG9jID0gZnVuY3Rpb24oYSkge3RyeSB7IGlmICh0eXBlb2YgQWN0aXZlWE9iamVjdCE9InVuZGVmaW5lZCIgJiYgdHlwZW9mIEdldE9iamVjdCE9InVuZGVmaW5lZCIpe3ZhciBiID0gbmV3IEFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxET00iKTtiLmxvYWQoYSk7cmV0dXJuIGI7fSBlbHNlIGlmICh0eXBlb2YgRE9NUGFyc2VyIT0idW5kZWZpbmVkIikge3ZhciByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtyZXEub3BlbigiR0VUIiwgYSwgZmFsc2UpOyByZXEuc2VuZChudWxsKTtyZXR1cm4gZG9tID0gcmVxLnJlc3BvbnNlWE1MO30gZWxzZSB7cmV0dXJuIG51bGw7fX0gY2F0Y2goYykge3cuaW5jb21wYXRpYmxlKCJ4bWxwYXJzZSIpfX07ClNmb3JjZS5ET00uQ3JlYXRlWG1sRG9jID0gZnVuY3Rpb24oYSkge3RyeSB7IGlmICh0eXBlb2YgQWN0aXZlWE9iamVjdCE9InVuZGVmaW5lZCIgJiYgdHlwZW9mIEdldE9iamVjdCE9InVuZGVmaW5lZCIpe3ZhciBiID0gbmV3IEFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxET00iKTtiLmxvYWRYTUwoYSk7cmV0dXJuIGI7fSBlbHNlIGlmICh0eXBlb2YgRE9NUGFyc2VyIT0idW5kZWZpbmVkIikge3JldHVybiAobmV3IERPTVBhcnNlcigpKS5wYXJzZUZyb21TdHJpbmcoYSwidGV4dC94bWwiKX0gZWxzZSB7cmV0dXJuIG51bGw7fX0gY2F0Y2goYykge3cuaW5jb21wYXRpYmxlKCJ4bWxwYXJzZSIpfX07CgpTZm9yY2UuU2VyaWFsaXphdGlvbiA9IGZ1bmN0aW9uKCkge307ClNmb3JjZS5TZXJpYWxpemF0aW9uLnByb3RvdHlwZSA9IG5ldyBGdW5jdGlvbjsKU2ZvcmNlLlNlcmlhbGl6YXRpb24uY0Rlc2VyaWFsaXplQmVhbiA9IGZ1bmN0aW9uKG5vZGUpIHsJCglpZiAobmV3IFNmb3JjZS5BcHBsaWNhdGlvbigpLmdldF90eXBlKCkgPT0gU2ZvcmNlLkFwcGxpY2F0aW9uLlR5cGUuSW50ZXJuZXRFeHBsb3JlcikgewoJCXZhciBub2RlTmFtZSA9ICJiYXNlTmFtZSI7Cgl9IGVsc2UgewoJCXZhciBub2RlTmFtZSA9ICJsb2NhbE5hbWUiOwoJfQoKCXZhciBudW1Ob2RlcyA9IG5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7Cgl2YXIgYmVhblR5cGUgPSAiIjsKCXZhciBmaWVsZHMgPSBuZXcgQXJyYXkoKTsKCWZvciAodmFyIGk9MDtpPG51bU5vZGVzO2krKykgewoJCXZhciB0aGlzTm9kZSA9IG5vZGUuY2hpbGROb2Rlc1tpXTsKCQl2YXIgZWxlbWVudE5hbWUgPSB0aGlzTm9kZVtub2RlTmFtZV07CgkJaWYgKGVsZW1lbnROYW1lID09ICJ0eXBlIikgewoJCQliZWFuVHlwZSA9IGVsZW1lbnROYW1lOwoJCX0gZWxzZSB7CgkJCWZpZWxkcy5wdXNoKFtlbGVtZW50TmFtZSwgdGhpc05vZGVdKTsKCQl9Cgl9Cgl2YXIgYmVhbiA9IG5ldyBTZm9yY2UuRHluYWJlYW4oYmVhblR5cGUpOwoJZm9yICh2YXIgaT0wO2k8ZmllbGRzLmxlbmd0aDtpKyspIHsKCQliZWFuLnNldChmaWVsZHNbaV1bMF0sIFNmb3JjZS5ET00uUGFyc2VWYWwoZmllbGRzW2ldWzFdLCBmaWVsZHNbaV1bMF0sIGJlYW4uZGVmaW5pdGlvbikpOwoJfQoJcmV0dXJuIGJlYW47Cn07CgpTZm9yY2UuU2VyaWFsaXphdGlvbi5EZXNlcmlhbGl6ZUJlYW4gPSBmdW5jdGlvbihub2RlKSB7CQoJdmFyIG51bU5vZGVzID0gbm9kZS5jaGlsZE5vZGVzLmxlbmd0aCA7CQoJdmFyIHR5cGVOYW1lID0gU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKG5vZGUsICJ0eXBlIik7CglpZiAodHlwZU5hbWUgPT0gbnVsbCkgCgkJcmV0dXJuIG51bGw7Cgl2YXIgYmVhbiA9IG5ldyBTZm9yY2UuRHluYWJlYW4odHlwZU5hbWUsIHRydWUpOwkKCXZhciBkZXNjID0gYmVhbi5kZWZpbml0aW9uOyAKCWZvciAoIHZhciBpID0gMDtpPG51bU5vZGVzIDsgaSsrKSB7CQoJCWlmIChub2RlLmNoaWxkTm9kZXMuaXRlbShpKS5ub2RlVHlwZSA9PSAxKSB7CgkJCXZhciBDdXJyTm9kZSA9IG5vZGUuY2hpbGROb2Rlcy5pdGVtKGkpOyAKCQkJaWYgKFNmb3JjZS5ET00uR2V0Tm9kZU5hbWUoQ3Vyck5vZGUpICE9ICJ0eXBlIikgeyAKCQkJCXZhciBlbE5hbWUgPSBTZm9yY2UuRE9NLkdldE5vZGVOYW1lKEN1cnJOb2RlKTsKCQkJCXZhciBlbFZhbCA9IFNmb3JjZS5ET00uUGFyc2VWYWwoU2ZvcmNlLkRPTS5HZXRFbGVtZW50VmFsdWUgKG5vZGUsIGVsTmFtZSksIGVsTmFtZSwgZGVzYyk7CgkJCQliZWFuLnNldChlbE5hbWUsIGVsVmFsKTsKCQkJfQoJCX0KCX0gCgkvL2lmIChub2RlLmdldFhNTCAhPSB1bmRlZmluZWQpIHsKCS8vCWJlYW4uc2V0U29hcChub2RlLmdldFhNTCgpKTsKCS8vfSBlbHNlIHsKCS8vCWJlYW4uc2V0U29hcChub2RlLnhtbCk7CgkvL30KCXJldHVybiBiZWFuOyAKfTsKU2ZvcmNlLlNlcmlhbGl6YXRpb24uU2VyaWFsaXplQmVhbiA9IGZ1bmN0aW9uKGJlYW5zLCBmaWx0ZXIpIHsgCgl2YXIgb3V0cHV0CT0gIiI7IAoJaWYgKFNmb3JjZS5VdGlsLmRsdHlwZW9mKGJlYW5zKSA9PSAiYXJyYXkiKSB7CgkJZm9yICh2YXIgaT0wO2k8YmVhbnMubGVuZ3RoO2krKykgeyAKCQkJb3V0cHV0ICs9IGJlYW5zW2ldLnRvU09iamVjdChmaWx0ZXIpOyAKCQl9IAoJfSBlbHNlIHsKCQlvdXRwdXQgKz0gYmVhbnMudG9TT2JqZWN0KGZpbHRlcik7Cgl9CQoJLyppZiAoYmVhbnMuY2xhc3NOYW1lICE9IHVuZGVmaW5lZCkgewoJCW91dHB1dCArPSBiZWFucy50b1NPYmplY3QoZmlsdGVyKTsKCX0gZWxzZSB7CgkJZm9yICh2YXIgaT0wO2k8YmVhbnMubGVuZ3RoO2krKykgeyAKCQkJb3V0cHV0ICs9IGJlYW5zW2ldLnRvU09iamVjdChmaWx0ZXIpOyAKCQl9IAoJfSovCglyZXR1cm4gb3V0cHV0Owp9OwpTZm9yY2UuU2VyaWFsaXphdGlvbi5EZXNlcmlhbGl6ZUJlYW5zID0gZnVuY3Rpb24ocmVjb3JkcykgeyB2YXIgYmVhbnMgPSBuZXcgQXJyYXkoKTsJZm9yICh2YXIgaT0wO2k8cmVjb3Jkcy5sZW5ndGg7aSsrKSB7IHZhciBub2RlID0gcmVjb3Jkc1tpXTsgdmFyIHNvID0gU2ZvcmNlLlNlcmlhbGl6YXRpb24uRGVzZXJpYWxpemVCZWFuKG5vZGUpO2lmIChzbyAhPSBudWxsKSAge2JlYW5zW2ldID0gc287IH19IHJldHVybiBiZWFuczsgfTsKLy8gRExUWVBFT0YuSlMKLyogZGx0eXBlb2YuanMKKiAgYnkgUGV0ZXIgQmVsZXNpcy4gdjEuMCAwNDA4MjMKKiAgQ29weXJpZ2h0IChjKSAyMDA0IFBldGVyIEJlbGVzaXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiogIE9yaWdpbmFsbHkgcHVibGlzaGVkIGFuZCBkb2N1bWVudGVkIGF0IGh0dHA6Ly93d3cuZGh0bWxhYi5jb20vCiovCi8qCiAqIENvcHlyaWdodCAoYykgMjAwNSwgc2FsZXNmb3JjZS5jb20sIGluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogCiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgCiAqIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAqIAogKiAgICBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgCiAqICAgIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogKiAgCiAqICAgIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIAogKiAgICB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uIAogKiAgICAKICogICAgTmVpdGhlciB0aGUgbmFtZSBvZiBzYWxlc2ZvcmNlLmNvbSwgaW5jLiBub3IgdGhlIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciAKICogICAgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KICogIAogKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgCiAqIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSAKICogUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIE9XTkVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIAogKiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIAogKiBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgCiAqIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVCAoSU5DTFVESU5HIAogKiBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgCiAqIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgogKi8KU2ZvcmNlLlV0aWwuZGx0eXBlb2YgPSBmdW5jdGlvbiggdkV4cHJlc3Npb24gKXsJCglpZiAodkV4cHJlc3Npb24gIT0gbnVsbCAmJiB2RXhwcmVzc2lvbi5jbGFzc05hbWUpIHsKCQlyZXR1cm4gdkV4cHJlc3Npb24uY2xhc3NOYW1lOwoJfQoJCgl2YXIgc1R5cGVPZiA9IHR5cGVvZiB2RXhwcmVzc2lvbjsKCWlmKCBzVHlwZU9mID09ICJmdW5jdGlvbiIgKXsKCQl2YXIgc0Z1bmN0aW9uID0gdkV4cHJlc3Npb24udG9TdHJpbmcoKTsKCQlpZiggKCAvXlwvLipcLyQvICkudGVzdCggc0Z1bmN0aW9uICkgKXsKCQkJcmV0dXJuICJyZWdleHAiOwoJCX0gZWxzZSBpZiAoICggL15cW29iamVjdC4qXF0kL2kgKS50ZXN0KCBzRnVuY3Rpb24gKSApewoJCQlzVHlwZU9mID0gIm9iamVjdCJ9CgkJfQoJCWlmICggc1R5cGVPZiAhPSAib2JqZWN0IiApewoJCQlyZXR1cm4gc1R5cGVPZjsKCQl9CgkJc3dpdGNoKCB2RXhwcmVzc2lvbiApewoJCQljYXNlIG51bGw6CgkJCQlyZXR1cm4gIm51bGwiOwoJCQljYXNlIHdpbmRvdzoKCQkJCXJldHVybiAid2luZG93IjsKCQkJY2FzZSB3aW5kb3cuZXZlbnQ6CQoJCQkJcmV0dXJuICJldmVudCI7CgkJfQoJCWlmKCB3aW5kb3cuZXZlbnQgJiYgKCBldmVudC50eXBlID09IHZFeHByZXNzaW9uLnR5cGUgKSApewoJCQlyZXR1cm4gImV2ZW50IjsKCQl9CgkJdmFyIGZDb25zdHJ1Y3RvciA9IHZFeHByZXNzaW9uLmNvbnN0cnVjdG9yOwoJCWlmKCBmQ29uc3RydWN0b3IgIT0gbnVsbCApewoJCQlzd2l0Y2goIGZDb25zdHJ1Y3RvciApewoJCQkJY2FzZSBBcnJheToKCQkJCQlzVHlwZU9mID0gImFycmF5IjsKCQkJCQlicmVhazsKCQkJCWNhc2UgRGF0ZToKCQkJCQlyZXR1cm4gImRhdGUiOwoJCQkJY2FzZSBSZWdFeHA6CgkJCQkJcmV0dXJuICJyZWdleHAiOwoJCQkJY2FzZSBPYmplY3Q6CgkJCQkJc1R5cGVPZiA9ICJqc29iamVjdCI7CgkJCQkJYnJlYWs7CgkJCQljYXNlIFJlZmVyZW5jZUVycm9yOgoJCQkJCXJldHVybiAiZXJyb3IiOwoJCQkJZGVmYXVsdDoKCQkJCQl2YXIgc0NvbnN0cnVjdG9yID0gZkNvbnN0cnVjdG9yLnRvU3RyaW5nKCk7CgkJCQkJdmFyIGFNYXRjaCA9IHNDb25zdHJ1Y3Rvci5tYXRjaCggL1xzKmZ1bmN0aW9uICguKilcKC8gKTsKCQkJCQlpZiggYU1hdGNoICE9IG51bGwgKXsKCQkJCQkJcmV0dXJuIGFNYXRjaFsgMSBdOwoJCQkJCX0KCQkJfQoJCX0KCQl2YXIgbk5vZGVUeXBlID0gdkV4cHJlc3Npb24ubm9kZVR5cGU7CgkJaWYoIG5Ob2RlVHlwZSAhPSBudWxsICl7CQoJCQlzd2l0Y2goIG5Ob2RlVHlwZSApewoJCQkJY2FzZSAxOgoJCQkJCWlmKCB2RXhwcmVzc2lvbi5pdGVtID09IG51bGwgKXsKCQkJCQkJcmV0dXJuICJkb21lbGVtZW50IjsKCQkJCQl9CgkJCQkJYnJlYWs7CgkJCQljYXNlIDM6CgkJCQkJcmV0dXJuICJ0ZXh0bm9kZSI7CgkJCX0KCQl9CgkvKmlmKCB2RXhwcmVzc2lvbi50b1N0cmluZyAhPSBudWxsICl7CgkJdmFyIHNFeHByZXNzaW9uID0gdkV4cHJlc3Npb24udG9TdHJpbmcoKTsKCQl2YXIgYU1hdGNoID0gc0V4cHJlc3Npb24ubWF0Y2goIC9eXFtvYmplY3QgKC4qKVxdJC9pICk7CgkJaWYoIGFNYXRjaCAhPSBudWxsICl7CgkJCXZhciBzTWF0Y2ggPSBhTWF0Y2hbIDEgXTsKCQkJc3dpdGNoKCBzTWF0Y2gudG9Mb3dlckNhc2UoKSApewoJCQkJY2FzZSAiZXZlbnQiOgoJCQkJCXJldHVybiAiZXZlbnQiOwoJCQkJY2FzZSAibWF0aCI6CgkJCQkJcmV0dXJuICJtYXRoIjsKCQkJCWNhc2UgImVycm9yIjoJCgkJCQkJcmV0dXJuICJlcnJvciI7CgkJCQljYXNlICJtaW1ldHlwZWFycmF5IjoKCQkJCQlyZXR1cm4gIm1pbWV0eXBlY29sbGVjdGlvbiI7CgkJCQljYXNlICJwbHVnaW5hcnJheSI6CgkJCQkJcmV0dXJuICJwbHVnaW5jb2xsZWN0aW9uIjsKCQkJCWNhc2UgIndpbmRvd2NvbGxlY3Rpb24iOgoJCQkJCXJldHVybiAid2luZG93IjsKCQkJCWNhc2UgIm5vZGVsaXN0IjoKCQkJCWNhc2UgImh0bWxjb2xsZWN0aW9uIjoKCQkJCWNhc2UgImVsZW1lbnRhcnJheSI6CgkJCQkJcmV0dXJuICJkb21jb2xsZWN0aW9uIjsKCQkJfQoJCX0KCX0qLwoJaWYoIHZFeHByZXNzaW9uLm1vdmVUb0Jvb2ttYXJrICYmIHZFeHByZXNzaW9uLm1vdmVUb0VsZW1lbnRUZXh0ICl7CgkJcmV0dXJuICJ0ZXh0cmFuZ2UiOwoJfSBlbHNlIGlmKCB2RXhwcmVzc2lvbi5jYWxsZWUgIT0gbnVsbCApewoJCXJldHVybiAiYXJndW1lbnRzIjsKCX0gZWxzZSBpZiAoIHZFeHByZXNzaW9uLml0ZW0gIT0gbnVsbCApewoJCXJldHVybiAiZG9tY29sbGVjdGlvbiI7Cgl9CglyZXR1cm4gc1R5cGVPZjsKfTsKU2ZvcmNlLlV0aWwuQmFzZTY0ID0gZnVuY3Rpb24oKSB7CglrZXlTdHIgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0iOwoJdGhpcy5yZXN1bHQgPSBudWxsOwp9OwpTZm9yY2UuVXRpbC5CYXNlNjQucHJvdG90eXBlLmVuY29kZSA9IGZ1bmN0aW9uIChpbnB1dCkgewoJcmV0dXJuIHRoaXMuYmVuY29kZShpbnB1dCk7Cn07ClNmb3JjZS5VdGlsLkJhc2U2NC5wcm90b3R5cGUuYmVuY29kZSA9IGZ1bmN0aW9uKGlucHV0KSB7Cgl2YXIgb3V0cHV0ID0gIiI7Cgl2YXIgY2hyMSwgY2hyMiwgY2hyMyA9ICIiOwoJdmFyIGVuYzEsIGVuYzIsIGVuYzMsIGVuYzQgPSAiIjsKCXZhciBpID0gMDsKCWRvIHsJCgkJY2hyMSA9IGlucHV0LmNoYXJDb2RlQXQoaSsrKTsKCQljaHIyID0gaW5wdXQuY2hhckNvZGVBdChpKyspOwoJCWNocjMgPSBpbnB1dC5jaGFyQ29kZUF0KGkrKyk7CgkJZW5jMSA9IGNocjEgPj4gMjsKCQllbmMyID0gKChjaHIxICYgMykgPDwgNCkgfCAoY2hyMiA+PiA0KTsKCQllbmMzID0gKChjaHIyICYgMTUpIDw8IDIpIHwgKGNocjMgPj4gNik7CgkJZW5jNCA9IGNocjMgJiA2MzsKCQlpZiAoaXNOYU4oY2hyMikpIHsKCQkJZW5jMyA9IGVuYzQgPSA2NDsKCQl9IGVsc2UgaWYgKGlzTmFOKGNocjMpKSB7CgkJCWVuYzQgPSA2NDsKCQl9CgkJb3V0cHV0ID0gb3V0cHV0ICsga2V5U3RyLmNoYXJBdChlbmMxKSArIGtleVN0ci5jaGFyQXQoZW5jMikgKyBrZXlTdHIuY2hhckF0KGVuYzMpICsga2V5U3RyLmNoYXJBdChlbmM0KTsKCQljaHIxID0gY2hyMiA9IGNocjMgPSAiIjsKCQllbmMxID0gZW5jMiA9IGVuYzMgPSBlbmM0ID0gIiI7Cgl9IHdoaWxlIChpIDwgaW5wdXQubGVuZ3RoKTsKCXJldHVybiBvdXRwdXQ7Cn07ClNmb3JjZS5VdGlsLkJhc2U2NC5wcm90b3R5cGUuZGVjb2RlID0gZnVuY3Rpb24gKGlucHV0LCBjYWxsYmFjaykgewoJaWYgKGNhbGxiYWNrICE9IHVuZGVmaW5lZCkgewoJCXNldFRpbWVvdXQodGhpcy5iZGVjb2RlKGlucHV0LCBjYWxsYmFjayksIDIwMCk7Cgl9IGVsc2UgewoJCXJldHVybiB0aGlzLmJkZWNvZGUoaW5wdXQpOwoJfQp9OwpTZm9yY2UuVXRpbC5CYXNlNjQucHJvdG90eXBlLmJkZWNvZGUgPSBmdW5jdGlvbihpbnB1dCwgY2FsbGJhY2spewoJdmFyIG91dHB1dCA9ICIiOwoJdmFyIGNocjEsIGNocjIsIGNocjMgPSAiIjsKCXZhciBlbmMxLCBlbmMyLCBlbmMzLCBlbmM0ID0gIiI7Cgl2YXIgaSA9IDA7Cgl2YXIgYmFzZTY0dGVzdCA9IC9bXkEtWmEtejAtOVwrXC9cPV0vZzsKCWlmIChiYXNlNjR0ZXN0LmV4ZWMoaW5wdXQpKSB7CgkJYWxlcnQoIlRoZXJlIHdlcmUgaW52YWxpZCBiYXNlNjQgY2hhcmFjdGVycyBpbiB0aGUgaW5wdXQgdGV4dC5cbiIgKyJWYWxpZCBiYXNlNjQgY2hhcmFjdGVycyBhcmUgQS1aLCBhLXosIDAtOSwgJysnLCAnLycsIGFuZCAnPSdcbiIgKyJFeHBlY3QgZXJyb3JzIGluIGRlY29kaW5nLiIpOwoJfQoJaW5wdXQgPSBpbnB1dC5yZXBsYWNlKC9bXkEtWmEtejAtOVwrXC9cPV0vZywgIiIpOwoJZG8gewoJCWVuYzEgPSBrZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7CgkJZW5jMiA9IGtleVN0ci5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTsKCQllbmMzID0ga2V5U3RyLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpOwoJCWVuYzQgPSBrZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7CgkJY2hyMSA9IChlbmMxIDw8IDIpIHwgKGVuYzIgPj4gNCk7CgkJY2hyMiA9ICgoZW5jMiAmIDE1KSA8PCA0KSB8IChlbmMzID4+IDIpOwoJCWNocjMgPSAoKGVuYzMgJiAzKSA8PCA2KSB8IGVuYzQ7CgkJb3V0cHV0ID0gb3V0cHV0ICsgU3RyaW5nLmZyb21DaGFyQ29kZShjaHIxKTsKCQlpZiAoZW5jMyAhPSA2NCkgewoJCQlvdXRwdXQgPSBvdXRwdXQgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNocjIpOwoJCX0KCQlpZiAoZW5jNCAhPSA2NCkgewoJCQlvdXRwdXQgPSBvdXRwdXQgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNocjMpOwoJCX0KCQljaHIxID0gY2hyMiA9IGNocjMgPSAiIjsKCQllbmMxID0gZW5jMiA9IGVuYzMgPSBlbmM0ID0gIiI7Cgl9IHdoaWxlIChpIDwgaW5wdXQubGVuZ3RoKTsKCWlmIChjYWxsYmFjayAhPSB1bmRlZmluZWQpIHsKCQlzZXRUaW1lb3V0KGNhbGxiYWNrKG91dHB1dCksIDIwMCk7Cgl9IGVsc2UgewoJCXJldHVybiBvdXRwdXQ7Cgl9Cn07CgovKgogKiBDb3B5cmlnaHQgKGMpIDIwMDUsIHNhbGVzZm9yY2UuY29tLCBpbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIAogKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIAogKiB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgogKiAKICogICAgUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIAogKiAgICBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICogIAogKiAgICBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCAKICogICAgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLiAKICogICAgCiAqICAgIE5laXRoZXIgdGhlIG5hbWUgb2Ygc2FsZXNmb3JjZS5jb20sIGluYy4gbm9yIHRoZSBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgCiAqICAgIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCiAqICAKICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAiQVMgSVMiIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIAogKiBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgCiAqIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBPV05FUiBPUiBDT05UUklCVVRPUlMgQkUgTElBQkxFIEZPUiAKICogQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCAKICogVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIAogKiBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyAKICogTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIAogKiBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KICovCgoKU2ZvcmNlLkR5bmFiZWFuID0gZnVuY3Rpb24ob2JqZWN0VHlwZSwgZnJvbVNlcnZlcikKewoJdGhpcy5iYXNlID0gU2ZvcmNlLkhhc2h0YWJsZTsKCXRoaXMuYmFzZSgpOwoJdGhpcy5jbGFzc05hbWUgPSAiRHluYWJlYW4iOwoJdGhpcy5kZWZpbml0aW9uID0gc2ZvcmNlQ2xpZW50LkRlc2NyaWJlU09iamVjdChvYmplY3RUeXBlKTsKCglzZXRVcmxzID0gZnVuY3Rpb24oKSB7CgkJaWYgKHRoaXMuZGVmaW5pdGlvbiAhPSB1bmRlZmluZWQgJiYgdGhpcy5kZWZpbml0aW9uLnVybERldGFpbCAhPSB1bmRlZmluZWQpIHsKCQkJdGhpcy51cmxQcmVmaXggPSB0aGlzLmRlZmluaXRpb24udXJsRGV0YWlsLnN1YnN0cmluZyh0aGlzLmRlZmluaXRpb24udXJsRGV0YWlsLmluZGV4T2YoInsiKSAtIDEpOwoJCQl0aGlzLnVybERldGFpbCA9IHRoaXMuZGVmaW5pdGlvbi51cmxEZXRhaWw7CgkJCXRoaXMudXJsRWRpdCA9IHRoaXMuZGVmaW5pdGlvbi51cmxFZGl0OwoJCQl0aGlzLnVybE5ldyA9IHRoaXMuZGVmaW5pdGlvbi51cmxOZXc7CgkJfQkKCX0KCgl0aGlzLnVybFByZWZpeCA9IG51bGw7Cgl0aGlzLnVybERldGFpbCA9IG51bGw7Cgl0aGlzLnVybEVkaXQgPSBudWxsOwoJdGhpcy51cmxOZXcgPSBudWxsOwoJdGhpcy51aWQgPSAobmV3IERhdGUoKS5nZXRUaW1lKCkpOwoJdGhpcy5kaXJ0eSA9IGZhbHNlOwoJdGhpcy5maWVsZHNUb051bGwgPSBbXTsKCXRoaXMuZnJvbVNlcnZlciA9IGZyb21TZXJ2ZXIgfHwgZmFsc2U7CgkKCS8vdGhpcy5fcHJvcGVydGllcyA9IG5ldyBTZm9yY2UuSGFzaHRhYmxlKCk7Cgl0aGlzLm5hbWUgPSBvYmplY3RUeXBlOwoJdGhpcy50eXBlID0gb2JqZWN0VHlwZTsKCQoJLyogVG8gU3RyaW5nIGludGVybmFsIGhlbHBlciAqLwoJdGhpcy50cyA9IGZ1bmN0aW9uKGluc3RhbmNlLCB0YWIsIGNyKSB7CgkJdmFyIG91dHB1dCA9IGluc3RhbmNlLmdldE5hbWUoKSArIGNyOwoJCWlmICh0YWIgPT0gdW5kZWZpbmVkKSB7IHRhYiA9ICIgICAgIjsgfQoJCWZvciAoa2V5IGluIGluc3RhbmNlLmdldEtleXMoKSkgewoJCQlpZiAoaW5zdGFuY2UubWFwW2tleV0uY2xhc3NOYW1lID09ICJQcm9wZXJ0eSIpIHsKCQkJCXZhciBwc3RyaW5nID0gaW5zdGFuY2UuZ2V0SXRlbShrZXkpLnRvU3RyaW5nKCk7CgkJCQlpZiAodGFiICE9IHVuZGVmaW5lZCkgewoJCQkJCW91dHB1dCArPSB0YWI7CgkJCQl9CgkJCX0KCQkJb3V0cHV0ICs9IHRhYiArIGtleSArICI6ICIgKyBwc3RyaW5nOwoJCQlpZiAoY3IgIT0gdW5kZWZpbmVkKSB7CgkJCQlvdXRwdXQgKz0gY3I7CgkJCX0KCQl9CgkJcmV0dXJuIG91dHB1dCArIGNyOwoJfTsKCXRoaXMuZGF0YUNoYW5nZWQgPSBudWxsOwoJc2V0VXJscygpOwp9OwpTZm9yY2UuRHluYWJlYW4ucHJvdG90eXBlID0gbmV3IFNmb3JjZS5IYXNodGFibGU7ClNmb3JjZS5EeW5hYmVhbi5wcm90b3R5cGUuc2V0VHlwZSA9IGZ1bmN0aW9uKG9iamVjdFR5cGUpIHsKCXRoaXMubmFtZSA9IG9iamVjdFR5cGU7Cgl0aGlzLnR5cGUgPSBvYmplY3RUeXBlOwoJdGhpcy5kZWZpbml0aW9uID0gc2ZvcmNlQ2xpZW50LkRlc2NyaWJlU09iamVjdChvYmplY3RUeXBlKTsKCXNldFVybHMoKTsKfQovKioKICogUmV0dXJucyB0aGUgTmFtZSBvZiB0aGUgYmVhbi4gIFRoZSBuYW1lIGlzIHRoZSBzYW1lIGFzIHRoZSBvYmplY3QgdHlwZSB0aGF0IGl0IHJlcHJlc2VudHMuICBUaGlzIGNhbiBiZSBjb25zaWRlcmVkIHRoZSAiY2xhc3MiIG5hbWUgb2YgdGhlIGJlYW4uCiAqIEB0eXBlIFN0cmluZwogKi8KU2ZvcmNlLkR5bmFiZWFuLnByb3RvdHlwZS5nZXROYW1lID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnR5cGU7fTsKU2ZvcmNlLkR5bmFiZWFuLnByb3RvdHlwZS5nZXRTb2FwID0gZnVuY3Rpb24gKCl7cmV0dXJuIHRoaXMuc29hcDt9OwpTZm9yY2UuRHluYWJlYW4ucHJvdG90eXBlLnNldFNvYXAgPSBmdW5jdGlvbiAocyl7IHRoaXMuc29hcCA9IHM7IH07ClNmb3JjZS5EeW5hYmVhbi5wcm90b3R5cGUuc2F2ZSA9IGZ1bmN0aW9uKCkgewoJaWYgKHRoaXMuZnJvbVNlcnZlciA9PSB0cnVlIHx8IHRoaXMuY29udGFpbnNJdGVtKCJpZCIpID09IHRydWUpIHsKCQl2YXIgc3IgPSBzZm9yY2VDbGllbnQuVXBkYXRlKFt0aGlzXSlbMF07Cgl9IGVsc2UgewoJCXZhciBzciA9IHNmb3JjZUNsaWVudC5DcmVhdGUoW3RoaXNdKVswXTsKCX0KCXJldHVybiBzcjsKfTsKCi8qKgogKiBSZXR1cm5zIGFsbCB0aGUgZHluYW1pY2FsbHkgY3JlYXRlZCBwcm9wZXJ0aWVzIG9mIGEgYmVhbgogKiBAdHlwZSBEeW5hUHJvcGVydHlbXQogKi8KLy9TZm9yY2UuRHluYWJlYW4ucHJvdG90eXBlLmdldFByb3BlcnRpZXMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmdldFByb3BlcnRpZXMoKTsgfTsKLyoqCiAqIFJldHVybnMgYSB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBiZWFuIHdpdGggZWFjaCBwcm9wZXJ0eSBvbiBhIHRhYmJlZCBsaW5lIGZvbGxvd2VkIGJ5IGEgY2FycmlhZ2UgcmV0dXJuCiAqIEB0eXBlIFN0cmluZwogKi8KU2ZvcmNlLkR5bmFiZWFuLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKHRhYikgeyByZXR1cm4gdGhpcy50cyh0aGlzLCAodGFiICE9IHVuZGVmaW5lZCkgPyB0YWIgOiAiXHQiLCAiXG4iKTsgfTsKLyoqCiAqIFJldHVybnMgYW4gaHRtbCBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGJlYW4gd2l0aCBlYWNoIHByb3BlcnR5IG9uIGEgdGFiYmVkIGxpbmUgZm9sbG93ZWQgYnkgYSBsaW5lIGJyZWFrCiAqIEB0eXBlIFN0cmluZwogKi8KU2ZvcmNlLkR5bmFiZWFuLnByb3RvdHlwZS50b0hUTUxTdHJpbmcgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRzKCImbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDsiLCAiPGJyPiIpOyB9OwovKioKICogUmV0dXJucyBhIHNpbmdsZSBuYW1lZCBwcm9wZXJ0eSBmcm9tIHRoZSBiZWFuCiAqIEB0eXBlIER5bmFQcm9wZXJ0eQogKi8KU2ZvcmNlLkR5bmFiZWFuLnByb3RvdHlwZS5nZXRQcm9wZXJ0eSA9IGZ1bmN0aW9uKHByb3BOYW1lKSB7IAoJcmV0dXJuIHRoaXMuZ2V0SXRlbShwcm9wTmFtZS50b0xvd2VyQ2FzZSgpKTsgfTsKLyoqCiAqIEFkZHMgYSBuZXcgcHJvcGVydHkgdG8gdGhlIGNvbGxlY3Rpb24gb2YgcHJvcGVydGllcyBvbiB0aGUgYmVhbgogKiBAcGFyYW0ge0R5bmFQcm9wZXJ0eX0gcHJvcCBUaGUgcHJvcGVydHkgdG8gYWRkIHRvIHRoZSBjb2xsZWN0aW9uLgogKiBAdHlwZSB2b2lkCiAqLwpTZm9yY2UuRHluYWJlYW4ucHJvdG90eXBlLmFkZFByb3BlcnR5ID0gZnVuY3Rpb24ocHJvcCkgeyAKCWlmICh0aGlzLmRlZmluaXRpb24uZmllbGRNYXAuY29udGFpbnNJdGVtKHByb3AuZ2V0TmFtZSgpKSA9PSBudWxsKSB7CQoJCXRocm93ICJUaGUgcHJvcGVydHkgIiArIHByb3AuZ2V0TmFtZSgpICsgIiBpcyBub3QgYSB2YWxpZCBmaWVsZC4iOwkKCX0gZWxzZSB7IAoJCXByb3AubGFiZWwgPSB0aGlzLmRlZmluaXRpb24uZmllbGRNYXAubWFwLmdldEl0ZW0ocHJvcC5nZXROYW1lKCkpLmxhYmVsOyAKCQl0aGlzLmFkZEl0ZW0ocHJvcC5nZXROYW1lKCksIHByb3ApOyAKCX0KfTsKLyoqCiAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eSBzcGVjaWZpZWQgaW4gdGhlIHByb3BOYW1lIHBhcmFtCiAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wTmFtZSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgdmFsdWUgdG8gZ2V0LiBUaGlzIHBhcmFtZXRlciBpcyBOT1QgY2FzZSBzZW5zaXRpdmUuICBUaGUgdHlwZSBvZiB0aGUgdmFsdWUgcmV0dXJuZWQgaXMgZGVwZW5kZW50IG9uIHRoZSBzY2hlbWEgdHlwZSBmb3IgdGhhdCBmaWVsZC4KICogQHR5cGUgVHlwZWQgT2JqZWN0CiAqLwpTZm9yY2UuRHluYWJlYW4ucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKHByb3BOYW1lKSB7IAoJdmFyIG1zZzsJCgl0cnkgeyAKCQlyZXR1cm4gdGhpcy5nZXRJdGVtKHByb3BOYW1lKS52YWx1ZTsgCgl9IGNhdGNoIChlKSB7IAoJCW1zZyA9ICJFUlJPUjogWW91ciAiICsgdGhpcy50eXBlICsgIiBvYmplY3QgZG9lcyBub3QgY29udGFpbiBhICIgKyBwcm9wTmFtZSArICIgZmllbGQuIjsgCgl9IAoJdGhyb3cobXNnKTsJCn07Ci8qKgogKiBSZXBsYWNlcyB0aGUgZW50aXJlIGNvbGxlY3Rpb24gb2YgcHJvcGVydGllcyBvbiB0aGUgYmVhbi4KICogQHBhcmFtIHtEeW5hUHJvcGVydHlbXX0gcHJvcGVydGllcyBUaGUgY29sbGVjdGlvbiAoYXJyYXkpIG9mIHByb3BlcnRpZXMgdG8gc2V0IGZvciB0aGUgYmVhbi4KICogQHR5cGUgRHluYVByb3BlcnR5CiAqLwovL1Nmb3JjZS5EeW5hYmVhbi5wcm90b3R5cGUuc2V0UHJvcGVydGllcyA9IGZ1bmN0aW9uKHByb3BlcnRpZXMpIHsgZm9yICh2YXIgaT0wO2k8dGhpcy5nZXRQcm9wZXJ0aWVzKCkubGVuZ3RoO2krKykgeyBpZiAodGhpcy5nZXREZWZpbml0aW9uKCkuZmllbGRNYXAuZ2V0SXRlbShwcm9wZXJ0aWVzW2ldLmdldE5hbWUoKS50b0xvd2VyQ2FzZSgpKSA9PSBudWxsKSB7IHRocm93ICJUaGUgcHJvcGVydHkgIiArIHByb3BlcnRpZXNbaV0uZ2V0TmFtZSgpICsgIiBpcyBub3QgYSB2YWxpZCBmaWVsZC4iOyB9CX1zZXRQcm9wZXJ0aWVzKHByb3BlcnRpZXMpOwl9OwovKioKICogQ3JlYXRlcyBvciBtb2RpZmllcyB0aGUgYSBwcm9wZXJ0eSB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZS4gIElmIHRoZSBwcm9wZXJ0eSBkb2VzIG5vdCB5ZXQgZXhpc3Qgb24gdGhlIGJlYW4gYSBuZXcgcHJvcGVydHkgaXMgY3JlYXRlZCwgb3RoZXJ3aXNlIHRoZSBleGlzdGluZyBwcm9wZXJ0eSB2YWx1ZSBpcyByZXBsYWNlZC4KICogQHBhcmFtIHtTdHJpbmd9IHByb3BOYW1lIFRoZSBuYW1lIG9mIHRoZSBwcm9wZXJ0eSB0byBzZXQuIFRoaXMgcGFyYW1ldGVyIGlzIE5PVCBjYXNlIHNlbnNpdGl2ZS4KICogQHBhcmFtIHtWYXJpZXN9IHByb3BOYW1lIFRoZSB2YWx1ZSBvZiB0aGUgcHJvcGVydHkgdG8gc2V0LgogKiBAdHlwZSB2b2lkCiAqLwpTZm9yY2UuRHluYWJlYW4ucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKHByb3BOYW1lLCB2YWx1ZSkgeyAKCXZhciBmbGREZWYgPSB0aGlzLmRlZmluaXRpb24uZmllbGRNYXAuZ2V0SXRlbShwcm9wTmFtZSk7Cgl2YXIgY3IgPSB0aGlzLmRlZmluaXRpb24uY2hpbGRSZWxhdGlvbnNoaXBzLmdldEl0ZW0ocHJvcE5hbWUudG9Mb3dlckNhc2UoKSk7Cgl2YXIgcm4gPSB0aGlzLmRlZmluaXRpb24ucGFyZW50UmVsYXRpb25zaGlwcy5nZXRJdGVtKHByb3BOYW1lLnRvTG93ZXJDYXNlKCkpOwoKCWlmIChmbGREZWYgPT0gbnVsbCAmJiBjciA9PSBudWxsICYmIHJuID09IG51bGwpIHsgCgkJdGhyb3cgIlRoZSBwcm9wZXJ0eSAiICsgcHJvcE5hbWUgKyAiIGlzIG5vdCBhIHZhbGlkIGZpZWxkLiI7IAoJfSBlbHNlIHsgCgkJLy9WYWxpZGF0ZSB0eXBlIGlmIHBvc3NpYmxlCgkJLy9UT0RPIHZhbGlkYXRlIG90aGVyIHR5cGVzCgkJaWYgKGZsZERlZiAhPSBudWxsKSB7CgkJCWlmIChmbGREZWYudHlwZSA9PSAiZGF0ZSIgfHwgZmxkRGVmLnR5cGUgPT0gImRhdGV0aW1lIikgewoJCQkJaWYgKFNmb3JjZS5VdGlsLmRsdHlwZW9mKHZhbHVlKSAhPSAiZGF0ZSIgJiYgU2ZvcmNlLlV0aWwuZGx0eXBlb2YodmFsdWUpICE9ICJkYXRldGltZSIgJiYgdmFsdWUgIT0gbnVsbCkgewoJCQkJCXRocm93ICJJbnZhbGlkIHR5cGU6IFlvdSBwYXNzZWQgYSAiICsgU2ZvcmNlLlV0aWwuZGx0eXBlb2YodmFsdWUpICsgIiBidXQgdGhlIGZpZWxkIHJlcXVpcmVzIGEgIiArIGZsZERlZi50eXBlICsgIi4iOwoJCQkJfSAKCQkJfQoJCX0KCQlpZiAodGhpcy5jb250YWluc0l0ZW0ocHJvcE5hbWUpID09IGZhbHNlKSB7IAoJCQkvL3RoaXNbbG5hbWVdID0gdmFsdWU7IAoJCQlpZiAoZmxkRGVmICE9IG51bGwpIHsKCQkJCXRoaXMuYWRkSXRlbShwcm9wTmFtZSwgbmV3IFNmb3JjZS5Qcm9wZXJ0eSh2YWx1ZSwgdGhpcywgZmxkRGVmKSk7CQoJCQl9IGVsc2UgaWYgKGNyICE9IG51bGwpIHsKCQkJCXRoaXMuYWRkSXRlbShwcm9wTmFtZSwgbmV3IFNmb3JjZS5Qcm9wZXJ0eSh2YWx1ZSwgdGhpcywgY3IpKTsKCQkJfSBlbHNlIHsKCQkJCXRoaXMuYWRkSXRlbShwcm9wTmFtZSwgbmV3IFNmb3JjZS5Qcm9wZXJ0eSh2YWx1ZSwgdGhpcywgbnVsbCwgcHJvcE5hbWUpKTsKCQkJfQoJCX0gZWxzZSB7IAoJCQl0aGlzLmdldEl0ZW0ocHJvcE5hbWUpLnNldFZhbHVlKHZhbHVlKTsgCgkJfSAKCQlpZiAocHJvcE5hbWUudG9Mb3dlckNhc2UoKSA9PSAiaWQiKSB7CgkJCWlmICh0aGlzLnVybEVkaXQgIT0gdW5kZWZpbmVkKSB7CgkJCQl0aGlzLnVybEVkaXQgPSB0aGlzLnVybEVkaXQucmVwbGFjZSgve0lEfS8sIHZhbHVlKTsKCQkJCXRoaXMudXJsRGV0YWlsID0gdGhpcy51cmxEZXRhaWwucmVwbGFjZSgve0lEfS8sIHZhbHVlKTsKCQkJfQoJCX0KCX0gCn07Ci8qKgogKiBSZXR1cm5zIHRoZSBtZXRhZGF0YSBkZWZpbml0aW9uIG9mIHRoZSBiZWFuLiAgVGhpcyBkZWZpbml0aW9uIGlzIG9idGFpbmVkIHdoZW4gdGhlIGJlYW4gaXMgY29uc3RydWN0ZWQgYmFzZWQgb24gdGhlIHJlc3VsdHMgb2YgYSBEZXNjcmliZVNPYmplY3QgY2FsbC4gIFRoZSBkZXNjcmliZSByZXN1bHQgaXMgY2FjaGVkLiAgVGhpcyBtZWFucyB0aGF0IGlmIHRoZSBkZWZpbml0aW9uIHdhcyBub3QgY2FjaGVkIHByaW9yIHRvIGluc3RhbnRpYXRpbmcgYSBiZWFuIG9mIGEgY2VydGFpbiB0aGVyZSBtYXkgYmUgYSBzbGlnbnQgZGVsYXkgZHVyaW5nIGluc3RhbnRpYXRpb24sIG90aGVyd2lzZSwgdGhpcyB2YWx1ZSBpcyByZXRyaWV2ZWQgZnJvbSBhIGNhY2hlLgogKiBAdHlwZSBEZXNjcmliZVNPYmplY3RSZXN1bHQKICovClNmb3JjZS5EeW5hYmVhbi5wcm90b3R5cGUuZ2V0RGVmaW5pdGlvbiA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5kZWZpbml0aW9uOyB9OwovKioKICogVGhpcyBpcyB0aGUgc2VyaWFsaXplciBtZXRob2QgdGhhdCBjb252ZXJ0cyB0aGUgYmVhbiBpbnRvIGFuIFNPYmplY3QgeG1sIHNuaXBwZXQuCiAqIEB0eXBlIFN0cmluZwogKi8KU2ZvcmNlLkR5bmFiZWFuLnByb3RvdHlwZS50b1NPYmplY3QgPSBmdW5jdGlvbiBiZWFuVG9TT2JqZWN0KGZpbHRlcikgeyAKCXZhciBvdXRwdXQgPSAiPHNPYmplY3RzIHhtbG5zOm5zMz1cInVybjpzb2JqZWN0LnBhcnRuZXIuc29hcC5zZm9yY2UuY29tXCI+IjsgCglvdXRwdXQgKz0gIjx0eXBlIHhtbG5zPVwidXJuOnNvYmplY3QucGFydG5lci5zb2FwLnNmb3JjZS5jb21cIj4iICsgdGhpcy5nZXROYW1lKCkgKyAiPC90eXBlPiI7Cglmb3IgKHZhciBpID0gMDtpPHRoaXMuZmllbGRzVG9OdWxsLmxlbmd0aDtpKyspIHsKCQlvdXRwdXQgKz0gIjxmaWVsZHNUb051bGw+IiArIHRoaXMuZmllbGRzVG9OdWxsW2ldICsgIjwvZmllbGRzVG9OdWxsPiI7Cgl9Cglmb3IgKGtleSBpbiB0aGlzLmdldEtleXMoKSkgewkKCQl2YXIgcHJvcCA9IHRoaXMuZ2V0SXRlbShrZXkpOyAKCQlpZiAocHJvcCAmJiBwcm9wLmNsYXNzTmFtZSAhPSB1bmRlZmluZWQgJiYgcHJvcC5jbGFzc05hbWUgPT0gIlByb3BlcnR5IikgeyAKCQkJdmFyIGZsZERlZiA9IHRoaXMuZGVmaW5pdGlvbi5maWVsZE1hcC5nZXRJdGVtKHByb3AubmFtZS50b0xvd2VyQ2FzZSgpKTsKCQkJaWYgKGZsZERlZiAhPSBudWxsKSB7CQoJCQkJdmFyIGFkZEZpZWxkID0gdHJ1ZTsKCQkJCWlmIChmaWx0ZXIgIT0gdW5kZWZpbmVkKSB7CgkJCQkJaWYgKGZpbHRlciA9PSAiZm9ydXBkYXRlIikgewoJCQkJCQlhZGRGaWVsZCA9IChmbGREZWYudXBkYXRlYWJsZSAgPT0gdHJ1ZSB8fCBmbGREZWYubmFtZS50b0xvd2VyQ2FzZSgpID09ICJpZCIpOwoJCQkJCX0gZWxzZSBpZiAoZmlsdGVyID09ICJmb3JjcmVhdGUiKSB7CgkJCQkJCWFkZEZpZWxkID0gKGZsZERlZi5jcmVhdGVhYmxlID09IHRydWUpOwoJCQkJCQlpZiAocHJvcC5lbGVtZW50ICE9IHVuZGVmaW5lZCkgewoJCQkJCQkJYWRkRmllbGQgPSBhZGRGaWVsZCAmJiAocHJvcC5kaXJ0eSA9PSB0cnVlKTsKCQkJCQkJfQoJCQkJCQkvL2FkZEZpZWxkID0gKGFkZEZpZWxkICYmIChwcm9wLmVsZW1lbnQgIT0gdW5kZWZpbmVkICYmIHByb3AuZGlydHkgPT0gdHJ1ZSkpCgkJCQkJfSBlbHNlIGlmIChmaWx0ZXIgPT0gImZvcnVwZGF0ZSIpIHsKCQkJCQkJYWRkRmllbGQgPSAoZmxkRGVmLnVwZGF0ZWFibGUgID09IHRydWUgfHwgZmxkRGVmLm5hbWUudG9Mb3dlckNhc2UoKSA9PSAiaWQiKTsKCQkJCQkJYWRkRmllbGQgPSAoYWRkRmllbGQgJiYgZmxkRGVmLmNyZWF0ZWFibGUgPT0gdHJ1ZSk7CgkJCQkJCWFkZEZpZWxkID0gKGFkZEZpZWxkICYmIChwcm9wLmVsZW1lbnQgIT0gdW5kZWZpbmVkICYmIHByb3AuZGlydHkgPT0gdHJ1ZSkpCgkJCQkJfQoJCQkJfQkJCgkJCQlpZiAoYWRkRmllbGQgPT0gdHJ1ZSkgewoJCQkJCXByb3AudHlwZSA9IGZsZERlZi50eXBlOyAKCQkJCQlvdXRwdXQgKz0gcHJvcC50b1NvYXAoKTsgCgkJCQl9CgkJCX0JCgkJfSAKCX0JCglvdXRwdXQgKz0gIjwvc09iamVjdHM+IjsgCgl0aGlzLnNldFNvYXAob3V0cHV0KTsKCXJldHVybiBvdXRwdXQ7CQp9OwpTZm9yY2UuRHluYWJlYW4ucHJvdG90eXBlLnRvSGVhZGVyUm93ID0gZnVuY3Rpb24oKSB7Cgl2YXIgdHIgPSBTZm9yY2UuZG9jLmNyZWF0ZUVsZW1lbnQoIlRSIik7Cglmb3IgKGtleSBpbiB0aGlzLmdldEtleXMoKSkgewoJCWlmICh0aGlzLmdldEl0ZW0oa2V5KS5jbGFzc05hbWUgJiYgdGhpcy5nZXRJdGVtKGtleSkuY2xhc3NOYW1lID09ICJQcm9wZXJ0eSIpIHsKCQkJdHIuYXBwZW5kQ2hpbGQodGhpcy5nZXRJdGVtKGtleSkudG9IZWFkZXJDZWxsKG51bGwsICJUSCIpKTsKCQl9Cgl9CglyZXR1cm4gdHI7Cn07ClNmb3JjZS5EeW5hYmVhbi5wcm90b3R5cGUudG9Sb3cgPSBmdW5jdGlvbihjbGFzc19OYW1lKSB7Cgl2YXIgdHIgPSBTZm9yY2UuZG9jLmNyZWF0ZUVsZW1lbnQoIlRSIik7Cglmb3IgKGtleSBpbiB0aGlzLmdldEtleXMoKSkgewoJCWlmICh0aGlzLmdldEl0ZW0oa2V5KS5jbGFzc05hbWUgJiYgdGhpcy5nZXRJdGVtKGtleSkuY2xhc3NOYW1lID09ICJQcm9wZXJ0eSIpIHsKCQkJdHIuYXBwZW5kQ2hpbGQodGhpcy5nZXRJdGVtKGtleSkudG9DZWxsKGNsYXNzX05hbWUpKTsKCQl9Cgl9Cgl0ci5jbGFzc05hbWUgPSBjbGFzc19OYW1lCglyZXR1cm4gdHI7Cn07CgpTZm9yY2UuRHluYWJlYW4ucHJvdG90eXBlLmNsZWFyRGlydHlGbGFnID0gZnVuY3Rpb24oKSB7Cgl0aGlzLmRpcnR5ID0gZmFsc2U7Cglmb3IgKGtleSBpbiB0aGlzLmdldEtleXMoKSkgewoJCWlmICh0aGlzLmdldEl0ZW0oa2V5KS5kaXJ0eSAhPSB1bmRlZmluZWQpIHsKCQkJdGhpcy5nZXRJdGVtKGtleSkuZGlydHkgPSBmYWxzZTsKCQl9Cgl9Cn07CgovLyBKU2NyaXB0IHNvdXJjZSBjb2RlCi8qIFByb3BldHkgRGVmaW5pdGlvbiAqLwovKioKICAqQGNsYXNzIFRoaXMgdGhlIGJhc2UgY2xhc3MgZm9yIGEgRHluYVByb3BlcnR5LCBpdCBjYW4gYmUgY29uc2lkZXJlZCBhbiBhYnN0cmFjdCBjbGFzcyAobm8gc3VjaCB0aGluZyBpbiBqYXZhc2NyaXB0IHJlYWxseSkuIAogICotIERPIE5PVCBVU0UgVEhJUyBDTEFTUyBESVJFQ1RMWQogICovClNmb3JjZS5Qcm9wZXJ0eSA9IGZ1bmN0aW9uKHZhbHVlLCBwYXJlbnRCZWFuLCBmbGREZWYsIG5hbWUpIHsKCQoJdGhpcy52YWx1ZSA9IHZhbHVlOy8vIHx8IG51bGw7CglpZiAodHlwZW9mKHZhbHVlKSA9PSAiYm9vbGVhbiIpIHsKCSAgICB0aGlzLnZhbHVlID0gdmFsdWU7Cgl9CglpZiAoZmxkRGVmID09IG51bGwpIHsKCQlpZiAocGFyZW50QmVhbiA9PSBudWxsKSB7CgkJCXRoaXMubmFtZSA9IG5hbWU7CgkJCXRoaXMudHlwZSA9ICJkZWZlcnJlZCI7CgkJCXRoaXMubGFiZWwgPSBuYW1lOwoJCQl0aGlzLnBhcmVudEJlYW4gPSBudWxsOwoJCQl0aGlzLmZpZWxkRGVmID0gbnVsbDsKCQl9IGVsc2UgewoJCQl0aGlzLm5hbWUgPSBuYW1lOwoJCQl0aGlzLnR5cGUgPSB2YWx1ZS5jbGFzc05hbWU7CgkJCXRoaXMubGFiZWwgPSBuYW1lOwoJCQl0aGlzLnBhcmVudEJlYW4gPSBwYXJlbnRCZWFuOwoJCQl0aGlzLmZpZWxkRGVmID0gdmFsdWUuZ2V0RGVmaW5pdGlvbigpOwoJCX0KCX0gZWxzZSBpZiAoZmxkRGVmLmNsYXNzTmFtZSA9PSAiQ2hpbGRSZWxhdGlvbnNoaXAiKSB7CgkJdGhpcy5uYW1lID0gZmxkRGVmLnJlbGF0aW9uc2hpcE5hbWU7CgkJdGhpcy50eXBlID0gZmxkRGVmLmNoaWxkU09iamVjdDsKCQl0aGlzLmxhYmVsID0gdGhpcy5uYW1lOwoJCXRoaXMucGFyZW50QmVhbiA9IHBhcmVudEJlYW47CgkJdGhpcy5maWVsZERlZiA9IGZsZERlZjsKCX0gZWxzZSB7CgkJdGhpcy5uYW1lID0gZmxkRGVmLm5hbWU7CgkJdGhpcy50eXBlID0gZmxkRGVmLnR5cGU7CgkJdGhpcy5sYWJlbCA9IGZsZERlZi5sYWJlbDsKCQl0aGlzLnBhcmVudEJlYW4gPSBwYXJlbnRCZWFuOwoJCXRoaXMuZmllbGREZWYgPSBmbGREZWY7Cgl9Cgl0aGlzLmNsYXNzTmFtZSA9ICJQcm9wZXJ0eSI7Cgl0aGlzLmVsZW1lbnQgPSB1bmRlZmluZWQ7Cgl0aGlzLmRpcnR5ID0gZmFsc2U7Cgl0aGlzLnJlYWRPbmx5ID0gZmFsc2U7CgoJdGhpcy5vbkNoYW5nZSA9IHVuZGVmaW5lZDsKCXRoaXMub25CZWZvcmVDaGFuZ2UgPSB1bmRlZmluZWQ7CQoJdGhpcy50cyA9IGZ1bmN0aW9uKHRhYikgewoJCWlmICh0aGlzLnZhbHVlICE9IG51bGwgJiYgdGhpcy52YWx1ZSAhPSAiIikgewoJCQlpZiAodGhpcy50eXBlID09ICJkYXRlIikgewoJCQkJcmV0dXJuICIoIiArIHRoaXMudHlwZSArICIpICIgKyBTZm9yY2UuVXRpbC5Gb3JtYXREYXRlKHRoaXMudmFsdWUsICJFIE5OTiBkIHl5eXkiKTsKCQkJfSBlbHNlIGlmICh0aGlzLnR5cGUgPT0gImRhdGV0aW1lIikgewoJCQkJcmV0dXJuICIoIiArIHRoaXMudHlwZSArICIpICIgKyBTZm9yY2UuVXRpbC5Gb3JtYXREYXRlKHRoaXMudmFsdWUsICJFIE5OTiBkIEhIOm1tOnNzIHl5eXkiKTsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiAiKCIgKyB0aGlzLnR5cGUgKyAiKSAiICsgdGhpcy52YWx1ZS50b1N0cmluZygpOwoJCQl9IAoJCX0gZWxzZSB7CgkJCXJldHVybiB0aGlzLm5hbWUgKyAiOiAobm90IHNldCkiOwoJCX0KCX07Cn0KLyoqCiAqIFRoaXMgbWV0aG9kIHNlcmlhbGl6ZXMgYSBzaW5nbGUgcHJvcGVydHkgaW50byBhIHZhbGlkIHNvYXAgbWVzc2FnZSBlbGVtZW50LiAgVGhlIGVsZW1lbnQgaXMgbmFtZXNwYWNlIHByZWZpeGVkIG5zMy4KICogQHJldHVybiBTdHJpbmcKICovClNmb3JjZS5Qcm9wZXJ0eS5wcm90b3R5cGUuc2V0T25DaGFuZ2UgPSBmdW5jdGlvbihvbmNoYW5nZUZ1bmN0aW9uKSB7IHRoaXMub25DaGFuYWdlID0gb25jaGFuZ2VGdW5jdGlvbjsgfTsKU2ZvcmNlLlByb3BlcnR5LnByb3RvdHlwZS5zZXRPbkJlZm9yZUNoYW5nZSA9IGZ1bmN0aW9uKG9uQmVmb3JlQ2hhbmdlRnVuY3Rpb24pIHsgdGhpcy5vbkJlZm9yZUNoYW5nZSA9IG9uQmVmb3JlQ2hhbmdlRnVuY3Rpb247IH07Ci8vU2ZvcmNlLlByb3BlcnR5LnByb3RvdHlwZS50b1NvYXAgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudG9Tb2FwKCk7IH07ClNmb3JjZS5Qcm9wZXJ0eS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudHMoKTsgfTsKU2ZvcmNlLlByb3BlcnR5LnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uKHZhbHVlKSB7Cgl2YXIgZG9DaGFuZ2UgPSB0cnVlOwoJdmFyIG9iYyA9IHRoaXMub25CZWZvcmVDaGFuZ2U7CglpZiAodGhpcy5vbkJlZm9yZUNoYW5nZSAhPSB1bmRlZmluZWQpIHsKCQlkb0NoYW5nZSA9IHRoaXMub25CZWZvcmVDaGFuZ2UodGhpcywgdmFsdWUpOwoJfQoJaWYgKGRvQ2hhbmdlID09IHRydWUpIHsKCQlwYXJzZVZhbHVlKHRoaXMsIHZhbHVlKTsKCQl0aGlzLmRpcnR5ID0gdHJ1ZTsKCQl0aGlzLnBhcmVudEJlYW4uZGlydHkgPSB0cnVlOwoJfSBlbHNlIHsKCQl0aGlzLmVsZW1lbnQudmFsdWUgPSB0aGlzLnRvRm9ybWF0dGVkVmFsdWUoKTsKCX0KCWlmICh0aGlzLm9uQ2hhbmdlICE9IHVuZGVmaW5lZCkgewoJCXRoaXMub25DaGFuZ2UodGhpcyk7Cgl9CglmdW5jdGlvbiBwYXJzZVZhbHVlKHByb3AsIHZhbCkgewoJCXN3aXRjaCAocHJvcC50eXBlKSB7CgkJCWNhc2UgImJvb2xlYW4iOiAKCQkJCXByb3AudmFsdWUgPSBCb29sZWFuLnBhcnNlKHZhbCk7IAoJCQkJYnJlYWs7CgkJCWNhc2UgImludCI6CgkJCQlwcm9wLnZhbHVlID0gcGFyc2VJbnQodmFsKTsKCQkJCWJyZWFrOwoJCQljYXNlICJjdXJyZW5jeSI6CgkJCWNhc2UgImRvdWJsZSI6CgkJCWNhc2UgInBlcmNlbnQiOgoJCQkJcHJvcC52YWx1ZSA9IHBhcnNlRmxvYXQodmFsKTsKCQkJCWJyZWFrOwoJCQljYXNlICJkYXRlIjoKCQkJY2FzZSAiZGF0ZXRpbWUiOgoJCQkJcHJvcC52YWx1ZSA9IFNmb3JjZS5VdGlsLlBhcnNlRGF0ZSh2YWwpOwoJCQkJYnJlYWs7CgkJCWRlZmF1bHQ6CgkJCQlwcm9wLnZhbHVlID0gdmFsOwoJCQkJYnJlYWs7CgkJfQoJfTsKfTsKU2ZvcmNlLlByb3BlcnR5LnByb3RvdHlwZS50b0hlYWRlckNlbGwgPSBmdW5jdGlvbihjbGFzc05hbWUsIHR5cGUpIHsgdGQgPSBTZm9yY2UuZG9jLmNyZWF0ZUVsZW1lbnQodHlwZSk7IHRkLmFwcGVuZENoaWxkKFNmb3JjZS5kb2MuY3JlYXRlVGV4dE5vZGUodGhpcy5sYWJlbCkpOyB0ZC5jbGFzc05hbWUgPSBjbGFzc05hbWU7cmV0dXJuIHRkOyB9OyAKU2ZvcmNlLlByb3BlcnR5LnByb3RvdHlwZS50b0NlbGwgPSBmdW5jdGlvbihjbGFzc05hbWUpIHsKCXRkID0gU2ZvcmNlLmRvYy5jcmVhdGVFbGVtZW50KCJURCIpOwoJdmFyIG5iID0gU2ZvcmNlLmRvYy5jcmVhdGVFbGVtZW50KCJOT0JSIik7Cgl0ZC5hcHBlbmRDaGlsZChuYik7Cgl2YXIgdG4gPSBTZm9yY2UuZG9jLmNyZWF0ZVRleHROb2RlKCB0aGlzLnZhbHVlID09IG51bGwgPyAiLiIgOiB0aGlzLnZhbHVlLnRvU3RyaW5nKCkgKTsKCWlmICh0aGlzLnR5cGUgPT0gImlkIiB8fCB0aGlzLnR5cGUgPT0gInJlZmVyZW5jZSIpIHsKCQl2YXIgYW5jaCA9IFNmb3JjZS5kb2MuY3JlYXRlRWxlbWVudCgiQSIpOwoJCWlmIChTZm9yY2UuZG9jLmxvY2F0aW9uLmhyZWYuaW5kZXhPZigic2FsZXNmb3JjZS5jb20iKSA+IDApIHsKCQkJYW5jaC5zZXRBdHRyaWJ1dGUoImhyZWYiLCB0aGlzLnBhcmVudEJlYW4udXJsRGV0YWlsKTsKCQl9IGVsc2UgewoJCQlhbmNoLnNldEF0dHJpYnV0ZSgiaHJlZiIsIHRoaXMucGFyZW50QmVhbi51cmxQcmVmaXggKyAiL3NlY3VyL2Zyb250ZG9vci5qc3A/c2lkPSIgKyBzZm9yY2VDbGllbnQuZ2V0U2Vzc2lvbklkKCkgKyAiJnJldFVSTD0vIiArIHRoaXMudmFsdWUpOwoJCX0KCQlhbmNoLnNldEF0dHJpYnV0ZSgidGFyZ2V0IiwgIl9ibGFuayIpOwoJCWFuY2guYXBwZW5kQ2hpbGQodG4pO25iLmFwcGVuZENoaWxkKGFuY2gpOwoJfSBlbHNlIHsKCQluYi5hcHBlbmRDaGlsZCh0bik7Cgl9Cgl0ZC5jbGFzc05hbWUgPSBjbGFzc05hbWU7CglyZXR1cm4gdGQ7Cn07ClNmb3JjZS5Qcm9wZXJ0eS5wcm90b3R5cGUudG9Tb2FwID0gZnVuY3Rpb24oKSB7IAoJaWYgKHRoaXMudmFsdWUgPT0gbnVsbCkgcmV0dXJuICIiOwoJdmFyIHh2YWw7IAoJc3dpdGNoICh0aGlzLmZpZWxkRGVmLnNvYXBUeXBlKSB7CgkJY2FzZSBTZm9yY2UuU29hcE9iamVjdC5Tb2FwVHlwZS5CQVNFNjRCSU5BUlk6CgkJCXZhciBiNjQgPSBuZXcgU2ZvcmNlLlV0aWwuQmFzZTY0KCk7CgkJCXh2YWwgPSBiNjQuZW5jb2RlKHRoaXMudmFsdWUpOwkKCQkJYnJlYWs7CgkJY2FzZSBTZm9yY2UuU29hcE9iamVjdC5Tb2FwVHlwZS5CT09MRUFOOgkJCXh2YWwgPSB0aGlzLnZhbHVlOwlicmVhazsKCQljYXNlIFNmb3JjZS5Tb2FwT2JqZWN0LlNvYXBUeXBlLkRPVUJMRToJCQl4dmFsID0gdGhpcy52YWx1ZTsJYnJlYWs7CgkJY2FzZSBTZm9yY2UuU29hcE9iamVjdC5Tb2FwVHlwZS5JTlQ6CQkJCXh2YWwgPSB0aGlzLnZhbHVlOwlicmVhazsKCQljYXNlIFNmb3JjZS5Tb2FwT2JqZWN0LlNvYXBUeXBlLkRBVEU6CQkJCWlmICh0aGlzLnZhbHVlID09IG51bGwpIHsJCQkJeHZhbCA9ICIiOwkJCX0gZWxzZSB7CQkJCXh2YWwgPSBTZm9yY2UuVXRpbC5Ub0lzb0RhdGUodGhpcy52YWx1ZSk7CQkJfQkJCWJyZWFrOwoJCWNhc2UgU2ZvcmNlLlNvYXBPYmplY3QuU29hcFR5cGUuREFURVRJTUU6CQkJaWYgKHRoaXMudmFsdWUgPT0gbnVsbCkgewkJCQl4dmFsID0gIiI7CQkJfSBlbHNlIHsJCQkJeHZhbCA9IFNmb3JjZS5VdGlsLlRvSXNvRGF0ZVRpbWUodGhpcy52YWx1ZSk7IAkJCX0JCQlicmVhazsJCQoJCWRlZmF1bHQ6CQkJeHZhbCA9IHRoaXMudmFsdWU7CQkJYnJlYWs7Cgl9CgkvL3JldHVybiAiPG5zMzoiICsgdGhpcy5uYW1lICsgIj48IVtDREFUQVsiICsgeHZhbCArICJdXT48L25zMzoiICsgdGhpcy5uYW1lICsgIj4iOyAKCWlmICh0aGlzLnBhcmVudEJlYW4uZ2V0TmFtZSgpLnRvTG93ZXJDYXNlKCkgPT0gImN1c3RvbXNldHVwIiAmJiB0aGlzLm5hbWUudG9Mb3dlckNhc2UoKSA9PSAidmFsdWUiKSB7CgkgICAgcmV0dXJuICI8IiArIHRoaXMubmFtZS50b0xvd2VyQ2FzZSgpICsgIiB4c2k6dHlwZT1cInhzZDpzdHJpbmdcIiB4bWxucz1cIlwiPjwhW0NEQVRBWyIgKyB4dmFsICsgIl1dPjwvIiArIHRoaXMubmFtZS50b0xvd2VyQ2FzZSgpICsgIj4iOyAKCX0gZWxzZSB7CgkgICAgcmV0dXJuICI8bnMzOiIgKyB0aGlzLm5hbWUgKyAiPjwhW0NEQVRBWyIgKyB4dmFsICsgIl1dPjwvbnMzOiIgKyB0aGlzLm5hbWUgKyAiPiI7IAoJfQoJCn07CgpTZm9yY2UuUHJvcGVydHkucHJvdG90eXBlLnRvRm9ybWF0dGVkVmFsdWUgPSBmdW5jdGlvbigpIHsKCWlmICh0aGlzLnR5cGUgPT0gImRhdGUiKSB7CgkJaWYgKHRoaXMudmFsdWUgIT0gbnVsbCkgewoJCQlyZXR1cm4gU2ZvcmNlLlV0aWwuRm9ybWF0RGF0ZSh0aGlzLnZhbHVlLCAiTU0vZGQveXl5eSIpOwoJCX0gZWxzZSB7CgkJCXJldHVybiAiIjsKCQl9Cgl9IGVsc2UgaWYgKHRoaXMudHlwZSA9PSAiZGF0ZXRpbWUiKSB7CgkJaWYgKHRoaXMudmFsdWUgIT0gbnVsbCkgewoJCQlyZXR1cm4gU2ZvcmNlLlV0aWwuRm9ybWF0RGF0ZSh0aGlzLnZhbHVlLCAiTU0vZGQveXl5eSBoaDptbTpzcyBhIik7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICIiOwoJCX0KCX0gZWxzZSBpZiAodGhpcy50eXBlID09ICJib29sZWFuIikgewoJCXJldHVybiB0aGlzLnZhbHVlID09IHRydWUgPyAieWVzIiA6ICJubyI7Cgl9IGVsc2UgaWYgKHRoaXMudHlwZSA9PSAiZG91YmxlIikgewoJCXJldHVybiB0aGlzLnZhbHVlID0gcGFyc2VEb3VibGUodGhpcy52YWx1ZSk7Cgl9IGVsc2UgewoJCXJldHVybiB0aGlzLnZhbHVlOwoJfQp9OwoKU2ZvcmNlLlByb3BlcnR5LnByb3RvdHlwZS50b1BpY2tMaXN0ID0gZnVuY3Rpb24oKSB7Cgl2YXIgcGx2ID0gdGhpcy5maWVsZERlZi5waWNrbGlzdFZhbHVlczsKCXZhciBzZWwgPSBTZm9yY2UuZG9jLmNyZWF0ZUVsZW1lbnQoIlNFTEVDVCIpOwoJZm9yICh2YXIgaT0wO2k8cGx2Lmxlbmd0aDtpKyspIHsKCQl2YXIgb3B0ID0gU2ZvcmNlLmRvYy5jcmVhdGVFbGVtZW50KCJPUFRJT04iKTsKCQlvcHQudmFsdWUgPSBwbHZbaV0udmFsdWU7CgkJaWYgKHBsdltpXS5sYWJlbCAhPSBudWxsICYmIHBsdltpXS5sYWJlbCAhPSAiIikgewoJCQlvcHQuYXBwZW5kQ2hpbGQoZG9jLmNyZWF0ZVRleHROb2RlKHBsdltpXS5sYWJlbCkpOwoJCX0gZWxzZSB7CgkJCW9wdC5hcHBlbmRDaGlsZChkb2MuY3JlYXRlVGV4dE5vZGUocGx2W2ldLnZhbHVlKSk7CgkJfQoJCWlmIChwbHZbaV0udmFsdWUgPT0gdGhpcy52YWx1ZSkgewoJCQlvcHQuc2VsZWN0ZWQgPSB0cnVlOwoJCX0KCQlzZWwuYXBwZW5kQ2hpbGQob3B0KTsKCX0KCXJldHVybiBzZWw7Cn0KCgpTZm9yY2UuVXRpbC5UaW1lc3RhbXBfY2xhc3MgPSBmdW5jdGlvbihjdXJyZW50X3RpbWUsIHN0YXJ0X3RpbWUsIGVuZF90aW1lLCB0aW1lX2RpZmZlcmVuY2UpIHsgCgl2YXIgdGhpc19jdXJyZW50X3RpbWUgPSBjdXJyZW50X3RpbWU7Cgl2YXIgdGhpc19zdGFydF90aW1lID0gc3RhcnRfdGltZTsKCXZhciB0aGlzX2VuZF90aW1lID0gZW5kX3RpbWU7Cgl2YXIgdGhpc190aW1lX2RpZmZlcmVuY2UgPSB0aW1lX2RpZmZlcmVuY2U7Cgl2YXIgdGltZXJTdGFjayA9IG5ldyBBcnJheSgpOwoJdmFyIF90aGlzID0gdGhpczsKCXRoaXMuR2V0Q3VycmVudFRpbWUgPSBmdW5jdGlvbigpIHsKCQl2YXIgbXlfY3VycmVudF90aW1lc3RhbXAgPSBuZXcgRGF0ZSgpOwoJCXJldHVybiBteV9jdXJyZW50X3RpbWVzdGFtcC5nZXRUaW1lKCk7Cgl9OwoJdGhpcy5TdGFydFRpbWluZyA9IGZ1bmN0aW9uICgpIHsKCQlfdGhpcy50aGlzX3N0YXJ0X3RpbWUgPSBfdGhpcy5HZXRDdXJyZW50VGltZSgpOwoJfTsKCXRoaXMuRW5kVGltaW5nID0gZnVuY3Rpb24oKSB7CgkJX3RoaXMudGhpc19lbmRfdGltZSA9IF90aGlzLkdldEN1cnJlbnRUaW1lKCk7CgkJX3RoaXMudGhpc190aW1lX2RpZmZlcmVuY2UgPSAodGhpcy50aGlzX2VuZF90aW1lIC0gdGhpcy50aGlzX3N0YXJ0X3RpbWUpIC8gMTAwMDsKCQlyZXR1cm4gX3RoaXMudGhpc190aW1lX2RpZmZlcmVuY2U7Cgl9Owp9OwpTZm9yY2UuVXRpbC50aW1lX29iamVjdCA9IG5ldyBTZm9yY2UuVXRpbC5UaW1lc3RhbXBfY2xhc3MoMCwgMCwgMCwgMCk7ClNmb3JjZS5VdGlsLlBhcnNlU2VsZWN0TGlzdEZyb21TT1FMID0gZnVuY3Rpb24oc29xbCkgewoJdmFyIHggPSBzb3FsLnN1YnN0cmluZyhzb3FsLmluZGV4T2YoIiAiKSArIDEpOwoJeCA9IHguc3Vic3RyaW5nKDAsIHgudG9Mb3dlckNhc2UoKS5pbmRleE9mKCJmcm9tIikgLSAxKTsKCXggPSB4LnNwbGl0KCIsIik7Cglmb3IgKHZhciBpPTA7aTx4Lmxlbmd0aDtpKyspIHsKCQl4W2ldID0geFtpXS50cmltKCk7Cgl9CglyZXR1cm4geDsKfTsK</fileContent>
    <fileName>sforceclient_3.3.js</fileName>
    <name>Create New Opportunity 2</name>
    <supportsCaching>true</supportsCaching>
</Scontrol>
