<apex:page controller="NI_PermissionsAuditorController" tabStyle="Permissions_Auditor__tab" sidebar="false">
    
    <apex:includeScript value="{!URLFOR($Resource.datatables, '/datatables/js/jquery-1.12.3.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.datatables, '/datatables/js/jquery.dataTables.min.js')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.datatables, '/datatables/css/jquery.dataTables.min.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.datatables, '/datatables/css/custom_datatable.css')}"/>
    
    
    <script>
        var objectData;
        $(document).ready(function() {
            getObjects();
            
            var tablexx = $('#example').dataTable({
                    "bAutoWidth": false,
                    "iDisplayLength": 10,
                    "scrollY": "400px",
                    "scrollCollapse": true,
                    "paging": false,
                    "bDeferRender": true,
                    "order": [[ 1, "asc" ]],
                    "aoColumnDefs": [{
                        'bSortable': false,
                        'aTargets': [0]
                    }],
        
                    "aoColumns": [
                        {"sTitle": "" , "mData": 'objectName',"sClass": "name","sSortDataType": "dom-text",
                           "type": "radio", "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="radio" id="'+data+'" name="radioButton"/>';
                                }
                                else return '';
                            }
                        },
                        {"sTitle": "Object" , "mData": 'objectLabel',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return data;
                                }
                                else return '';
                            }
                        }
                    ],
                    
                    showFilterBar: true,
                    
                    "fnDrawCallback": function() {
                        $("input:radio[name=radioButton]").click(function(){
                            var id = $(this).attr('id');
                            document.getElementById('selObj').value = id;
                            showObjectPermissions(id);
                        }); 
                        
                        setHeight(['expand'], 550);
                        expandSection(['showhide']);
                        
                        collapseSection(['showhide1', 'showhide2', 'showhide3']);
                        
                        setHeightValue('height1', 150);
                        setHeightValue('height2', 150);
                        setHeightValue('height3', 150);
                    } 
            });
            
            
            var tableProfile = $('#profile').dataTable({
                    "bAutoWidth": false,
                    "iDisplayLength": 20,
                    "scrollY": "300px",
                    "scrollCollapse": true,
                    "paging": false,
                    "bDeferRender": true,
                    "order": [[ 0, "asc" ]],
                    "aoColumnDefs": [{
                        'bSortable': false,
                        'aTargets': [1, 2, 3, 4, 5, 6, 7, 8]
                    }],
        
                    "aoColumns": [
                        {"sTitle": "Profile Name" , "mData": 'name',"sClass": "name","sSortDataType": "dom-text",
                           "mRender": function ( data, type, full ) {
                                if(data){
                                    //return data;
                                    return '<a href="/'+full.id+'" target="_blank">'+data+'</a>';
                                }
                                else return '';
                            }
                        },
                        {"sTitle": "Read" , "mData": 'permissionRead',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "Create" , "mData": 'permissionCreate',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "Edit" , "mData": 'permissionEdit',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "Delete" , "mData": 'permissionDelete',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "View All" , "mData": 'permissionViewAll',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "Modify All" , "mData": 'permissionModifyAll',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "Field Read" , "mData": 'permissionFieldRead',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "Field Edit" , "mData": 'permissionFieldEdit',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                    ],
                    
                    showFilterBar: true
                    
            });
            
           var tablePSet = $('#permissionSet').dataTable({
                    "bAutoWidth": false,
                    "iDisplayLength": 10,
                    "scrollY": "300px",
                    "scrollCollapse": true,
                    "paging": false,
                    "bDeferRender": true,
                    "order": [[ 0, "asc" ]],
                    "aoColumnDefs": [{
                        'bSortable': false,
                        'aTargets': [1, 2, 3, 4, 5, 6, 7, 8]
                    }],
        
                    "aoColumns": [
                        {"sTitle": "Permission Set Name" , "mData": 'name',"sClass": "name","sSortDataType": "dom-text",
                           "mRender": function ( data, type, full ) {
                                if(data){
                                    //return data;
                                    return '<a href="/'+full.id+'" target="_blank">'+data+'</a>';
                                }
                                else return '';
                            }
                        },
                        {"sTitle": "Read" , "mData": 'permissionRead',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "Create" , "mData": 'permissionCreate',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "Edit" , "mData": 'permissionEdit',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "Delete" , "mData": 'permissionDelete',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "View All" , "mData": 'permissionViewAll',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "Modify All" , "mData": 'permissionModifyAll',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "Field Read" , "mData": 'permissionFieldRead',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                        ,
                        {"sTitle": "Field Edit" , "mData": 'permissionFieldEdit',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return '<input type="checkbox" checked="'+data+'" disabled="true"/>';
                                }
                                else return '<input type="checkbox" disabled="true"/>';
                            }
                        }
                    ],
                    showFilterBar: true
            });
            
            var tableUserInfo = $('#userInfo').DataTable({
                    "bAutoWidth": false,
                    "iDisplayLength": 10,
                    "scrollY": "300px",
                    "processing": true,
                    "scrollCollapse": true,
                    "paging": false,
                    "bDeferRender": true,
                    "order": [[ 1, "asc" ]],
                    "aoColumnDefs": [{
                        'bSortable': false,
                        'aTargets': [0, 2]
                    }],
        
                    "aoColumns": [
                        {
                            "class": "details-control","orderable": false, "data": null, "defaultContent": ""
                        },
                        {"sTitle": "User Name" , "mData": 'userName',"sClass": "name","sSortDataType": "dom-text",
                           "mRender": function ( data, type, full ) {
                                if(data){
                                    //return data;
                                    return '<a href="/'+full.id+'?noredirect=1" target="_blank">'+data+'</a>';
                                }
                                else return '';
                            }
                        },
                        {"sTitle": "Profile" , "mData": 'profileName',"sClass": "name","sSortDataType": "dom-text",
                                "mRender": function ( data, type, full ) {
                                if(data){
                                    return data;
                                }
                                else return '';
                            }
                        }
                    ],
                    showFilterBar: true
            });
            
            // Array to track the ids of the details displayed rows
            var detailRows = [];
         
            $('#userInfo tbody').on( 'click', 'tr td.details-control', function () {
                var tr = $(this).closest('tr');
                var row = tableUserInfo.row( tr );
                var idx = $.inArray( tr.attr('id'), detailRows );
         
                if ( row.child.isShown() ) {
                    tr.removeClass( 'details' );
                    row.child.hide();
         
                    // Remove from the 'open' array
                    detailRows.splice( idx, 1 );
                }
                else {
                    tr.addClass( 'details' );
                    row.child( format( row.data() ) ).show();
         
                    // Add to the 'open' array
                    if ( idx === -1 ) {
                        detailRows.push( tr.attr('id') );
                    }
                }
            } );
         
            // On each draw, loop over the `detailRows` array and show any child rows
            tableUserInfo.on( 'draw', function () {
                $.each( detailRows, function ( i, id ) {
                    $('#'+id+' td.details-control').trigger( 'click' );
                } );
            } );
         
        function showObjectPermissions(objId){
            $(".loader").fadeIn("slow");
            var size = size1 = size2 = 0;
            
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.NI_PermissionsAuditorController.findObjectPermissions}',
                objId, 
                function(result, event){
                    if(event.status){
                        objectData = result;
                        $('#fields_id').html('') ;
                        var str=$('#fields_id').html();
                        str+='<option value=""></option>'
                        $.each(result[0].fieldsList, function(index, obj){
                              str+='<option value="'+obj.fieldName+'">'+obj.fieldLabel+'</option>'
                        });
                        $('#fields_id').html(str);
                    
                        $('#profile').dataTable().fnClearTable(); 
                        var profileObj = result[0].permissionsObj[0];
                        var psetObj = result[1].permissionsObj[0];
                        var userObj = result[0].userInfoList[0];
                        
                        if(profileObj != null){
                            $('#profile').dataTable().fnAddData(result[0].permissionsObj);
                            size = result[0].permissionsObj.length;
                        }
                        
                        $('#permissionSet').dataTable().fnClearTable();
                        if(psetObj != null){
                            $('#permissionSet').dataTable().fnAddData(result[1].permissionsObj);
                            size1 = result[1].permissionsObj.length;
                        }
                        
                        $('#userInfo').dataTable().fnClearTable();
                        if(userObj != null){
                            $('#userInfo').dataTable().fnAddData(result[0].userInfoList);
                            size2 = result[0].userInfoList.length;
                        }
                        
                        setHeightValue('height1', calculateHeight(size));
                        setHeightValue('height2', calculateHeight(size1));
                        setHeightValue('height3', calculateHeight(size2));
                        
                        setHeight(['expand1'], calculateHeight(size));
                        expandSection(['showhide1']);
                        
                        var sectionIds = ['expand', 'expand2', 'expand3'];
                        setHeight(sectionIds, 0);
                        
                        var collapseIds = ['showhide', 'showhide2', 'showhide3'];
                        collapseSection(collapseIds);
                        
                        $(".loader").fadeOut("slow");
                    }
                }
            );
           
        }
        
        $("#showhide").click(function(){
            if($('#expand').height() == 550){
                setHeight(['expand'], 0);
                collapseSection(['showhide']);
            }
            else{
                setHeight(['expand'], 550);
                expandSection(['showhide']);
            }
        });
        
        $("#showhide1").click(function(){
            if($('#expand1').height() != 0){
                setHeight(['expand1'], 0);
                collapseSection(['showhide1']);
            }
            else{
                var hgt = $('#height1').val();
                setHeight(['expand1'], hgt);
                expandSection(['showhide1']);
            }
        });
        
        $("#showhide2").click(function(){
            if($('#expand2').height() != 0){
                setHeight(['expand2'], 0);
                collapseSection(['showhide2']);
            }
            else{
                var hgt = $('#height2').val();
                setHeight(['expand2'], hgt);
                expandSection(['showhide2']);
            }
        });
        
        $("#showhide3").click(function(){
            if($('#expand3').height() != 0){
                setHeight(['expand3'], 0);
                collapseSection(['showhide3']);
            }
            else{
                var hgt = $('#height3').val();
                setHeight(['expand3'], hgt);
                expandSection(['showhide3']);
            }
        });
        
        function getObjects(){
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.NI_PermissionsAuditorController.findObjectList}',
                function(result, event){
                    if(event.status){
                        $('#example').dataTable().fnClearTable();
                        $('#example').dataTable().fnAddData(result);
                    }
                    $(".loader").fadeOut("slow");
                }
            )
        }
        
        } );
        
        function calculateHeight(size){
            var hgt = size * 50;
            if(hgt > 420){
                hgt = 420;
            }
            else if(hgt < 250 && hgt >= 100){
                hgt = 250;
            }
            else if(hgt <= 100){
                hgt = 150;
            }
            return hgt;
        }   
        
        function setHeight(sectionIds, hgt){
            $.each(sectionIds, function(Index, val){
                $('#'+val).height(hgt);
            });
        }
        
        function setHeightValue(id, hgt){
            $('#'+id).val(hgt);
        }
        
        function collapseSection(sectionIds){
            $.each(sectionIds, function(Index, val){
                $('#'+val).removeClass("closeImg");
                $('#'+val).addClass("openImg");
            });
        }
        
        function expandSection(sectionIds){
            $.each(sectionIds, function(Index, val){
                $('#'+val).removeClass("openImg");
                $('#'+val).addClass("closeImg");
            });
        }
        
        function format ( d ) {
            var inrTable = '<table border="0" cellpadding="0" cellspacing="0" class="display dataTable no-footer" style="overflow: auto; width: 100%;" role="grid" aria-describedby="permissionSet_info">'
            inrTable += '<thead><tr role="row" style="height: 0px;">';
            inrTable += '<th class="name sorting_asc" colspan="1" style="padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px; width: 267px;">';
            inrTable += '<div style="padding: 8px 10px;">Profile/Permission Set Name</div></th>';
            inrTable += '<th class="name" colspan="1" style="padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px; width: 267px;">';
            inrTable += '<div style="padding: 8px 10px;">Type</div></th>';
            inrTable += '<th class="name sorting_disabled" rowspan="1" colspan="1" aria-label="Read" style="padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px; height: 0px; width: 51px;">';
            inrTable += '<div style="padding: 8px 10px;">Read</div></th>';
            inrTable += '<th class="name sorting_disabled" rowspan="1" colspan="1" aria-label="Create" style="padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px; height: 0px; width: 63px;">';
            inrTable += '<div style="padding: 8px 10px;">Create</div></th>';
            inrTable += '<th class="name sorting_disabled" rowspan="1" colspan="1" aria-label="Edit" style="padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px; height: 0px; width: 41px;">';
            inrTable += '<div style="padding: 8px 10px;">Edit</div></th>';
            inrTable += '<th class="name sorting_disabled" rowspan="1" colspan="1" aria-label="Delete" style="padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px; height: 0px; width: 61px;">';
            inrTable += '<div style="padding: 8px 10px;">Delete</div></th>';
            inrTable += '<th class="name sorting_disabled" rowspan="1" colspan="1" aria-label="View All" style="padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px; height: 0px; width: 72px;">';
            inrTable += '<div style="padding: 8px 10px;">View All</div></th>';
            inrTable += '<th class="name sorting_disabled" rowspan="1" colspan="1" aria-label="Modify All" style="padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px; height: 0px; width: 86px;">';
            inrTable += '<div style="padding: 8px 10px;">Modify All</div></th>';
            inrTable += '<th class="name sorting_disabled" rowspan="1" colspan="1" aria-label="Field Read" style="padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px; height: 0px; width: 92px;">';
            inrTable += '<div style="padding: 8px 10px;">Field Read</div></th>';
            inrTable += '<th class="name sorting_disabled" rowspan="1" colspan="1" aria-label="field Edit" style="padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; border-bottom-width: 0px; height: 0px; width: 78px;">';
            inrTable += '<div style="padding: 8px 10px;">Field Edit</div>';
            inrTable += '</th></tr></thead><tbody>';
            
            $.each(d.permissionsList, function(index, value){
                
                inrTable += '<tr role="row" class="odd">';
                inrTable += '<td class="name sorting_1">'+value.name+'</td>';
                inrTable += '<td class="name">'+value.type+'</td>';
                inrTable += '<td class="name">';
                if(value.permissionRead == true){
                    inrTable += '<input type="checkbox" checked="true" disabled="true">';
                }
                else{
                    inrTable += '<input type="checkbox" disabled="true">';
                }
                inrTable += '</td>';
                
                inrTable += '<td class="name">';
                if(value.permissionCreate == true){
                    inrTable += '<input type="checkbox" checked="true" disabled="true">';
                }
                else{
                    inrTable += '<input type="checkbox" disabled="true">';
                }
                inrTable += '</td>';
                
                inrTable += '<td class="name">';
                if(value.permissionEdit == true){
                    inrTable += '<input type="checkbox" checked="true" disabled="true">';
                }
                else{
                    inrTable += '<input type="checkbox" disabled="true">';
                }
                inrTable += '</td>';
                
                inrTable += '<td class="name">';
                if(value.permissionDelete == true){
                    inrTable += '<input type="checkbox" checked="true" disabled="true">';
                }
                else{
                    inrTable += '<input type="checkbox" disabled="true">';
                }
                inrTable += '</td>';
                
                inrTable += '<td class="name">';
                if(value.permissionViewAll == true){
                    inrTable += '<input type="checkbox" checked="true" disabled="true">';
                }
                else{
                    inrTable += '<input type="checkbox" disabled="true">';
                }
                inrTable += '</td>';
                
                inrTable += '<td class="name">';
                if(value.permissionModifyAll == true){
                    inrTable += '<input type="checkbox" checked="true" disabled="true">';
                }
                else{
                    inrTable += '<input type="checkbox" disabled="true">';
                }
                inrTable += '</td>';
                
                inrTable += '<td class="name">';
                if(value.permissionFieldRead == true){
                    inrTable += '<input type="checkbox" checked="true" disabled="true">';
                }
                else{
                    inrTable += '<input type="checkbox" disabled="true">';
                }
                inrTable += '</td>';
                
                inrTable += '<td class="name">';
                if(value.permissionFieldEdit == true){
                    inrTable += '<input type="checkbox" checked="true" disabled="true">';
                }
                else{
                    inrTable += '<input type="checkbox" disabled="true">';
                }
                inrTable += '</td></tr>';
            });
            
            inrTable += '</tbody></table>';
            
            return inrTable;
        }
        
        function showFieldPermissions(){
            $(".loader").fadeIn("slow");
            var fieldName = $("#fields_id option:selected").val();
            var objName = document.getElementById('selObj').value;
           Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.NI_PermissionsAuditorController.findFieldLevelPermissions}',
                objName, fieldName, objectData, 
                function(result, event){
                    if(event.status){
                        
                        $('#profile').dataTable().fnClearTable(); 
                        var profileObj = result[0].permissionsObj[0];
                        var psetObj = result[1].permissionsObj[0];
                        var userObj = result[0].userInfoList[0];
                        
                        if(profileObj != null){
                            $('#profile').dataTable().fnAddData(result[0].permissionsObj);
                        }
                        
                        $('#permissionSet').dataTable().fnClearTable();
                        if(psetObj != null){
                            $('#permissionSet').dataTable().fnAddData(result[1].permissionsObj);
                        }
                        
                        if(userObj != null){
                            updateUserPermissions(result[0].permissionsMap, result[0].userInfoList);
                        }
                        
                        //$('#showhide').removeClass("closeImg");
                        //$('#showhide').addClass("openImg");
                        setHeight(['expand'], 0);
                        collapseSection(['showhide']);

                        var hgt = $('#height1').val();
                        /*$('#expand1').height(hgt);
                        $('#showhide1').removeClass("openImg");
                        $('#showhide1').addClass("closeImg");
                        */
                        setHeight(['expand1'], hgt);
                        expandSection(['showhide1']);
                        
                        /*$('#expand2').height(0);
                        $('#showhide2').removeClass("closeImg");
                        $('#showhide2').addClass("openImg");
                        */
                        setHeight(['expand2'], 0);
                        collapseSection(['showhide2']);

                        /*$('#expand3').height(0);
                        $('#showhide3').removeClass("closeImg");
                        $('#showhide3').addClass("openImg");
                        */
                        setHeight(['expand3'], 0);
                        collapseSection(['showhide3']);

                        $(".loader").fadeOut("slow");
                        
                    }
                }, {timeout: 120000 }
            );
            
        }
        
        function updateUserPermissions(permissionsMap, userInfoList){
            
            Visualforce.remoting.Manager.invokeAction(
                '{!$RemoteAction.NI_PermissionsAuditorController.updateUsersPermissions}',
                permissionsMap, userInfoList, 
                function(result, event){
                    if(event.status){
                        $('#userInfo').dataTable().fnClearTable();
                        $('#userInfo').dataTable().fnAddData(result);
                    }
                }, {timeout: 120000 }
            );
        }
    </script>
    <html>
        <body>
            <apex:form >
                <input type="hidden" id="selObj" />
                <input type="hidden" id="height1"/>
                <input type="hidden" id="height2"/>
                <input type="hidden" id="height3"/>
                
                <div class="loader"></div>
                <apex:pageBlock >
                    <apex:pageBlockSection title="Object Selection Panel" columns="1" collapsible="false">
                        <input id="toggle" type="checkbox" checked="true"></input>
                        <label id="showhide" for="toggle"></label>
                        <div id="expand">
                            <section>
                                <br/>
                                <table id="example" cellpadding="0" cellspacing="0" border="0" class="display " style="overflow:auto;" >
                                </table>
                            </section>
                        </div>
                        <div style="padding-left:3%;">
                            <label>Select Field </label>
                            <select id="fields_id" onchange="showFieldPermissions()">
                                <option value=""></option>
                            </select>
                        </div>
                    </apex:pageBlockSection>
                    <apex:pageBlockSection title="Profile Level Permissions" columns="1" collapsible="false">
                        <input id="toggle1" type="checkbox" checked="true"></input>
                        <label id="showhide1" for="toggle1"></label>
                        <div id="expand1">
                            <section>
                                <table id="profile" cellpadding="0" cellspacing="0" border="0" class="display" style="overflow:auto;" >
                                </table>
                            </section>
                        </div>
                        
                    </apex:pageBlockSection>
                    <apex:pageBlockSection title="Permission Set Permissions" columns="1" collapsible="false">
                        <input id="toggle2" type="checkbox" checked="true"></input>
                        <label id="showhide2" for="toggle2"></label>
                        <div id="expand2">
                            <section>
                                <table id="permissionSet" cellpadding="0" cellspacing="0" border="0" class="display" style="overflow:auto;" >
                                </table>
                            </section>
                        </div>
                        
                    </apex:pageBlockSection>
                    <apex:pageBlockSection title="User Info" columns="1" collapsible="false">
                        <input id="toggle3" type="checkbox" checked="true"></input>
                        <label id="showhide3" for="toggle3"></label>
                        <div id="expand3">
                            <section>
                                <table id="userInfo" cellpadding="0" cellspacing="0" border="0" class="display" style="overflow:auto;" >
                                </table>
                            </section>
                        </div>
                        
                    </apex:pageBlockSection>
              </apex:pageBlock>
              </apex:form>
        </body>
    </html>
</apex:page>