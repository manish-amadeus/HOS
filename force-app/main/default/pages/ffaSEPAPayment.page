<apex:page standardController="c2g__codaPayment__c" extensions="ffaSEPAPaymentController" contentType="text/xml" showHeader="false" sidebar="false" cache="false">
<apex:outputText value="{!xmlDeclaration}" rendered="{!sepaEligible}"/>
	<apex:messages />

    <apex:outputText rendered="{!sepaEligible}">
<Document xmlns="urn:iso:std:iso:20022:tech:xsd:pain.001.001.03" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<CstmrCdtTrfInitn>
		<!-- Group Header -->
		<GrpHdr> 
			<MsgId>{!messageId}</MsgId> <!-- Number of Transactions + Date / Time Creation Date -->
		    <CreDtTm>{!createdDateTime}</CreDtTm> <!-- Date / Time Creation Date -->
		    <NbOfTxs>{!numberofTransactions}</NbOfTxs> <!-- Count of Transactions -->
		    <CtrlSum>{!payment.Positive_Payment_Value__c}</CtrlSum>
			<InitgPty>
		    	<Nm>{!payment.c2g__OwnerCompany__r.Name}</Nm> <!-- company name -->
		    </InitgPty>
		</GrpHdr>
		<!-- Payment Info -->
		<PmtInf>
			<PmtInfId>{!payment.Name}</PmtInfId>
	      	<PmtMtd>TRF</PmtMtd>
	      	<BtchBookg>true</BtchBookg>
	      	<NbOfTxs>{!numberofTransactions}</NbOfTxs>
	      	<CtrlSum>{!payment.Positive_Payment_Value__c}</CtrlSum>
	      	<PmtTpInf>
	        	<InstrPrty>NORM</InstrPrty>
	        	<SvcLvl>
	          		<Cd>SEPA</Cd>
	        	</SvcLvl>
	      	</PmtTpInf>
	      	<ReqdExctnDt>{!paymentDate}</ReqdExctnDt>
	      	<Dbtr>
	        	<Nm>ITESSO BV</Nm>
	        	<PstlAdr>
	          		<Ctry>NL</Ctry>
	          		<AdrLine>Chass veld 15G</AdrLine>
	          		<AdrLine>4811 DH Breda</AdrLine>
	        	</PstlAdr>
	      	</Dbtr>
	      	<DbtrAcct>
	        <Id>
	          <IBAN>{!payment.c2g__BankAccount__r.c2g__IBANNumber__c}</IBAN>
	        </Id>
	        <Ccy>{!payment.Payment_Currency_Code__c}</Ccy>
	      	</DbtrAcct>
	      	<DbtrAgt>
	        	<FinInstnId>
	          		<BIC>{!payment.c2g__BankAccount__r.c2g__SWIFTNumber__c}</BIC>
	        	</FinInstnId>
	      	</DbtrAgt>
	      	<ChrgBr>SLEV</ChrgBr>

    		<!-- Repeat for Each Payment Detail -->
    		<apex:repeat value="{!paymentMediaSummaryList}" var="pms"> 
	    		<CdtTrfTxInf>
			        <PmtId>
			          <EndToEndId>{!pms.Name}</EndToEndId>
			        </PmtId>
			        <Amt>
			          <InstdAmt Ccy="EUR">{!pms.Positive_Payment_Value__c}</InstdAmt>
			        </Amt>
			        <CdtrAgt>
			          <FinInstnId>
			            <BIC>{!pms.c2g__BankSwiftNumber__c}</BIC>
			          </FinInstnId>
			        </CdtrAgt>
			        <Cdtr>
			          <Nm>{!pms.ffbf__AccountName__c}</Nm>
			          <PstlAdr>
			            <Ctry>{!pms.c2g__BillingCountry__c}</Ctry>
			            <AdrLine>{!pms.ffbf__AccountBillingAddress__c}</AdrLine>
			            <AdrLine>{!pms.ffbf__AccountBankCity__c} {!pms.ffbf__AccountBankZipPostalCode__c}</AdrLine>
			          </PstlAdr>
			        </Cdtr>
			        <CdtrAcct>
			          <Id>
			            <IBAN>{!pms.ffbf__AccountBankIBANNumber__c}</IBAN>
			          </Id>
			        </CdtrAcct>
			        <RmtInf>
			          <Ustrd>{!pms.c2g__PaymentMediaControl__r.c2g__Payment__r.Name}</Ustrd>
			        </RmtInf>
			    </CdtTrfTxInf>
			</apex:repeat><!-- End Repeat -->
		</PmtInf>
	</CstmrCdtTrfInitn>
</Document>

</apex:outputText>
</apex:page>