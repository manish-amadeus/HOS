<apex:page controller="AH_MilestoneSummation_Cntrl" >
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    
    <script type="text/javascript">

        function showLoadingModal()
        {
            $("#spinner").css({"display":"inline"});
        }
    
        function hideLoadingModal()
        {
            $("#spinner").css({"display":"none"});
        }
    
    </script>
    
    <div class="modal" id="spinner">
        <div class="box">
            <img src="/img/loading.gif" alt="Saving"/><i id="spinner-label" style="padding-left:5px">Loading...</i>
        </div>
    </div>
    
    <apex:form id="frm">
        <apex:pageBlock id="pb1" title="Schedule Services Scrum Snapshot">
            
            <apex:pageMessages id="msg1"/> 
            
            <apex:pageBlockSection title="Enter filter criteria and Schedule Job">
                
                <apex:pageBlockSectionItem helpText="Enter value to filter milestones that have Milestone Amount greater than this value.">
                    <apex:outputLabel value="Milestone Amount"/>
                    <apex:inputField value="{!milestoneSettings.Milestone_Amount__c}" required="false" label="Milestone Amount" />
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="Enter comma separated values of Milestone Names to filter milestones that does not contain these values.">
                    <apex:outputLabel value="Milestone Name"/>
                    <apex:inputField value="{!milestoneSettings.Milestone_Name__c}" required="false" label="Milestone Name" />
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="Enter comma separated values of milestone types to filter milestones of this type.">
                    <apex:outputLabel value="Milestone Type"/>
                    <apex:inputField value="{!milestoneSettings.Milestone_Type__c}" required="false" label="Milestone Type" />
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="Enter comma separated values to filter milestones whose project names does not contain these values">
                    <apex:outputLabel value="Project Name"/>
                    <apex:inputField value="{!milestoneSettings.Project_Name__c}" required="false" label="Project Name" />
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="Enter comma separated values, these values will be considered in filter criteria.">
                    <apex:outputLabel value="Project Type"/>
                    <apex:inputField value="{!milestoneSettings.Project_Type__c}" required="false" label="Project Type" />
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="Enter comma separated values to filter milestones that contains target period.">
                    <apex:outputLabel value="Target Period"/>
                    <apex:inputField value="{!milestoneSettings.Target_Period__c}" required="false" label="Target Period" />
                </apex:pageBlockSectionItem>
                
                <apex:commandButton value="Schedule Job" action="{!callSchedulableClass}" reRender="pb1" onclick="showLoadingModal();" oncomplete="hideLoadingModal();" disabled="{!showSchMessage}"/>
                <apex:commandButton value="Abort Scheduled Job" action="{!abortScheduledJob}" reRender="pb1" onClick="showLoadingModal();" oncomplete="hideLoadingModal();"/>
                
            </apex:pageBlockSection>
            
        </apex:pageBlock>
        
        <apex:pageBlock id="pb2" title="Run History" rendered="{!asyncJobList.size > 0}">
            <apex:pageBlockSection title="Last 5 run" columns="1">
                <apex:pageBlockTable value="{!asyncJobList}" var="aj">
                    <apex:column headerValue="Apex Class" value="{!aj.ApexClassId}"></apex:column>
                    <apex:column headerValue="Target Object">Services Scrum - Snapshot</apex:column>
                    <apex:column headerValue="Status" value="{!aj.Status}"></apex:column>
                    <apex:column headerValue="Running User" value="{!aj.CreatedBy.Name}"></apex:column>
                    <apex:column headerValue="Completed Run Time" value="{!aj.CompletedDate}"></apex:column>
                    <apex:column headerValue="Status Detail" value="{!aj.ExtendedStatus}"></apex:column>
                    <apex:column headerValue="Total Batches" value="{!aj.TotalJobItems}"></apex:column>
                    <apex:column headerValue="Batches Processed" value="{!aj.JobItemsProcessed}"></apex:column>
                    <apex:column headerValue="Failures" value="{!aj.NumberOfErrors}"></apex:column>
                </apex:pageBlockTable>
            </apex:pageBlockSection>
            
        </apex:pageBlock>
    </apex:form>
    
    <style>
        .modal 
        {
            display: none;
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background:rgba( 255, 255, 255, .8 )
            50% 50%
            no-repeat;
        }
        .box 
        {
            background-color: white;
            border-radius: 10px;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            box-shadow: 0 0 20px 0 #222;
            -webkit-box-shadow: 0 0 20px 0 #222;
            -moz-box-shadow: 0 0 20px 0 #222;
            position: fixed;
            top: 50%;
            left: 50%;
            margin-top: -50px;
            margin-left: -100px;
            height: 80px;
            width: 240px;
            padding-top: 35px;
            text-align: center;
        }
    </style>
    
</apex:page>