<apex:page controller="AH_PLCM_Property" action="{!CheckTermsAndConditionStatus}">
    <head>
        <!-- Include CSS -->
        <apex:stylesheet value="{!$Resource.AH_PLCM_Style}" />
        <apex:stylesheet value="{!$Resource.AH_PLCM_Bubble}" />

        <!-- Include JS -->
        <apex:includeScript value="{!$Resource.AH_PLCM_JQuery_341}" />
        <apex:includeScript value="{!$Resource.AH_PLCM_JQuery_FloatThead_Min}" />

        <style type="text/css">
            .help-show .tbl-multi-select {
                width: 92% !important;
            }
            .td-lbl {
                text-align:right;
                vertical-align:inherit;
                padding-right: 5px;
            }
            .timezone-bubble::before {
                left: 255px !important;
            }

            .homeTab .timezone-bubble::before {
                left: 327px !important;
            }

            .left-bar-show.help-show .timezone-bubble::before {
                left: 380px !important;
            }
            .chk-bubble-icon::before {
                left: 0px !important;
                top: -11% !important
            }

            /* Responsive CSS for Bubble Pop Ups :: Start */
            @media only screen and (min-width: 1441px) { /* Large Screen */
                .header-bubble {
                    left: {!IF(ProjectPortalStatus.IsPropertyUpdated, 20, 41)}% !important;
                }

                .help-show .header-bubble {
                    left: {!IF(ProjectPortalStatus.IsPropertyUpdated, 20, 34)}% !important;
                }
                
                .left-bar-show .header-bubble {
                    left: {!IF(ProjectPortalStatus.IsPropertyUpdated, 20, 53)}% !important;
                }
                
                .left-bar-show.help-show .header-bubble {
                    left: {!IF(ProjectPortalStatus.IsPropertyUpdated, 20, 45)}% !important;
                }
                
                .timezone-bubble {
                    right: 11% !important;
                }

                .help-show .timezone-bubble {
                    right: 9% !important;   
                }
                
                .left-bar-show.help-show .timezone-bubble {
                    right: 20% !important;  
                }
            }

            @media only screen and (max-width: 1440px) { /* Medium Screen */
                .header-bubble {
                    left: {!IF(ProjectPortalStatus.IsPropertyUpdated, 140, 550)}px;
                }

                .homeTab .header-bubble {
                    left: {!IF(ProjectPortalStatus.IsPropertyUpdated, 125, 500)}px;
                }

                .left-bar-show .header-bubble { left:{!IF(ProjectPortalStatus.IsPropertyUpdated, 140, 680)}px !important; }

                .left-bar-show.help-show .header-bubble { left:{!IF(ProjectPortalStatus.IsPropertyUpdated, 95, 595)}px !important; }

                .help-show .header-bubble { left:{!IF(ProjectPortalStatus.IsPropertyUpdated, 125, 445)}px !important; }

                .help-show.homeTab .header-bubble { left:{!IF(ProjectPortalStatus.IsPropertyUpdated, 85, 390)}px !important; }

                .timezone-bubble { right: {!IF(lstProperties.size == 1, 170, 40)}px; }

                .homeTab .timezone-bubble { right: 121px; }

                .homeTab.help-show .timezone-bubble { right: 58px; }

                .help-show .timezone-bubble {
                    right: {!IF(lstProperties.size == 1, 75, 20)}px !important;
                }

                .left-bar-show.help-show .timezone-bubble {
                    right: {!IF(lstProperties.size == 1, -10, 20)}px !important;
                }

                .left-bar-show .timezone-bubble {
                    right: {!IF(lstProperties.size == 1, 135, 40)}px !important;
                }
            }
            /* Responsive CSS for Bubble Pop Ups :: End */
        </style>
    </head>
    <apex:form id="frmProperty">
        <!-- set project id in hidden field for next post back -->
        <input type="hidden" id="hdnProjectId" name="ProjectId" value="{!ProjectId}" />
        
        <!-- Progressbar :: Start -->
        <c:AH_PLCM_Progress_Bar IsPropertyUpdated="{!ProjectPortalStatus.IsPropertyUpdated}" IsUsersCreated="{!ProjectPortalStatus.IsUsersCreated}"
        IsXrefCompleted="{!ProjectPortalStatus.IsXrefCompleted}" PerecentageCompleted="{!ProjectPortalStatus.PerecentageCompleted}" />
        <!-- Progressbar :: End -->

        <div style="width:100%; padding:0px;">
            <div class="error-msg">Please fill below required fields to proceed.</div>
            <div class="main-div">
                <div class="main-header">
                    <table class="tbl-header" border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td class="td-title">
                                    <h2 class="main-title">Property Information</h2>
                                </td>
                                <td style="text-align: right; padding-right: 10px !important;">
                                    <input type="submit" value="Take Tutorial" onclick="javacsript: showBubble(0);return false;" class="btn-common" />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="main-body">
                    <table class="tbl-multi-select" border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td colspan="3" style="text-align:center;">
                                    <h1>Multi-Select</h1>
                                </td>
                            </tr>
                            <tr>
                                <td class="td-lbl">
                                    <b>Set Default Time Zone for Multiple Properties: </b>
                                </td>
                                <td style="text-align:left;">
                                    <select name="ddlDefaultTimezone" class="position-relative" id="ddlDefaultTimezone" style="min-width:500px;">
                                        <option value="">--None--</option>
                                    </select>
                                    <div id="divBubblePopup_2" class="bubble-popup">
                                        <div class="property-name-bubble header-bubble">
                                            <section class="bbl-header-text">Time Zone &amp; Currency Multi Select</section>
                                            <input id="button" type="button" onclick="javascript:skipBubble();" value="X"  class="btn-close-bubble"/>
                                            <br/>            
                                            This section allows you to assign a single Time Zone and/or Currency to multiple properties in the new application. Start by choosing the desired Time Zone or Currency.<br/><br/><br/>
                                            <input type="button" value="Previous" style="float:Left" onclick="javascript:showBubble(1);"/>
                                            <label class="lbl-bbl-numbers">3 of {!IF(lstProperties.size == 1, 5, 6)}</label>                                            
                                            <input type="button" value="Continue" style="float:right" onclick="javascript:showBubble({!IF(lstProperties.size == 1, 4, 3)});" />
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="td-lbl">
                                    <b>Set Default Currency for Multiple Properties: </b>
                                </td>
                                <td style="text-align:left;">
                                    <select name="ddlDefaultCurrency" id="ddlDefaultCurrency" style="min-width:265px;">
                                        <option value="">--None--</option>
                                    </select>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div id="divTable" class="data-grid-wrapper">
                        <table id="dataGrid" class="data-grid" border="0" cellpadding="0" cellspacing="0">
                            <thead>
                                <tr class="header-row">
                                    <th style="text-align: center; {!IF(lstProperties.size == 1, 'display: none;', '')}">
                                        <label>Select All</label>
                                        <input id="chkSelectAll" type="checkbox" style="vertical-align: middle;" />
                                    </th>
                                    <th>Property Name</th>
                                    <th>Site Name</th>
                                    <th>City</th>
                                    <th>State</th>
                                    <th>Time Zone</th>
                                    <th>Currency</th>
                                </tr>
                            </thead>
                            <tbody>
                                <apex:variable var="index" value="{!0}" />
                                <apex:repeat value="{!lstProperties}" var="property">
                                    <tr class="data-row" onmouseover="if (window.hiOn){hiOn(this);} " onmouseout="if (window.hiOff){hiOff(this);} " onblur="if (window.hiOff){hiOff(this);}" onfocus="if (window.hiOn){hiOn(this);}">
                                        <td style="text-align: center; {!IF(lstProperties.size == 1, 'display: none;', '')}">
                                            <input type="checkbox" class="chk-copy" />
                                            <apex:outputPanel rendered="{!(index == 0)}">
                                                <div class="bubble-popup" id="divBubblePopup_3">
                                                    <div class="property-name-bubble chk-bubble-icon" style="text-align: left !important; left: 23px;">
                                                        <section class="bbl-header-text">Property Selection</section>
                                                        <input id="button" type="button" onclick="javascript:skipBubble();" value="X"  class="btn-close-bubble"/>
                                                        <br/>
                                                        Next, select the individual properties to assign the chosen Time Zone and/or Currency using the checkboxes provided.<br/><br/><br/>
                                                        <input onclick="javascript:showBubble(2);" style="float:Left" type="button" value="Previous" />
                                                        <label class="lbl-bbl-numbers">{!IF(lstProperties.size == 1, 3, 4)} of {!IF(lstProperties.size == 1, 5,6)}</label>                                                    
                                                        <input onclick="javascript:showBubble(4);" style="float:right" type="button" value="Continue" />
                                                    </div>
                                                </div>
                                            </apex:outputPanel>
                                        </td>
                                        <td>
                                            {!property.Name}

                                            <!--Bubble Help Popup For Property Name Column-->
                                            <apex:outputPanel rendered="{!(index == 0)}">
                                                <div class="bubble-popup" id="divBubblePopup_1">
                                                    <div class="property-name-bubble">
                                                        <section class="bbl-header-text">Property Confirmation</section>
                                                        <input id="button" type="button" onclick="javascript:skipBubble();" value="X" class="btn-close-bubble"/>
                                                        <br/>
                                                        Please confirm the list of properties that are to be migrated. For more information refer to the Help content on the right side of this page.<br /><br /><br />
                                                        <div>
                                                            <input onclick="javascript:showBubble(0);" style="float:Left" type="button" value="Previous" />
                                                            <label class="lbl-bbl-numbers">{!IF(lstProperties.size == 1, 2, 2)} of {!IF(lstProperties.size == 1, 5,6)}</label>                                                        
                                                            <input onclick="javascript:showBubble(2);" style="float:right" type="button" value="Continue" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </apex:outputPanel>
                                        </td>
                                        <td>{!property.Site_Name__c}</td>
                                        <td>{!property.Property_City__c}</td>
                                        <td>{!property.Property_State__c}</td>
                                        <td>
                                            <div class="requiredInput">
                                                <div class="requiredBlock" style="{!IF(ProjectPortalStatus.IsPropertyUpdated == true, 'display:none;', '')}"></div>
                                                <apex:inputField id="ddlTimeZone" onchange="javascript:checkIfEmpty(this);" styleClass="ddl-time-zone" value="{!property.Property_Time_Zone__c}"></apex:inputField>
                                            </div>
                                            <apex:outputPanel rendered="{!(index == 0)}">
                                            <!--Bubble Help Popup For Currency-->
                                                <div id="divBubblePopup_4" class="bubble-popup" >
                                                    <div class="property-name-bubble timezone-bubble">
                                                        <section class="bbl-header-text">Time Zone &amp; Currency Single Select</section>
                                                        <input id="button" type="button" onclick="javascript:skipBubble();" value="X" class="btn-close-bubble"/>
                                                        <br/>
                                                        Individual properties can be updated separately in each property row. For more information refer to the Help content on the right side of this page. <br/><br/><br/>
                                                        <input type="button" value="Previous" style="float:Left" onclick="javascript:showBubble({!IF(lstProperties.size == 1, 2, 3)});"/>                                                    
                                                        <label class="lbl-bbl-numbers">{!IF(lstProperties.size == 1, 4, 5)} of {!IF(lstProperties.size == 1, 5,6)}</label>
                                                        <input type="button" value="Continue" style="float:right" onclick="javascript:showBubble(5);" />
                                                    </div>
                                                </div>
                                            </apex:outputPanel>
                                        </td>
                                        <td>
                                            <div class="requiredInput">
                                                <div class="requiredBlock" style="{!IF(ProjectPortalStatus.IsPropertyUpdated == true, 'display:none;', '')}"></div>
                                                <apex:inputField id="ddlCurrency" styleClass="ddl-currency" onchange="javascript:checkIfEmpty(this);" value="{!property.Property_Currency__c}"></apex:inputField>
                                            </div>
                                        </td>
                                    </tr>
                                    <apex:variable var="index" value="{!index + 1}" />
                                </apex:repeat>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="main-footer">
                    <apex:commandButton styleClass="btn-common" immediate="true" value="Back to Home" onclick="javascript: unbindNavigationWaring();" action="{!BackToIntroductionPage}" style="float:left;"/>
                    <div class="export-menu">
                        <button onclick="$('.menu-options').toggle(); return false;" class="menu-btn btn-common">Export</button>
                        <div class="menu-options">
                            <a onclick="javascript:exportReport('{!ProjectId}', 'properties', 'xls'); return false;">Excel</a>
                            <a onclick="javascript:exportReport('{!ProjectId}', 'properties', 'pdf'); return false;">PDF</a>
                        </div>
                    </div>
                    <apex:commandButton styleClass="btn-common" value="Save" action="{!UpdatePropertyDetails}" onclick="javascript: showHideLoader(true);" style="{!IF(ProjectPortalStatus.IsPropertyUpdated == true, 'display:none;', '')}" />
                    <apex:commandButton styleClass="btn-common" value="{!IF(ProjectPortalStatus.IsPropertyUpdated == true, '', 'Confirm & ')}Next" action="{!ConfirmAndNext}" onclick="javascript: return validateData(true);" />
                </div>
            </div>
            <div class="help-wrapper" >
                <div class="help-button">
                    <a id="btnHelp">Hide Help</a>
                </div>
                <div class="help-box">
                    <div class="help-box-inner">
                        <div class="help-title">Property Information</div>
                        <div class="help-text">
                            The listed properties are those included in this migration project or project phase. If these do not appear to be correct, please email <a href = "mailto: Hospitality.PLCM@amadeus.com">Hospitality.PLCM@amadeus.com</a>.
                            <br/><br/>
                            To set the Time Zone and/or Currency to be the same for multiple properties, use the “Set Default Time Zone for Multiple properties” and “Set Default Currency for Multiple Properties” picklists. Then, check the appropriate property checkbox(es).  You may also use the individual property’s picklists in each row to change Time Zone or Currency values accordingly. These will become the default Time Zone and Currency for the designated property and will be reflected in that property’s business such as Bookings and Reports. 
                            <br/><br/>
                            Feel free to create a report of your configurations by using the "Export to Excel" or "Export to PDF" button.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--Bubble Help Popup For Default(First) Bubble-->
        <div id="divBubblePopup_0" class="bubble-popup" style="{!IF(ProjectBubbleStatus.IsPropertyBubbleSkipped, '', 'display:block;')}">
            <div class="popup-first-last">        
                <section class="bbl-header-text">Migrating Properties</section>
                <input id="button" type="button" onclick="javascript:skipBubble();" value="X" class="btn-close-bubble"/>
                <br/>
                On this page you will see the list of migrating properties and will need to assign the correct Time Zone and Currency for each.<br/><br/><br/>            
                <input type="button" value="Skip Tutorial" style="float:Left" onclick="javascript:skipBubble();"/>
                <label class="lbl-bbl-numbers" style="width:60%">{!IF(lstProperties.size == 1, 1, 1)} of {!IF(lstProperties.size == 1, 5,6)}</label>        
                <input type="button" value="Start Tutorial" style="float:right;" onclick="javascript:showBubble(1);" />
            </div>
        </div>
        <!--Final Bubble Help Popup-->
        <div class="bubble-popup" id="divBubblePopup_5">
            <div class="popup-first-last">
                <section class="bbl-header-text">Thank You</section>
                <input id="button" type="button" onclick="javascript:skipBubble();" value="X" class="btn-close-bubble"/>
                <br/>
                Thank you for completing these steps. When ready to continue with the tool, please click Confirm &amp; Next.<br /><br /><br />
                <input onclick="javascript:showBubble(4);" style="float:Left" type="button" value="Previous" />            
                <label class="lbl-bbl-numbers" style="width:70%">{!IF(lstProperties.size == 1, 5, 6)} of {!IF(lstProperties.size == 1, 5,6)}</label>
                <input onclick="javascript:skipBubble();" style="float:right" type="button" value="Close" />
            </div>
        </div>
    </apex:form>
    <script type="text/javascript">
        var __sfdcSessionId = '{!GETSESSIONID()}'; //Use to execute SOQL query
    </script>
    <script src="/soap/ajax/28.0/connection.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            //Change Page Title
            window.parent.document.title = "Property Information";
            var $form = $(document.getElementById('{!$Component.frmProperty}'));
            setFormAction($form);

            $("#chkSelectAll").on("change", function() {
                $(".chk-copy").prop("checked", $(this).is(":checked"));
                $(".chk-copy").trigger("change");
            });

            //Fill drop downs default timezones and default currencies
            fillDropDowns();

            if('{!ProjectPortalStatus.IsPropertyUpdated}'.toLowerCase() == 'true') {
                $("input[type='checkbox']").each(function(index, obj) {
                    $(this).attr("disabled", true);
                    $(this).attr('tabindex', '-1'); //Do not allow focus in element
                });

                $("select").each(function(index, obj) {
                    //If property update step is completed then disable all drop downs
                    disableControl(obj, true);
                });

                //Do not display warning message for disabled controls
                unbindNavigationWaring();
            }
            else {
                setTimeout(function() {
                    //Display warning message while moving to other tab
                    bindNavigationWaring();
                }, 500);
            }

            $("#ddlDefaultTimezone,#ddlDefaultCurrency").on("change", function() {
                if(parseInt('{!lstProperties.size}') == 1) { //If only one property then direct select
                    if($(this).attr("id") == "ddlDefaultTimezone") {
                        setDefaultTimeZone(this);
                    }
                    else if($(this).attr("id") == "ddlDefaultCurrency") {
                        setDefaultCurrency(this);
                    }
                }
                else {
                    $(".chk-copy").prop("checked", false);
                    $("#chkSelectAll").prop("checked", false);
                    if(($("#ddlDefaultTimezone").val() != "" && $("#ddlDefaultTimezone").val().toLowerCase() != "--none--")
                        || ($("#ddlDefaultCurrency").val() != "" && $("#ddlDefaultCurrency").val().toLowerCase() != "--none--")) {
                        $(".chk-copy").removeClass("disabled-control");
                        $(".chk-copy").removeAttr('tabindex');
                        $("#chkSelectAll").removeClass("disabled-control");
                        $("#chkSelectAll").removeAttr('tabindex');
                    }
                    else {
                        $(".chk-copy").addClass("disabled-control");
                        $(".chk-copy").attr('tabindex', '-1');
                        $("#chkSelectAll").addClass("disabled-control");
                        $("#chkSelectAll").attr('tabindex', '-1');
                    }
                }
            });

            $(".ddl-time-zone,.ddl-currency").on("change", function() {
                var currentRow = $(this).parents(".data-row");
                $(".chk-copy", currentRow).prop("checked", false);
                $("#chkSelectAll").prop("checked", false);
            });

            $(".chk-copy").on("change", function() {
                var currentRow = $(this).parents(".data-row");
                var selectedTimezone = $("#ddlDefaultTimezone").val();
                if(selectedTimezone != "" && selectedTimezone.toLowerCase() != "--none--") {
                    var $ddlTimeZone = $(".ddl-time-zone", currentRow);
                    if($(this).is(":checked")) {
                        $ddlTimeZone.data("value", $ddlTimeZone.val()); //Save previous value
                        $ddlTimeZone.val(selectedTimezone);
                        $ddlTimeZone.removeClass("ddl-empty");

                        var totalCheckboxes = $(".chk-copy").length;
                        var totalCheckedCheckboxes = $(".chk-copy:checked").length;
                        if(totalCheckboxes == totalCheckedCheckboxes) { //All checkboxes are checked
                            //Check select all checkbox
                            $("#chkSelectAll").prop("checked", true);
                        }
                    }
                    else { //Checkbox deselected
                        var prevValue = $ddlTimeZone.data("value");
                        $ddlTimeZone.val(prevValue); //Select previous value
                        if(prevValue == "" || prevValue.toLowerCase() == "--none--") {
                            $ddlTimeZone.addClass("ddl-empty");
                        }

                        //Uncheck select all checkbox
                        $("#chkSelectAll").prop("checked", false);
                    }
                }

                var selectedCurrency = $("#ddlDefaultCurrency").val();
                if(selectedCurrency != "" && selectedCurrency.toLowerCase() != "--none--") {
                    var $ddlCurrency = $(".ddl-currency", currentRow);
                    $ddlCurrency.removeClass("ddl-empty");
                    if($(this).is(":checked")) {
                        $ddlCurrency.data("value", $ddlCurrency.val()); //Save previous value
                        $ddlCurrency.val(selectedCurrency);

                        var totalCheckboxes = $(".chk-copy").length;
                        var totalCheckedCheckboxes = $(".chk-copy:checked").length;
                        if(totalCheckboxes == totalCheckedCheckboxes) { //All checkboxes are checked
                            //Check select all checkbox
                            $("#chkSelectAll").prop("checked", true);
                        }
                    }
                    else { //Checkbox deselected
                        var prevValue = $ddlCurrency.data("value");
                        $ddlCurrency.val(prevValue); //Select previous value
                        if(prevValue == "" || prevValue.toLowerCase() == "--none--") {
                            $ddlCurrency.addClass("ddl-empty");
                        }

                        //Uncheck select all checkbox
                        $("#chkSelectAll").prop("checked", false);
                    }
                }
            });
        });

        //Fill options in drop down (Default time zone and currencies)
        function fillDropDowns() {
            var arrAllowedCurrencies = new Array();
            arrAllowedCurrencies.push(getOptionValueByText($(".ddl-currency").first(), 'USD'));
            arrAllowedCurrencies.push(getOptionValueByText($(".ddl-currency").first(), 'CAD'));

            /* var arrAllowedTimeZones = new Array();
            var americaTimeZones = getOptionValueByText($(".ddl-time-zone").first(), 'America');
            if(typeof(americaTimeZones) == 'string') {
                arrAllowedTimeZones.push(americaTimeZones);
            }
            else {
                arrAllowedTimeZones = americaTimeZones;
            }
            arrAllowedTimeZones.push(getOptionValueByText($(".ddl-time-zone").first(), 'Atlantic/Bermuda'));
            arrAllowedTimeZones.push(getOptionValueByText($(".ddl-time-zone").first(), 'Pacific/Honolulu')); */

            var arrCurrencies = document.getElementsByClassName("ddl-currency");
            for (var i = 0; i < arrCurrencies.length; i++) {
                //If currency not selected then fill with yellow color
                checkIfEmpty(arrCurrencies[i]);

                $("option", arrCurrencies[i]).each(function() { //Remove currencies other than USD and CAD
                    var strValue = $(this).attr("value");
                    if(typeof(strValue) != 'undefined' && strValue != null && strValue != '' && strValue.toLowerCase() != '--none--'
                        && arrAllowedCurrencies.indexOf(strValue) == -1) {
                        $(this).remove();
                    }
                });
            }

            var arrTimeZones = document.getElementsByClassName("ddl-time-zone");
            for (var i = 0; i < arrTimeZones.length; i++) {
                //If timezone not selected then fill with yellow color
                checkIfEmpty(arrTimeZones[i]);

                /* $("option", arrTimeZones[i]).each(function() { //Remove time zones other than America
                    var strValue = $(this).attr("value");
                    if(typeof(strValue) != 'undefined' && strValue != null && strValue != '' && strValue.toLowerCase() != '--none--'
                        && arrAllowedTimeZones.indexOf(strValue) == -1) {
                        $(this).remove();
                    }
                }); */
            }

            if(optionExists(arrTimeZones[0], '') || optionExists(arrTimeZones[0], '--None--')) {
                //Fill options in default timezone drop down (Without None option)
                $("#ddlDefaultTimezone").html($(arrTimeZones[0]).html());
            }
            else {
                //Fill options in default timezone drop down (with None option)
                $("#ddlDefaultTimezone").append($(arrTimeZones[0]).html());
            }
            document.getElementById("ddlDefaultTimezone").selectedIndex = 0;

            if(optionExists(arrCurrencies[0], '') || optionExists(arrCurrencies[0], '--None--')) {
                //Fill options in default currency drop down (Without None option)
                $("#ddlDefaultCurrency").html($(arrCurrencies[0]).html());
            }
            else {
                //Fill options in default currency drop down (with None option)
                $("#ddlDefaultCurrency").append($(arrCurrencies[0]).html());
            }
            $("#ddlDefaultCurrency").val(getOptionValueByText($("#ddlDefaultCurrency"), 'USD'));

            if('{!ProjectPortalStatus.IsPropertyUpdated}'.toLowerCase() != 'true') {
                $(".ddl-currency").each(function() {
                    if($(this).val() == '') {
                        $(this).val(getOptionValueByText($(this), 'USD'));
                        $(this).trigger("change");
                    }
                });
            }
        }

        //Get value of curreny by text
        function getOptionValueByText(objDropDown, strText) {
            var arr = new Array();
            $("option", objDropDown).each(function() {
                if($(this).attr("value").indexOf(strText) > -1) {
                    arr.push($(this).attr("value"));;
                }
            });
            return (arr.length == 1 ? arr[0] : arr);
        }

        //Set default timezone for all properties while user selects it in drop down
        function setDefaultTimeZone(ddlDefaultTimeZone) {
            var ddlTimeZones = document.getElementsByClassName('ddl-time-zone');
            var strValue = $(ddlDefaultTimeZone).val();
            if(strValue != "" && strValue.toLowerCase() != "--none--") {
                for (var i = 0; i < ddlTimeZones.length; i++) {
                    if(optionExists(ddlTimeZones[i], strValue)) {
                        $(ddlTimeZones[i]).val(strValue);
                    }

                    //Make yellow if not selected any value
                    checkIfEmpty(ddlTimeZones[i]);
                }
            }
        }

        //Set default currency for all properties while user selects it in drop down
        function setDefaultCurrency(ddlDefaultCurrency) {
            var ddlCurrencies = document.getElementsByClassName('ddl-currency');
            var strValue = $(ddlDefaultCurrency).val();
            if(strValue != "" && strValue.toLowerCase() != "--none--") {
                for (var i = 0; i < ddlCurrencies.length; i++) {
                    if(optionExists(ddlCurrencies[i], strValue)) {
                        $(ddlCurrencies[i]).val(strValue);
                    }

                    //Make yellow if not selected any value
                    checkIfEmpty(ddlCurrencies[i]);
                }
            }
        }

        //Check if drop down contains options or not
        function optionExists(objDropDown, strValue) {
            for (i = 0; i < objDropDown.options.length; i++){
                if (objDropDown.options[i].value == strValue){
                    return true;
                }
            }
            return false;
        }

        //Check in field is empty, then fill with yellow color
        function checkIfEmpty(elem) {
            var strValue = $(elem).val();
            if (typeof(strValue) != 'undefined' && strValue != null && strValue != ''
                && strValue.toLowerCase() != '--none--') {
                //Fill with yellow
                $(elem).removeClass("ddl-empty");
            }
            else {
                //Remove yellow
                $(elem).addClass("ddl-empty");
            }
        }

        //Validate values of all controls while submitting
        function validateData(isConfirm) {
            if ('{!IF(ProjectPortalStatus.IsPropertyUpdated == true, 'true', '')}' == 'true') {
                showHideLoader(true); //Show loader

                //Do not validate if property updation is already done
                return true;
            }

            var flagError = false;
            $(".ddl-time-zone").each(function () {
                if ($(this).val() == "" || $(this).val().toLowerCase() == "--none--") {
                    //Time zone not selected
                    flagError = true;
                }
            });

            $(".ddl-currency").each(function () {
                if ($(this).val() == "" || $(this).val().toLowerCase() == "--none--") {
                    //Currency not selected
                    flagError = true;
                }
            });

            $(".error-msg").hide(); //Hide error message
            if (flagError) {
                //Display error message
                $(".error-msg").show();
                $('html, body').animate({
                    scrollTop: 0
                }, 1000);
                return false;
            }
            else if (isConfirm && '{!ProjectPortalStatus.IsPropertyUpdated}'.toLowerCase() == 'false') {
                //Clicked on confirm button then display confirmation message
                if(confirm("You will no longer be able to change your selections. Do you want to proceed?")) {
                    showHideLoader(true); //Show loader
                    return true;
                }
                else {
                    return false;
                }
            }
        }

        //Display bubble help popup
        function showBubble(index) {            
            //Hide all bubble help popup
            $(".bubble-popup").hide();
            $("#divBubblePopup_" + index).show(); //Show next or prevous popup
        }
        
        //Click on skip bubble button
        function skipBubble() {
            if('{!ProjectBubbleStatus.IsPropertyBubbleSkipped}'.toLowerCase() != 'true') {
                //Update bubble help popup flag in NI Doc record
                updateBubbleFlag('{!ProjectId}', 'property');
            }
            $('.bubble-popup').hide(); //Hide Bubble Popup
        }
    </script>
</apex:page>