<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Sends an email alert to the Case Owner when Rally Status si Verified, Ops Consultation or Needs More Information. Email Alert Name: Rally Status Update Notification.</description>
        <name>RallyStatusUpdateNotification</name>
        <label>Rally Status Update Notification</label>
        <locationX>854</locationX>
        <locationY>429</locationY>
        <actionName>Case.Rally_Status_Update_Notification</actionName>
        <actionType>emailAlert</actionType>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <apiVersion>55.0</apiVersion>
    <assignments>
        <description>Creates a record in the AH Error Log object if the &quot;Rally Status Update Notification&quot; Email Alert element fails</description>
        <name>RallyStatusUpdateNotificationErrorLog</name>
        <label>RallyStatusUpdateNotificationErrorLog</label>
        <locationX>876</locationX>
        <locationY>216</locationY>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.Apex_Class_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>FLOW: Case - Rally Status Change Update (API Name: Case_RallyStatusChangeUpdate)</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.Message__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.Object_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Case</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.RecordTypeId</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>0120d000000JOx3AAG</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.User__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$User.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.DML_Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>RallyStatusUpdateNotificationElement</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.Record_ID__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>ErrorLogging</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Creates a record in the AH Error Log object if the &quot;UpdateRallyPriorValueStatus&quot; Update Records element fails</description>
        <name>UpdateRallyPriorStatusErrorLog</name>
        <label>UpdateRallyPriorStatusErrorLog</label>
        <locationX>472</locationX>
        <locationY>214</locationY>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.Apex_Class_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>FLOW: Case - Rally Status Change Update (API Name: Case_RallyStatusChangeUpdate)</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.Message__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.Object_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Case</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.RecordTypeId</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>0120d000000JOx3AAG</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.User__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$User.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.DML_Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>UpdateRallyStatusPriorValueElement</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varErrorLogRecord.Record_ID__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>ErrorLogging</targetReference>
        </connector>
    </assignments>
    <decisions>
        <description>Decides if the Rally Status now equals Verified, Ops Consultation or Need More Information. If the Rally Status equals one of these values, send an email alert to the Case Owner. If not, no further actions are needed. Email Alert will be sent to the Case owner if the Owner of the case if an active user.</description>
        <name>SendEmailAlertDecision</name>
        <label>SendEmailAlertDecision</label>
        <locationX>643</locationX>
        <locationY>450</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>SendEmail</name>
            <conditionLogic>(1 OR 2 OR 3) AND 4</conditionLogic>
            <conditions>
                <leftValueReference>$Record.UserStory_Rally_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Verified</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.UserStory_Rally_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Ops Consultation</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.UserStory_Rally_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Need More Information</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Owner:User.IsActive</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>RallyStatusUpdateNotification</targetReference>
            </connector>
            <label>SendEmail</label>
        </rules>
    </decisions>
    <description>NICC-060084; Updates the Rally Status Prior Value field on Cases when the Rally Status field is updated and sends an email alert to the Case Owner to notify them of the change.</description>
    <interviewLabel>Case - Rally Status Change Update {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Case - Rally Status Change Update</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <description>Logs an error message into the AH Error Log object if the Flow fails to run</description>
        <name>ErrorLogging</name>
        <label>ErrorLogging</label>
        <locationX>667</locationX>
        <locationY>143</locationY>
        <inputAssignments>
            <field>Apex_Class_Name__c</field>
            <value>
                <stringValue>Case - Rally Status Change Update (API Name: Case_RallyStatusChangeUpdate)</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Message__c</field>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Object_Name__c</field>
            <value>
                <stringValue>Case</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RecordTypeId</field>
            <value>
                <stringValue>0120d000000JOx3AAG</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>User__c</field>
            <value>
                <elementReference>$User.Id</elementReference>
            </value>
        </inputAssignments>
        <object>NI_Admin_Error_Log__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordUpdates>
        <description>Updates field called Rally Status Prior Value on the Case record</description>
        <name>UpdateRallyStatusPriorValue</name>
        <label>UpdateRallyStatusPriorValue</label>
        <locationX>341</locationX>
        <locationY>465</locationY>
        <connector>
            <targetReference>SendEmailAlertDecision</targetReference>
        </connector>
        <inputAssignments>
            <field>Rally_Status_Prior_Value__c</field>
            <value>
                <elementReference>$Record__Prior.UserStory_Rally_Status__c</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>46</locationX>
        <locationY>23</locationY>
        <connector>
            <targetReference>UpdateRallyStatusPriorValue</targetReference>
        </connector>
        <object>Case</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <description>Record used to record an error log if an element of the Flow fails</description>
        <name>varErrorLogRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>NI_Admin_Error_Log__c</objectType>
    </variables>
</Flow>
