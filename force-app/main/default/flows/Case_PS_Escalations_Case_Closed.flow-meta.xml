<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Sends an email alert to the Case Requester when the Case is closed.</description>
        <name>SendEmailAlert</name>
        <label>SendEmailAlert</label>
        <locationX>606</locationX>
        <locationY>366</locationY>
        <actionName>Case.PS_Escalations_Case_Closed_Email_Alert</actionName>
        <actionType>emailAlert</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <apiVersion>54.0</apiVersion>
    <decisions>
        <description>Decides if the Requester is an active user. If the user is inactive, no email alert is sent and the Flow ends. If the user is active, the Flow continues and sends an email alert.</description>
        <name>UserActiveDecision</name>
        <label>UserActiveDecision</label>
        <locationX>383</locationX>
        <locationY>364</locationY>
        <defaultConnectorLabel>UserInactive</defaultConnectorLabel>
        <rules>
            <name>UserActive</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GetRequester.IsActive</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>SendEmailAlert</targetReference>
            </connector>
            <label>UserActive</label>
        </rules>
    </decisions>
    <description>NICC-057654; update via NICC-058328
Sends an email alert to the Requester of the Case when the Case has been Closed</description>
    <interviewLabel>Case - PS Escalations Case Closed {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Case - PS Escalations Case Closed</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <description>Gets the User record for the user listed as the Requester on the Case. We need this record to determine if the User is still active or not. If the user is not active, no Email alert will be sent.</description>
        <name>GetRequester</name>
        <label>GetRequester</label>
        <locationX>117</locationX>
        <locationY>374</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>UserActiveDecision</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Requestor__r.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>User</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>72</locationX>
        <locationY>40</locationY>
        <connector>
            <targetReference>GetRequester</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>RecordTypeId</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>012320000009gD7AAI</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Closed</stringValue>
            </value>
        </filters>
        <filters>
            <field>Requestor__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <object>Case</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
</Flow>
