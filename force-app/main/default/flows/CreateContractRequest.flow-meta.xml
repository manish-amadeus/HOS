<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Sends an email alert to the user who created the Request record to let them know the Request was created and a link to the record</description>
        <name>OM_New_Request_Record</name>
        <label>OM New Request Record</label>
        <locationX>1217</locationX>
        <locationY>364</locationY>
        <actionName>Request__c.Order_Management_New_Request_Record</actionName>
        <actionType>emailAlert</actionType>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>varRequestRecordId</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <description>Sends an email to a system admin with details about a missing Record Type ID</description>
        <name>recordTypeIdMissingEmail</name>
        <label>Record Type ID Missing Email</label>
        <locationX>261</locationX>
        <locationY>590</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>recordTypeIdErrorEmailTemplate</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <stringValue>kimberly.contreraz@amadeus.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>kimberly.contreraz@amadeus.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <stringValue>Flow Contract Request Failed - Missing Record Type ID</stringValue>
            </value>
        </inputParameters>
    </actionCalls>
    <apiVersion>52.0</apiVersion>
    <assignments>
        <description>Assigns field values to the new Request record</description>
        <name>AssignNewRecord</name>
        <label>AssignNewRecord</label>
        <locationX>756</locationX>
        <locationY>72</locationY>
        <assignmentItems>
            <assignToReference>varNewRequestRecord.Account__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varAccountId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varNewRequestRecord.Comments__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>commentsContractRequestScreen</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varNewRequestRecord.Open_Time__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varNewRequestRecord.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>getQueueId.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varNewRequestRecord.Product_Family__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>productFamilyPicklistContractRequestScreen</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varNewRequestRecord.RecordTypeId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>recordTypeId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varNewRequestRecord.Related_Opportunity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>oppId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varNewRequestRecord.Request_Contact__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$User.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varNewRequestRecord.Request_Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>New</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varNewRequestRecord.Request_Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>requestTypePicklistContractRequestScreen</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>createContractRequest</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Holds the ID of the new Request record just created. Used in the Email Alert action later.</description>
        <name>requestRecordIdAssignment</name>
        <label>Request Record ID</label>
        <locationX>905</locationX>
        <locationY>260</locationY>
        <assignmentItems>
            <assignToReference>varRequestRecordId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>varNewRequestRecord.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>processingScreen</targetReference>
        </connector>
    </assignments>
    <choices>
        <name>adminRequest</name>
        <choiceText>Admin Request</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Admin Request</stringValue>
        </value>
    </choices>
    <choices>
        <name>amendmentRequest</name>
        <choiceText>Amendment Request</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Amendment Request</stringValue>
        </value>
    </choices>
    <choices>
        <name>changeOrderRequest</name>
        <choiceText>Change Order Request</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Change Order Request</stringValue>
        </value>
    </choices>
    <choices>
        <name>choiceContractSearch</name>
        <choiceText>Contract Search</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Contract Search</stringValue>
        </value>
    </choices>
    <choices>
        <name>contractRequestIndividualProperty</name>
        <choiceText>Contract Request (Individual Property)</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Contract Request (Individual Property)</stringValue>
        </value>
    </choices>
    <choices>
        <name>contractRequestMultiProperty</name>
        <choiceText>&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(62, 62, 60);&quot;&gt;Contract Request (Multi-Property)&lt;/span&gt;</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Contract Request (Multi-Property)</stringValue>
        </value>
    </choices>
    <choices>
        <name>defaultValueNone</name>
        <choiceText>--None--</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>--None--</stringValue>
        </value>
    </choices>
    <choices>
        <name>PMS</name>
        <choiceText>PMS</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>PMS</stringValue>
        </value>
    </choices>
    <choices>
        <name>proposalRequestPricingRequest</name>
        <choiceText>Proposal Request (Pricing Request)</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Proposal Request (Pricing Request)</stringValue>
        </value>
    </choices>
    <choices>
        <name>revisionRequest</name>
        <choiceText>Revision Request</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Revision Request</stringValue>
        </value>
    </choices>
    <choices>
        <name>salesAndCatering</name>
        <choiceText>Sales and Catering</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Sales and Catering</stringValue>
        </value>
    </choices>
    <choices>
        <name>serviceOptimization</name>
        <choiceText>Service Optimization</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Service Optimization</stringValue>
        </value>
    </choices>
    <constants>
        <description>Holds the email address of the System Admin to send email alerts to for error resolution</description>
        <name>emailSystemAdministrator</name>
        <dataType>String</dataType>
        <value>
            <stringValue>kimberly.contreraz@amadeus.com</stringValue>
        </value>
    </constants>
    <constants>
        <description>Holds the comments that a user enters on the Contract Request screen</description>
        <name>requestComments</name>
        <dataType>String</dataType>
    </constants>
    <decisions>
        <name>recordTypeIdPopulated</name>
        <label>Record Type Id Populated</label>
        <locationX>244</locationX>
        <locationY>380</locationY>
        <defaultConnector>
            <targetReference>getQueueId</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Record Type ID Populated</defaultConnectorLabel>
        <rules>
            <name>recordTypeIDNULL</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>recordTypeId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Record_Type_ID_NULL_Error_Screen</targetReference>
            </connector>
            <label>Record Type ID NULL</label>
        </rules>
    </decisions>
    <description>NICC-051009; NICC-057573; NICC-061648
Creates a Contract Request record for the Order Management team. Used in a custom button called &quot;Contract Request&quot; on the Opportunity object. Adding the ability to create a Request directly from the Account record.</description>
    <interviewLabel>Opportunity - Create Contract Request {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Opportunity - Create Contract Request</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <description>Creates a new Contract Request record in the Request object</description>
        <name>createContractRequest</name>
        <label>Create Contract Request</label>
        <locationX>939</locationX>
        <locationY>50</locationY>
        <connector>
            <targetReference>requestRecordIdAssignment</targetReference>
        </connector>
        <faultConnector>
            <targetReference>contractValidationRequestErrorScreen</targetReference>
        </faultConnector>
        <inputReference>varNewRequestRecord</inputReference>
    </recordCreates>
    <recordLookups>
        <description>Gets the Account record associated with this Request</description>
        <name>GetAccount</name>
        <label>GetAccount</label>
        <locationX>584</locationX>
        <locationY>75</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>AssignNewRecord</targetReference>
        </connector>
        <filterLogic>or</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>getOpportunities.Account.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varAccountId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Account</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Gets the ID of the Opportunity</description>
        <name>getOpportunities</name>
        <label>Get Opportunities</label>
        <locationX>670</locationX>
        <locationY>220</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>GetAccount</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>oppId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Opportunity</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Gets the Id of the Queue to assign the Request record to upon record creation</description>
        <name>getQueueId</name>
        <label>Get Queue Id</label>
        <locationX>480</locationX>
        <locationY>262</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>getOpportunities</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>queueDevName</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Group</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Gets the ID of the record type called &quot;Contract Validation Request&quot; from the Request object</description>
        <name>getRecordTypeId</name>
        <label>Get Record Type Id</label>
        <locationX>251</locationX>
        <locationY>211</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>recordTypeIdPopulated</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Contract_Request</stringValue>
            </value>
        </filters>
        <object>RecordType</object>
        <outputAssignments>
            <assignToReference>recordTypeId</assignToReference>
            <field>Id</field>
        </outputAssignments>
    </recordLookups>
    <screens>
        <name>contractRequestScreen</name>
        <label>Contract Request Screen</label>
        <locationX>42</locationX>
        <locationY>195</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>getRecordTypeId</targetReference>
        </connector>
        <fields>
            <name>oppScreenDisplayText</name>
            <fieldText>&lt;p style=&quot;text-align: center;&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;Contract Request&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>contractRequestScreen_Section1</name>
            <fieldType>RegionContainer</fieldType>
            <fields>
                <name>contractRequestScreen_Section1_Column1</name>
                <fieldType>Region</fieldType>
                <fields>
                    <name>requestTypePicklistContractRequestScreen</name>
                    <choiceReferences>adminRequest</choiceReferences>
                    <choiceReferences>amendmentRequest</choiceReferences>
                    <choiceReferences>contractRequestIndividualProperty</choiceReferences>
                    <choiceReferences>contractRequestMultiProperty</choiceReferences>
                    <choiceReferences>changeOrderRequest</choiceReferences>
                    <choiceReferences>revisionRequest</choiceReferences>
                    <choiceReferences>proposalRequestPricingRequest</choiceReferences>
                    <choiceReferences>choiceContractSearch</choiceReferences>
                    <dataType>String</dataType>
                    <fieldText>Request Type</fieldText>
                    <fieldType>DropdownBox</fieldType>
                    <isRequired>false</isRequired>
                </fields>
                <inputParameters>
                    <name>width</name>
                    <value>
                        <stringValue>6</stringValue>
                    </value>
                </inputParameters>
                <isRequired>false</isRequired>
            </fields>
            <fields>
                <name>contractRequestScreen_Section1_Column2</name>
                <fieldType>Region</fieldType>
                <fields>
                    <name>productFamilyPicklistContractRequestScreen</name>
                    <choiceReferences>salesAndCatering</choiceReferences>
                    <choiceReferences>serviceOptimization</choiceReferences>
                    <choiceReferences>PMS</choiceReferences>
                    <dataType>String</dataType>
                    <fieldText>Product Family</fieldText>
                    <fieldType>DropdownBox</fieldType>
                    <isRequired>false</isRequired>
                </fields>
                <inputParameters>
                    <name>width</name>
                    <value>
                        <stringValue>6</stringValue>
                    </value>
                </inputParameters>
                <isRequired>false</isRequired>
            </fields>
            <isRequired>false</isRequired>
        </fields>
        <fields>
            <name>commentsContractRequestScreen</name>
            <defaultValue>
                <stringValue>{!requestComments}</stringValue>
            </defaultValue>
            <fieldText>Comments</fieldText>
            <fieldType>LargeTextArea</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <description>This screen will display an error message to a user if the Contract Validation Request record cannot be created.</description>
        <name>contractValidationRequestErrorScreen</name>
        <label>Contract Validation Request Error Screen</label>
        <locationX>1197</locationX>
        <locationY>45</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>errorScreenDisplayText</name>
            <fieldText>&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(62, 62, 60);&quot;&gt;Unfortunately, we are unable to create your Contract Request at this time. Please review the error message below for issues that need to be resolved or contact your system administrator for more information.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;i style=&quot;background-color: rgb(255, 255, 255); color: rgb(18, 18, 18);&quot;&gt;{!$Flow.FaultMessage}&lt;/i&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>processingScreen</name>
        <label>Processing Screen</label>
        <locationX>1095</locationX>
        <locationY>221</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>OM_New_Request_Record</targetReference>
        </connector>
        <fields>
            <name>processingScreenDisplayText</name>
            <fieldText>&lt;p&gt;&lt;span style=&quot;color: rgb(62, 62, 60); background-color: rgb(255, 255, 255);&quot;&gt;Your Contract Request is being processed and will be available momentarily. Click the Next button to return to the Opportunity or Account.&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Record_Type_ID_NULL_Error_Screen</name>
        <label>Record Type ID NULL Error Screen</label>
        <locationX>111</locationX>
        <locationY>510</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>recordTypeIdMissingEmail</targetReference>
        </connector>
        <fields>
            <name>nullRecordTypeIDText</name>
            <fieldText>&lt;p&gt;We are unable to process your Contract Request at this time. Please click Next to send an email to your system administrator for resolution.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <start>
        <locationX>44</locationX>
        <locationY>38</locationY>
        <connector>
            <targetReference>contractRequestScreen</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>getOpportunityIdFailedTextTemplate</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;Error: {!$Flow.FaultMessage}&lt;/p&gt;&lt;p&gt;Flow Name: Opportunity - Contract Validation Request&lt;/p&gt;&lt;p&gt;Element: Get Oportunity Id&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <description>This text template contains details of an issue with getting the RecordType ID to create the Contract Validation Request</description>
        <name>recordTypeIdErrorEmailTemplate</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>The below-named flow has failed to run properly. The Flow failed to properly record the Record Type ID. Please review for resolution.

Name of the Flow: Opportunity - Contract Request

Error Location: Get Record Type ID

Record ID: {!oppId}

Running User ID: {!$User.Id}

Running User Name: {!$User.FirstName} {!$User.LastName}</text>
    </textTemplates>
    <variables>
        <description>Holds the Id of the Opportunity used to create the Contract Validation Request</description>
        <name>oppId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>queueDevName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>Order_Mgmt_Contract_Request</stringValue>
        </value>
    </variables>
    <variables>
        <description>Holds the Id of the Record Type &quot;Contract Validation Request&quot; from the Request object</description>
        <name>recordTypeId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varAccountId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Holds the field values for the new Request record that will be created</description>
        <name>varNewRequestRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Request__c</objectType>
    </variables>
    <variables>
        <description>Variable to hold the ID of the newly created Request record.</description>
        <name>varRequestRecordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
</Flow>
