<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>56.0</apiVersion>
    <assignments>
        <description>Add child Case to Update Collection</description>
        <name>Add_child_Case_to_Update_Collection</name>
        <label>Add child Case to Update Collection</label>
        <locationX>1010</locationX>
        <locationY>378</locationY>
        <assignmentItems>
            <assignToReference>varChildCaseUpdates</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Through_Child_Cases</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Through_Parent_Case_Articles</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Update Child Case Status to Closed</description>
        <name>Update_Child_Case_Status_to_Closed</name>
        <label>Update Child Case Status to Closed</label>
        <locationX>767</locationX>
        <locationY>303</locationY>
        <assignmentItems>
            <assignToReference>Loop_Through_Child_Cases.Status</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Closed</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_child_Case_to_Update_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Hold new instances of CaseArticle Records</description>
        <name>varCaseArticle</name>
        <label>varCaseArticle</label>
        <locationX>1126</locationX>
        <locationY>538</locationY>
        <assignmentItems>
            <assignToReference>varChildCaseArticle.CaseId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Through_Child_Cases.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varChildCaseArticle.KnowledgeArticleId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Through_Parent_Case_Articles.KnowledgeArticleId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCaseArticleInserts</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>varChildCaseArticle</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Through_Parent_Case_Articles</targetReference>
        </connector>
    </assignments>
    <description>This flow copies the Knowledge Articles from the Parent Case to Child Cases and updates the Child Cases Status to close when the Parent Case is closed, only when Child Case status equals Resolved - Pending Customer Confirmation
NICC-064077</description>
    <interviewLabel>Mass Close Child Support Cases {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Case - Mass Close Child Support Cases</label>
    <loops>
        <name>Loop_Through_Child_Cases</name>
        <label>Loop Through Child Cases</label>
        <locationX>516</locationX>
        <locationY>286</locationY>
        <collectionReference>varChildCases</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Update_Child_Case_Status_to_Closed</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Insert_Child_Case_Article_Records</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Through_Parent_Case_Articles</name>
        <label>Loop Through Parent Case Articles</label>
        <locationX>840</locationX>
        <locationY>463</locationY>
        <collectionReference>varParentCaseArticles</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>varCaseArticle</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_Through_Child_Cases</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Insert_Child_Case_Article_Records</name>
        <label>Insert Child Case Article Records</label>
        <locationX>347</locationX>
        <locationY>466</locationY>
        <connector>
            <targetReference>Update_Case_Child_Case_Statuses</targetReference>
        </connector>
        <inputReference>varCaseArticleInserts</inputReference>
    </recordCreates>
    <recordLookups>
        <description>Get all child cases belonging to record that invoked flow.</description>
        <name>Get_Child_Cases</name>
        <label>Get Child Cases</label>
        <locationX>525</locationX>
        <locationY>61</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Parent_Case_Articles</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ParentId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Resolved - Pending Customer Confirmation</stringValue>
            </value>
        </filters>
        <object>Case</object>
        <outputReference>varChildCases</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Status</queriedFields>
    </recordLookups>
    <recordLookups>
        <description>Query for all articles on parent case that invoked flow and add them to a collection.</description>
        <name>Get_Parent_Case_Articles</name>
        <label>Get Parent Case Articles</label>
        <locationX>698</locationX>
        <locationY>115</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Through_Child_Cases</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>CaseId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <object>CaseArticle</object>
        <outputReference>varParentCaseArticles</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>CaseId</queriedFields>
        <queriedFields>KnowledgeArticleId</queriedFields>
    </recordLookups>
    <recordUpdates>
        <name>Update_Case_Child_Case_Statuses</name>
        <label>Update Case Child Case Statuses</label>
        <locationX>566</locationX>
        <locationY>559</locationY>
        <inputReference>varChildCaseUpdates</inputReference>
    </recordUpdates>
    <start>
        <locationX>122</locationX>
        <locationY>38</locationY>
        <connector>
            <targetReference>Get_Child_Cases</targetReference>
        </connector>
        <filterLogic>1 AND 2 AND( 3 OR 4)</filterLogic>
        <filters>
            <field>Status</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Closed</stringValue>
            </value>
        </filters>
        <filters>
            <field>RecordTypeId</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>0126000000011YUAAY</stringValue>
            </value>
        </filters>
        <filters>
            <field>RecordTypeId</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>0126000000011YWAAY</stringValue>
            </value>
        </filters>
        <object>Case</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <description>A collection to store new Child Case Article Records for inserts</description>
        <name>varCaseArticleInserts</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseArticle</objectType>
    </variables>
    <variables>
        <description>New instance of case article for child case.</description>
        <name>varChildCaseArticle</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseArticle</objectType>
    </variables>
    <variables>
        <description>A collection of child cases of case record that invoked flow.</description>
        <name>varChildCases</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <description>Collection of child cases that are to be closed.</description>
        <name>varChildCaseUpdates</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <description>A collection of parent case articles that need to be added to child cases.</description>
        <name>varParentCaseArticles</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseArticle</objectType>
    </variables>
</Flow>
