<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>49.0</apiVersion>
    <assignments>
        <name>SumChildSourceAssessmentRollupValues</name>
        <label>Sum Child Source Assessment Rollup Values</label>
        <locationX>325</locationX>
        <locationY>474</locationY>
        <assignmentItems>
            <assignToReference>ChildSourceAssessmentCount</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>ChildSource.Rollup_Assessment_Count__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ChildSourceAssessmentSum</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>ChildSource.Rollup_Assessment_Sum__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>SUMAssessmentRollups</targetReference>
        </connector>
    </assignments>
    <interviewLabel>Child Source Count on Master Source {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Child Source Rollup to Master Source</label>
    <loops>
        <description>SUM the Assessment Count and Assessment Sum fields for all Child Source records</description>
        <name>SUMAssessmentRollups</name>
        <label>SUM Assessment Rollups</label>
        <locationX>326</locationX>
        <locationY>283</locationY>
        <assignNextValueToReference>ChildSource</assignNextValueToReference>
        <collectionReference>curBIOSourceChildSources</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>SumChildSourceAssessmentRollupValues</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_Master_Source_Record</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <description>Get the Child Source Records (i.e. Corporate Security Standards) so that you can roll up (SUM) the Assessment Count and the Assessment Sum values from each of these records to the Master Source record (i.e. Corporate Security Policy).</description>
        <name>Get_BIO_Source_Records</name>
        <label>Get BIO Source Records</label>
        <locationX>309</locationX>
        <locationY>65</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>SUMAssessmentRollups</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Master_Source__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>AssessmentMasterSourceId</elementReference>
            </value>
        </filters>
        <object>BIO_Source__c</object>
        <outputReference>curBIOSourceChildSources</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Rollup_Assessment_Count__c</queriedFields>
        <queriedFields>Rollup_Assessment_Sum__c</queriedFields>
    </recordLookups>
    <recordUpdates>
        <description>Update the fields on the Master Source record that store the sum of the Assessment Count and Assessment Sum fields from the related Child Source records</description>
        <name>Update_Master_Source_Record</name>
        <label>Update Master Source Record</label>
        <locationX>780</locationX>
        <locationY>293</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>AssessmentMasterSourceId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Child_Source_Assessment_Count__c</field>
            <value>
                <elementReference>ChildSourceAssessmentCount</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Child_Source_Assessment_Sum__c</field>
            <value>
                <elementReference>ChildSourceAssessmentSum</elementReference>
            </value>
        </inputAssignments>
        <object>BIO_Source__c</object>
    </recordUpdates>
    <startElementReference>Get_BIO_Source_Records</startElementReference>
    <status>Active</status>
    <variables>
        <description>Assessment.Source.MasterSourceId</description>
        <name>AssessmentMasterSourceId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>The Id of the Source record that is related to the Assessment that is triggering this flow</description>
        <name>AssessmentSourceId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ChildSource</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>BIO_Source__c</objectType>
    </variables>
    <variables>
        <name>ChildSourceAssessmentCount</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>ChildSourceAssessmentSum</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>curBIOSourceChildSources</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>BIO_Source__c</objectType>
    </variables>
    <variables>
        <name>curBIOSourceId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>TotalChildSourceCount</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
</Flow>
