<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>New_NI_Change_Request</fullName>
    <availability>online</availability>
    <description>Updated per Salesforce.com Change Request:  NICC-016754</description>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>New NI Change Request</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>/*
old url 

/setup/ui/recordtypeselect.jsp?ent=01I600000006SsE&amp;retURL=%2F{!NI_Project_Backlog_Tasks__c.Id}&amp;save_new_url=%2Fa0s%2Fe%3FretURL%3D%252F{!NI_Project_Backlog_Tasks__c.Id}&amp;
CF00N60000002gM4r={!NI_Project_Backlog_Tasks__c.Name}&amp;
CF00N60000002gM4r_lkid={!NI_Project_Backlog_Tasks__c.Id}&amp;
CF00N60000002gM4m={!NI_Project_Backlog_Tasks__c.NI_Project_Backlog_Item__c}&amp; 
CF00N60000002gM4m_lkid={!NI_Project_Backlog_Tasks__c.NI_Project_Backlog_ItemId__c}*/


{!REQUIRESCRIPT(&quot;/soap/ajax/20.0/connection.js&quot;)} 
{!REQUIRESCRIPT(&quot;/soap/ajax/10.0/apex.js&quot;)} 


var recordtypeResult1 = sforce.connection.query(&quot;Select id FROM RecordType WHERE Name=&apos;Salesforce.com Change Request&apos; and SobjectType=&apos;NI_Change_Control__c&apos;&quot;);

var recordTypeID = &apos;&apos;;


if(recordtypeResult1 != &apos;&apos;){
 recordTypeID = recordtypeResult1.records.Id;
}

var task_id = &quot;{!NI_Project_Backlog_Tasks__c.Id}&quot;;
var task_name = &quot;{!NI_Project_Backlog_Tasks__c.Name}&quot;;
var task_id = &quot;{!NI_Project_Backlog_Tasks__c.Id}&quot;;
var backlog_item = &quot;{!NI_Project_Backlog_Tasks__c.NI_Project_Backlog_Item__c}&quot;;
var backlog_item_id = &quot;{!NI_Project_Backlog_Tasks__c.NI_Project_Backlog_ItemId__c}&quot;;


var sales_force_app =&quot;Salesforce&quot;;
var request_summary =&quot;{!NI_Project_Backlog__c.Name}&quot;;
var request_details = &quot;{!JSENCODE(NI_Project_Backlog__c.Project_Details__c)}&quot;;
var change_steps = &quot;Deploy related changes from the Development Sandbox.&quot;;
var test_plan = &quot;Confirm standard work flows are functioning as designed per the related &apos;NI Project Backlog&apos; record.&quot;;
var rollback_plan = &quot;Undeploy related functionality&quot;;
var change_reason = &quot;Additional Functionality&quot;;
//var production_start_date = &quot;{!NI_Project_Backlog_Tasks__c.Due_Date__c}&quot;;
var delployment_owner=&quot;Stuart Emery&quot;;

var project_title = &quot;{!NI_Project_Backlog__c.Name}&quot;;
var project_id = &quot;{!NI_Project_Backlog__c.Id}&quot;;
var change_type = &quot;{!NI_Project_Backlog__c.Change_Type__c}&quot;;

var today=new Date();
var in_a_week=new Date().setDate(today.getDate()+7);
var d = new Date(in_a_week);
var month = (d.getMonth()+1);
var day = (d.getDate());
var year = (d.getFullYear());

var production_start_date =  month + &quot;/&quot; + day + &quot;/&quot; + year;

/*
/setup/ui/recordtypeselect.jsp?ent=01I600000006SsE&amp;retURL=%2F{!NI_Project_Backlog_Tasks__c.Id}&amp;save_new_url=%2Fa0s%2Fe%3FretURL%3D%252F{!NI_Project_Backlog_Tasks__c.Id}&amp;
*/


var main_url = &apos;/a0s/e?&amp;retURL=%2F&apos;+task_id+&apos;&amp;save_new_url=%2Fa0s%2Fe%3FretURL%3D%252F&apos;+task_id+&apos;&amp;CF00N60000002gM4r=&apos;+task_name+&apos;&amp;CF00N60000002gM4r_lkid=&apos;+task_id+&apos;&amp;CF00N60000002gM4m=&apos;+backlog_item +&apos;&amp;CF00N60000002gM4m_lkid=&apos;+backlog_item_id+&apos;&amp;RecordType=&apos;+recordTypeID+&apos;&amp;&apos;;

/*
var main_url = &apos;/setup/ui/recordtypeselect.jsp?ent=01I600000006SsE&amp;retURL=%2F&apos;+task_id+&apos;&amp;save_new_url=%2Fa0s%2Fe%3FretURL%3D%252F&apos;+task_id+&apos;&amp;CF00N60000002gM4r=&apos;+task_name+&apos;&amp;CF00N60000002gM4r_lkid=&apos;+task_id+&apos;&amp;CF00N60000002gM4m=&apos;+backlog_item +&apos;&amp;CF00N60000002gM4m_lkid=&apos;+backlog_item_id+&apos;&amp;&apos;;*/


var url = main_url+&apos;00N60000002FV0i=Salesforce&amp;00N60000002FGsd=&apos;+request_summary+&apos;&amp;00N60000002FGsT=&apos;+change_steps+&apos;&amp;00N60000002FGsh=&apos;+test_plan+&apos;&amp;00N60000002FGse=&apos;+rollback_plan +&apos;&amp;00N60000002FGsR=&apos;+change_reason+&apos;&amp;CF00N60000002FGsa=&apos;+delployment_owner+&apos;&amp;00N60000002FGsb=Medium&apos;;

if(request_details != &apos;&apos;){
url+=&apos;&amp;00N60000002FGsc=&apos;+request_details;
}

if(production_start_date != &apos;&apos;){
url+=&apos;&amp;00N60000002FGsX=&apos;+production_start_date;
}

var FromFieldBeneficiaries  =&quot;{!NI_Project_Backlog__c.Beneficiaries__c}&quot;; 
var ToFunctionalArea =&quot;00N60000002FGsZ&quot;;  


var pairs =  FromFieldBeneficiaries.split(&quot;;&quot;); 
if(pairs != &apos;&apos;){
  var Fields = &quot;&quot;;
  for (var i=0;i&lt;pairs.length;i++) 
  {  
   var ThisValue = pairs[i]; 
   Fields =Fields + ToFunctionalArea +  &quot;=&quot; + ThisValue + &quot;&amp;&quot;; 
  } 
  url+=&apos;&amp;&apos; +Fields;
}


var FromFieldChangetype  = change_type; 
var ToChangeType =&quot;00N60000002FGsU&quot;;  


var pairs =  FromFieldChangetype.split(&quot;;&quot;); 
if(pairs != &apos;&apos;){
  var Fields = &quot;&quot;;
  for (var i=0;i&lt;pairs.length;i++) 
  {  
   var ThisValue = pairs[i]; 
   Fields =Fields + ToChangeType +  &quot;=&quot; + ThisValue + &quot;&amp;&quot;; 
  } 
  url+=&apos;&amp;&apos; +Fields;
}


window.location.href = url;</url>
</WebLink>
