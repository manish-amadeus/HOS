<<<<<<< HEAD
<apex:component >
   <!-- Declare the attributes -->
   <apex:attribute name="WorkbookDocumentId" description="The Document ID on which chatter will be created" type="String" required="true" />   
   <script>
      var isFormAssemblySaved = false;
      var RefreshTimer;
      var moveToNextStepAfterComplete = false;
      var blockNavigation = false;
      var requestedStepPositionForConfirm;
      var showNotificationButtons; //Controls Code path after user clicks Continue or Cancel
      var stepbarScrollPosition = 0;

      function consolelog(message)
      {
         if (DisplayConsoleLogMessages) console.log(message);
      }
      function updateTimerStart(){
         //Only start the refresh timer if there isn't an error
         if (isPageLoadErrorMessage=='') RefreshTimer = setTimeout(UpdateTimer, UpdateTimerIntervalInMilliSeconds);
      }
      function updateTimerStop(){
         clearTimeout(RefreshTimer);
      }
      $(document).ready(function() {
         //Only update chatter icon if in Community View and no error has occurred
         updateTimerStart();
      });

      window.onbeforeunload = function(event) {
         if (isFormAssemblySaved == false)
         {
            //TODO: V2.X Message about navigating away
            //return "You have unsaved changes. Are you sure you want to navigate away?";
         }
      };

      var updateTimerCounter = 0;
      function UpdateTimerCallback()
      {
         updateTimerCounter++;
         consolelog('UpdateTimer CallBack: ' + updateTimerCounter);
         RefreshTimer = setTimeout(UpdateTimer, UpdateTimerIntervalInMilliSeconds);
         //Set scroll postion back to the same as it was before refreshing step data
         $('.sidebar .left-side').scrollTop(stepbarScrollPosition);
      }

      function UpdateTimer()
      {
         clearTimeout(RefreshTimer);
         consolelog("UpdateTimer: call server side: " + updateTimerCounter);
         actionfunction_UpdateTimer();
         //Get the current scroll position to set it back once step data refreshed
         stepbarScrollPosition = $('.sidebar .left-side').scrollTop();
      }

      //This is used to update the chatter Button based on if there are chatter messages
      function setChatterIcon(){
         consolelog('chatterUpdate:' + chatterUpdate );
         let chatterButton = document.getElementById('chatterButton');
         let chatterButtonImage = document.getElementById('chatterButtonImage');

         //consolelog(chatterButton);
         //consolelog(chatterButtonImage);

         //consolelog(chatterButton.classList.contains('chatterButtonUnread'));

         if (chatterUpdate==false && chatterButton.classList.contains('chatterButtonUnread')) {
            chatterButton.classList.remove('chatterButtonUnread');
            chatterButtonImage.classList.remove('fa-comment-medical');
            chatterButtonImage.classList.add('fa-comment-dots');
            consolelog('Unread');
         }
         if (chatterUpdate == true && !chatterButton.classList.contains('chatterButtonUnread')) {
            chatterButton.classList.add('chatterButtonUnread');
            chatterButtonImage.classList.remove('fa-comment-dots');
            chatterButtonImage.classList.add('fa-comment-medical');
            consolelog('Read');
         }
      }

      function MarkStepComplete(){
         if (blockNavigation == true) return;

         //Get the current scroll position to set it back once step mark complete done
         stepbarScrollPosition = $('.sidebar .left-side').scrollTop();

         //Check if current step is saved - otherwise prompt
         if(!isFormAssemblySaved)
         {
            showNotificationsWithButtons(LABEL_VerifyFormSave, 'MarkStepComplete');
            return;
         }

         showSpinner();
         actionfunction_MarkStepComplete();
      }
      function markStepCompleteCallback()
      {
         //TODO: ROBDEV Catch error
         //Set scroll postion back to the same as it was before marking step complete
         $('.sidebar .left-side').scrollTop(stepbarScrollPosition);
         hideSpinner();
         showNotifications(NotificationToShow);
         consolelog('markStepCompleteCallback - Step Marked Complete');
         if(moveToNextStepAfterComplete==true)
         {
            moveToNextStepAfterComplete == false;
            actionfunction_ChangeToNextStepNotCompleted();
         }
      }

      function changeToStepCallback()
      {
         hideSpinner();
         if (currentPosition > 0)
         {
            isFormAssemblySaved = false;
            $('#rmStep' + currentPosition).addClass("current-step");
         }
         else {
            //Don't display confirmation message if user is on start page or workbook completion page
            isFormAssemblySaved = true;
         }
      }

      function changeToStep(requestedStepPosition, isLocked, isPrerequisiteStepNotCompleted, prerequisiteStepPosition, prerequisiteStepName)
      {
         if (blockNavigation == true) return;

         if(IsCommunityView && isWorkbookCompleted)
         {
            showNotifications('{!$Label.AH_UDC_ViewWorkbook_SubmittedReadOnly}');
            return;
         }

         if (isPropertyConfirmed == true)
         {
            if(typeof(isLocked) != 'undefined' && isLocked.toLowerCase() == 'true')
            {
               showNotifications(LABEL_StepLockedMessage); //Display message and don't allow user to proceed with step
               return;
            }

            if(typeof(isPrerequisiteStepNotCompleted) != 'undefined' && isPrerequisiteStepNotCompleted.toLowerCase() == 'true')
            {
               var message = LABEL_PrerequisiteStepNotCompletedMessage.replace('{0}', prerequisiteStepPosition).replace('{1}', prerequisiteStepName);
               showNotifications(message); //Display message and don't allow user to proceed with step
               return;
            }

            //Check if current step is saved - otherwise prompt
            if(!isFormAssemblySaved)
            {
               requestedStepPositionForConfirm = requestedStepPosition;
               showNotificationsWithButtons(LABEL_VerifyFormSave, 'ChangeToStep');
               return;
            }
            showSpinner();
            actionfunction_ChangeToStep(requestedStepPosition);
         }
         else
         {
            showNotifications('{!$Label.AH_UDC_ViewWorkbook_ConfirmPropertyFirst}');
         }
      }

      function saveformContinue()
      {
         hideNotifications();
         showSpinner();
         if(showNotificationButtons == 'ChangeToStep')
         {
            actionfunction_ChangeToStep(requestedStepPositionForConfirm);
         }
         if(showNotificationButtons == 'MarkStepComplete')
         {
            actionfunction_MarkStepComplete();
         }
         if(showNotificationButtons == 'DeleteUploadedFile')
         {
            deleteFile();
         }
      }

      function saveformCancel()
      {
         hideNotifications();
      }

      //Open blank tab on click of chatter button
      function onClickChatterButton() {
         //var tabName = getQueryStringValue('tabset-8bc76'); //Get community tab name and pass into url
         //window.open('/customers/s/sfdcpage/' + encodeURIComponent('/apex/AH_UDC_Chatter?Id={!WorkbookDocumentId}&tabset-8bc76=' + tabName), '_blank');
         var chatHeight = window.screen.height - 300;
         var chatWidth = window.screen.width - 300;
         var chatTop = 200;
         var chatLeft = 150;
         if (IsCommunityView)
         {
            chatterUpdate = false;
            setChatterIcon();
            var host = window.location.protocol + "//" + window.location.host;
            window.open(host + '/customers/AH_UDC_Chatter?id={!WorkbookDocumentId}', 'AH_UDC_CHATTER', 'location=no, width=' + chatWidth + ', height=' + chatHeight + ', top=' + chatTop + ', left=' + chatLeft);
         }
         else
         {
            window.open('/' + documentationId, 'AH_UDC_Documentation', 'location=no, width=' + chatWidth + ', height=' + chatHeight + ', top=' + chatTop + ', left=' + chatLeft);
         }
      }

      //Get query string value
      function getQueryStringValue(queryStringName) {
         var url = decodeURIComponent(window.parent.location.href);
         var arr = url.slice(url.indexOf('?') + 1).split('&');
         if(arr != null) {
            for(var i = 0; i < arr.length; i++) {
               var arrKeyValue = arr[i].split('=');
               if(arrKeyValue != null && arrKeyValue.length > 1) {
                     if(arrKeyValue[0] == queryStringName) {
                        return arrKeyValue[1];
                     }
               }
            }
         }
         return '';
      }

      //Event listener for ThankYouPage
      window.addEventListener("message", (event) => {
        consolelog('event.origin: ' + event.origin);
        consolelog('event.data: ' + event.data);
        if(event.origin == 'https://staging-mbrfp.meetingbroker.com' ||
		     event.origin == 'https://mbrfp.meetingbroker.com')
        {
          if(event.data=='ThankYouPage')
          {
            consolelog('ThankYouPage');
            $('html,body').animate({ scrollTop: 0 }); //Scroll top to show thank you
            isFormAssemblySaved = true;
            updateTimerStop();
            UpdateTimer();
          }
          if(event.data=='MarkComplete')
          {
            showSpinner();
            //Mark Step Complete & Navigate to Next Step
            moveToNextStepAfterComplete = true;
            actionfunction_MarkStepComplete();
          }
          if(event.data=='CloseHelpSidebar')
          {
            let helpbar = document.getElementsByClassName('help-bar')[0];
            if (helpbar.classList.contains('opened')) toggleHelpBar();
          }
        }
      }, false);

      var currentHelpUrl ='';
      function displayHelp(helpUrl)
      {
         //If help hasn't changed don't change it
         if (currentHelpUrl == helpUrl) return;
         currentHelpUrl = helpUrl;

         if (helpUrl=='')
         {
            document.getElementById('helpicon').style.display='none';
            document.getElementById('helpopenclose').style.display='none';
            let helpbar = document.getElementsByClassName('help-bar')[0];
            if (helpbar.classList.contains('opened'))
            {
               toggleHelpBar();
            }
         }
         else
         {
            document.getElementById('helpicon').style.display='';
            document.getElementById('helparea').src=helpUrl;
            document.getElementById('helpopenclose').style.display='';
         }
      }

      function isStepVisible(elem)
      {
          var docViewTop = $('.sidebar .left-side').scrollTop();
          var docViewBottom = docViewTop + $('.sidebar .left-side').height();

          var elemTop = $(elem).offset().top;
          var elemBottom = elemTop + $(elem).height();

          return (elemBottom <= docViewBottom && elemTop >= docViewTop);
      }

      function completeInitialRender()
      {
         //Log Any Messages
         if (logMessages=='true')
         {
            setTimeout(actionfunction_LogMessages, 500);
         }

         if(!isStepVisible(document.getElementById('step_' + currentPosition))) { //Check if first not completed step is not visible to due to scroll position
            //Scroll to first not completed step
            $('.sidebar .left-side').scrollTop($('#step_' + currentPosition).offset().top - 50);
         }
      }

      function completeReRender()
      {
         if (isPageLoadErrorMessage == true)
            //Don't show the page if a controller page load error has occurred
            updateTimerStop(); //If there is an error then stop timer otherwise it will hide error message and show page again
         else {
            setChatterIcon();
            setStartCompleteColor();

            displayHelp(currentStepHelpUrl);

            //Hide Mark Complete Button
            if (currentStepStatus=='' || currentStepStatus=='Completed' || currentStepStatus=='Locked')
            {
               document.getElementById('mark_complete_button').style.display='none';
            }
            else
            {
               document.getElementById('mark_complete_button').style.display='';
               document.getElementById('completed_button').style.display='none';
            }
            if (NotificationToShow!='') showNotifications(NotificationToShow);

            if($('#infoIcon').length > 0) {
               unBindToolTip($('#infoIcon').get(0));
               bindToolTip($('#infoIcon').get(0), $('#infoIcon').data('tooltip'), null, '75%', 'lastupdatedby-helptext-show');
            }
         }
      }

      function ConfirmOnClickConfirm()
      {
         showSpinner();
         actionfunction_ConfirmProperty();
      }

      function confirmPropertyCallback()
      {
         hideSpinner();
         consolelog('confirmPropertyCallback');
         //Check if property was confirmed
         if(isPropertyConfirmed == true)
         {
            showNotifications('{!$Label.AH_UDC_Property_Confirmation}');
            actionfunction_ChangeToNextStepNotCompleted();
         }
         else
         {
            showNotifications('An error occurred confirming the property.');
         }
      }

      //Spinner Controls
      function showSpinner() {
         consolelog('showSpinner');
         $('#spinner').show();
         $('#spinner_background').show();
         $('html,body').animate({ scrollTop: 0 });
         consolelog('spinner true');
         blockNavigation = true;
      }
      function hideSpinner(){
         $('#spinner').hide();
         $('#spinner_background').hide();
         consolelog('spinner false');
         blockNavigation = false;
      }

      //show the message
      $('#notification_background').hide();
      function showNotificationsWithButtons(msg, buttons) {
         blockNavigation = true;
         showNotificationButtons = buttons;
         $('#notification_buttons_saveform').show();
         $('#notification_message').html(msg);
         $('#notification_background').show();
         $('html,body').animate({ scrollTop: 0 }); //Scroll top to show message
      }

      function showNotifications(msg) {
         consolelog('showNotifications: ' + msg);
         $('#notification_message').html(msg);
         $('#notification_background').show();
         $('html,body').animate({ scrollTop: 0 });
         setTimeout(hideNotifications, NotificationDisplayMilliseconds);
      }
      function hideNotifications()
      {
      //$('.notification_background').css( "background-color", "var(--completed-color)");
         consolelog('showNotificationsTimerEnd');
         $('#notification_buttons_saveform').hide();
         $('#notification_background').hide(); //hide notification message
         $('#notification_message').html(''); //Clear notification message
         blockNavigation = false;
      }

      function ConfirmOnClickCancel()
      {
         if (IsCommunityView==true)
         {
            window.location = returnToWelcomePageUrl;
         }
      }

      function setStartCompleteColor()
      {
         if (isPropertyConfirmed){
            let startCircles = document.getElementsByClassName('start-step-circle');
            for(var i=0; i<startCircles.length; i++)
            {
               startCircles[i].classList.add('startCompleted')
            }
         }
         if (isWorkbookCompleted){
            let completeCircles = document.getElementsByClassName('complete-step-circle');
            for(var i=0; i<completeCircles.length; i++)
            {
               completeCircles[i].classList.add('completeCompleted')
            }
         }
      }

      function Submit()
      {
         if (blockNavigation == true) return;
         showSpinner();
         actionfunction_Submit();
      };

      function submitCallback()
      {
         consolelog('NotificationToShow' + NotificationToShow);
         hideSpinner();
         showNotifications(NotificationToShow);
      }

      //Open Help in Seaprate Window on click of popout button
      function onClickHelp() {
         //Tell the parent to close the help sidebar
         var host = window.location.protocol + "//" + window.location.host;

         var helpHeight = window.screen.height - 300;
         var helpWidth = window.screen.width - 300;
         var helpTop = 200;
         var helpLeft = 150;
         if (IsCommunityView==true)
         {
            window.open(host + '/customers/AH_UDC_ViewHelp?id=' + currentStepId, 'AH_UDC_HELP').focus();
         }
         else
         {
            window.open(host + '/apex/AH_UDC_ViewHelp?id=' + currentStepId, 'AH_UDC_HELP').focus();
         }
      }
   </script>
   <script>
      function toggleSidebar() {
          let sidebar = document.getElementsByClassName('sidebar')[0]
          let helpbar = document.getElementsByClassName('help-bar')[0]
          let navbar = document.getElementsByClassName('navbar-nav')[0]
          let chevron = document.getElementsByClassName('toggle-indicator')[0]
          let logo = document.getElementsByClassName('logo')[0]
          let content = document.getElementsByClassName('content')[0]
          let stepssummary = document.getElementById('steps_summary');

          if (sidebar.classList.contains('closed')) {

              // Remove closed state classes
              sidebar.classList.remove('closed')
              logo.classList.remove('closed-sidebar')
              content.classList.remove('closed-sidebar')
              // Add opened state classes
              sidebar.classList.add('opened')
              logo.classList.add('opened-sidebar')
              content.classList.add('opened-sidebar')
              // Change chevron icon
              chevron.classList.remove('fa-chevron-right')
              chevron.classList.add('fa-chevron-left')

              stepssummary.style.display='none';
          } else {
              // Remove opened state classes
              sidebar.classList.remove('opened')
              logo.classList.remove('opened-sidebar')
              content.classList.remove('opened-sidebar')
              // Add closed state classes
              sidebar.classList.add('closed')
              logo.classList.add('closed-sidebar')
              content.classList.add('closed-sidebar')
              // Change chevron icon
              chevron.classList.remove('fa-chevron-left')
              chevron.classList.add('fa-chevron-right')

              stepssummary.style.display='';
          }
      }

   </script>
=======
<apex:component >
   <!-- Declare the attributes -->
   <apex:attribute name="WorkbookDocumentId" description="The Document ID on which chatter will be created" type="String" required="true" />   
   <script>
      var isFormAssemblySaved = false;
      var RefreshTimer;
      var moveToNextStepAfterComplete = false;
      var blockNavigation = false;
      var requestedStepPositionForConfirm;
      var showNotificationButtons; //Controls Code path after user clicks Continue or Cancel
      var stepbarScrollPosition = 0;

      function consolelog(message)
      {
         if (DisplayConsoleLogMessages) console.log(message);
      }
      function updateTimerStart(){
         //Only start the refresh timer if there isn't an error
         if (isPageLoadErrorMessage=='' && isWorkbookSent == true) RefreshTimer = setTimeout(UpdateTimer, UpdateTimerIntervalInMilliSeconds);
      }
      function updateTimerStop(){
         clearTimeout(RefreshTimer);
      }
      $(document).ready(function() {
         //Only update chatter icon if in Community View and no error has occurred
         updateTimerStart();
      });

      window.onbeforeunload = function(event) {
         if (isFormAssemblySaved == false)
         {
            //TODO: V2.X Message about navigating away
            //return "You have unsaved changes. Are you sure you want to navigate away?";
         }
      };

      var updateTimerCounter = 0;
      function UpdateTimerCallback()
      {
         updateTimerCounter++;
         consolelog('UpdateTimer CallBack: ' + updateTimerCounter);
         RefreshTimer = setTimeout(UpdateTimer, UpdateTimerIntervalInMilliSeconds);
         //Set scroll postion back to the same as it was before refreshing step data
         $('.sidebar .left-side').scrollTop(stepbarScrollPosition);
      }

      function UpdateTimer()
      {
         clearTimeout(RefreshTimer);
         consolelog("UpdateTimer: call server side: " + updateTimerCounter);
         actionfunction_UpdateTimer();
         //Get the current scroll position to set it back once step data refreshed
         stepbarScrollPosition = $('.sidebar .left-side').scrollTop();
      }

      //This is used to update the chatter Button based on if there are chatter messages
      function setChatterIcon(){
         consolelog('chatterUpdate:' + chatterUpdate );
         let chatterButton = document.getElementById('chatterButton');
         let chatterButtonImage = document.getElementById('chatterButtonImage');

         //consolelog(chatterButton);
         //consolelog(chatterButtonImage);

         //consolelog(chatterButton.classList.contains('chatterButtonUnread'));

         if (chatterUpdate==false && chatterButton.classList.contains('chatterButtonUnread')) {
            chatterButton.classList.remove('chatterButtonUnread');
            chatterButtonImage.classList.remove('fa-comment-medical');
            chatterButtonImage.classList.add('fa-comment-dots');
            consolelog('Unread');
         }
         if (chatterUpdate == true && !chatterButton.classList.contains('chatterButtonUnread')) {
            chatterButton.classList.add('chatterButtonUnread');
            chatterButtonImage.classList.remove('fa-comment-dots');
            chatterButtonImage.classList.add('fa-comment-medical');
            consolelog('Read');
         }
      }

      function MarkStepComplete(){
         if (blockNavigation == true) return;

         //Get the current scroll position to set it back once step mark complete done
         stepbarScrollPosition = $('.sidebar .left-side').scrollTop();

         //Check if current step is saved - otherwise prompt
         if(!isFormAssemblySaved)
         {
            showNotificationsWithButtons('{!$Label.AH_UDC_ViewWorkbook_VerifyFormSave}', 'MarkStepComplete');
            return;
         }

         showSpinner();
         actionfunction_MarkStepComplete();
      }
      function markStepCompleteCallback()
      {
         //TODO: ROBDEV Catch error
         //Set scroll postion back to the same as it was before marking step complete
         $('.sidebar .left-side').scrollTop(stepbarScrollPosition);
         hideSpinner();
         showNotifications(NotificationToShow);
         consolelog('markStepCompleteCallback - Step Marked Complete');
         if(moveToNextStepAfterComplete==true)
         {
            moveToNextStepAfterComplete == false;
            actionfunction_ChangeToNextStepNotCompleted();
         }
      }

      function changeToStepCallback()
      {
         hideSpinner();
         if (currentPosition > 0)
         {
            isFormAssemblySaved = false;
            $('#rmStep' + currentPosition).addClass("current-step");
         }
         else {
            //Don't display confirmation message if user is on start page or workbook completion page
            isFormAssemblySaved = true;
         }
      }

      function changeToStep(requestedStepPosition, isLocked, isPrerequisiteStepNotCompleted, prerequisiteStepPosition, prerequisiteStepName)
      {
         if (blockNavigation == true) return;

         if(IsCommunityView && isWorkbookCompleted)
         {
            showNotifications('{!$Label.AH_UDC_ViewWorkbook_SubmittedReadOnly}');
            return;
         }

         if (isPropertyConfirmed == true)
         {
            if(typeof(isLocked) != 'undefined' && isLocked.toLowerCase() == 'true')
            {
               showNotifications('{!$Label.AH_UDC_StepLockedMessage}'); //Display message and don't allow user to proceed with step
               return;
            }

            if(typeof(isPrerequisiteStepNotCompleted) != 'undefined' && isPrerequisiteStepNotCompleted.toLowerCase() == 'true')
            {
               var message = '{!$Label.AH_UDC_PrerequisiteStepNotCompletedMessage}'.replace('{0}', prerequisiteStepPosition).replace('{1}', prerequisiteStepName);
               showNotifications(message); //Display message and don't allow user to proceed with step
               return;
            }

            //Check if current step is saved - otherwise prompt
            if(!isFormAssemblySaved)
            {
               requestedStepPositionForConfirm = requestedStepPosition;
               showNotificationsWithButtons('{!$Label.AH_UDC_ViewWorkbook_VerifyFormSave}', 'ChangeToStep');
               return;
            }
            showSpinner();
            actionfunction_ChangeToStep(requestedStepPosition);
         }
         else
         {
            showNotifications('{!$Label.AH_UDC_ViewWorkbook_ConfirmPropertyFirst}');
         }
      }

      function saveformContinue()
      {
         hideNotifications();
         showSpinner();
         if(showNotificationButtons == 'ChangeToStep')
         {
            actionfunction_ChangeToStep(requestedStepPositionForConfirm);
         }
         if(showNotificationButtons == 'MarkStepComplete')
         {
            actionfunction_MarkStepComplete();
         }
         if(showNotificationButtons == 'DeleteUploadedFile')
         {
            deleteFile();
         }
      }

      function saveformCancel()
      {
         hideNotifications();
      }

      //Open blank tab on click of chatter button
      function onClickChatterButton() {
         //var tabName = getQueryStringValue('tabset-8bc76'); //Get community tab name and pass into url
         //window.open('/customers/s/sfdcpage/' + encodeURIComponent('/apex/AH_UDC_Chatter?Id={!WorkbookDocumentId}&tabset-8bc76=' + tabName), '_blank');
         var chatHeight = window.screen.height - 300;
         var chatWidth = window.screen.width - 300;
         var chatTop = 200;
         var chatLeft = 150;
         if (IsCommunityView)
         {
            chatterUpdate = false;
            setChatterIcon();
            var host = window.location.protocol + "//" + window.location.host;
            window.open(host + '/customers/AH_UDC_Chatter?id={!WorkbookDocumentId}', 'AH_UDC_CHATTER', 'location=no, width=' + chatWidth + ', height=' + chatHeight + ', top=' + chatTop + ', left=' + chatLeft);
         }
         else
         {
            window.open('/' + documentationId, 'AH_UDC_Documentation', 'location=no, width=' + chatWidth + ', height=' + chatHeight + ', top=' + chatTop + ', left=' + chatLeft);
         }
      }

      //Get query string value
      function getQueryStringValue(queryStringName) {
         var url = decodeURIComponent(window.parent.location.href);
         var arr = url.slice(url.indexOf('?') + 1).split('&');
         if(arr != null) {
            for(var i = 0; i < arr.length; i++) {
               var arrKeyValue = arr[i].split('=');
               if(arrKeyValue != null && arrKeyValue.length > 1) {
                     if(arrKeyValue[0] == queryStringName) {
                        return arrKeyValue[1];
                     }
               }
            }
         }
         return '';
      }

      //Event listener for ThankYouPage
      window.addEventListener("message", (event) => {
        consolelog('event.origin: ' + event.origin);
        consolelog('event.data: ' + event.data);
        if(event.origin == 'https://staging-mbrfp.meetingbroker.com' ||
		     event.origin == 'https://mbrfp.meetingbroker.com')
        {
          if(event.data=='ThankYouPage')
          {
            consolelog('ThankYouPage');
            $('html,body').animate({ scrollTop: 0 }); //Scroll top to show thank you
            isFormAssemblySaved = true;
            updateTimerStop();
            UpdateTimer();
          }
          if(event.data=='MarkComplete')
          {
            showSpinner();
            //Mark Step Complete & Navigate to Next Step
            moveToNextStepAfterComplete = true;
            actionfunction_MarkStepComplete();
          }
          if(event.data=='CloseHelpSidebar')
          {
            let helpbar = document.getElementsByClassName('help-bar')[0];
            if (helpbar.classList.contains('opened')) toggleHelpBar();
          }
        }
      }, false);

      var currentHelpUrl ='';
      function displayHelp(helpUrl)
      {
         //If help hasn't changed don't change it
         if (currentHelpUrl == helpUrl) return;
         currentHelpUrl = helpUrl;

         if (helpUrl=='')
         {
            document.getElementById('helpicon').style.display='none';
            document.getElementById('helpopenclose').style.display='none';
            let helpbar = document.getElementsByClassName('help-bar')[0];
            if (helpbar.classList.contains('opened'))
            {
               toggleHelpBar();
            }
         }
         else
         {
            document.getElementById('helpicon').style.display='';
            document.getElementById('helparea').src=helpUrl;
            document.getElementById('helpopenclose').style.display='';
         }
      }

      function isStepVisible(elem)
      {
         try {
            var docViewTop = $('.sidebar .left-side').scrollTop();
            var docViewBottom = docViewTop + $('.sidebar .left-side').height();

            var elemTop = $(elem).offset().top;
            var elemBottom = elemTop + $(elem).height();

            return (elemBottom <= docViewBottom && elemTop >= docViewTop);
         } 
         catch(e){
         }
      }

      function completeInitialRender()
      {
         //Log Any Messages
         if (logMessages=='true')
         {
            setTimeout(actionfunction_LogMessages, 500);
         }

         if(!isStepVisible(document.getElementById('step_' + currentPosition))) { //Check if first not completed step is not visible to due to scroll position
            //Scroll to first not completed step
            $('.sidebar .left-side').scrollTop($('#step_' + currentPosition).offset().top - 50);
         }
      }

      function completeReRender()
      {
         if (isWorkbookSent == false)
         {
            document.getElementById('mark_complete_button').style.display='none';
            document.getElementById('completed_button').style.display='none';
         }
         else
         {
            if (isPageLoadErrorMessage == true)
               //Don't show the page if a controller page load error has occurred
               updateTimerStop(); //If there is an error then stop timer otherwise it will hide error message and show page again
            else {
               setChatterIcon();
               setStartCompleteColor();

               displayHelp(currentStepHelpUrl);

               document.getElementById('mark_complete_button').style.display='none';
               document.getElementById('completed_button').style.display='none';

               //Hide Mark Complete Button
               if (isWorkbookArchived)
               {
                  document.getElementById('mark_complete_button').style.display='none';
                  document.getElementById('completed_button').style.display='none';
               }
               else if (currentStepStatus=='Completed' || currentStepStatus=='Locked')
               {
                  document.getElementById('mark_complete_button').style.display='none';
                  document.getElementById('completed_button').style.display='';
               }
               else if (currentStepStatus=='New')
               {
                  document.getElementById('mark_complete_button').style.display='none';
                  document.getElementById('completed_button').style.display='none';
               }
               else if (currentStepStatus=='In Progress')
               {
                  document.getElementById('mark_complete_button').style.display='';
                  document.getElementById('completed_button').style.display='none';
               }
               if (NotificationToShow!='') showNotifications(NotificationToShow);

               if($('#infoIcon').length > 0) {
                  unBindToolTip($('#infoIcon').get(0));
                  bindToolTip($('#infoIcon').get(0), $('#infoIcon').data('tooltip'), null, '75%', 'lastupdatedby-helptext-show');
               }
            }
         }
      }

      function ConfirmOnClickConfirm()
      {
         showSpinner();
         actionfunction_ConfirmProperty();
      }

      function confirmPropertyCallback()
      {
         hideSpinner();
         consolelog('confirmPropertyCallback');
         //Check if property was confirmed
         if(isPropertyConfirmed == true)
         {
            showNotifications('{!$Label.AH_UDC_Property_Confirmation}');
            actionfunction_ChangeToNextStepNotCompleted();
         }
         else
         {
            showNotifications('An error occurred confirming the property.');
         }
      }

      //Spinner Controls
      function showSpinner() {
         consolelog('showSpinner');
         $('#spinner').show();
         $('#spinner_background').show();
         $('html,body').animate({ scrollTop: 0 });
         consolelog('spinner true');
         blockNavigation = true;
      }
      function hideSpinner(){
         $('#spinner').hide();
         $('#spinner_background').hide();
         consolelog('spinner false');
         blockNavigation = false;
      }

      //show the message
      $('#notification_background').hide();
      function showNotificationsWithButtons(msg, buttons) {
         blockNavigation = true;
         showNotificationButtons = buttons;
         $('#notification_buttons_saveform').show();
         $('#notification_message').html(msg);
         $('#notification_background').show();
         $('html,body').animate({ scrollTop: 0 }); //Scroll top to show message
      }

      function showNotifications(msg) {
         consolelog('showNotifications: ' + msg);
         $('#notification_message').html(msg);
         $('#notification_background').show();
         $('html,body').animate({ scrollTop: 0 });
         setTimeout(hideNotifications, NotificationDisplayMilliseconds);
      }
      function hideNotifications()
      {
      //$('.notification_background').css( "background-color", "var(--completed-color)");
         consolelog('showNotificationsTimerEnd');
         $('#notification_buttons_saveform').hide();
         $('#notification_background').hide(); //hide notification message
         $('#notification_message').html(''); //Clear notification message
         blockNavigation = false;
      }

      function ConfirmOnClickCancel()
      {
         if (IsCommunityView==true)
         {
            window.location = returnToWelcomePageUrl;
         }
      }

      function setStartCompleteColor()
      {
         if (isPropertyConfirmed){
            let startCircles = document.getElementsByClassName('start-step-circle');
            for(var i=0; i<startCircles.length; i++)
            {
               startCircles[i].classList.add('startCompleted')
            }
         }
         if (isWorkbookCompleted){
            let completeCircles = document.getElementsByClassName('complete-step-circle');
            for(var i=0; i<completeCircles.length; i++)
            {
               completeCircles[i].classList.add('completeCompleted')
            }
         }
      }

      function Submit()
      {
         if (blockNavigation == true) return;
         showSpinner();
         actionfunction_Submit();
      };

      function submitCallback()
      {
         consolelog('NotificationToShow' + NotificationToShow);
         hideSpinner();
         showNotifications(NotificationToShow);
      }

      //Open Help in Seaprate Window on click of popout button
      function onClickHelp() {
         //Tell the parent to close the help sidebar
         var host = window.location.protocol + "//" + window.location.host;

         var helpHeight = window.screen.height - 300;
         var helpWidth = window.screen.width - 300;
         var helpTop = 200;
         var helpLeft = 150;
         if (IsCommunityView==true)
         {
            window.open(host + '/customers/AH_UDC_ViewHelp?id=' + currentStepId, 'AH_UDC_HELP').focus();
         }
         else
         {
            window.open(host + '/apex/AH_UDC_ViewHelp?id=' + currentStepId, 'AH_UDC_HELP').focus();
         }
      }
   </script>
   <script>
      function toggleSidebar() {
          let sidebar = document.getElementsByClassName('sidebar')[0]
          let helpbar = document.getElementsByClassName('help-bar')[0]
          let navbar = document.getElementsByClassName('navbar-nav')[0]
          let chevron = document.getElementsByClassName('toggle-indicator')[0]
          let logo = document.getElementsByClassName('logo')[0]
          let content = document.getElementsByClassName('content')[0]
          let stepssummary = document.getElementById('steps_summary');

          if (sidebar.classList.contains('closed')) {

              // Remove closed state classes
              sidebar.classList.remove('closed')
              logo.classList.remove('closed-sidebar')
              content.classList.remove('closed-sidebar')
              // Add opened state classes
              sidebar.classList.add('opened')
              logo.classList.add('opened-sidebar')
              content.classList.add('opened-sidebar')
              // Change chevron icon
              chevron.classList.remove('fa-chevron-right')
              chevron.classList.add('fa-chevron-left')

              stepssummary.style.display='none';
          } else {
              // Remove opened state classes
              sidebar.classList.remove('opened')
              logo.classList.remove('opened-sidebar')
              content.classList.remove('opened-sidebar')
              // Add closed state classes
              sidebar.classList.add('closed')
              logo.classList.add('closed-sidebar')
              content.classList.add('closed-sidebar')
              // Change chevron icon
              chevron.classList.remove('fa-chevron-left')
              chevron.classList.add('fa-chevron-right')

              stepssummary.style.display='';
          }
      }

   </script>
>>>>>>> be8f81a97d079e6e4c45f805d88969f9bcae9d8a
</apex:component>